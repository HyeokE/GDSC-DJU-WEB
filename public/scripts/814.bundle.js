/*! For license information please see 814.bundle.js.LICENSE.txt */
"use strict";(self.webpackChunkgdsc_dju_web=self.webpackChunkgdsc_dju_web||[]).push([[814],{90774:(e,t,n)=>{n.d(t,{$Y:()=>re,B0:()=>Te,FN:()=>ne,IX:()=>ue,Jt:()=>Ce,UJ:()=>M,Ym:()=>Se,a1:()=>Oe,aF:()=>Ae,bm:()=>R,cF:()=>xe,g6:()=>De,gE:()=>y,gH:()=>d,iH:()=>Re,oq:()=>Ne,pb:()=>ke,qm:()=>x,sd:()=>Ee,y4:()=>p});var r=n(32238),i=n(74444),s=n(8463);const o="firebasestorage.googleapis.com";class a extends i.ZR{constructor(e,t){super(c(e),`Firebase Storage: ${t} (${c(e)})`),this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,a.prototype)}_codeEquals(e){return c(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message=`${this._baseMessage}\n${this.customData.serverResponse}`:this.message=this._baseMessage}}function c(e){return"storage/"+e}function u(){return new a("unknown","An unknown error occurred, please check the error payload for server response.")}function l(){return new a("canceled","User canceled the upload/download.")}function h(){return new a("cannot-slice-blob","Cannot slice blob for upload. Please retry the upload.")}function d(e){return new a("invalid-argument",e)}function f(){return new a("app-deleted","The Firebase app was deleted.")}function p(e){return new a("invalid-root-operation","The operation '"+e+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}function m(e,t){return new a("invalid-format","String does not match format '"+e+"': "+t)}function g(e){throw new a("internal-error","Internal error: "+e)}class y{constructor(e,t){this.bucket=e,this.path_=t}get path(){return this.path_}get isRoot(){return 0===this.path.length}fullServerUrl(){const e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(e,t){let n;try{n=y.makeFromUrl(e,t)}catch(t){return new y(e,"")}if(""===n.path)return n;throw new a("invalid-default-bucket","Invalid default bucket '"+e+"'.")}static makeFromUrl(e,t){let n=null;const r="([A-Za-z0-9.\\-_]+)",i=new RegExp("^gs://"+r+"(/(.*))?$","i");function s(e){e.path_=decodeURIComponent(e.path)}const c=t.replace(/[.]/g,"\\."),u=[{regex:i,indices:{bucket:1,path:3},postModify:function(e){"/"===e.path.charAt(e.path.length-1)&&(e.path_=e.path_.slice(0,-1))}},{regex:new RegExp(`^https?://${c}/v[A-Za-z0-9_]+/b/${r}/o(/([^?#]*).*)?$`,"i"),indices:{bucket:1,path:3},postModify:s},{regex:new RegExp(`^https?://${t===o?"(?:storage.googleapis.com|storage.cloud.google.com)":t}/${r}/([^?#]*)`,"i"),indices:{bucket:1,path:2},postModify:s}];for(let t=0;t<u.length;t++){const r=u[t],i=r.regex.exec(e);if(i){const e=i[r.indices.bucket];let t=i[r.indices.path];t||(t=""),n=new y(e,t),r.postModify(n);break}}if(null==n)throw function(e){return new a("invalid-url","Invalid URL '"+e+"'.")}(e);return n}}class v{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(e=!1){}}function w(e){return"string"==typeof e||e instanceof String}function _(e){return b()&&e instanceof Blob}function b(){return"undefined"!=typeof Blob}function I(e,t,n,r){if(r<t)throw d(`Invalid value for '${e}'. Expected ${t} or greater.`);if(r>n)throw d(`Invalid value for '${e}'. Expected ${n} or less.`)}function T(e,t,n){let r=t;return null==n&&(r=`https://${t}`),`${n}://${r}/v0${e}`}function E(e){const t=encodeURIComponent;let n="?";for(const r in e)e.hasOwnProperty(r)&&(n=n+(t(r)+"=")+t(e[r])+"&");return n=n.slice(0,-1),n}var S;!function(e){e[e.NO_ERROR=0]="NO_ERROR",e[e.NETWORK_ERROR=1]="NETWORK_ERROR",e[e.ABORT=2]="ABORT"}(S||(S={}));class k{constructor(e,t,n,r,i,s,o,a,c,u,l){this.url_=e,this.method_=t,this.headers_=n,this.body_=r,this.successCodes_=i,this.additionalRetryCodes_=s,this.callback_=o,this.errorCallback_=a,this.timeout_=c,this.progressCallback_=u,this.connectionFactory_=l,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise(((e,t)=>{this.resolve_=e,this.reject_=t,this.start_()}))}start_(){const e=(e,t)=>{const n=this.resolve_,r=this.reject_,i=t.connection;if(t.wasSuccessCode)try{const e=this.callback_(i,i.getResponse());void 0!==e?n(e):n()}catch(e){r(e)}else if(null!==i){const e=u();e.serverResponse=i.getErrorText(),this.errorCallback_?r(this.errorCallback_(i,e)):r(e)}else t.canceled?r(this.appDelete_?f():l()):r(new a("retry-limit-exceeded","Max retry time for operation exceeded, please try again."))};this.canceled_?e(0,new A(!1,null,!0)):this.backoffId_=function(e,t,n){let r=1,i=null,s=null,o=!1,a=0;function c(){return 2===a}let u=!1;function l(...e){u||(u=!0,t.apply(null,e))}function h(t){i=setTimeout((()=>{i=null,e(f,c())}),t)}function d(){s&&clearTimeout(s)}function f(e,...t){if(u)return void d();if(e)return d(),void l.call(null,e,...t);if(c()||o)return d(),void l.call(null,e,...t);let n;r<64&&(r*=2),1===a?(a=2,n=0):n=1e3*(r+Math.random()),h(n)}let p=!1;function m(e){p||(p=!0,d(),u||(null!==i?(e||(a=2),clearTimeout(i),h(0)):e||(a=1)))}return h(0),s=setTimeout((()=>{o=!0,m(!0)}),n),m}(((e,t)=>{if(t)return void e(!1,new A(!1,null,!0));const n=this.connectionFactory_();this.pendingConnection_=n;const r=e=>{const t=e.loaded,n=e.lengthComputable?e.total:-1;null!==this.progressCallback_&&this.progressCallback_(t,n)};null!==this.progressCallback_&&n.addUploadProgressListener(r),n.send(this.url_,this.method_,this.body_,this.headers_).then((()=>{null!==this.progressCallback_&&n.removeUploadProgressListener(r),this.pendingConnection_=null;const t=n.getErrorCode()===S.NO_ERROR,i=n.getStatus();if(!t||this.isRetryStatusCode_(i)){const t=n.getErrorCode()===S.ABORT;return void e(!1,new A(!1,null,t))}const s=-1!==this.successCodes_.indexOf(i);e(!0,new A(s,n))}))}),e,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,null!==this.backoffId_&&(0,this.backoffId_)(!1),null!==this.pendingConnection_&&this.pendingConnection_.abort()}isRetryStatusCode_(e){const t=e>=500&&e<600,n=-1!==[408,429].indexOf(e),r=-1!==this.additionalRetryCodes_.indexOf(e);return t||n||r}}class A{constructor(e,t,n){this.wasSuccessCode=e,this.connection=t,this.canceled=!!n}}function C(){return"undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof WebKitBlobBuilder?WebKitBlobBuilder:void 0}function N(...e){const t=C();if(void 0!==t){const n=new t;for(let t=0;t<e.length;t++)n.append(e[t]);return n.getBlob()}if(b())return new Blob(e);throw new a("unsupported-environment","This browser doesn't seem to support creating Blobs")}const R={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"};class D{constructor(e,t){this.data=e,this.contentType=t||null}}function x(e,t){switch(e){case R.RAW:return new D(O(t));case R.BASE64:case R.BASE64URL:return new D(P(e,t));case R.DATA_URL:return new D(function(e){const t=new L(e);return t.base64?P(R.BASE64,t.rest):function(e){let t;try{t=decodeURIComponent(e)}catch(e){throw m(R.DATA_URL,"Malformed data URL.")}return O(t)}(t.rest)}(t),new L(t).contentType)}throw u()}function O(e){const t=[];for(let n=0;n<e.length;n++){let r=e.charCodeAt(n);r<=127?t.push(r):r<=2047?t.push(192|r>>6,128|63&r):55296==(64512&r)?n<e.length-1&&56320==(64512&e.charCodeAt(n+1))?(r=65536|(1023&r)<<10|1023&e.charCodeAt(++n),t.push(240|r>>18,128|r>>12&63,128|r>>6&63,128|63&r)):t.push(239,191,189):56320==(64512&r)?t.push(239,191,189):t.push(224|r>>12,128|r>>6&63,128|63&r)}return new Uint8Array(t)}function P(e,t){switch(e){case R.BASE64:{const n=-1!==t.indexOf("-"),r=-1!==t.indexOf("_");if(n||r)throw m(e,"Invalid character '"+(n?"-":"_")+"' found: is it base64url encoded?");break}case R.BASE64URL:{const n=-1!==t.indexOf("+"),r=-1!==t.indexOf("/");if(n||r)throw m(e,"Invalid character '"+(n?"+":"/")+"' found: is it base64 encoded?");t=t.replace(/-/g,"+").replace(/_/g,"/");break}}let n;try{n=atob(t)}catch(t){throw m(e,"Invalid character found")}const r=new Uint8Array(n.length);for(let e=0;e<n.length;e++)r[e]=n.charCodeAt(e);return r}class L{constructor(e){this.base64=!1,this.contentType=null;const t=e.match(/^data:([^,]+)?,/);if(null===t)throw m(R.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");const n=t[1]||null;var r,i;null!=n&&(this.base64=(i=";base64",(r=n).length>=i.length&&r.substring(r.length-i.length)===i),this.contentType=this.base64?n.substring(0,n.length-";base64".length):n),this.rest=e.substring(e.indexOf(",")+1)}}class M{constructor(e,t){let n=0,r="";_(e)?(this.data_=e,n=e.size,r=e.type):e instanceof ArrayBuffer?(t?this.data_=new Uint8Array(e):(this.data_=new Uint8Array(e.byteLength),this.data_.set(new Uint8Array(e))),n=this.data_.length):e instanceof Uint8Array&&(t?this.data_=e:(this.data_=new Uint8Array(e.length),this.data_.set(e)),n=e.length),this.size_=n,this.type_=r}size(){return this.size_}type(){return this.type_}slice(e,t){if(_(this.data_)){const s=(n=this.data_,r=e,i=t,n.webkitSlice?n.webkitSlice(r,i):n.mozSlice?n.mozSlice(r,i):n.slice?n.slice(r,i):null);return null===s?null:new M(s)}var n,r,i;{const n=new Uint8Array(this.data_.buffer,e,t-e);return new M(n,!0)}}static getBlob(...e){if(b()){const t=e.map((e=>e instanceof M?e.data_:e));return new M(N.apply(null,t))}{const t=e.map((e=>w(e)?x(R.RAW,e).data:e.data_));let n=0;t.forEach((e=>{n+=e.byteLength}));const r=new Uint8Array(n);let i=0;return t.forEach((e=>{for(let t=0;t<e.length;t++)r[i++]=e[t]})),new M(r,!0)}}uploadData(){return this.data_}}function U(e){let t;try{t=JSON.parse(e)}catch(e){return null}return"object"!=typeof(n=t)||Array.isArray(n)?null:t;var n}function F(e){const t=e.lastIndexOf("/",e.length-2);return-1===t?e:e.slice(t+1)}function V(e,t){return t}class q{constructor(e,t,n,r){this.server=e,this.local=t||e,this.writable=!!n,this.xform=r||V}}let B=null;function j(){if(B)return B;const e=[];e.push(new q("bucket")),e.push(new q("generation")),e.push(new q("metageneration")),e.push(new q("name","fullPath",!0));const t=new q("name");t.xform=function(e,t){return function(e){return!w(e)||e.length<2?e:F(e)}(t)},e.push(t);const n=new q("size");return n.xform=function(e,t){return void 0!==t?Number(t):t},e.push(n),e.push(new q("timeCreated")),e.push(new q("updated")),e.push(new q("md5Hash",null,!0)),e.push(new q("cacheControl",null,!0)),e.push(new q("contentDisposition",null,!0)),e.push(new q("contentEncoding",null,!0)),e.push(new q("contentLanguage",null,!0)),e.push(new q("contentType",null,!0)),e.push(new q("metadata","customMetadata",!0)),B=e,B}function $(e,t,n){const r=U(t);return null===r?null:function(e,t,n){const r={type:"file"},i=n.length;for(let e=0;e<i;e++){const i=n[e];r[i.local]=i.xform(r,t[i.server])}return function(e,t){Object.defineProperty(e,"ref",{get:function(){const n=e.bucket,r=e.fullPath,i=new y(n,r);return t._makeStorageReference(i)}})}(r,e),r}(e,r,n)}function z(e,t){const n={},r=t.length;for(let i=0;i<r;i++){const r=t[i];r.writable&&(n[r.server]=e[r.local])}return JSON.stringify(n)}class G{constructor(e,t,n,r){this.url=e,this.method=t,this.handler=n,this.timeout=r,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}}function K(e){if(!e)throw u()}function H(e,t){return function(n,r){const i=$(e,r,t);return K(null!==i),i}}function W(e){return function(t,n){let r;var i,s;return 401===t.getStatus()?r=t.getErrorText().includes("Firebase App Check token is invalid")?new a("unauthorized-app","This app does not have permission to access Firebase Storage on this project."):new a("unauthenticated","User is not authenticated, please authenticate using Firebase Authentication and try again."):402===t.getStatus()?(s=e.bucket,r=new a("quota-exceeded","Quota for bucket '"+s+"' exceeded, please view quota on https://firebase.google.com/pricing/.")):403===t.getStatus()?(i=e.path,r=new a("unauthorized","User does not have permission to access '"+i+"'.")):r=n,r.serverResponse=n.serverResponse,r}}function Y(e){const t=W(e);return function(n,r){let i=t(n,r);var s;return 404===n.getStatus()&&(s=e.path,i=new a("object-not-found","Object '"+s+"' does not exist.")),i.serverResponse=r.serverResponse,i}}function Q(e,t,n){const r=T(t.fullServerUrl(),e.host,e._protocol),i=e.maxOperationRetryTime,s=new G(r,"GET",H(e,n),i);return s.errorHandler=Y(t),s}function X(e,t,n,r,i){const s={};t.isRoot?s.prefix="":s.prefix=t.path+"/",n&&n.length>0&&(s.delimiter=n),r&&(s.pageToken=r),i&&(s.maxResults=i);const o=T(t.bucketOnlyServerUrl(),e.host,e._protocol),a=e.maxOperationRetryTime,c=new G(o,"GET",function(e,t){return function(n,r){const i=function(e,t,n){const r=U(n);return null===r?null:function(e,t,n){const r={prefixes:[],items:[],nextPageToken:n.nextPageToken};if(n.prefixes)for(const i of n.prefixes){const n=i.replace(/\/$/,""),s=e._makeStorageReference(new y(t,n));r.prefixes.push(s)}if(n.items)for(const i of n.items){const n=e._makeStorageReference(new y(t,i.name));r.items.push(n)}return r}(e,t,r)}(e,t,r);return K(null!==i),i}}(e,t.bucket),a);return c.urlParams=s,c.errorHandler=W(t),c}function J(e,t,n){const r=Object.assign({},n);return r.fullPath=e.path,r.size=t.size(),r.contentType||(r.contentType=function(e,t){return t&&t.type()||"application/octet-stream"}(0,t)),r}class Z{constructor(e,t,n,r){this.current=e,this.total=t,this.finalized=!!n,this.metadata=r||null}}function ee(e,t){let n=null;try{n=e.getResponseHeader("X-Goog-Upload-Status")}catch(e){K(!1)}return K(!!n&&-1!==(t||["active"]).indexOf(n)),n}const te=262144;const ne={STATE_CHANGED:"state_changed"},re={RUNNING:"running",PAUSED:"paused",SUCCESS:"success",CANCELED:"canceled",ERROR:"error"};function ie(e){switch(e){case"running":case"pausing":case"canceling":return re.RUNNING;case"paused":return re.PAUSED;case"success":return re.SUCCESS;case"canceled":return re.CANCELED;default:return re.ERROR}}class se{constructor(e,t,n){if("function"==typeof e||null!=t||null!=n)this.next=e,this.error=null!=t?t:void 0,this.complete=null!=n?n:void 0;else{const t=e;this.next=t.next,this.error=t.error,this.complete=t.complete}}}function oe(e){return(...t)=>{Promise.resolve().then((()=>e(...t)))}}class ae extends class{constructor(){this.sent_=!1,this.xhr_=new XMLHttpRequest,this.initXhr(),this.errorCode_=S.NO_ERROR,this.sendPromise_=new Promise((e=>{this.xhr_.addEventListener("abort",(()=>{this.errorCode_=S.ABORT,e()})),this.xhr_.addEventListener("error",(()=>{this.errorCode_=S.NETWORK_ERROR,e()})),this.xhr_.addEventListener("load",(()=>{e()}))}))}send(e,t,n,r){if(this.sent_)throw g("cannot .send() more than once");if(this.sent_=!0,this.xhr_.open(t,e,!0),void 0!==r)for(const e in r)r.hasOwnProperty(e)&&this.xhr_.setRequestHeader(e,r[e].toString());return void 0!==n?this.xhr_.send(n):this.xhr_.send(),this.sendPromise_}getErrorCode(){if(!this.sent_)throw g("cannot .getErrorCode() before sending");return this.errorCode_}getStatus(){if(!this.sent_)throw g("cannot .getStatus() before sending");try{return this.xhr_.status}catch(e){return-1}}getResponse(){if(!this.sent_)throw g("cannot .getResponse() before sending");return this.xhr_.response}getErrorText(){if(!this.sent_)throw g("cannot .getErrorText() before sending");return this.xhr_.statusText}abort(){this.xhr_.abort()}getResponseHeader(e){return this.xhr_.getResponseHeader(e)}addUploadProgressListener(e){null!=this.xhr_.upload&&this.xhr_.upload.addEventListener("progress",e)}removeUploadProgressListener(e){null!=this.xhr_.upload&&this.xhr_.upload.removeEventListener("progress",e)}}{initXhr(){this.xhr_.responseType="text"}}function ce(){return new ae}class ue{constructor(e,t,n=null){this._transferred=0,this._needToFetchStatus=!1,this._needToFetchMetadata=!1,this._observers=[],this._error=void 0,this._uploadUrl=void 0,this._request=void 0,this._chunkMultiplier=1,this._resolve=void 0,this._reject=void 0,this._ref=e,this._blob=t,this._metadata=n,this._mappings=j(),this._resumable=this._shouldDoResumable(this._blob),this._state="running",this._errorHandler=e=>{this._request=void 0,this._chunkMultiplier=1,e._codeEquals("canceled")?(this._needToFetchStatus=!0,this.completeTransitions_()):(this._error=e,this._transition("error"))},this._metadataErrorHandler=e=>{this._request=void 0,e._codeEquals("canceled")?this.completeTransitions_():(this._error=e,this._transition("error"))},this._promise=new Promise(((e,t)=>{this._resolve=e,this._reject=t,this._start()})),this._promise.then(null,(()=>{}))}_makeProgressCallback(){const e=this._transferred;return t=>this._updateProgress(e+t)}_shouldDoResumable(e){return e.size()>262144}_start(){"running"===this._state&&void 0===this._request&&(this._resumable?void 0===this._uploadUrl?this._createResumable():this._needToFetchStatus?this._fetchStatus():this._needToFetchMetadata?this._fetchMetadata():this._continueUpload():this._oneShotUpload())}_resolveToken(e){Promise.all([this._ref.storage._getAuthToken(),this._ref.storage._getAppCheckToken()]).then((([t,n])=>{switch(this._state){case"running":e(t,n);break;case"canceling":this._transition("canceled");break;case"pausing":this._transition("paused")}}))}_createResumable(){this._resolveToken(((e,t)=>{const n=function(e,t,n,r,i){const s=t.bucketOnlyServerUrl(),o=J(t,r,i),a={name:o.fullPath},c=T(s,e.host,e._protocol),u={"X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":`${r.size()}`,"X-Goog-Upload-Header-Content-Type":o.contentType,"Content-Type":"application/json; charset=utf-8"},l=z(o,n),h=e.maxUploadRetryTime,d=new G(c,"POST",(function(e){let t;ee(e);try{t=e.getResponseHeader("X-Goog-Upload-URL")}catch(e){K(!1)}return K(w(t)),t}),h);return d.urlParams=a,d.headers=u,d.body=l,d.errorHandler=W(t),d}(this._ref.storage,this._ref._location,this._mappings,this._blob,this._metadata),r=this._ref.storage._makeRequest(n,ce,e,t);this._request=r,r.getPromise().then((e=>{this._request=void 0,this._uploadUrl=e,this._needToFetchStatus=!1,this.completeTransitions_()}),this._errorHandler)}))}_fetchStatus(){const e=this._uploadUrl;this._resolveToken(((t,n)=>{const r=function(e,t,n,r){const i=e.maxUploadRetryTime,s=new G(n,"POST",(function(e){const t=ee(e,["active","final"]);let n=null;try{n=e.getResponseHeader("X-Goog-Upload-Size-Received")}catch(e){K(!1)}n||K(!1);const i=Number(n);return K(!isNaN(i)),new Z(i,r.size(),"final"===t)}),i);return s.headers={"X-Goog-Upload-Command":"query"},s.errorHandler=W(t),s}(this._ref.storage,this._ref._location,e,this._blob),i=this._ref.storage._makeRequest(r,ce,t,n);this._request=i,i.getPromise().then((e=>{e=e,this._request=void 0,this._updateProgress(e.current),this._needToFetchStatus=!1,e.finalized&&(this._needToFetchMetadata=!0),this.completeTransitions_()}),this._errorHandler)}))}_continueUpload(){const e=te*this._chunkMultiplier,t=new Z(this._transferred,this._blob.size()),n=this._uploadUrl;this._resolveToken(((r,i)=>{let s;try{s=function(e,t,n,r,i,s,o,c){const u=new Z(0,0);if(o?(u.current=o.current,u.total=o.total):(u.current=0,u.total=r.size()),r.size()!==u.total)throw new a("server-file-wrong-size","Server recorded incorrect upload file size, please retry the upload.");const l=u.total-u.current;let d=l;i>0&&(d=Math.min(d,i));const f=u.current,p=f+d,m={"X-Goog-Upload-Command":d===l?"upload, finalize":"upload","X-Goog-Upload-Offset":`${u.current}`},g=r.slice(f,p);if(null===g)throw h();const y=t.maxUploadRetryTime,v=new G(n,"POST",(function(e,n){const i=ee(e,["active","final"]),o=u.current+d,a=r.size();let c;return c="final"===i?H(t,s)(e,n):null,new Z(o,a,"final"===i,c)}),y);return v.headers=m,v.body=g.uploadData(),v.progressCallback=c||null,v.errorHandler=W(e),v}(this._ref._location,this._ref.storage,n,this._blob,e,this._mappings,t,this._makeProgressCallback())}catch(e){return this._error=e,void this._transition("error")}const o=this._ref.storage._makeRequest(s,ce,r,i);this._request=o,o.getPromise().then((e=>{this._increaseMultiplier(),this._request=void 0,this._updateProgress(e.current),e.finalized?(this._metadata=e.metadata,this._transition("success")):this.completeTransitions_()}),this._errorHandler)}))}_increaseMultiplier(){te*this._chunkMultiplier<33554432&&(this._chunkMultiplier*=2)}_fetchMetadata(){this._resolveToken(((e,t)=>{const n=Q(this._ref.storage,this._ref._location,this._mappings),r=this._ref.storage._makeRequest(n,ce,e,t);this._request=r,r.getPromise().then((e=>{this._request=void 0,this._metadata=e,this._transition("success")}),this._metadataErrorHandler)}))}_oneShotUpload(){this._resolveToken(((e,t)=>{const n=function(e,t,n,r,i){const s=t.bucketOnlyServerUrl(),o={"X-Goog-Upload-Protocol":"multipart"},a=function(){let e="";for(let t=0;t<2;t++)e+=Math.random().toString().slice(2);return e}();o["Content-Type"]="multipart/related; boundary="+a;const c=J(t,r,i),u="--"+a+"\r\nContent-Type: application/json; charset=utf-8\r\n\r\n"+z(c,n)+"\r\n--"+a+"\r\nContent-Type: "+c.contentType+"\r\n\r\n",l="\r\n--"+a+"--",d=M.getBlob(u,r,l);if(null===d)throw h();const f={name:c.fullPath},p=T(s,e.host,e._protocol),m=e.maxUploadRetryTime,g=new G(p,"POST",H(e,n),m);return g.urlParams=f,g.headers=o,g.body=d.uploadData(),g.errorHandler=W(t),g}(this._ref.storage,this._ref._location,this._mappings,this._blob,this._metadata),r=this._ref.storage._makeRequest(n,ce,e,t);this._request=r,r.getPromise().then((e=>{this._request=void 0,this._metadata=e,this._updateProgress(this._blob.size()),this._transition("success")}),this._errorHandler)}))}_updateProgress(e){const t=this._transferred;this._transferred=e,this._transferred!==t&&this._notifyObservers()}_transition(e){if(this._state!==e)switch(e){case"canceling":case"pausing":this._state=e,void 0!==this._request&&this._request.cancel();break;case"running":const t="paused"===this._state;this._state=e,t&&(this._notifyObservers(),this._start());break;case"paused":case"error":case"success":this._state=e,this._notifyObservers();break;case"canceled":this._error=l(),this._state=e,this._notifyObservers()}}completeTransitions_(){switch(this._state){case"pausing":this._transition("paused");break;case"canceling":this._transition("canceled");break;case"running":this._start()}}get snapshot(){const e=ie(this._state);return{bytesTransferred:this._transferred,totalBytes:this._blob.size(),state:e,metadata:this._metadata,task:this,ref:this._ref}}on(e,t,n,r){const i=new se(t||void 0,n||void 0,r||void 0);return this._addObserver(i),()=>{this._removeObserver(i)}}then(e,t){return this._promise.then(e,t)}catch(e){return this.then(null,e)}_addObserver(e){this._observers.push(e),this._notifyObserver(e)}_removeObserver(e){const t=this._observers.indexOf(e);-1!==t&&this._observers.splice(t,1)}_notifyObservers(){this._finishPromise(),this._observers.slice().forEach((e=>{this._notifyObserver(e)}))}_finishPromise(){if(void 0!==this._resolve){let e=!0;switch(ie(this._state)){case re.SUCCESS:oe(this._resolve.bind(null,this.snapshot))();break;case re.CANCELED:case re.ERROR:oe(this._reject.bind(null,this._error))();break;default:e=!1}e&&(this._resolve=void 0,this._reject=void 0)}}_notifyObserver(e){switch(ie(this._state)){case re.RUNNING:case re.PAUSED:e.next&&oe(e.next.bind(e,this.snapshot))();break;case re.SUCCESS:e.complete&&oe(e.complete.bind(e))();break;case re.CANCELED:case re.ERROR:default:e.error&&oe(e.error.bind(e,this._error))()}}resume(){const e="paused"===this._state||"pausing"===this._state;return e&&this._transition("running"),e}pause(){const e="running"===this._state;return e&&this._transition("pausing"),e}cancel(){const e="running"===this._state||"pausing"===this._state;return e&&this._transition("canceling"),e}}class le{constructor(e,t){this._service=e,this._location=t instanceof y?t:y.makeFromUrl(t,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,t){return new le(e,t)}get root(){const e=new y(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return F(this._location.path)}get storage(){return this._service}get parent(){const e=function(e){if(0===e.length)return null;const t=e.lastIndexOf("/");return-1===t?"":e.slice(0,t)}(this._location.path);if(null===e)return null;const t=new y(this._location.bucket,e);return new le(this._service,t)}_throwIfRoot(e){if(""===this._location.path)throw p(e)}}function he(e){const t={prefixes:[],items:[]};return de(e,t).then((()=>t))}async function de(e,t,n){const r={pageToken:n},i=await fe(e,r);t.prefixes.push(...i.prefixes),t.items.push(...i.items),null!=i.nextPageToken&&await de(e,t,i.nextPageToken)}function fe(e,t){null!=t&&"number"==typeof t.maxResults&&I("options.maxResults",1,1e3,t.maxResults);const n=t||{},r=X(e.storage,e._location,"/",n.pageToken,n.maxResults);return e.storage.makeRequestWithTokens(r,ce)}function pe(e){e._throwIfRoot("getDownloadURL");const t=function(e,t,n){const r=T(t.fullServerUrl(),e.host,e._protocol),i=e.maxOperationRetryTime,s=new G(r,"GET",function(e,t){return function(n,r){const i=$(e,r,t);return K(null!==i),function(e,t,n,r){const i=U(t);if(null===i)return null;if(!w(i.downloadTokens))return null;const s=i.downloadTokens;if(0===s.length)return null;const o=encodeURIComponent;return s.split(",").map((t=>{const i=e.bucket,s=e.fullPath;return T("/b/"+o(i)+"/o/"+o(s),n,r)+E({alt:"media",token:t})}))[0]}(i,r,e.host,e._protocol)}}(e,n),i);return s.errorHandler=Y(t),s}(e.storage,e._location,j());return e.storage.makeRequestWithTokens(t,ce).then((e=>{if(null===e)throw new a("no-download-url","The given file does not have any download URLs.");return e}))}function me(e,t){const n=function(e,t){const n=t.split("/").filter((e=>e.length>0)).join("/");return 0===e.length?n:e+"/"+n}(e._location.path,t),r=new y(e._location.bucket,n);return new le(e.storage,r)}function ge(e,t){if(e instanceof we){const n=e;if(null==n._bucket)throw new a("no-default-bucket","No default bucket found. Did you set the 'storageBucket' property when initializing the app?");const r=new le(n,n._bucket);return null!=t?ge(r,t):r}return void 0!==t?me(e,t):e}function ye(e,t){if(t&&/^[A-Za-z]+:\/\//.test(t)){if(e instanceof we)return new le(e,t);throw d("To use ref(service, url), the first argument must be a Storage instance.")}return ge(e,t)}function ve(e,t){const n=null==t?void 0:t.storageBucket;return null==n?null:y.makeFromBucketSpec(n,e)}class we{constructor(e,t,n,r,i){this.app=e,this._authProvider=t,this._appCheckProvider=n,this._url=r,this._firebaseVersion=i,this._bucket=null,this._host=o,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=12e4,this._maxUploadRetryTime=6e5,this._requests=new Set,this._bucket=null!=r?y.makeFromBucketSpec(r,this._host):ve(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,null!=this._url?this._bucket=y.makeFromBucketSpec(this._url,e):this._bucket=ve(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){I("time",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){I("time",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const e=this._authProvider.getImmediate({optional:!0});if(e){const t=await e.getToken();if(null!==t)return t.accessToken}return null}async _getAppCheckToken(){const e=this._appCheckProvider.getImmediate({optional:!0});return e?(await e.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach((e=>e.cancel())),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new le(this,e)}_makeRequest(e,t,n,r){if(this._deleted)return new v(f());{const i=function(e,t,n,r,i,s){const o=E(e.urlParams),a=e.url+o,c=Object.assign({},e.headers);return function(e,t){t&&(e["X-Firebase-GMPID"]=t)}(c,t),function(e,t){null!==t&&t.length>0&&(e.Authorization="Firebase "+t)}(c,n),function(e,t){e["X-Firebase-Storage-Version"]="webjs/"+(null!=t?t:"AppManager")}(c,s),function(e,t){null!==t&&(e["X-Firebase-AppCheck"]=t)}(c,r),new k(a,e.method,c,e.body,e.successCodes,e.additionalRetryCodes,e.handler,e.errorHandler,e.timeout,e.progressCallback,i)}(e,this._appId,n,r,t,this._firebaseVersion);return this._requests.add(i),i.getPromise().then((()=>this._requests.delete(i)),(()=>this._requests.delete(i))),i}}async makeRequestWithTokens(e,t){const[n,r]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,t,n,r).getPromise()}}const _e="@firebase/storage",be="0.9.5",Ie="storage";function Te(e,t,n){return function(e,t,n){return e._throwIfRoot("uploadBytesResumable"),new ue(e,new M(t),n)}(e=(0,i.m9)(e),t,n)}function Ee(e){return function(e){e._throwIfRoot("getMetadata");const t=Q(e.storage,e._location,j());return e.storage.makeRequestWithTokens(t,ce)}(e=(0,i.m9)(e))}function Se(e,t){return function(e,t){e._throwIfRoot("updateMetadata");const n=function(e,t,n,r){const i=T(t.fullServerUrl(),e.host,e._protocol),s=z(n,r),o=e.maxOperationRetryTime,a=new G(i,"PATCH",H(e,r),o);return a.headers={"Content-Type":"application/json; charset=utf-8"},a.body=s,a.errorHandler=Y(t),a}(e.storage,e._location,t,j());return e.storage.makeRequestWithTokens(n,ce)}(e=(0,i.m9)(e),t)}function ke(e,t){return fe(e=(0,i.m9)(e),t)}function Ae(e){return he(e=(0,i.m9)(e))}function Ce(e){return pe(e=(0,i.m9)(e))}function Ne(e){return function(e){e._throwIfRoot("deleteObject");const t=function(e,t){const n=T(t.fullServerUrl(),e.host,e._protocol),r=e.maxOperationRetryTime,i=new G(n,"DELETE",(function(e,t){}),r);return i.successCodes=[200,204],i.errorHandler=Y(t),i}(e.storage,e._location);return e.storage.makeRequestWithTokens(t,ce)}(e=(0,i.m9)(e))}function Re(e,t){return ye(e=(0,i.m9)(e),t)}function De(e,t){return me(e,t)}function xe(e=(0,r.getApp)(),t){return e=(0,i.m9)(e),(0,r._getProvider)(e,Ie).getImmediate({identifier:t})}function Oe(e,t,n,r={}){!function(e,t,n,r={}){e.host=`${t}:${n}`,e._protocol="http";const{mockUserToken:s}=r;s&&(e._overrideAuthToken="string"==typeof s?s:(0,i.Sg)(s,e.app.options.projectId))}(e,t,n,r)}(0,r._registerComponent)(new s.wA(Ie,(function(e,{instanceIdentifier:t}){const n=e.getProvider("app").getImmediate(),i=e.getProvider("auth-internal"),s=e.getProvider("app-check-internal");return new we(n,i,s,t,r.SDK_VERSION)}),"PUBLIC").setMultipleInstances(!0)),(0,r.registerVersion)(_e,be,""),(0,r.registerVersion)(_e,be,"esm2017")},74444:(e,t,n)=>{n.d(t,{BH:()=>c,G6:()=>w,L:()=>s,LL:()=>T,Mn:()=>v,Sg:()=>u,UG:()=>d,X3:()=>B,ZB:()=>a,ZR:()=>I,b$:()=>m,d:()=>g,eu:()=>b,hl:()=>_,jU:()=>f,m9:()=>L,ne:()=>x,pd:()=>D,r3:()=>S,ru:()=>p,tV:()=>o,uI:()=>h,vZ:()=>A,w1:()=>y,xO:()=>N,xb:()=>k,z$:()=>l,zd:()=>R});const r=function(e){const t=[];let n=0;for(let r=0;r<e.length;r++){let i=e.charCodeAt(r);i<128?t[n++]=i:i<2048?(t[n++]=i>>6|192,t[n++]=63&i|128):55296==(64512&i)&&r+1<e.length&&56320==(64512&e.charCodeAt(r+1))?(i=65536+((1023&i)<<10)+(1023&e.charCodeAt(++r)),t[n++]=i>>18|240,t[n++]=i>>12&63|128,t[n++]=i>>6&63|128,t[n++]=63&i|128):(t[n++]=i>>12|224,t[n++]=i>>6&63|128,t[n++]=63&i|128)}return t},i={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let t=0;t<e.length;t+=3){const i=e[t],s=t+1<e.length,o=s?e[t+1]:0,a=t+2<e.length,c=a?e[t+2]:0,u=i>>2,l=(3&i)<<4|o>>4;let h=(15&o)<<2|c>>6,d=63&c;a||(d=64,s||(h=64)),r.push(n[u],n[l],n[h],n[d])}return r.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(r(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):function(e){const t=[];let n=0,r=0;for(;n<e.length;){const i=e[n++];if(i<128)t[r++]=String.fromCharCode(i);else if(i>191&&i<224){const s=e[n++];t[r++]=String.fromCharCode((31&i)<<6|63&s)}else if(i>239&&i<365){const s=((7&i)<<18|(63&e[n++])<<12|(63&e[n++])<<6|63&e[n++])-65536;t[r++]=String.fromCharCode(55296+(s>>10)),t[r++]=String.fromCharCode(56320+(1023&s))}else{const s=e[n++],o=e[n++];t[r++]=String.fromCharCode((15&i)<<12|(63&s)<<6|63&o)}}return t.join("")}(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();const n=t?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let t=0;t<e.length;){const i=n[e.charAt(t++)],s=t<e.length?n[e.charAt(t)]:0;++t;const o=t<e.length?n[e.charAt(t)]:64;++t;const a=t<e.length?n[e.charAt(t)]:64;if(++t,null==i||null==s||null==o||null==a)throw Error();const c=i<<2|s>>4;if(r.push(c),64!==o){const e=s<<4&240|o>>2;if(r.push(e),64!==a){const e=o<<6&192|a;r.push(e)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}},s=function(e){return function(e){const t=r(e);return i.encodeByteArray(t,!0)}(e).replace(/\./g,"")},o=function(e){try{return i.decodeString(e,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function a(e,t){if(!(t instanceof Object))return t;switch(t.constructor){case Date:return new Date(t.getTime());case Object:void 0===e&&(e={});break;case Array:e=[];break;default:return t}for(const n in t)t.hasOwnProperty(n)&&"__proto__"!==n&&(e[n]=a(e[n],t[n]));return e}class c{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}wrapCallback(e){return(t,n)=>{t?this.reject(t):this.resolve(n),"function"==typeof e&&(this.promise.catch((()=>{})),1===e.length?e(t):e(t,n))}}}function u(e,t){if(e.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n=t||"demo-project",r=e.iat||0,i=e.sub||e.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o=Object.assign({iss:`https://securetoken.google.com/${n}`,aud:n,iat:r,exp:r+3600,auth_time:r,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}}},e);return[s(JSON.stringify({alg:"none",type:"JWT"})),s(JSON.stringify(o)),""].join(".")}function l(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function h(){return"undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(l())}function d(){try{return"[object process]"===Object.prototype.toString.call(n.g.process)}catch(e){return!1}}function f(){return"object"==typeof self&&self.self===self}function p(){const e="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof e&&void 0!==e.id}function m(){return"object"==typeof navigator&&"ReactNative"===navigator.product}function g(){return l().indexOf("Electron/")>=0}function y(){const e=l();return e.indexOf("MSIE ")>=0||e.indexOf("Trident/")>=0}function v(){return l().indexOf("MSAppHost/")>=0}function w(){return!d()&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function _(){return"object"==typeof indexedDB}function b(){return new Promise(((e,t)=>{try{let n=!0;const r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),n||self.indexedDB.deleteDatabase(r),e(!0)},i.onupgradeneeded=()=>{n=!1},i.onerror=()=>{var e;t((null===(e=i.error)||void 0===e?void 0:e.message)||"")}}catch(e){t(e)}}))}class I extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,I.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,T.prototype.create)}}class T{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e,...t){const n=t[0]||{},r=`${this.service}/${e}`,i=this.errors[e],s=i?function(e,t){return e.replace(E,((e,n)=>{const r=t[n];return null!=r?String(r):`<${n}?>`}))}(i,n):"Error",o=`${this.serviceName}: ${s} (${r}).`;return new I(r,o,n)}}const E=/\{\$([^}]+)}/g;function S(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function k(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}function A(e,t){if(e===t)return!0;const n=Object.keys(e),r=Object.keys(t);for(const i of n){if(!r.includes(i))return!1;const n=e[i],s=t[i];if(C(n)&&C(s)){if(!A(n,s))return!1}else if(n!==s)return!1}for(const e of r)if(!n.includes(e))return!1;return!0}function C(e){return null!==e&&"object"==typeof e}function N(e){const t=[];for(const[n,r]of Object.entries(e))Array.isArray(r)?r.forEach((e=>{t.push(encodeURIComponent(n)+"="+encodeURIComponent(e))})):t.push(encodeURIComponent(n)+"="+encodeURIComponent(r));return t.length?"&"+t.join("&"):""}function R(e){const t={};return e.replace(/^\?/,"").split("&").forEach((e=>{if(e){const[n,r]=e.split("=");t[decodeURIComponent(n)]=decodeURIComponent(r)}})),t}function D(e){const t=e.indexOf("?");if(!t)return"";const n=e.indexOf("#",t);return e.substring(t,n>0?n:void 0)}function x(e,t){const n=new O(e,t);return n.subscribe.bind(n)}class O{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then((()=>{e(this)})).catch((e=>{this.error(e)}))}next(e){this.forEachObserver((t=>{t.next(e)}))}error(e){this.forEachObserver((t=>{t.error(e)})),this.close(e)}complete(){this.forEachObserver((e=>{e.complete()})),this.close()}subscribe(e,t,n){let r;if(void 0===e&&void 0===t&&void 0===n)throw new Error("Missing Observer.");r=function(e,t){if("object"!=typeof e||null===e)return!1;for(const t of["next","error","complete"])if(t in e&&"function"==typeof e[t])return!0;return!1}(e)?e:{next:e,error:t,complete:n},void 0===r.next&&(r.next=P),void 0===r.error&&(r.error=P),void 0===r.complete&&(r.complete=P);const i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then((()=>{try{this.finalError?r.error(this.finalError):r.complete()}catch(e){}})),this.observers.push(r),i}unsubscribeOne(e){void 0!==this.observers&&void 0!==this.observers[e]&&(delete this.observers[e],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then((()=>{if(void 0!==this.observers&&void 0!==this.observers[e])try{t(this.observers[e])}catch(e){"undefined"!=typeof console&&console.error&&console.error(e)}}))}close(e){this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then((()=>{this.observers=void 0,this.onNoObservers=void 0})))}}function P(){}function L(e){return e&&e._delegate?e._delegate:e}function M(e,t){return new Promise(((n,r)=>{e.onsuccess=e=>{n(e.target.result)},e.onerror=e=>{var n;r(`${t}: ${null===(n=e.target.error)||void 0===n?void 0:n.message}`)}}))}class U{constructor(e){this._db=e,this.objectStoreNames=this._db.objectStoreNames}transaction(e,t="readonly"){return new F(this._db.transaction.call(this._db,e,t))}createObjectStore(e,t){return new V(this._db.createObjectStore(e,t))}close(){this._db.close()}}class F{constructor(e){this._transaction=e,this.complete=new Promise(((e,t)=>{this._transaction.oncomplete=function(){e()},this._transaction.onerror=()=>{t(this._transaction.error)},this._transaction.onabort=()=>{t(this._transaction.error)}}))}objectStore(e){return new V(this._transaction.objectStore(e))}}class V{constructor(e){this._store=e}index(e){return new q(this._store.index(e))}createIndex(e,t,n){return new q(this._store.createIndex(e,t,n))}get(e){return M(this._store.get(e),"Error reading from IndexedDB")}put(e,t){return M(this._store.put(e,t),"Error writing to IndexedDB")}delete(e){return M(this._store.delete(e),"Error deleting from IndexedDB")}clear(){return M(this._store.clear(),"Error clearing IndexedDB object store")}}class q{constructor(e){this._index=e}get(e){return M(this._index.get(e),"Error reading from IndexedDB")}}function B(e,t,n){return new Promise(((r,i)=>{try{const s=indexedDB.open(e,t);s.onsuccess=e=>{r(new U(e.target.result))},s.onerror=e=>{var t;i(`Error opening indexedDB: ${null===(t=e.target.error)||void 0===t?void 0:t.message}`)},s.onupgradeneeded=e=>{n(new U(s.result),e.oldVersion,e.newVersion,new F(s.transaction))}}catch(e){i(`Error opening indexedDB: ${e.message}`)}}))}},15503:(e,t,n)=>{n.d(t,{ZF:()=>r.initializeApp});var r=n(32238);(0,r.registerVersion)("firebase","9.6.11","app")},1902:(e,t,n)=>{n.d(t,{Z:()=>r.Z});var r=n(98180);r.Z.registerVersion("firebase","9.6.11","app-compat")},7725:(e,t,n)=>{var r=n(98180),i=n(74444),s=n(32238),o=n(70655),a=n(53333),c=n(8463);const u=function(){return{"admin-restricted-operation":"This operation is restricted to administrators only.","argument-error":"","app-not-authorized":"This app, identified by the domain where it's hosted, is not authorized to use Firebase Authentication with the provided API key. Review your key configuration in the Google API console.","app-not-installed":"The requested mobile application corresponding to the identifier (Android package name or iOS bundle ID) provided is not installed on this device.","captcha-check-failed":"The reCAPTCHA response token provided is either invalid, expired, already used or the domain associated with it does not match the list of whitelisted domains.","code-expired":"The SMS code has expired. Please re-send the verification code to try again.","cordova-not-ready":"Cordova framework is not ready.","cors-unsupported":"This browser is not supported.","credential-already-in-use":"This credential is already associated with a different user account.","custom-token-mismatch":"The custom token corresponds to a different audience.","requires-recent-login":"This operation is sensitive and requires recent authentication. Log in again before retrying this request.","dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK.","dynamic-link-not-activated":"Please activate Dynamic Links in the Firebase Console and agree to the terms and conditions.","email-change-needs-verification":"Multi-factor users must always have a verified email.","email-already-in-use":"The email address is already in use by another account.","emulator-config-failed":'Auth instance has already been used to make a network call. Auth can no longer be configured to use the emulator. Try calling "connectAuthEmulator()" sooner.',"expired-action-code":"The action code has expired.","cancelled-popup-request":"This operation has been cancelled due to another conflicting popup being opened.","internal-error":"An internal AuthError has occurred.","invalid-app-credential":"The phone verification request contains an invalid application verifier. The reCAPTCHA token response is either invalid or expired.","invalid-app-id":"The mobile app identifier is not registed for the current project.","invalid-user-token":"This user's credential isn't valid for this project. This can happen if the user's token has been tampered with, or if the user isn't for the project associated with this API key.","invalid-auth-event":"An internal AuthError has occurred.","invalid-verification-code":"The SMS verification code used to create the phone auth credential is invalid. Please resend the verification code sms and be sure to use the verification code provided by the user.","invalid-continue-uri":"The continue URL provided in the request is invalid.","invalid-cordova-configuration":"The following Cordova plugins must be installed to enable OAuth sign-in: cordova-plugin-buildinfo, cordova-universal-links-plugin, cordova-plugin-browsertab, cordova-plugin-inappbrowser and cordova-plugin-customurlscheme.","invalid-custom-token":"The custom token format is incorrect. Please check the documentation.","invalid-dynamic-link-domain":"The provided dynamic link domain is not configured or authorized for the current project.","invalid-email":"The email address is badly formatted.","invalid-emulator-scheme":"Emulator URL must start with a valid scheme (http:// or https://).","invalid-api-key":"Your API key is invalid, please check you have copied it correctly.","invalid-cert-hash":"The SHA-1 certificate hash provided is invalid.","invalid-credential":"The supplied auth credential is malformed or has expired.","invalid-message-payload":"The email template corresponding to this action contains invalid characters in its message. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-multi-factor-session":"The request does not contain a valid proof of first factor successful sign-in.","invalid-oauth-provider":"EmailAuthProvider is not supported for this operation. This operation only supports OAuth providers.","invalid-oauth-client-id":"The OAuth client ID provided is either invalid or does not match the specified API key.","unauthorized-domain":"This domain is not authorized for OAuth operations for your Firebase project. Edit the list of authorized domains from the Firebase console.","invalid-action-code":"The action code is invalid. This can happen if the code is malformed, expired, or has already been used.","wrong-password":"The password is invalid or the user does not have a password.","invalid-persistence-type":"The specified persistence type is invalid. It can only be local, session or none.","invalid-phone-number":"The format of the phone number provided is incorrect. Please enter the phone number in a format that can be parsed into E.164 format. E.164 phone numbers are written in the format [+][country code][subscriber number including area code].","invalid-provider-id":"The specified provider ID is invalid.","invalid-recipient-email":"The email corresponding to this action failed to send as the provided recipient email address is invalid.","invalid-sender":"The email template corresponding to this action contains an invalid sender email or name. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-verification-id":"The verification ID used to create the phone auth credential is invalid.","invalid-tenant-id":"The Auth instance's tenant ID is invalid.","missing-android-pkg-name":"An Android Package Name must be provided if the Android App is required to be installed.","auth-domain-config-required":"Be sure to include authDomain when calling firebase.initializeApp(), by following the instructions in the Firebase console.","missing-app-credential":"The phone verification request is missing an application verifier assertion. A reCAPTCHA response token needs to be provided.","missing-verification-code":"The phone auth credential was created with an empty SMS verification code.","missing-continue-uri":"A continue URL must be provided in the request.","missing-iframe-start":"An internal AuthError has occurred.","missing-ios-bundle-id":"An iOS Bundle ID must be provided if an App Store ID is provided.","missing-or-invalid-nonce":"The request does not contain a valid nonce. This can occur if the SHA-256 hash of the provided raw nonce does not match the hashed nonce in the ID token payload.","missing-multi-factor-info":"No second factor identifier is provided.","missing-multi-factor-session":"The request is missing proof of first factor successful sign-in.","missing-phone-number":"To send verification codes, provide a phone number for the recipient.","missing-verification-id":"The phone auth credential was created with an empty verification ID.","app-deleted":"This instance of FirebaseApp has been deleted.","multi-factor-info-not-found":"The user does not have a second factor matching the identifier provided.","multi-factor-auth-required":"Proof of ownership of a second factor is required to complete sign-in.","account-exists-with-different-credential":"An account already exists with the same email address but different sign-in credentials. Sign in using a provider associated with this email address.","network-request-failed":"A network AuthError (such as timeout, interrupted connection or unreachable host) has occurred.","no-auth-event":"An internal AuthError has occurred.","no-such-provider":"User was not linked to an account with the given provider.","null-user":"A null user object was provided as the argument for an operation which requires a non-null user object.","operation-not-allowed":"The given sign-in provider is disabled for this Firebase project. Enable it in the Firebase console, under the sign-in method tab of the Auth section.","operation-not-supported-in-this-environment":'This operation is not supported in the environment this application is running on. "location.protocol" must be http, https or chrome-extension and web storage must be enabled.',"popup-blocked":"Unable to establish a connection with the popup. It may have been blocked by the browser.","popup-closed-by-user":"The popup has been closed by the user before finalizing the operation.","provider-already-linked":"User can only be linked to one identity for the given provider.","quota-exceeded":"The project's quota for this operation has been exceeded.","redirect-cancelled-by-user":"The redirect operation has been cancelled by the user before finalizing.","redirect-operation-pending":"A redirect sign-in operation is already pending.","rejected-credential":"The request contains malformed or mismatching credentials.","second-factor-already-in-use":"The second factor is already enrolled on this account.","maximum-second-factor-count-exceeded":"The maximum allowed number of second factors on a user has been exceeded.","tenant-id-mismatch":"The provided tenant ID does not match the Auth instance's tenant ID",timeout:"The operation has timed out.","user-token-expired":"The user's credential is no longer valid. The user must sign in again.","too-many-requests":"We have blocked all requests from this device due to unusual activity. Try again later.","unauthorized-continue-uri":"The domain of the continue URL is not whitelisted.  Please whitelist the domain in the Firebase console.","unsupported-first-factor":"Enrolling a second factor or signing in with a multi-factor account requires sign-in with a supported first factor.","unsupported-persistence-type":"The current environment does not support the specified persistence type.","unsupported-tenant-operation":"This operation is not supported in a multi-tenant context.","unverified-email":"The operation requires a verified email.","user-cancelled":"The user did not grant your application the permissions it requested.","user-not-found":"There is no user record corresponding to this identifier. The user may have been deleted.","user-disabled":"The user account has been disabled by an administrator.","user-mismatch":"The supplied credentials do not correspond to the previously signed in user.","user-signed-out":"","weak-password":"The password must be 6 characters long or more.","web-storage-unsupported":"This browser is not supported or 3rd party cookies and data may be disabled.","already-initialized":"initializeAuth() has already been called with different options. To avoid this error, call initializeAuth() with the same options as when it was originally called, or call getAuth() to return the already initialized instance."}},l=function(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}},h=new i.LL("auth","Firebase",{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}),d=new a.Yd("@firebase/auth");function f(e,...t){d.logLevel<=a.in.ERROR&&d.error(`Auth (${s.SDK_VERSION}): ${e}`,...t)}function p(e,...t){throw v(e,...t)}function m(e,...t){return v(e,...t)}function g(e,t,n){const r=Object.assign(Object.assign({},l()),{[t]:n});return new i.LL("auth","Firebase",r).create(t,{appName:e.name})}function y(e,t,n){if(!(t instanceof n))throw n.name!==t.constructor.name&&p(e,"argument-error"),g(e,"argument-error",`Type of ${t.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function v(e,...t){if("string"!=typeof e){const n=t[0],r=[...t.slice(1)];return r[0]&&(r[0].appName=e.name),e._errorFactory.create(n,...r)}return h.create(e,...t)}function w(e,t,...n){if(!e)throw v(t,...n)}function _(e){const t="INTERNAL ASSERTION FAILED: "+e;throw f(t),new Error(t)}function b(e,t){e||_(t)}const I=new Map;function T(e){b(e instanceof Function,"Expected a class definition");let t=I.get(e);return t?(b(t instanceof e,"Instance stored in cache mismatched with class"),t):(t=new e,I.set(e,t),t)}function E(){var e;return"undefined"!=typeof self&&(null===(e=self.location)||void 0===e?void 0:e.href)||""}function S(){return"http:"===k()||"https:"===k()}function k(){var e;return"undefined"!=typeof self&&(null===(e=self.location)||void 0===e?void 0:e.protocol)||null}class A{constructor(e,t){this.shortDelay=e,this.longDelay=t,b(t>e,"Short delay should be less than long delay!"),this.isMobile=(0,i.uI)()||(0,i.b$)()}get(){return"undefined"!=typeof navigator&&navigator&&"onLine"in navigator&&"boolean"==typeof navigator.onLine&&(S()||(0,i.ru)()||"connection"in navigator)&&!navigator.onLine?Math.min(5e3,this.shortDelay):this.isMobile?this.longDelay:this.shortDelay}}function C(e,t){b(e.emulator,"Emulator should always be set here");const{url:n}=e.emulator;return t?`${n}${t.startsWith("/")?t.slice(1):t}`:n}class N{static initialize(e,t,n){this.fetchImpl=e,t&&(this.headersImpl=t),n&&(this.responseImpl=n)}static fetch(){return this.fetchImpl?this.fetchImpl:"undefined"!=typeof self&&"fetch"in self?self.fetch:void _("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:"undefined"!=typeof self&&"Headers"in self?self.Headers:void _("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:"undefined"!=typeof self&&"Response"in self?self.Response:void _("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const R={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"internal-error",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error"},D=new A(3e4,6e4);function x(e,t){return e.tenantId&&!t.tenantId?Object.assign(Object.assign({},t),{tenantId:e.tenantId}):t}async function O(e,t,n,r,s={}){return P(e,s,(async()=>{let s={},o={};r&&("GET"===t?o=r:s={body:JSON.stringify(r)});const a=(0,i.xO)(Object.assign({key:e.config.apiKey},o)).slice(1),c=await e._getAdditionalHeaders();return c["Content-Type"]="application/json",e.languageCode&&(c["X-Firebase-Locale"]=e.languageCode),N.fetch()(M(e,e.config.apiHost,n,a),Object.assign({method:t,headers:c,referrerPolicy:"no-referrer"},s))}))}async function P(e,t,n){e._canInitEmulator=!1;const r=Object.assign(Object.assign({},R),t);try{const t=new U(e),i=await Promise.race([n(),t.promise]);t.clearNetworkTimeout();const s=await i.json();if("needConfirmation"in s)throw F(e,"account-exists-with-different-credential",s);if(i.ok&&!("errorMessage"in s))return s;{const t=i.ok?s.errorMessage:s.error.message,[n,o]=t.split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===n)throw F(e,"credential-already-in-use",s);if("EMAIL_EXISTS"===n)throw F(e,"email-already-in-use",s);const a=r[n]||n.toLowerCase().replace(/[_\s]+/g,"-");if(o)throw g(e,a,o);p(e,a)}}catch(t){if(t instanceof i.ZR)throw t;p(e,"network-request-failed")}}async function L(e,t,n,r,i={}){const s=await O(e,t,n,r,i);return"mfaPendingCredential"in s&&p(e,"multi-factor-auth-required",{_serverResponse:s}),s}function M(e,t,n,r){const i=`${t}${n}?${r}`;return e.config.emulator?C(e.config,i):`${e.config.apiScheme}://${i}`}class U{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise(((e,t)=>{this.timer=setTimeout((()=>t(m(this.auth,"network-request-failed"))),D.get())}))}clearNetworkTimeout(){clearTimeout(this.timer)}}function F(e,t,n){const r={appName:e.name};n.email&&(r.email=n.email),n.phoneNumber&&(r.phoneNumber=n.phoneNumber);const i=m(e,t,r);return i.customData._tokenResponse=n,i}function V(e){if(e)try{const t=new Date(Number(e));if(!isNaN(t.getTime()))return t.toUTCString()}catch(e){}}function q(e){return 1e3*Number(e)}function B(e){const[t,n,r]=e.split(".");if(void 0===t||void 0===n||void 0===r)return f("JWT malformed, contained fewer than 3 sections"),null;try{const e=(0,i.tV)(n);return e?JSON.parse(e):(f("Failed to decode base64 JWT payload"),null)}catch(e){return f("Caught error parsing JWT payload as JSON",e),null}}async function j(e,t,n=!1){if(n)return t;try{return await t}catch(t){throw t instanceof i.ZR&&function({code:e}){return"auth/user-disabled"===e||"auth/user-token-expired"===e}(t)&&e.auth.currentUser===e&&await e.auth.signOut(),t}}class ${constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){const e=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),e}{this.errorBackoff=3e4;const e=(null!==(t=this.user.stsTokenManager.expirationTime)&&void 0!==t?t:0)-Date.now()-3e5;return Math.max(0,e)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout((async()=>{await this.iteration()}),t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){return void("auth/network-request-failed"===e.code&&this.schedule(!0))}this.schedule()}}class z{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=V(this.lastLoginAt),this.creationTime=V(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function G(e){var t;const n=e.auth,r=await e.getIdToken(),i=await j(e,async function(e,t){return O(e,"POST","/v1/accounts:lookup",t)}(n,{idToken:r}));w(null==i?void 0:i.users.length,n,"internal-error");const s=i.users[0];e._notifyReloadListener(s);const a=(null===(t=s.providerUserInfo)||void 0===t?void 0:t.length)?s.providerUserInfo.map((e=>{var{providerId:t}=e,n=(0,o._T)(e,["providerId"]);return{providerId:t,uid:n.rawId||"",displayName:n.displayName||null,email:n.email||null,phoneNumber:n.phoneNumber||null,photoURL:n.photoUrl||null}})):[],c=(u=e.providerData,l=a,[...u.filter((e=>!l.some((t=>t.providerId===e.providerId)))),...l]);var u,l;const h=e.isAnonymous,d=!(e.email&&s.passwordHash||(null==c?void 0:c.length)),f=!!h&&d,p={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:c,metadata:new z(s.createdAt,s.lastLoginAt),isAnonymous:f};Object.assign(e,p)}class K{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){w(e.idToken,"internal-error"),w(void 0!==e.idToken,"internal-error"),w(void 0!==e.refreshToken,"internal-error");const t="expiresIn"in e&&void 0!==e.expiresIn?Number(e.expiresIn):function(e){const t=B(e);return w(t,"internal-error"),w(void 0!==t.exp,"internal-error"),w(void 0!==t.iat,"internal-error"),Number(t.exp)-Number(t.iat)}(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}async getToken(e,t=!1){return w(!this.accessToken||this.refreshToken,e,"user-token-expired"),t||!this.accessToken||this.isExpired?this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null:this.accessToken}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:n,refreshToken:r,expiresIn:s}=await async function(e,t){const n=await P(e,{},(async()=>{const n=(0,i.xO)({grant_type:"refresh_token",refresh_token:t}).slice(1),{tokenApiHost:r,apiKey:s}=e.config,o=M(e,r,"/v1/token",`key=${s}`),a=await e._getAdditionalHeaders();return a["Content-Type"]="application/x-www-form-urlencoded",N.fetch()(o,{method:"POST",headers:a,body:n})}));return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}(e,t);this.updateTokensAndExpiration(n,r,Number(s))}updateTokensAndExpiration(e,t,n){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+1e3*n}static fromJSON(e,t){const{refreshToken:n,accessToken:r,expirationTime:i}=t,s=new K;return n&&(w("string"==typeof n,"internal-error",{appName:e}),s.refreshToken=n),r&&(w("string"==typeof r,"internal-error",{appName:e}),s.accessToken=r),i&&(w("number"==typeof i,"internal-error",{appName:e}),s.expirationTime=i),s}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new K,this.toJSON())}_performRefresh(){return _("not implemented")}}function H(e,t){w("string"==typeof e||void 0===e,"internal-error",{appName:t})}class W{constructor(e){var{uid:t,auth:n,stsTokenManager:r}=e,i=(0,o._T)(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new $(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=n,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=i.displayName||null,this.email=i.email||null,this.emailVerified=i.emailVerified||!1,this.phoneNumber=i.phoneNumber||null,this.photoURL=i.photoURL||null,this.isAnonymous=i.isAnonymous||!1,this.tenantId=i.tenantId||null,this.providerData=i.providerData?[...i.providerData]:[],this.metadata=new z(i.createdAt||void 0,i.lastLoginAt||void 0)}async getIdToken(e){const t=await j(this,this.stsTokenManager.getToken(this.auth,e));return w(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return async function(e,t=!1){const n=(0,i.m9)(e),r=await n.getIdToken(t),s=B(r);w(s&&s.exp&&s.auth_time&&s.iat,n.auth,"internal-error");const o="object"==typeof s.firebase?s.firebase:void 0,a=null==o?void 0:o.sign_in_provider;return{claims:s,token:r,authTime:V(q(s.auth_time)),issuedAtTime:V(q(s.iat)),expirationTime:V(q(s.exp)),signInProvider:a||null,signInSecondFactor:(null==o?void 0:o.sign_in_second_factor)||null}}(this,e)}reload(){return async function(e){const t=(0,i.m9)(e);await G(t),await t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)}(this)}_assign(e){this!==e&&(w(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map((e=>Object.assign({},e))),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){return new W(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}))}_onReload(e){w(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let n=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),n=!0),t&&await G(this),await this.auth._persistUserIfCurrent(this),n&&this.auth._notifyListenersIfCurrent(this)}async delete(){const e=await this.getIdToken();return await j(this,async function(e,t){return O(e,"POST","/v1/accounts:delete",t)}(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map((e=>Object.assign({},e))),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var n,r,i,s,o,a,c,u;const l=null!==(n=t.displayName)&&void 0!==n?n:void 0,h=null!==(r=t.email)&&void 0!==r?r:void 0,d=null!==(i=t.phoneNumber)&&void 0!==i?i:void 0,f=null!==(s=t.photoURL)&&void 0!==s?s:void 0,p=null!==(o=t.tenantId)&&void 0!==o?o:void 0,m=null!==(a=t._redirectEventId)&&void 0!==a?a:void 0,g=null!==(c=t.createdAt)&&void 0!==c?c:void 0,y=null!==(u=t.lastLoginAt)&&void 0!==u?u:void 0,{uid:v,emailVerified:_,isAnonymous:b,providerData:I,stsTokenManager:T}=t;w(v&&T,e,"internal-error");const E=K.fromJSON(this.name,T);w("string"==typeof v,e,"internal-error"),H(l,e.name),H(h,e.name),w("boolean"==typeof _,e,"internal-error"),w("boolean"==typeof b,e,"internal-error"),H(d,e.name),H(f,e.name),H(p,e.name),H(m,e.name),H(g,e.name),H(y,e.name);const S=new W({uid:v,auth:e,email:h,emailVerified:_,displayName:l,isAnonymous:b,photoURL:f,phoneNumber:d,tenantId:p,stsTokenManager:E,createdAt:g,lastLoginAt:y});return I&&Array.isArray(I)&&(S.providerData=I.map((e=>Object.assign({},e)))),m&&(S._redirectEventId=m),S}static async _fromIdTokenResponse(e,t,n=!1){const r=new K;r.updateFromServerResponse(t);const i=new W({uid:t.localId,auth:e,stsTokenManager:r,isAnonymous:n});return await G(i),i}}class Y{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return void 0===t?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}Y.type="NONE";const Q=Y;function X(e,t,n){return`firebase:${e}:${t}:${n}`}class J{constructor(e,t,n){this.persistence=e,this.auth=t,this.userKey=n;const{config:r,name:i}=this.auth;this.fullUserKey=X(this.userKey,r.apiKey,i),this.fullPersistenceKey=X("persistence",r.apiKey,i),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);return e?W._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();return await this.removeCurrentUser(),this.persistence=e,t?this.setCurrentUser(t):void 0}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,n="authUser"){if(!t.length)return new J(T(Q),e,n);const r=(await Promise.all(t.map((async e=>{if(await e._isAvailable())return e})))).filter((e=>e));let i=r[0]||T(Q);const s=X(n,e.config.apiKey,e.name);let o=null;for(const n of t)try{const t=await n._get(s);if(t){const r=W._fromJSON(e,t);n!==i&&(o=r),i=n;break}}catch(e){}const a=r.filter((e=>e._shouldAllowMigration));return i._shouldAllowMigration&&a.length?(i=a[0],o&&await i._set(s,o.toJSON()),await Promise.all(t.map((async e=>{if(e!==i)try{await e._remove(s)}catch(e){}}))),new J(i,e,n)):new J(i,e,n)}}function Z(e){const t=e.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";if(re(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(ee(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(se(t))return"Blackberry";if(oe(t))return"Webos";if(te(t))return"Safari";if((t.includes("chrome/")||ne(t))&&!t.includes("edge/"))return"Chrome";if(ie(t))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,n=e.match(t);if(2===(null==n?void 0:n.length))return n[1]}return"Other"}function ee(e=(0,i.z$)()){return/firefox\//i.test(e)}function te(e=(0,i.z$)()){const t=e.toLowerCase();return t.includes("safari/")&&!t.includes("chrome/")&&!t.includes("crios/")&&!t.includes("android")}function ne(e=(0,i.z$)()){return/crios\//i.test(e)}function re(e=(0,i.z$)()){return/iemobile/i.test(e)}function ie(e=(0,i.z$)()){return/android/i.test(e)}function se(e=(0,i.z$)()){return/blackberry/i.test(e)}function oe(e=(0,i.z$)()){return/webos/i.test(e)}function ae(e=(0,i.z$)()){return/iphone|ipad|ipod/i.test(e)}function ce(e=(0,i.z$)()){return ae(e)||ie(e)||oe(e)||se(e)||/windows phone/i.test(e)||re(e)}function ue(e,t=[]){let n;switch(e){case"Browser":n=Z((0,i.z$)());break;case"Worker":n=`${Z((0,i.z$)())}-${e}`;break;default:n=e}const r=t.length?t.join(","):"FirebaseCore-web";return`${n}/JsCore/${s.SDK_VERSION}/${r}`}class le{constructor(e,t,n){this.app=e,this.heartbeatServiceProvider=t,this.config=n,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new de(this),this.idTokenSubscription=new de(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=h,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=n.sdkClientVersion}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=T(t)),this._initializationPromise=this.queue((async()=>{var n,r;if(!this._deleted&&(this.persistenceManager=await J.create(this,e),!this._deleted)){if(null===(n=this._popupRedirectResolver)||void 0===n?void 0:n._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch(e){}await this.initializeCurrentUser(t),this.lastNotifiedUid=(null===(r=this.currentUser)||void 0===r?void 0:r.uid)||null,this._deleted||(this._isInitialized=!0)}})),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();return this.currentUser||e?this.currentUser&&e&&this.currentUser.uid===e.uid?(this._currentUser._assign(e),void await this.currentUser.getIdToken()):void await this._updateCurrentUser(e):void 0}async initializeCurrentUser(e){var t;let n=await this.assertedPersistence.getCurrentUser();if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const r=null===(t=this.redirectUser)||void 0===t?void 0:t._redirectEventId,i=null==n?void 0:n._redirectEventId,s=await this.tryRedirectSignIn(e);r&&r!==i||!(null==s?void 0:s.user)||(n=s.user)}return n?n._redirectEventId?(w(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===n._redirectEventId?this.directlySetCurrentUser(n):this.reloadAndSetCurrentUserOrClear(n)):this.reloadAndSetCurrentUserOrClear(n):this.directlySetCurrentUser(null)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch(e){await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await G(e)}catch(e){if("auth/network-request-failed"!==e.code)return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=function(){if("undefined"==typeof navigator)return null;const e=navigator;return e.languages&&e.languages[0]||e.language||null}()}async _delete(){this._deleted=!0}async updateCurrentUser(e){const t=e?(0,i.m9)(e):null;return t&&w(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e){if(!this._deleted)return e&&w(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),this.queue((async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()}))}async signOut(){return(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null)}setPersistence(e){return this.queue((async()=>{await this.assertedPersistence.setPersistence(T(e))}))}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new i.LL("auth","Firebase",e())}onAuthStateChanged(e,t,n){return this.registerStateListener(this.authStateSubscription,e,t,n)}onIdTokenChanged(e,t,n){return this.registerStateListener(this.idTokenSubscription,e,t,n)}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:null===(e=this._currentUser)||void 0===e?void 0:e.toJSON()}}async _setRedirectUser(e,t){const n=await this.getOrInitRedirectPersistenceManager(t);return null===e?n.removeCurrentUser():n.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&T(e)||this._popupRedirectResolver;w(t,this,"argument-error"),this.redirectPersistenceManager=await J.create(this,[T(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,n;return this._isInitialized&&await this.queue((async()=>{})),(null===(t=this._currentUser)||void 0===t?void 0:t._redirectEventId)===e?this._currentUser:(null===(n=this.redirectUser)||void 0===n?void 0:n._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue((async()=>this.directlySetCurrentUser(e)))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const n=null!==(t=null===(e=this.currentUser)||void 0===e?void 0:e.uid)&&void 0!==t?t:null;this.lastNotifiedUid!==n&&(this.lastNotifiedUid=n,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,n,r){if(this._deleted)return()=>{};const i="function"==typeof t?t:t.next.bind(t),s=this._isInitialized?Promise.resolve():this._initializationPromise;return w(s,this,"internal-error"),s.then((()=>i(this.currentUser))),"function"==typeof t?e.addObserver(t,n,r):e.addObserver(t)}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&(this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh()),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return w(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){e&&!this.frameworks.includes(e)&&(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=ue(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);const n=await(null===(e=this.heartbeatServiceProvider.getImmediate({optional:!0}))||void 0===e?void 0:e.getHeartbeatsHeader());return n&&(t["X-Firebase-Client"]=n),t}}function he(e){return(0,i.m9)(e)}class de{constructor(e){this.auth=e,this.observer=null,this.addObserver=(0,i.ne)((e=>this.observer=e))}get next(){return w(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}function fe(e){const t=e.indexOf(":");return t<0?"":e.substr(0,t+1)}function pe(e){if(!e)return null;const t=Number(e);return isNaN(t)?null:t}class me{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return _("not implemented")}_getIdTokenResponse(e){return _("not implemented")}_linkToIdToken(e,t){return _("not implemented")}_getReauthenticationResolver(e){return _("not implemented")}}async function ge(e,t){return O(e,"POST","/v1/accounts:resetPassword",x(e,t))}async function ye(e,t){return O(e,"POST","/v1/accounts:update",t)}async function ve(e,t){return O(e,"POST","/v1/accounts:sendOobCode",x(e,t))}class we extends me{constructor(e,t,n,r=null){super("password",n),this._email=e,this._password=t,this._tenantId=r}static _fromEmailAndPassword(e,t){return new we(e,t,"password")}static _fromEmailAndCode(e,t,n=null){return new we(e,t,"emailLink",n)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t="string"==typeof e?JSON.parse(e):e;if((null==t?void 0:t.email)&&(null==t?void 0:t.password)){if("password"===t.signInMethod)return this._fromEmailAndPassword(t.email,t.password);if("emailLink"===t.signInMethod)return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":return async function(e,t){return L(e,"POST","/v1/accounts:signInWithPassword",x(e,t))}(e,{returnSecureToken:!0,email:this._email,password:this._password});case"emailLink":return async function(e,t){return L(e,"POST","/v1/accounts:signInWithEmailLink",x(e,t))}(e,{email:this._email,oobCode:this._password});default:p(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":return ye(e,{idToken:t,returnSecureToken:!0,email:this._email,password:this._password});case"emailLink":return async function(e,t){return L(e,"POST","/v1/accounts:signInWithEmailLink",x(e,t))}(e,{idToken:t,email:this._email,oobCode:this._password});default:p(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}async function _e(e,t){return L(e,"POST","/v1/accounts:signInWithIdp",x(e,t))}class be extends me{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new be(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):p("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t="string"==typeof e?JSON.parse(e):e,{providerId:n,signInMethod:r}=t,i=(0,o._T)(t,["providerId","signInMethod"]);if(!n||!r)return null;const s=new be(n,r);return s.idToken=i.idToken||void 0,s.accessToken=i.accessToken||void 0,s.secret=i.secret,s.nonce=i.nonce,s.pendingToken=i.pendingToken||null,s}_getIdTokenResponse(e){return _e(e,this.buildRequest())}_linkToIdToken(e,t){const n=this.buildRequest();return n.idToken=t,_e(e,n)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,_e(e,t)}buildRequest(){const e={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=(0,i.xO)(t)}return e}}const Ie={USER_NOT_FOUND:"user-not-found"};class Te extends me{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,t){return new Te({verificationId:e,verificationCode:t})}static _fromTokenResponse(e,t){return new Te({phoneNumber:e,temporaryProof:t})}_getIdTokenResponse(e){return async function(e,t){return L(e,"POST","/v1/accounts:signInWithPhoneNumber",x(e,t))}(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return async function(e,t){const n=await L(e,"POST","/v1/accounts:signInWithPhoneNumber",x(e,t));if(n.temporaryProof)throw F(e,"account-exists-with-different-credential",n);return n}(e,Object.assign({idToken:t},this._makeVerificationRequest()))}_getReauthenticationResolver(e){return async function(e,t){return L(e,"POST","/v1/accounts:signInWithPhoneNumber",x(e,Object.assign(Object.assign({},t),{operation:"REAUTH"})),Ie)}(e,this._makeVerificationRequest())}_makeVerificationRequest(){const{temporaryProof:e,phoneNumber:t,verificationId:n,verificationCode:r}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:n,code:r}}toJSON(){const e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){"string"==typeof e&&(e=JSON.parse(e));const{verificationId:t,verificationCode:n,phoneNumber:r,temporaryProof:i}=e;return n||t||r||i?new Te({verificationId:t,verificationCode:n,phoneNumber:r,temporaryProof:i}):null}}class Ee{constructor(e){var t,n,r,s,o,a;const c=(0,i.zd)((0,i.pd)(e)),u=null!==(t=c.apiKey)&&void 0!==t?t:null,l=null!==(n=c.oobCode)&&void 0!==n?n:null,h=function(e){switch(e){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}(null!==(r=c.mode)&&void 0!==r?r:null);w(u&&l&&h,"argument-error"),this.apiKey=u,this.operation=h,this.code=l,this.continueUrl=null!==(s=c.continueUrl)&&void 0!==s?s:null,this.languageCode=null!==(o=c.languageCode)&&void 0!==o?o:null,this.tenantId=null!==(a=c.tenantId)&&void 0!==a?a:null}static parseLink(e){const t=function(e){const t=(0,i.zd)((0,i.pd)(e)).link,n=t?(0,i.zd)((0,i.pd)(t)).deep_link_id:null,r=(0,i.zd)((0,i.pd)(e)).deep_link_id;return(r?(0,i.zd)((0,i.pd)(r)).link:null)||r||n||t||e}(e);try{return new Ee(t)}catch(e){return null}}}class Se{constructor(){this.providerId=Se.PROVIDER_ID}static credential(e,t){return we._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const n=Ee.parseLink(t);return w(n,"argument-error"),we._fromEmailAndCode(e,n.code,n.tenantId)}}Se.PROVIDER_ID="password",Se.EMAIL_PASSWORD_SIGN_IN_METHOD="password",Se.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class ke{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class Ae extends ke{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class Ce extends Ae{static credentialFromJSON(e){const t="string"==typeof e?JSON.parse(e):e;return w("providerId"in t&&"signInMethod"in t,"argument-error"),be._fromParams(t)}credential(e){return this._credential(Object.assign(Object.assign({},e),{nonce:e.rawNonce}))}_credential(e){return w(e.idToken||e.accessToken,"argument-error"),be._fromParams(Object.assign(Object.assign({},e),{providerId:this.providerId,signInMethod:this.providerId}))}static credentialFromResult(e){return Ce.oauthCredentialFromTaggedObject(e)}static credentialFromError(e){return Ce.oauthCredentialFromTaggedObject(e.customData||{})}static oauthCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:n,oauthTokenSecret:r,pendingToken:i,nonce:s,providerId:o}=e;if(!(n||r||t||i))return null;if(!o)return null;try{return new Ce(o)._credential({idToken:t,accessToken:n,nonce:s,pendingToken:i})}catch(e){return null}}}class Ne extends Ae{constructor(){super("facebook.com")}static credential(e){return be._fromParams({providerId:Ne.PROVIDER_ID,signInMethod:Ne.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Ne.credentialFromTaggedObject(e)}static credentialFromError(e){return Ne.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e))return null;if(!e.oauthAccessToken)return null;try{return Ne.credential(e.oauthAccessToken)}catch(e){return null}}}Ne.FACEBOOK_SIGN_IN_METHOD="facebook.com",Ne.PROVIDER_ID="facebook.com";class Re extends Ae{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return be._fromParams({providerId:Re.PROVIDER_ID,signInMethod:Re.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return Re.credentialFromTaggedObject(e)}static credentialFromError(e){return Re.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:n}=e;if(!t&&!n)return null;try{return Re.credential(t,n)}catch(e){return null}}}Re.GOOGLE_SIGN_IN_METHOD="google.com",Re.PROVIDER_ID="google.com";class De extends Ae{constructor(){super("github.com")}static credential(e){return be._fromParams({providerId:De.PROVIDER_ID,signInMethod:De.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return De.credentialFromTaggedObject(e)}static credentialFromError(e){return De.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e))return null;if(!e.oauthAccessToken)return null;try{return De.credential(e.oauthAccessToken)}catch(e){return null}}}De.GITHUB_SIGN_IN_METHOD="github.com",De.PROVIDER_ID="github.com";class xe extends me{constructor(e,t){super(e,e),this.pendingToken=t}_getIdTokenResponse(e){return _e(e,this.buildRequest())}_linkToIdToken(e,t){const n=this.buildRequest();return n.idToken=t,_e(e,n)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,_e(e,t)}toJSON(){return{signInMethod:this.signInMethod,providerId:this.providerId,pendingToken:this.pendingToken}}static fromJSON(e){const t="string"==typeof e?JSON.parse(e):e,{providerId:n,signInMethod:r,pendingToken:i}=t;return n&&r&&i&&n===r?new xe(n,i):null}static _create(e,t){return new xe(e,t)}buildRequest(){return{requestUri:"http://localhost",returnSecureToken:!0,pendingToken:this.pendingToken}}}class Oe extends ke{constructor(e){w(e.startsWith("saml."),"argument-error"),super(e)}static credentialFromResult(e){return Oe.samlCredentialFromTaggedObject(e)}static credentialFromError(e){return Oe.samlCredentialFromTaggedObject(e.customData||{})}static credentialFromJSON(e){const t=xe.fromJSON(e);return w(t,"argument-error"),t}static samlCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{pendingToken:t,providerId:n}=e;if(!t||!n)return null;try{return xe._create(n,t)}catch(e){return null}}}class Pe extends Ae{constructor(){super("twitter.com")}static credential(e,t){return be._fromParams({providerId:Pe.PROVIDER_ID,signInMethod:Pe.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return Pe.credentialFromTaggedObject(e)}static credentialFromError(e){return Pe.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:n}=e;if(!t||!n)return null;try{return Pe.credential(t,n)}catch(e){return null}}}async function Le(e,t){return L(e,"POST","/v1/accounts:signUp",x(e,t))}Pe.TWITTER_SIGN_IN_METHOD="twitter.com",Pe.PROVIDER_ID="twitter.com";class Me{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,n,r=!1){const i=await W._fromIdTokenResponse(e,n,r),s=Ue(n);return new Me({user:i,providerId:s,_tokenResponse:n,operationType:t})}static async _forOperation(e,t,n){await e._updateTokensIfNecessary(n,!0);const r=Ue(n);return new Me({user:e,providerId:r,_tokenResponse:n,operationType:t})}}function Ue(e){return e.providerId?e.providerId:"phoneNumber"in e?"phone":null}class Fe extends i.ZR{constructor(e,t,n,r){var i;super(t.code,t.message),this.operationType=n,this.user=r,Object.setPrototypeOf(this,Fe.prototype),this.customData={appName:e.name,tenantId:null!==(i=e.tenantId)&&void 0!==i?i:void 0,_serverResponse:t.customData._serverResponse,operationType:n}}static _fromErrorAndOperation(e,t,n,r){return new Fe(e,t,n,r)}}function Ve(e,t,n,r){return("reauthenticate"===t?n._getReauthenticationResolver(e):n._getIdTokenResponse(e)).catch((n=>{if("auth/multi-factor-auth-required"===n.code)throw Fe._fromErrorAndOperation(e,n,t,r);throw n}))}function qe(e){return new Set(e.map((({providerId:e})=>e)).filter((e=>!!e)))}async function Be(e,t,n=!1){const r=await j(e,t._linkToIdToken(e.auth,await e.getIdToken()),n);return Me._forOperation(e,"link",r)}async function je(e,t,n){await G(t);const r=!1===e?"provider-already-linked":"no-such-provider";w(qe(t.providerData).has(n)===e,t.auth,r)}async function $e(e,t,n=!1){const{auth:r}=e,i="reauthenticate";try{const s=await j(e,Ve(r,i,t,e),n);w(s.idToken,r,"internal-error");const o=B(s.idToken);w(o,r,"internal-error");const{sub:a}=o;return w(e.uid===a,r,"user-mismatch"),Me._forOperation(e,i,s)}catch(e){throw"auth/user-not-found"===(null==e?void 0:e.code)&&p(r,"user-mismatch"),e}}async function ze(e,t,n=!1){const r="signIn",i=await Ve(e,r,t),s=await Me._fromIdTokenResponse(e,r,i);return n||await e._updateCurrentUser(s.user),s}async function Ge(e,t){return ze(he(e),t)}async function Ke(e,t){const n=(0,i.m9)(e);return await je(!1,n,t.providerId),Be(n,t)}async function He(e,t){return $e((0,i.m9)(e),t)}class We{constructor(e,t){this.factorId=e,this.uid=t.mfaEnrollmentId,this.enrollmentTime=new Date(t.enrolledAt).toUTCString(),this.displayName=t.displayName}static _fromServerResponse(e,t){return"phoneInfo"in t?Ye._fromServerResponse(e,t):p(e,"internal-error")}}class Ye extends We{constructor(e){super("phone",e),this.phoneNumber=e.phoneInfo}static _fromServerResponse(e,t){return new Ye(t)}}function Qe(e,t,n){var r;w((null===(r=n.url)||void 0===r?void 0:r.length)>0,e,"invalid-continue-uri"),w(void 0===n.dynamicLinkDomain||n.dynamicLinkDomain.length>0,e,"invalid-dynamic-link-domain"),t.continueUrl=n.url,t.dynamicLinkDomain=n.dynamicLinkDomain,t.canHandleCodeInApp=n.handleCodeInApp,n.iOS&&(w(n.iOS.bundleId.length>0,e,"missing-ios-bundle-id"),t.iOSBundleId=n.iOS.bundleId),n.android&&(w(n.android.packageName.length>0,e,"missing-android-pkg-name"),t.androidInstallApp=n.android.installApp,t.androidMinimumVersionCode=n.android.minimumVersion,t.androidPackageName=n.android.packageName)}async function Xe(e,t){const n=(0,i.m9)(e),r=await ge(n,{oobCode:t}),s=r.requestType;switch(w(s,n,"internal-error"),s){case"EMAIL_SIGNIN":break;case"VERIFY_AND_CHANGE_EMAIL":w(r.newEmail,n,"internal-error");break;case"REVERT_SECOND_FACTOR_ADDITION":w(r.mfaInfo,n,"internal-error");default:w(r.email,n,"internal-error")}let o=null;return r.mfaInfo&&(o=We._fromServerResponse(he(n),r.mfaInfo)),{data:{email:("VERIFY_AND_CHANGE_EMAIL"===r.requestType?r.newEmail:r.email)||null,previousEmail:("VERIFY_AND_CHANGE_EMAIL"===r.requestType?r.email:r.newEmail)||null,multiFactorInfo:o},operation:s}}async function Je(e,t,n){const{auth:r}=e,i={idToken:await e.getIdToken(),returnSecureToken:!0};t&&(i.email=t),n&&(i.password=n);const s=await j(e,ye(r,i));await e._updateTokensIfNecessary(s,!0)}class Ze{constructor(e,t,n={}){this.isNewUser=e,this.providerId=t,this.profile=n}}class et extends Ze{constructor(e,t,n,r){super(e,t,n),this.username=r}}class tt extends Ze{constructor(e,t){super(e,"facebook.com",t)}}class nt extends et{constructor(e,t){super(e,"github.com",t,"string"==typeof(null==t?void 0:t.login)?null==t?void 0:t.login:null)}}class rt extends Ze{constructor(e,t){super(e,"google.com",t)}}class it extends et{constructor(e,t,n){super(e,"twitter.com",t,n)}}function st(e){const{user:t,_tokenResponse:n}=e;return t.isAnonymous&&!n?{providerId:null,isNewUser:!1,profile:null}:function(e){var t,n;if(!e)return null;const{providerId:r}=e,i=e.rawUserInfo?JSON.parse(e.rawUserInfo):{},s=e.isNewUser||"identitytoolkit#SignupNewUserResponse"===e.kind;if(!r&&(null==e?void 0:e.idToken)){const r=null===(n=null===(t=B(e.idToken))||void 0===t?void 0:t.firebase)||void 0===n?void 0:n.sign_in_provider;if(r)return new Ze(s,"anonymous"!==r&&"custom"!==r?r:null)}if(!r)return null;switch(r){case"facebook.com":return new tt(s,i);case"github.com":return new nt(s,i);case"google.com":return new rt(s,i);case"twitter.com":return new it(s,i,e.screenName||null);case"custom":case"anonymous":return new Ze(s,null);default:return new Ze(s,r,i)}}(n)}class ot{constructor(e,t){this.type=e,this.credential=t}static _fromIdtoken(e){return new ot("enroll",e)}static _fromMfaPendingCredential(e){return new ot("signin",e)}toJSON(){return{multiFactorSession:{["enroll"===this.type?"idToken":"pendingCredential"]:this.credential}}}static fromJSON(e){var t,n;if(null==e?void 0:e.multiFactorSession){if(null===(t=e.multiFactorSession)||void 0===t?void 0:t.pendingCredential)return ot._fromMfaPendingCredential(e.multiFactorSession.pendingCredential);if(null===(n=e.multiFactorSession)||void 0===n?void 0:n.idToken)return ot._fromIdtoken(e.multiFactorSession.idToken)}return null}}class at{constructor(e,t,n){this.session=e,this.hints=t,this.signInResolver=n}static _fromError(e,t){const n=he(e),r=t.customData._serverResponse,i=(r.mfaInfo||[]).map((e=>We._fromServerResponse(n,e)));w(r.mfaPendingCredential,n,"internal-error");const s=ot._fromMfaPendingCredential(r.mfaPendingCredential);return new at(s,i,(async e=>{const i=await e._process(n,s);delete r.mfaInfo,delete r.mfaPendingCredential;const o=Object.assign(Object.assign({},r),{idToken:i.idToken,refreshToken:i.refreshToken});switch(t.operationType){case"signIn":const e=await Me._fromIdTokenResponse(n,t.operationType,o);return await n._updateCurrentUser(e.user),e;case"reauthenticate":return w(t.user,n,"internal-error"),Me._forOperation(t.user,t.operationType,o);default:p(n,"internal-error")}}))}async resolveSignIn(e){const t=e;return this.signInResolver(t)}}class ct{constructor(e){this.user=e,this.enrolledFactors=[],e._onReload((t=>{t.mfaInfo&&(this.enrolledFactors=t.mfaInfo.map((t=>We._fromServerResponse(e.auth,t))))}))}static _fromUser(e){return new ct(e)}async getSession(){return ot._fromIdtoken(await this.user.getIdToken())}async enroll(e,t){const n=e,r=await this.getSession(),i=await j(this.user,n._process(this.user.auth,r,t));return await this.user._updateTokensIfNecessary(i),this.user.reload()}async unenroll(e){const t="string"==typeof e?e:e.uid,n=await this.user.getIdToken(),r=await j(this.user,(i=this.user.auth,s={idToken:n,mfaEnrollmentId:t},O(i,"POST","/v2/accounts/mfaEnrollment:withdraw",x(i,s))));var i,s;this.enrolledFactors=this.enrolledFactors.filter((({uid:e})=>e!==t)),await this.user._updateTokensIfNecessary(r);try{await this.user.reload()}catch(e){if("auth/user-token-expired"!==e.code)throw e}}}const ut=new WeakMap,lt="__sak";class ht{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(lt,"1"),this.storage.removeItem(lt),Promise.resolve(!0)):Promise.resolve(!1)}catch(e){return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}class dt extends ht{constructor(){super((()=>window.localStorage),"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.safariLocalStorageNotSynced=function(){const e=(0,i.z$)();return te(e)||ae(e)}()&&function(){try{return!(!window||window===window.top)}catch(e){return!1}}(),this.fallbackToPolling=ce(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const n=this.storage.getItem(t),r=this.localCache[t];n!==r&&e(t,r,n)}}onStorageEvent(e,t=!1){if(!e.key)return void this.forAllChangedKeys(((e,t,n)=>{this.notifyListeners(e,n)}));const n=e.key;if(t?this.detachListener():this.stopPolling(),this.safariLocalStorageNotSynced){const r=this.storage.getItem(n);if(e.newValue!==r)null!==e.newValue?this.storage.setItem(n,e.newValue):this.storage.removeItem(n);else if(this.localCache[n]===e.newValue&&!t)return}const r=()=>{const e=this.storage.getItem(n);(t||this.localCache[n]!==e)&&this.notifyListeners(n,e)},s=this.storage.getItem(n);(0,i.w1)()&&10===document.documentMode&&s!==e.newValue&&e.newValue!==e.oldValue?setTimeout(r,10):r()}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const e of Array.from(n))e(t?JSON.parse(t):t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval((()=>{this.forAllChangedKeys(((e,t,n)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:n}),!0)}))}),1e3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}dt.type="LOCAL";const ft=dt;class pt extends ht{constructor(){super((()=>window.sessionStorage),"SESSION")}_addListener(e,t){}_removeListener(e,t){}}pt.type="SESSION";const mt=pt;class gt{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find((t=>t.isListeningto(e)));if(t)return t;const n=new gt(e);return this.receivers.push(n),n}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:n,eventType:r,data:i}=t.data,s=this.handlersMap[r];if(!(null==s?void 0:s.size))return;t.ports[0].postMessage({status:"ack",eventId:n,eventType:r});const o=Array.from(s).map((async e=>e(t.origin,i))),a=await function(e){return Promise.all(e.map((async e=>{try{return{fulfilled:!0,value:await e}}catch(e){return{fulfilled:!1,reason:e}}})))}(o);t.ports[0].postMessage({status:"done",eventId:n,eventType:r,response:a})}_subscribe(e,t){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),t&&0!==this.handlersMap[e].size||delete this.handlersMap[e],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}function yt(e="",t=10){let n="";for(let e=0;e<t;e++)n+=Math.floor(10*Math.random());return e+n}gt.receivers=[];class vt{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,n=50){const r="undefined"!=typeof MessageChannel?new MessageChannel:null;if(!r)throw new Error("connection_unavailable");let i,s;return new Promise(((o,a)=>{const c=yt("",20);r.port1.start();const u=setTimeout((()=>{a(new Error("unsupported_event"))}),n);s={messageChannel:r,onMessage(e){const t=e;if(t.data.eventId===c)switch(t.data.status){case"ack":clearTimeout(u),i=setTimeout((()=>{a(new Error("timeout"))}),3e3);break;case"done":clearTimeout(i),o(t.data.response);break;default:clearTimeout(u),clearTimeout(i),a(new Error("invalid_response"))}}},this.handlers.add(s),r.port1.addEventListener("message",s.onMessage),this.target.postMessage({eventType:e,eventId:c,data:t},[r.port2])})).finally((()=>{s&&this.removeMessageHandler(s)}))}}function wt(){return window}function _t(){return void 0!==wt().WorkerGlobalScope&&"function"==typeof wt().importScripts}const bt="firebaseLocalStorageDb",It="firebaseLocalStorage",Tt="fbase_key";class Et{constructor(e){this.request=e}toPromise(){return new Promise(((e,t)=>{this.request.addEventListener("success",(()=>{e(this.request.result)})),this.request.addEventListener("error",(()=>{t(this.request.error)}))}))}}function St(e,t){return e.transaction([It],t?"readwrite":"readonly").objectStore(It)}function kt(){const e=indexedDB.open(bt,1);return new Promise(((t,n)=>{e.addEventListener("error",(()=>{n(e.error)})),e.addEventListener("upgradeneeded",(()=>{const t=e.result;try{t.createObjectStore(It,{keyPath:Tt})}catch(e){n(e)}})),e.addEventListener("success",(async()=>{const n=e.result;n.objectStoreNames.contains(It)?t(n):(n.close(),await function(){const e=indexedDB.deleteDatabase(bt);return new Et(e).toPromise()}(),t(await kt()))}))}))}async function At(e,t,n){const r=St(e,!0).put({[Tt]:t,value:n});return new Et(r).toPromise()}function Ct(e,t){const n=St(e,!0).delete(t);return new Et(n).toPromise()}class Nt{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then((()=>{}),(()=>{}))}async _openDb(){return this.db||(this.db=await kt()),this.db}async _withRetries(e){let t=0;for(;;)try{const t=await this._openDb();return await e(t)}catch(e){if(t++>3)throw e;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return _t()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=gt._getInstance(_t()?self:null),this.receiver._subscribe("keyChanged",(async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)}))),this.receiver._subscribe("ping",(async(e,t)=>["keyChanged"]))}async initializeSender(){var e,t;if(this.activeServiceWorker=await async function(){if(!(null===navigator||void 0===navigator?void 0:navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch(e){return null}}(),!this.activeServiceWorker)return;this.sender=new vt(this.activeServiceWorker);const n=await this.sender._send("ping",{},800);n&&(null===(e=n[0])||void 0===e?void 0:e.fulfilled)&&(null===(t=n[0])||void 0===t?void 0:t.value.includes("keyChanged"))&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){var t;if(this.sender&&this.activeServiceWorker&&((null===(t=null===navigator||void 0===navigator?void 0:navigator.serviceWorker)||void 0===t?void 0:t.controller)||null)===this.activeServiceWorker)try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch(t){}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await kt();return await At(e,lt,"1"),await Ct(e,lt),!0}catch(e){}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite((async()=>(await this._withRetries((n=>At(n,e,t))),this.localCache[e]=t,this.notifyServiceWorker(e))))}async _get(e){const t=await this._withRetries((t=>async function(e,t){const n=St(e,!1).get(t),r=await new Et(n).toPromise();return void 0===r?null:r.value}(t,e)));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite((async()=>(await this._withRetries((t=>Ct(t,e))),delete this.localCache[e],this.notifyServiceWorker(e))))}async _poll(){const e=await this._withRetries((e=>{const t=St(e,!1).getAll();return new Et(t).toPromise()}));if(!e)return[];if(0!==this.pendingWrites)return[];const t=[],n=new Set;for(const{fbase_key:r,value:i}of e)n.add(r),JSON.stringify(this.localCache[r])!==JSON.stringify(i)&&(this.notifyListeners(r,i),t.push(r));for(const e of Object.keys(this.localCache))this.localCache[e]&&!n.has(e)&&(this.notifyListeners(e,null),t.push(e));return t}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const e of Array.from(n))e(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval((async()=>this._poll()),800)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&this.stopPolling()}}Nt.type="LOCAL";const Rt=Nt;function Dt(e){return new Promise(((t,n)=>{const r=document.createElement("script");var i,s;r.setAttribute("src",e),r.onload=t,r.onerror=e=>{const t=m("internal-error");t.customData=e,n(t)},r.type="text/javascript",r.charset="UTF-8",(null!==(s=null===(i=document.getElementsByTagName("head"))||void 0===i?void 0:i[0])&&void 0!==s?s:document).appendChild(r)}))}function xt(e){return`__${e}${Math.floor(1e6*Math.random())}`}const Ot=1e12;class Pt{constructor(e){this.auth=e,this.counter=Ot,this._widgets=new Map}render(e,t){const n=this.counter;return this._widgets.set(n,new Lt(e,this.auth.name,t||{})),this.counter++,n}reset(e){var t;const n=e||Ot;null===(t=this._widgets.get(n))||void 0===t||t.delete(),this._widgets.delete(n)}getResponse(e){var t;const n=e||Ot;return(null===(t=this._widgets.get(n))||void 0===t?void 0:t.getResponse())||""}async execute(e){var t;const n=e||Ot;return null===(t=this._widgets.get(n))||void 0===t||t.execute(),""}}class Lt{constructor(e,t,n){this.params=n,this.timerId=null,this.deleted=!1,this.responseToken=null,this.clickHandler=()=>{this.execute()};const r="string"==typeof e?document.getElementById(e):e;w(r,"argument-error",{appName:t}),this.container=r,this.isVisible="invisible"!==this.params.size,this.isVisible?this.execute():this.container.addEventListener("click",this.clickHandler)}getResponse(){return this.checkIfDeleted(),this.responseToken}delete(){this.checkIfDeleted(),this.deleted=!0,this.timerId&&(clearTimeout(this.timerId),this.timerId=null),this.container.removeEventListener("click",this.clickHandler)}execute(){this.checkIfDeleted(),this.timerId||(this.timerId=window.setTimeout((()=>{this.responseToken=function(e){const t=[],n="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let e=0;e<50;e++)t.push(n.charAt(Math.floor(Math.random()*n.length)));return t.join("")}();const{callback:e,"expired-callback":t}=this.params;if(e)try{e(this.responseToken)}catch(e){}this.timerId=window.setTimeout((()=>{if(this.timerId=null,this.responseToken=null,t)try{t()}catch(e){}this.isVisible&&this.execute()}),6e4)}),500))}checkIfDeleted(){if(this.deleted)throw new Error("reCAPTCHA mock was already deleted!")}}const Mt=xt("rcb"),Ut=new A(3e4,6e4);class Ft{constructor(){this.hostLanguage="",this.counter=0,this.librarySeparatelyLoaded=!!wt().grecaptcha}load(e,t=""){return w(function(e){return e.length<=6&&/^\s*[a-zA-Z0-9\-]*\s*$/.test(e)}(t),e,"argument-error"),this.shouldResolveImmediately(t)?Promise.resolve(wt().grecaptcha):new Promise(((n,r)=>{const s=wt().setTimeout((()=>{r(m(e,"network-request-failed"))}),Ut.get());wt()[Mt]=()=>{wt().clearTimeout(s),delete wt()[Mt];const i=wt().grecaptcha;if(!i)return void r(m(e,"internal-error"));const o=i.render;i.render=(e,t)=>{const n=o(e,t);return this.counter++,n},this.hostLanguage=t,n(i)},Dt(`https://www.google.com/recaptcha/api.js??${(0,i.xO)({onload:Mt,render:"explicit",hl:t})}`).catch((()=>{clearTimeout(s),r(m(e,"internal-error"))}))}))}clearedOneInstance(){this.counter--}shouldResolveImmediately(e){return!!wt().grecaptcha&&(e===this.hostLanguage||this.counter>0||this.librarySeparatelyLoaded)}}class Vt{async load(e){return new Pt(e)}clearedOneInstance(){}}const qt="recaptcha",Bt={theme:"light",type:"image"};class jt{constructor(e,t=Object.assign({},Bt),n){this.parameters=t,this.type=qt,this.destroyed=!1,this.widgetId=null,this.tokenChangeListeners=new Set,this.renderPromise=null,this.recaptcha=null,this.auth=he(n),this.isInvisible="invisible"===this.parameters.size,w("undefined"!=typeof document,this.auth,"operation-not-supported-in-this-environment");const r="string"==typeof e?document.getElementById(e):e;w(r,this.auth,"argument-error"),this.container=r,this.parameters.callback=this.makeTokenCallback(this.parameters.callback),this._recaptchaLoader=this.auth.settings.appVerificationDisabledForTesting?new Vt:new Ft,this.validateStartingState()}async verify(){this.assertNotDestroyed();const e=await this.render(),t=this.getAssertedRecaptcha();return t.getResponse(e)||new Promise((n=>{const r=e=>{e&&(this.tokenChangeListeners.delete(r),n(e))};this.tokenChangeListeners.add(r),this.isInvisible&&t.execute(e)}))}render(){try{this.assertNotDestroyed()}catch(e){return Promise.reject(e)}return this.renderPromise||(this.renderPromise=this.makeRenderPromise().catch((e=>{throw this.renderPromise=null,e}))),this.renderPromise}_reset(){this.assertNotDestroyed(),null!==this.widgetId&&this.getAssertedRecaptcha().reset(this.widgetId)}clear(){this.assertNotDestroyed(),this.destroyed=!0,this._recaptchaLoader.clearedOneInstance(),this.isInvisible||this.container.childNodes.forEach((e=>{this.container.removeChild(e)}))}validateStartingState(){w(!this.parameters.sitekey,this.auth,"argument-error"),w(this.isInvisible||!this.container.hasChildNodes(),this.auth,"argument-error"),w("undefined"!=typeof document,this.auth,"operation-not-supported-in-this-environment")}makeTokenCallback(e){return t=>{if(this.tokenChangeListeners.forEach((e=>e(t))),"function"==typeof e)e(t);else if("string"==typeof e){const n=wt()[e];"function"==typeof n&&n(t)}}}assertNotDestroyed(){w(!this.destroyed,this.auth,"internal-error")}async makeRenderPromise(){if(await this.init(),!this.widgetId){let e=this.container;if(!this.isInvisible){const t=document.createElement("div");e.appendChild(t),e=t}this.widgetId=this.getAssertedRecaptcha().render(e,this.parameters)}return this.widgetId}async init(){w(S()&&!_t(),this.auth,"internal-error"),await function(){let e=null;return new Promise((t=>{"complete"!==document.readyState?(e=()=>t(),window.addEventListener("load",e)):t()})).catch((t=>{throw e&&window.removeEventListener("load",e),t}))}(),this.recaptcha=await this._recaptchaLoader.load(this.auth,this.auth.languageCode||void 0);const e=await async function(e){return(await O(e,"GET","/v1/recaptchaParams")).recaptchaSiteKey||""}(this.auth);w(e,this.auth,"internal-error"),this.parameters.sitekey=e}getAssertedRecaptcha(){return w(this.recaptcha,this.auth,"internal-error"),this.recaptcha}}class $t{constructor(e,t){this.verificationId=e,this.onConfirmation=t}confirm(e){const t=Te._fromVerification(this.verificationId,e);return this.onConfirmation(t)}}async function zt(e,t,n){var r;const i=await n.verify();try{let s;if(w("string"==typeof i,e,"argument-error"),w(n.type===qt,e,"argument-error"),s="string"==typeof t?{phoneNumber:t}:t,"session"in s){const t=s.session;if("phoneNumber"in s){w("enroll"===t.type,e,"internal-error");const n=await function(e,t){return O(e,"POST","/v2/accounts/mfaEnrollment:start",x(e,t))}(e,{idToken:t.credential,phoneEnrollmentInfo:{phoneNumber:s.phoneNumber,recaptchaToken:i}});return n.phoneSessionInfo.sessionInfo}{w("signin"===t.type,e,"internal-error");const n=(null===(r=s.multiFactorHint)||void 0===r?void 0:r.uid)||s.multiFactorUid;w(n,e,"missing-multi-factor-info");const o=await function(e,t){return O(e,"POST","/v2/accounts/mfaSignIn:start",x(e,t))}(e,{mfaPendingCredential:t.credential,mfaEnrollmentId:n,phoneSignInInfo:{recaptchaToken:i}});return o.phoneResponseInfo.sessionInfo}}{const{sessionInfo:t}=await async function(e,t){return O(e,"POST","/v1/accounts:sendVerificationCode",x(e,t))}(e,{phoneNumber:s.phoneNumber,recaptchaToken:i});return t}}finally{n._reset()}}class Gt{constructor(e){this.providerId=Gt.PROVIDER_ID,this.auth=he(e)}verifyPhoneNumber(e,t){return zt(this.auth,e,(0,i.m9)(t))}static credential(e,t){return Te._fromVerification(e,t)}static credentialFromResult(e){const t=e;return Gt.credentialFromTaggedObject(t)}static credentialFromError(e){return Gt.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{phoneNumber:t,temporaryProof:n}=e;return t&&n?Te._fromTokenResponse(t,n):null}}function Kt(e,t){return t?T(t):(w(e._popupRedirectResolver,e,"argument-error"),e._popupRedirectResolver)}Gt.PROVIDER_ID="phone",Gt.PHONE_SIGN_IN_METHOD="phone";class Ht extends me{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return _e(e,this._buildIdpRequest())}_linkToIdToken(e,t){return _e(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return _e(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function Wt(e){return ze(e.auth,new Ht(e),e.bypassAuthState)}function Yt(e){const{auth:t,user:n}=e;return w(n,t,"internal-error"),$e(n,new Ht(e),e.bypassAuthState)}async function Qt(e){const{auth:t,user:n}=e;return w(n,t,"internal-error"),Be(n,new Ht(e),e.bypassAuthState)}class Xt{constructor(e,t,n,r,i=!1){this.auth=e,this.resolver=n,this.user=r,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise((async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(e){this.reject(e)}}))}async onAuthEvent(e){const{urlResponse:t,sessionId:n,postBody:r,tenantId:i,error:s,type:o}=e;if(s)return void this.reject(s);const a={auth:this.auth,requestUri:t,sessionId:n,tenantId:i||void 0,postBody:r||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(o)(a))}catch(e){this.reject(e)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return Wt;case"linkViaPopup":case"linkViaRedirect":return Qt;case"reauthViaPopup":case"reauthViaRedirect":return Yt;default:p(this.auth,"internal-error")}}resolve(e){b(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){b(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const Jt=new A(2e3,1e4);class Zt extends Xt{constructor(e,t,n,r,i){super(e,t,r,i),this.provider=n,this.authWindow=null,this.pollId=null,Zt.currentPopupAction&&Zt.currentPopupAction.cancel(),Zt.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return w(e,this.auth,"internal-error"),e}async onExecution(){b(1===this.filter.length,"Popup operations only handle one event");const e=yt();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch((e=>{this.reject(e)})),this.resolver._isIframeWebStorageSupported(this.auth,(e=>{e||this.reject(m(this.auth,"web-storage-unsupported"))})),this.pollUserCancellation()}get eventId(){var e;return(null===(e=this.authWindow)||void 0===e?void 0:e.associatedEvent)||null}cancel(){this.reject(m(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Zt.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,n;(null===(n=null===(t=this.authWindow)||void 0===t?void 0:t.window)||void 0===n?void 0:n.closed)?this.pollId=window.setTimeout((()=>{this.pollId=null,this.reject(m(this.auth,"popup-closed-by-user"))}),2e3):this.pollId=window.setTimeout(e,Jt.get())};e()}}Zt.currentPopupAction=null;const en=new Map;class tn extends Xt{constructor(e,t,n=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,n),this.eventId=null}async execute(){let e=en.get(this.auth._key());if(!e){try{const t=await async function(e,t){const n=sn(t),r=rn(e);if(!await r._isAvailable())return!1;const i="true"===await r._get(n);return await r._remove(n),i}(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(t)}catch(t){e=()=>Promise.reject(t)}en.set(this.auth._key(),e)}return this.bypassAuthState||en.set(this.auth._key(),(()=>Promise.resolve(null))),e()}async onAuthEvent(e){if("signInViaRedirect"===e.type)return super.onAuthEvent(e);if("unknown"!==e.type){if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}else this.resolve(null)}async onExecution(){}cleanUp(){}}async function nn(e,t){return rn(e)._set(sn(t),"true")}function rn(e){return T(e._redirectPersistence)}function sn(e){return X("pendingRedirect",e.config.apiKey,e.name)}async function on(e,t,n=!1){const r=he(e),i=Kt(r,t),s=new tn(r,i,n),o=await s.execute();return o&&!n&&(delete o.user._redirectEventId,await r._persistUserIfCurrent(o.user),await r._setRedirectUser(null,t)),o}async function an(e){const t=yt(`${e.uid}:::`);return e._redirectEventId=t,await e.auth._setRedirectUser(e),await e.auth._persistUserIfCurrent(e),t}class cn{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach((n=>{this.isEventForConsumer(e,n)&&(t=!0,this.sendToConsumer(e,n),this.saveEventToCache(e))})),this.hasHandledPotentialRedirect||!function(e){switch(e.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return ln(e);default:return!1}}(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var n;if(e.error&&!ln(e)){const r=(null===(n=e.error.code)||void 0===n?void 0:n.split("auth/")[1])||"internal-error";t.onError(m(this.auth,r))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const n=null===t.eventId||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&n}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=6e5&&this.cachedEventUids.clear(),this.cachedEventUids.has(un(e))}saveEventToCache(e){this.cachedEventUids.add(un(e)),this.lastProcessedEventTime=Date.now()}}function un(e){return[e.type,e.eventId,e.sessionId,e.tenantId].filter((e=>e)).join("-")}function ln({type:e,error:t}){return"unknown"===e&&"auth/no-auth-event"===(null==t?void 0:t.code)}async function hn(e,t={}){return O(e,"GET","/v1/projects",t)}const dn=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,fn=/^https?/;function pn(e){const t=E(),{protocol:n,hostname:r}=new URL(t);if(e.startsWith("chrome-extension://")){const i=new URL(e);return""===i.hostname&&""===r?"chrome-extension:"===n&&e.replace("chrome-extension://","")===t.replace("chrome-extension://",""):"chrome-extension:"===n&&i.hostname===r}if(!fn.test(n))return!1;if(dn.test(e))return r===e;const i=e.replace(/\./g,"\\.");return new RegExp("^(.+\\."+i+"|"+i+")$","i").test(r)}const mn=new A(3e4,6e4);function gn(){const e=wt().___jsl;if(null==e?void 0:e.H)for(const t of Object.keys(e.H))if(e.H[t].r=e.H[t].r||[],e.H[t].L=e.H[t].L||[],e.H[t].r=[...e.H[t].L],e.CP)for(let t=0;t<e.CP.length;t++)e.CP[t]=null}let yn=null;function vn(e){return yn=yn||function(e){return new Promise(((t,n)=>{var r,i,s;function o(){gn(),gapi.load("gapi.iframes",{callback:()=>{t(gapi.iframes.getContext())},ontimeout:()=>{gn(),n(m(e,"network-request-failed"))},timeout:mn.get()})}if(null===(i=null===(r=wt().gapi)||void 0===r?void 0:r.iframes)||void 0===i?void 0:i.Iframe)t(gapi.iframes.getContext());else{if(!(null===(s=wt().gapi)||void 0===s?void 0:s.load)){const t=xt("iframefcb");return wt()[t]=()=>{gapi.load?o():n(m(e,"network-request-failed"))},Dt(`https://apis.google.com/js/api.js?onload=${t}`).catch((e=>n(e)))}o()}})).catch((e=>{throw yn=null,e}))}(e),yn}const wn=new A(5e3,15e3),_n={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},bn=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function In(e){const t=e.config;w(t.authDomain,e,"auth-domain-config-required");const n=t.emulator?C(t,"emulator/auth/iframe"):`https://${e.config.authDomain}/__/auth/iframe`,r={apiKey:t.apiKey,appName:e.name,v:s.SDK_VERSION},o=bn.get(e.config.apiHost);o&&(r.eid=o);const a=e._getFrameworks();return a.length&&(r.fw=a.join(",")),`${n}?${(0,i.xO)(r).slice(1)}`}const Tn={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"};class En{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch(e){}}}function Sn(e,t,n,r,o,a){w(e.config.authDomain,e,"auth-domain-config-required"),w(e.config.apiKey,e,"invalid-api-key");const c={apiKey:e.config.apiKey,appName:e.name,authType:n,redirectUrl:r,v:s.SDK_VERSION,eventId:o};if(t instanceof ke){t.setDefaultLanguage(e.languageCode),c.providerId=t.providerId||"",(0,i.xb)(t.getCustomParameters())||(c.customParameters=JSON.stringify(t.getCustomParameters()));for(const[e,t]of Object.entries(a||{}))c[e]=t}if(t instanceof Ae){const e=t.getScopes().filter((e=>""!==e));e.length>0&&(c.scopes=e.join(","))}e.tenantId&&(c.tid=e.tenantId);const u=c;for(const e of Object.keys(u))void 0===u[e]&&delete u[e];return`${function({config:e}){return e.emulator?C(e,"emulator/auth/handler"):`https://${e.authDomain}/__/auth/handler`}(e)}?${(0,i.xO)(u).slice(1)}`}const kn="webStorageSupport";class An extends class{constructor(e){this.factorId=e}_process(e,t,n){switch(t.type){case"enroll":return this._finalizeEnroll(e,t.credential,n);case"signin":return this._finalizeSignIn(e,t.credential);default:return _("unexpected MultiFactorSessionType")}}}{constructor(e){super("phone"),this.credential=e}static _fromCredential(e){return new An(e)}_finalizeEnroll(e,t,n){return function(e,t){return O(e,"POST","/v2/accounts/mfaEnrollment:finalize",x(e,t))}(e,{idToken:t,displayName:n,phoneVerificationInfo:this.credential._makeVerificationRequest()})}_finalizeSignIn(e,t){return function(e,t){return O(e,"POST","/v2/accounts/mfaSignIn:finalize",x(e,t))}(e,{mfaPendingCredential:t,phoneVerificationInfo:this.credential._makeVerificationRequest()})}}class Cn{constructor(){}static assertion(e){return An._fromCredential(e)}}Cn.FACTOR_ID="phone";var Nn,Rn="@firebase/auth",Dn="0.19.12";class xn{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),(null===(e=this.auth.currentUser)||void 0===e?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged((t=>{var n;e((null===(n=t)||void 0===n?void 0:n.stsTokenManager.accessToken)||null)}));this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){w(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}function On(){return window}Nn="Browser",(0,s._registerComponent)(new c.wA("auth",((e,{options:t})=>{const n=e.getProvider("app").getImmediate(),r=e.getProvider("heartbeat"),{apiKey:i,authDomain:s}=n.options;return((e,n)=>{w(i&&!i.includes(":"),"invalid-api-key",{appName:e.name}),w(!(null==s?void 0:s.includes(":")),"argument-error",{appName:e.name});const r={apiKey:i,authDomain:s,clientPlatform:Nn,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:ue(Nn)},o=new le(e,n,r);return function(e,t){const n=(null==t?void 0:t.persistence)||[],r=(Array.isArray(n)?n:[n]).map(T);(null==t?void 0:t.errorMap)&&e._updateErrorMap(t.errorMap),e._initializeWithPersistence(r,null==t?void 0:t.popupRedirectResolver)}(o,t),o})(n,r)}),"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback(((e,t,n)=>{e.getProvider("auth-internal").initialize()}))),(0,s._registerComponent)(new c.wA("auth-internal",(e=>{return t=he(e.getProvider("auth").getImmediate()),new xn(t);var t}),"PRIVATE").setInstantiationMode("EXPLICIT")),(0,s.registerVersion)(Rn,Dn,void 0),(0,s.registerVersion)(Rn,Dn,"esm2017");class Pn extends cn{constructor(){super(...arguments),this.passiveListeners=new Set,this.initPromise=new Promise((e=>{this.resolveInialized=e}))}addPassiveListener(e){this.passiveListeners.add(e)}removePassiveListener(e){this.passiveListeners.delete(e)}resetRedirect(){this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1}onEvent(e){return this.resolveInialized(),this.passiveListeners.forEach((t=>t(e))),super.onEvent(e)}async initialized(){await this.initPromise}}async function Ln(e){const t=await Un()._get(Fn(e));return t&&await Un()._remove(Fn(e)),t}function Mn(){const e=[],t="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let n=0;n<20;n++){const n=Math.floor(Math.random()*t.length);e.push(t.charAt(n))}return e.join("")}function Un(){return T(ft)}function Fn(e){return X("authEvent",e.config.apiKey,e.name)}function Vn(e){if(!(null==e?void 0:e.includes("?")))return{};const[t,...n]=e.split("?");return(0,i.zd)(n.join("?"))}function qn(){return{type:"unknown",eventId:null,sessionId:null,urlResponse:null,postBody:null,tenantId:null,error:m("no-auth-event")}}function Bn(){var e;return(null===(e=null===self||void 0===self?void 0:self.location)||void 0===e?void 0:e.protocol)||null}function jn(e=(0,i.z$)()){return!("file:"!==Bn()&&"ionic:"!==Bn()||!e.toLowerCase().match(/iphone|ipad|ipod|android/))}function $n(){try{const e=self.localStorage,t=yt();if(e)return e.setItem(t,"1"),e.removeItem(t),!function(e=(0,i.z$)()){return(0,i.w1)()&&11===(null===document||void 0===document?void 0:document.documentMode)||function(e=(0,i.z$)()){return/Edge\/\d+/.test(e)}(e)}()||(0,i.hl)()}catch(e){return zn()&&(0,i.hl)()}return!1}function zn(){return void 0!==n.g&&"WorkerGlobalScope"in n.g&&"importScripts"in n.g}function Gn(){return("http:"===Bn()||"https:"===Bn()||(0,i.ru)()||jn())&&!((0,i.b$)()||(0,i.UG)())&&$n()&&!zn()}function Kn(){return jn()&&"undefined"!=typeof document}const Hn={LOCAL:"local",NONE:"none",SESSION:"session"},Wn=w,Yn="persistence";async function Qn(e){await e._initializationPromise;const t=Xn(),n=X(Yn,e.config.apiKey,e.name);t&&t.setItem(n,e._getPersistence())}function Xn(){var e;try{return(null===(e="undefined"!=typeof window?window:null)||void 0===e?void 0:e.sessionStorage)||null}catch(e){return null}}const Jn=w;class Zn{constructor(){this.browserResolver=T(class{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=mt,this._completeRedirectFn=on}async _openPopup(e,t,n,r){var s;return b(null===(s=this.eventManagers[e._key()])||void 0===s?void 0:s.manager,"_initialize() not called before _openPopup()"),function(e,t,n,r=500,s=600){const o=Math.max((window.screen.availHeight-s)/2,0).toString(),a=Math.max((window.screen.availWidth-r)/2,0).toString();let c="";const u=Object.assign(Object.assign({},Tn),{width:r.toString(),height:s.toString(),top:o,left:a}),l=(0,i.z$)().toLowerCase();n&&(c=ne(l)?"_blank":n),ee(l)&&(t=t||"http://localhost",u.scrollbars="yes");const h=Object.entries(u).reduce(((e,[t,n])=>`${e}${t}=${n},`),"");if(function(e=(0,i.z$)()){var t;return ae(e)&&!!(null===(t=window.navigator)||void 0===t?void 0:t.standalone)}(l)&&"_self"!==c)return function(e,t){const n=document.createElement("a");n.href=e,n.target=t;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(r)}(t||"",c),new En(null);const d=window.open(t||"",c,h);w(d,e,"popup-blocked");try{d.focus()}catch(e){}return new En(d)}(e,Sn(e,t,n,E(),r),yt())}async _openRedirect(e,t,n,r){var i;return await this._originValidation(e),i=Sn(e,t,n,E(),r),wt().location.href=i,new Promise((()=>{}))}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:e,promise:n}=this.eventManagers[t];return e?Promise.resolve(e):(b(n,"If manager is not set, promise should be"),n)}const n=this.initAndGetManager(e);return this.eventManagers[t]={promise:n},n.catch((()=>{delete this.eventManagers[t]})),n}async initAndGetManager(e){const t=await async function(e){const t=await vn(e),n=wt().gapi;return w(n,e,"internal-error"),t.open({where:document.body,url:In(e),messageHandlersFilter:n.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:_n,dontclear:!0},(t=>new Promise((async(n,r)=>{await t.restyle({setHideOnLeave:!1});const i=m(e,"network-request-failed"),s=wt().setTimeout((()=>{r(i)}),wn.get());function o(){wt().clearTimeout(s),n(t)}t.ping(o).then(o,(()=>{r(i)}))}))))}(e),n=new cn(e);return t.register("authEvent",(t=>(w(null==t?void 0:t.authEvent,e,"invalid-auth-event"),{status:n.onEvent(t.authEvent)?"ACK":"ERROR"})),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:n},this.iframes[e._key()]=t,n}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(kn,{type:kn},(n=>{var r;const i=null===(r=null==n?void 0:n[0])||void 0===r?void 0:r.webStorageSupport;void 0!==i&&t(!!i),p(e,"internal-error")}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=async function(e){if(e.config.emulator)return;const{authorizedDomains:t}=await hn(e);for(const e of t)try{if(pn(e))return}catch(e){}p(e,"unauthorized-domain")}(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return ce()||te()||ae()}}),this.cordovaResolver=T(class{constructor(){this._redirectPersistence=mt,this._shouldInitProactively=!0,this.eventManagers=new Map,this.originValidationPromises={},this._completeRedirectFn=on}async _initialize(e){const t=e._key();let n=this.eventManagers.get(t);return n||(n=new Pn(e),this.eventManagers.set(t,n),this.attachCallbackListeners(e,n)),n}_openPopup(e){p(e,"operation-not-supported-in-this-environment")}async _openRedirect(e,t,n,r){!function(e){var t,n,r,i,s,o,a,c,u,l;const h=On();w("function"==typeof(null===(t=null==h?void 0:h.universalLinks)||void 0===t?void 0:t.subscribe),e,"invalid-cordova-configuration",{missingPlugin:"cordova-universal-links-plugin-fix"}),w(void 0!==(null===(n=null==h?void 0:h.BuildInfo)||void 0===n?void 0:n.packageName),e,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-buildInfo"}),w("function"==typeof(null===(s=null===(i=null===(r=null==h?void 0:h.cordova)||void 0===r?void 0:r.plugins)||void 0===i?void 0:i.browsertab)||void 0===s?void 0:s.openUrl),e,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-browsertab"}),w("function"==typeof(null===(c=null===(a=null===(o=null==h?void 0:h.cordova)||void 0===o?void 0:o.plugins)||void 0===a?void 0:a.browsertab)||void 0===c?void 0:c.isAvailable),e,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-browsertab"}),w("function"==typeof(null===(l=null===(u=null==h?void 0:h.cordova)||void 0===u?void 0:u.InAppBrowser)||void 0===l?void 0:l.open),e,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-inappbrowser"})}(e);const s=await this._initialize(e);await s.initialized(),s.resetRedirect(),en.clear(),await this._originValidation(e);const o=function(e,t,n=null){return{type:t,eventId:n,urlResponse:null,sessionId:Mn(),postBody:null,tenantId:e.tenantId,error:m(e,"no-auth-event")}}(e,n,r);await function(e,t){return Un()._set(Fn(e),t)}(e,o);const a=await async function(e,t,n){var r;const{BuildInfo:i}=On();b(t.sessionId,"AuthEvent did not contain a session ID");const s=await async function(e){const t=function(e){if(b(/[0-9a-zA-Z]+/.test(e),"Can only convert alpha-numeric strings"),"undefined"!=typeof TextEncoder)return(new TextEncoder).encode(e);const t=new ArrayBuffer(e.length),n=new Uint8Array(t);for(let t=0;t<e.length;t++)n[t]=e.charCodeAt(t);return n}(e),n=await crypto.subtle.digest("SHA-256",t);return Array.from(new Uint8Array(n)).map((e=>e.toString(16).padStart(2,"0"))).join("")}(t.sessionId),o={};return ae()?o.ibi=i.packageName:ie()?o.apn=i.packageName:p(e,"operation-not-supported-in-this-environment"),i.displayName&&(o.appDisplayName=i.displayName),o.sessionId=s,Sn(e,n,t.type,void 0,null!==(r=t.eventId)&&void 0!==r?r:void 0,o)}(e,o,t);return async function(e,t,n){const{cordova:r}=On();let i=()=>{};try{await new Promise(((s,o)=>{let a=null;function c(){var e;s();const t=null===(e=r.plugins.browsertab)||void 0===e?void 0:e.close;"function"==typeof t&&t(),"function"==typeof(null==n?void 0:n.close)&&n.close()}function u(){a||(a=window.setTimeout((()=>{o(m(e,"redirect-cancelled-by-user"))}),2e3))}function l(){"visible"===(null===document||void 0===document?void 0:document.visibilityState)&&u()}t.addPassiveListener(c),document.addEventListener("resume",u,!1),ie()&&document.addEventListener("visibilitychange",l,!1),i=()=>{t.removePassiveListener(c),document.removeEventListener("resume",u,!1),document.removeEventListener("visibilitychange",l,!1),a&&window.clearTimeout(a)}}))}finally{i()}}(e,s,await function(e){const{cordova:t}=On();return new Promise((n=>{t.plugins.browsertab.isAvailable((r=>{let s=null;r?t.plugins.browsertab.openUrl(e):s=t.InAppBrowser.open(e,function(e=(0,i.z$)()){return/(iPad|iPhone|iPod).*OS 7_\d/i.test(e)||/(iPad|iPhone|iPod).*OS 8_\d/i.test(e)}()?"_blank":"_system","location=yes"),n(s)}))}))}(a))}_isIframeWebStorageSupported(e,t){throw new Error("Method not implemented.")}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=async function(e){const{BuildInfo:t}=On(),n={};ae()?n.iosBundleId=t.packageName:ie()?n.androidPackageName=t.packageName:p(e,"operation-not-supported-in-this-environment"),await hn(e,n)}(e)),this.originValidationPromises[t]}attachCallbackListeners(e,t){const{universalLinks:n,handleOpenURL:r,BuildInfo:i}=On(),s=setTimeout((async()=>{await Ln(e),t.onEvent(qn())}),500),o=async n=>{clearTimeout(s);const r=await Ln(e);let i=null;r&&(null==n?void 0:n.url)&&(i=function(e,t){var n,r;const i=function(e){const t=Vn(e),n=t.link?decodeURIComponent(t.link):void 0,r=Vn(n).link,i=t.deep_link_id?decodeURIComponent(t.deep_link_id):void 0;return Vn(i).link||i||r||n||e}(t);if(i.includes("/__/auth/callback")){const t=Vn(i),s=t.firebaseError?function(e){try{return JSON.parse(e)}catch(e){return null}}(decodeURIComponent(t.firebaseError)):null,o=null===(r=null===(n=null==s?void 0:s.code)||void 0===n?void 0:n.split("auth/"))||void 0===r?void 0:r[1],a=o?m(o):null;return a?{type:e.type,eventId:e.eventId,tenantId:e.tenantId,error:a,urlResponse:null,sessionId:null,postBody:null}:{type:e.type,eventId:e.eventId,tenantId:e.tenantId,sessionId:e.sessionId,urlResponse:i,postBody:null}}return null}(r,n.url)),t.onEvent(i||qn())};void 0!==n&&"function"==typeof n.subscribe&&n.subscribe(null,o);const a=r,c=`${i.packageName.toLowerCase()}://`;On().handleOpenURL=async e=>{if(e.toLowerCase().startsWith(c)&&o({url:e}),"function"==typeof a)try{a(e)}catch(e){console.error(e)}}}}),this.underlyingResolver=null,this._redirectPersistence=mt,this._completeRedirectFn=on}async _initialize(e){return await this.selectUnderlyingResolver(),this.assertedUnderlyingResolver._initialize(e)}async _openPopup(e,t,n,r){return await this.selectUnderlyingResolver(),this.assertedUnderlyingResolver._openPopup(e,t,n,r)}async _openRedirect(e,t,n,r){return await this.selectUnderlyingResolver(),this.assertedUnderlyingResolver._openRedirect(e,t,n,r)}_isIframeWebStorageSupported(e,t){this.assertedUnderlyingResolver._isIframeWebStorageSupported(e,t)}_originValidation(e){return this.assertedUnderlyingResolver._originValidation(e)}get _shouldInitProactively(){return Kn()||this.browserResolver._shouldInitProactively}get assertedUnderlyingResolver(){return Jn(this.underlyingResolver,"internal-error"),this.underlyingResolver}async selectUnderlyingResolver(){if(this.underlyingResolver)return;const e=await async function(){return!!Kn()&&new Promise((e=>{const t=setTimeout((()=>{e(!1)}),1e3);document.addEventListener("deviceready",(()=>{clearTimeout(t),e(!0)}))}))}();this.underlyingResolver=e?this.cordovaResolver:this.browserResolver}}function er(e){return e.unwrap()}function tr(e){const{_tokenResponse:t}=e instanceof i.ZR?e.customData:e;if(!t)return null;if(!(e instanceof i.ZR)&&"temporaryProof"in t&&"phoneNumber"in t)return Gt.credentialFromResult(e);const n=t.providerId;if(!n||"password"===n)return null;let r;switch(n){case"google.com":r=Re;break;case"facebook.com":r=Ne;break;case"github.com":r=De;break;case"twitter.com":r=Pe;break;default:const{oauthIdToken:e,oauthAccessToken:i,oauthTokenSecret:s,pendingToken:o,nonce:a}=t;return i||s||e||o?o?n.startsWith("saml.")?xe._create(n,o):be._fromParams({providerId:n,signInMethod:n,pendingToken:o,idToken:e,accessToken:i}):new Ce(n).credential({idToken:e,accessToken:i,rawNonce:a}):null}return e instanceof i.ZR?r.credentialFromError(e):r.credentialFromResult(e)}function nr(e,t){return t.catch((t=>{throw t instanceof i.ZR&&function(e,t){var n;const r=null===(n=t.customData)||void 0===n?void 0:n._tokenResponse;if("auth/multi-factor-auth-required"===t.code)t.resolver=new ir(e,function(e,t){var n;const r=(0,i.m9)(e),s=t;return w(t.customData.operationType,r,"argument-error"),w(null===(n=s.customData._serverResponse)||void 0===n?void 0:n.mfaPendingCredential,r,"argument-error"),at._fromError(r,s)}(e,t));else if(r){const e=tr(t),n=t;e&&(n.credential=e,n.tenantId=r.tenantId||void 0,n.email=r.email||void 0,n.phoneNumber=r.phoneNumber||void 0)}}(e,t),t})).then((e=>{const t=e.operationType,n=e.user;return{operationType:t,credential:(r=e,tr(r)),additionalUserInfo:st(e),user:sr.getOrCreate(n)};var r}))}async function rr(e,t){const n=await t;return{verificationId:n.verificationId,confirm:t=>nr(e,n.confirm(t))}}class ir{constructor(e,t){this.resolver=t,this.auth=e.wrapped()}get session(){return this.resolver.session}get hints(){return this.resolver.hints}resolveSignIn(e){return nr(er(this.auth),this.resolver.resolveSignIn(e))}}class sr{constructor(e){this._delegate=e,this.multiFactor=function(e){const t=(0,i.m9)(e);return ut.has(t)||ut.set(t,ct._fromUser(t)),ut.get(t)}(e)}static getOrCreate(e){return sr.USER_MAP.has(e)||sr.USER_MAP.set(e,new sr(e)),sr.USER_MAP.get(e)}delete(){return this._delegate.delete()}reload(){return this._delegate.reload()}toJSON(){return this._delegate.toJSON()}getIdTokenResult(e){return this._delegate.getIdTokenResult(e)}getIdToken(e){return this._delegate.getIdToken(e)}linkAndRetrieveDataWithCredential(e){return this.linkWithCredential(e)}async linkWithCredential(e){return nr(this.auth,Ke(this._delegate,e))}async linkWithPhoneNumber(e,t){return rr(this.auth,async function(e,t,n){const r=(0,i.m9)(e);await je(!1,r,"phone");const s=await zt(r.auth,t,(0,i.m9)(n));return new $t(s,(e=>Ke(r,e)))}(this._delegate,e,t))}async linkWithPopup(e){return nr(this.auth,async function(e,t,n){const r=(0,i.m9)(e);y(r.auth,t,ke);const s=Kt(r.auth,n);return new Zt(r.auth,"linkViaPopup",t,s,r).executeNotNull()}(this._delegate,e,Zn))}async linkWithRedirect(e){return await Qn(he(this.auth)),function(e,t,n){return async function(e,t,n){const r=(0,i.m9)(e);y(r.auth,t,ke);const s=Kt(r.auth,n);await je(!1,r,t.providerId),await nn(s,r.auth);const o=await an(r);return s._openRedirect(r.auth,t,"linkViaRedirect",o)}(e,t,n)}(this._delegate,e,Zn)}reauthenticateAndRetrieveDataWithCredential(e){return this.reauthenticateWithCredential(e)}async reauthenticateWithCredential(e){return nr(this.auth,He(this._delegate,e))}reauthenticateWithPhoneNumber(e,t){return rr(this.auth,async function(e,t,n){const r=(0,i.m9)(e),s=await zt(r.auth,t,(0,i.m9)(n));return new $t(s,(e=>He(r,e)))}(this._delegate,e,t))}reauthenticateWithPopup(e){return nr(this.auth,async function(e,t,n){const r=(0,i.m9)(e);y(r.auth,t,ke);const s=Kt(r.auth,n);return new Zt(r.auth,"reauthViaPopup",t,s,r).executeNotNull()}(this._delegate,e,Zn))}async reauthenticateWithRedirect(e){return await Qn(he(this.auth)),function(e,t,n){return async function(e,t,n){const r=(0,i.m9)(e);y(r.auth,t,ke);const s=Kt(r.auth,n);await nn(s,r.auth);const o=await an(r);return s._openRedirect(r.auth,t,"reauthViaRedirect",o)}(e,t,n)}(this._delegate,e,Zn)}sendEmailVerification(e){return async function(e,t){const n=(0,i.m9)(e),r={requestType:"VERIFY_EMAIL",idToken:await e.getIdToken()};t&&Qe(n.auth,r,t);const{email:s}=await async function(e,t){return ve(e,t)}(n.auth,r);s!==e.email&&await e.reload()}(this._delegate,e)}async unlink(e){return await async function(e,t){const n=(0,i.m9)(e);await je(!0,n,t);const{providerUserInfo:r}=await async function(e,t){return O(e,"POST","/v1/accounts:update",t)}(n.auth,{idToken:await n.getIdToken(),deleteProvider:[t]}),s=qe(r||[]);return n.providerData=n.providerData.filter((e=>s.has(e.providerId))),s.has("phone")||(n.phoneNumber=null),await n.auth._persistUserIfCurrent(n),n}(this._delegate,e),this}updateEmail(e){return function(e,t){return Je((0,i.m9)(e),t,null)}(this._delegate,e)}updatePassword(e){return function(e,t){return Je((0,i.m9)(e),null,t)}(this._delegate,e)}updatePhoneNumber(e){return async function(e,t){await Be((0,i.m9)(e),t)}(this._delegate,e)}updateProfile(e){return async function(e,{displayName:t,photoURL:n}){if(void 0===t&&void 0===n)return;const r=(0,i.m9)(e),s={idToken:await r.getIdToken(),displayName:t,photoUrl:n,returnSecureToken:!0},o=await j(r,async function(e,t){return O(e,"POST","/v1/accounts:update",t)}(r.auth,s));r.displayName=o.displayName||null,r.photoURL=o.photoUrl||null;const a=r.providerData.find((({providerId:e})=>"password"===e));a&&(a.displayName=r.displayName,a.photoURL=r.photoURL),await r._updateTokensIfNecessary(o)}(this._delegate,e)}verifyBeforeUpdateEmail(e,t){return async function(e,t,n){const r=(0,i.m9)(e),s={requestType:"VERIFY_AND_CHANGE_EMAIL",idToken:await e.getIdToken(),newEmail:t};n&&Qe(r.auth,s,n);const{email:o}=await async function(e,t){return ve(e,t)}(r.auth,s);o!==e.email&&await e.reload()}(this._delegate,e,t)}get emailVerified(){return this._delegate.emailVerified}get isAnonymous(){return this._delegate.isAnonymous}get metadata(){return this._delegate.metadata}get phoneNumber(){return this._delegate.phoneNumber}get providerData(){return this._delegate.providerData}get refreshToken(){return this._delegate.refreshToken}get tenantId(){return this._delegate.tenantId}get displayName(){return this._delegate.displayName}get email(){return this._delegate.email}get photoURL(){return this._delegate.photoURL}get providerId(){return this._delegate.providerId}get uid(){return this._delegate.uid}get auth(){return this._delegate.auth}}sr.USER_MAP=new WeakMap;const or=w;class ar{constructor(e,t){if(this.app=e,t.isInitialized())return this._delegate=t.getImmediate(),void this.linkUnderlyingAuth();const{apiKey:n}=e.options;or(n,"invalid-api-key",{appName:e.name}),or(n,"invalid-api-key",{appName:e.name});const r="undefined"!=typeof window?Zn:void 0;this._delegate=t.initialize({options:{persistence:ur(n,e.name),popupRedirectResolver:r}}),this._delegate._updateErrorMap(u),this.linkUnderlyingAuth()}get emulatorConfig(){return this._delegate.emulatorConfig}get currentUser(){return this._delegate.currentUser?sr.getOrCreate(this._delegate.currentUser):null}get languageCode(){return this._delegate.languageCode}set languageCode(e){this._delegate.languageCode=e}get settings(){return this._delegate.settings}get tenantId(){return this._delegate.tenantId}set tenantId(e){this._delegate.tenantId=e}useDeviceLanguage(){this._delegate.useDeviceLanguage()}signOut(){return this._delegate.signOut()}useEmulator(e,t){!function(e,t,n){const r=he(e);w(r._canInitEmulator,r,"emulator-config-failed"),w(/^https?:\/\//.test(t),r,"invalid-emulator-scheme");const i=!!(null==n?void 0:n.disableWarnings),s=fe(t),{host:o,port:a}=function(e){const t=fe(e),n=/(\/\/)?([^?#/]+)/.exec(e.substr(t.length));if(!n)return{host:"",port:null};const r=n[2].split("@").pop()||"",i=/^(\[[^\]]+\])(:|$)/.exec(r);if(i){const e=i[1];return{host:e,port:pe(r.substr(e.length+1))}}{const[e,t]=r.split(":");return{host:e,port:pe(t)}}}(t),c=null===a?"":`:${a}`;r.config.emulator={url:`${s}//${o}${c}/`},r.settings.appVerificationDisabledForTesting=!0,r.emulatorConfig=Object.freeze({host:o,port:a,protocol:s.replace(":",""),options:Object.freeze({disableWarnings:i})}),i||function(){function e(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}"undefined"!=typeof console&&"function"==typeof console.info&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),"undefined"!=typeof window&&"undefined"!=typeof document&&("loading"===document.readyState?window.addEventListener("DOMContentLoaded",e):e())}()}(this._delegate,e,t)}applyActionCode(e){return async function(e,t){await async function(e,t){return O(e,"POST","/v1/accounts:update",x(e,t))}((0,i.m9)(e),{oobCode:t})}(this._delegate,e)}checkActionCode(e){return Xe(this._delegate,e)}confirmPasswordReset(e,t){return async function(e,t,n){await ge((0,i.m9)(e),{oobCode:t,newPassword:n})}(this._delegate,e,t)}async createUserWithEmailAndPassword(e,t){return nr(this._delegate,async function(e,t,n){const r=he(e),i=await Le(r,{returnSecureToken:!0,email:t,password:n}),s=await Me._fromIdTokenResponse(r,"signIn",i);return await r._updateCurrentUser(s.user),s}(this._delegate,e,t))}fetchProvidersForEmail(e){return this.fetchSignInMethodsForEmail(e)}fetchSignInMethodsForEmail(e){return async function(e,t){const n={identifier:t,continueUri:S()?E():"http://localhost"},{signinMethods:r}=await async function(e,t){return O(e,"POST","/v1/accounts:createAuthUri",x(e,t))}((0,i.m9)(e),n);return r||[]}(this._delegate,e)}isSignInWithEmailLink(e){return function(e,t){const n=Ee.parseLink(t);return"EMAIL_SIGNIN"===(null==n?void 0:n.operation)}(this._delegate,e)}async getRedirectResult(){or(Gn(),this._delegate,"operation-not-supported-in-this-environment");const e=await async function(e,t){return await he(e)._initializationPromise,on(e,t,!1)}(this._delegate,Zn);return e?nr(this._delegate,Promise.resolve(e)):{credential:null,user:null}}addFrameworkForLogging(e){!function(e,t){he(e)._logFramework(t)}(this._delegate,e)}onAuthStateChanged(e,t,n){const{next:r,error:i,complete:s}=cr(e,t,n);return this._delegate.onAuthStateChanged(r,i,s)}onIdTokenChanged(e,t,n){const{next:r,error:i,complete:s}=cr(e,t,n);return this._delegate.onIdTokenChanged(r,i,s)}sendSignInLinkToEmail(e,t){return async function(e,t,n){const r=(0,i.m9)(e),s={requestType:"EMAIL_SIGNIN",email:t};w(n.handleCodeInApp,r,"argument-error"),n&&Qe(r,s,n),await async function(e,t){return ve(e,t)}(r,s)}(this._delegate,e,t)}sendPasswordResetEmail(e,t){return async function(e,t,n){const r=(0,i.m9)(e),s={requestType:"PASSWORD_RESET",email:t};n&&Qe(r,s,n),await async function(e,t){return ve(e,t)}(r,s)}(this._delegate,e,t||void 0)}async setPersistence(e){let t;switch(function(e,t){Wn(Object.values(Hn).includes(t),e,"invalid-persistence-type"),(0,i.b$)()?Wn(t!==Hn.SESSION,e,"unsupported-persistence-type"):(0,i.UG)()?Wn(t===Hn.NONE,e,"unsupported-persistence-type"):zn()?Wn(t===Hn.NONE||t===Hn.LOCAL&&(0,i.hl)(),e,"unsupported-persistence-type"):Wn(t===Hn.NONE||$n(),e,"unsupported-persistence-type")}(this._delegate,e),e){case Hn.SESSION:t=mt;break;case Hn.LOCAL:t=await T(Rt)._isAvailable()?Rt:ft;break;case Hn.NONE:t=Q;break;default:return p("argument-error",{appName:this._delegate.name})}return this._delegate.setPersistence(t)}signInAndRetrieveDataWithCredential(e){return this.signInWithCredential(e)}signInAnonymously(){return nr(this._delegate,async function(e){var t;const n=he(e);if(await n._initializationPromise,null===(t=n.currentUser)||void 0===t?void 0:t.isAnonymous)return new Me({user:n.currentUser,providerId:null,operationType:"signIn"});const r=await Le(n,{returnSecureToken:!0}),i=await Me._fromIdTokenResponse(n,"signIn",r,!0);return await n._updateCurrentUser(i.user),i}(this._delegate))}signInWithCredential(e){return nr(this._delegate,Ge(this._delegate,e))}signInWithCustomToken(e){return nr(this._delegate,async function(e,t){const n=he(e),r=await async function(e,t){return L(e,"POST","/v1/accounts:signInWithCustomToken",x(e,t))}(n,{token:t,returnSecureToken:!0}),i=await Me._fromIdTokenResponse(n,"signIn",r);return await n._updateCurrentUser(i.user),i}(this._delegate,e))}signInWithEmailAndPassword(e,t){return nr(this._delegate,function(e,t,n){return Ge((0,i.m9)(e),Se.credential(t,n))}(this._delegate,e,t))}signInWithEmailLink(e,t){return nr(this._delegate,async function(e,t,n){const r=(0,i.m9)(e),s=Se.credentialWithLink(t,n||E());return w(s._tenantId===(r.tenantId||null),r,"tenant-id-mismatch"),Ge(r,s)}(this._delegate,e,t))}signInWithPhoneNumber(e,t){return rr(this._delegate,async function(e,t,n){const r=he(e),s=await zt(r,t,(0,i.m9)(n));return new $t(s,(e=>Ge(r,e)))}(this._delegate,e,t))}async signInWithPopup(e){return or(Gn(),this._delegate,"operation-not-supported-in-this-environment"),nr(this._delegate,async function(e,t,n){const r=he(e);y(e,t,ke);const i=Kt(r,n);return new Zt(r,"signInViaPopup",t,i).executeNotNull()}(this._delegate,e,Zn))}async signInWithRedirect(e){return or(Gn(),this._delegate,"operation-not-supported-in-this-environment"),await Qn(this._delegate),function(e,t,n){return async function(e,t,n){const r=he(e);y(e,t,ke);const i=Kt(r,n);return await nn(i,r),i._openRedirect(r,t,"signInViaRedirect")}(e,t,n)}(this._delegate,e,Zn)}updateCurrentUser(e){return this._delegate.updateCurrentUser(e)}verifyPasswordResetCode(e){return async function(e,t){const{data:n}=await Xe((0,i.m9)(e),t);return n.email}(this._delegate,e)}unwrap(){return this._delegate}_delete(){return this._delegate._delete()}linkUnderlyingAuth(){this._delegate.wrapped=()=>this}}function cr(e,t,n){let r=e;"function"!=typeof e&&({next:r,error:t,complete:n}=e);const i=r;return{next:e=>i(e&&sr.getOrCreate(e)),error:t,complete:n}}function ur(e,t){const n=function(e,t){const n=Xn();if(!n)return[];const r=X(Yn,e,t);switch(n.getItem(r)){case Hn.NONE:return[Q];case Hn.LOCAL:return[Rt,mt];case Hn.SESSION:return[mt];default:return[]}}(e,t);if("undefined"==typeof self||n.includes(Rt)||n.push(Rt),"undefined"!=typeof window)for(const e of[ft,mt])n.includes(e)||n.push(e);return n.includes(Q)||n.push(Q),n}ar.Persistence=Hn;class lr{constructor(){this.providerId="phone",this._delegate=new Gt(er(r.Z.auth()))}static credential(e,t){return Gt.credential(e,t)}verifyPhoneNumber(e,t){return this._delegate.verifyPhoneNumber(e,t)}unwrap(){return this._delegate}}lr.PHONE_SIGN_IN_METHOD=Gt.PHONE_SIGN_IN_METHOD,lr.PROVIDER_ID=Gt.PROVIDER_ID;const hr=w;var dr;(dr=r.Z).INTERNAL.registerComponent(new c.wA("auth-compat",(e=>{const t=e.getProvider("app-compat").getImmediate(),n=e.getProvider("auth");return new ar(t,n)}),"PUBLIC").setServiceProps({ActionCodeInfo:{Operation:{EMAIL_SIGNIN:"EMAIL_SIGNIN",PASSWORD_RESET:"PASSWORD_RESET",RECOVER_EMAIL:"RECOVER_EMAIL",REVERT_SECOND_FACTOR_ADDITION:"REVERT_SECOND_FACTOR_ADDITION",VERIFY_AND_CHANGE_EMAIL:"VERIFY_AND_CHANGE_EMAIL",VERIFY_EMAIL:"VERIFY_EMAIL"}},EmailAuthProvider:Se,FacebookAuthProvider:Ne,GithubAuthProvider:De,GoogleAuthProvider:Re,OAuthProvider:Ce,SAMLAuthProvider:Oe,PhoneAuthProvider:lr,PhoneMultiFactorGenerator:Cn,RecaptchaVerifier:class{constructor(e,t,n=r.Z.app()){var i;hr(null===(i=n.options)||void 0===i?void 0:i.apiKey,"invalid-api-key",{appName:n.name}),this._delegate=new jt(e,t,n.auth()),this.type=this._delegate.type}clear(){this._delegate.clear()}render(){return this._delegate.render()}verify(){return this._delegate.verify()}},TwitterAuthProvider:Pe,Auth:ar,AuthCredential:me,Error:i.ZR}).setInstantiationMode("LAZY").setMultipleInstances(!1)),dr.registerVersion("@firebase/auth-compat","0.2.12")},34507:(e,t,n)=>{var r,i=n(98180),s=n(32238),o=n(8463),a=n(53333),c=n(74444),u="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==n.g?n.g:"undefined"!=typeof self?self:{},l={},h=h||{},d=u||self;function f(){}function p(e){var t=typeof e;return"array"==(t="object"!=t?t:e?Array.isArray(e)?"array":t:"null")||"object"==t&&"number"==typeof e.length}function m(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}var g="closure_uid_"+(1e9*Math.random()>>>0),y=0;function v(e,t,n){return e.call.apply(e.bind,arguments)}function w(e,t,n){if(!e)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),e.apply(t,n)}}return function(){return e.apply(t,arguments)}}function _(e,t,n){return(_=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?v:w).apply(null,arguments)}function b(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}function I(e,t){function n(){}n.prototype=t.prototype,e.Z=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.Vb=function(e,n,r){for(var i=Array(arguments.length-2),s=2;s<arguments.length;s++)i[s-2]=arguments[s];return t.prototype[n].apply(e,i)}}function T(){this.s=this.s,this.o=this.o}var E={};T.prototype.s=!1,T.prototype.na=function(){if(!this.s&&(this.s=!0,this.M(),0)){var e=function(e){return Object.prototype.hasOwnProperty.call(e,g)&&e[g]||(e[g]=++y)}(this);delete E[e]}},T.prototype.M=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const S=Array.prototype.indexOf?function(e,t){return Array.prototype.indexOf.call(e,t,void 0)}:function(e,t){if("string"==typeof e)return"string"!=typeof t||1!=t.length?-1:e.indexOf(t,0);for(let n=0;n<e.length;n++)if(n in e&&e[n]===t)return n;return-1},k=Array.prototype.forEach?function(e,t,n){Array.prototype.forEach.call(e,t,n)}:function(e,t,n){const r=e.length,i="string"==typeof e?e.split(""):e;for(let s=0;s<r;s++)s in i&&t.call(n,i[s],s,e)};function A(e){return Array.prototype.concat.apply([],arguments)}function C(e){const t=e.length;if(0<t){const n=Array(t);for(let r=0;r<t;r++)n[r]=e[r];return n}return[]}function N(e){return/^[\s\xa0]*$/.test(e)}var R,D=String.prototype.trim?function(e){return e.trim()}:function(e){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(e)[1]};function x(e,t){return-1!=e.indexOf(t)}function O(e,t){return e<t?-1:e>t?1:0}e:{var P=d.navigator;if(P){var L=P.userAgent;if(L){R=L;break e}}R=""}function M(e,t,n){for(const r in e)t.call(n,e[r],r,e)}function U(e){const t={};for(const n in e)t[n]=e[n];return t}var F="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function V(e,t){let n,r;for(let t=1;t<arguments.length;t++){for(n in r=arguments[t],r)e[n]=r[n];for(let t=0;t<F.length;t++)n=F[t],Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}}function q(e){return q[" "](e),e}q[" "]=f;var B,j,$=x(R,"Opera"),z=x(R,"Trident")||x(R,"MSIE"),G=x(R,"Edge"),K=G||z,H=x(R,"Gecko")&&!(x(R.toLowerCase(),"webkit")&&!x(R,"Edge"))&&!(x(R,"Trident")||x(R,"MSIE"))&&!x(R,"Edge"),W=x(R.toLowerCase(),"webkit")&&!x(R,"Edge");function Y(){var e=d.document;return e?e.documentMode:void 0}e:{var Q="",X=(j=R,H?/rv:([^\);]+)(\)|;)/.exec(j):G?/Edge\/([\d\.]+)/.exec(j):z?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(j):W?/WebKit\/(\S+)/.exec(j):$?/(?:Version)[ \/]?(\S+)/.exec(j):void 0);if(X&&(Q=X?X[1]:""),z){var J=Y();if(null!=J&&J>parseFloat(Q)){B=String(J);break e}}B=Q}var Z,ee={};function te(){return e=ee,Object.prototype.hasOwnProperty.call(e,9)?e[9]:e[9]=function(){let e=0;const t=D(String(B)).split("."),n=D("9").split("."),r=Math.max(t.length,n.length);for(let o=0;0==e&&o<r;o++){var i=t[o]||"",s=n[o]||"";do{if(i=/(\d*)(\D*)(.*)/.exec(i)||["","","",""],s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],0==i[0].length&&0==s[0].length)break;e=O(0==i[1].length?0:parseInt(i[1],10),0==s[1].length?0:parseInt(s[1],10))||O(0==i[2].length,0==s[2].length)||O(i[2],s[2]),i=i[3],s=s[3]}while(0==e)}return 0<=e}();var e}d.document&&z?Z=Y()||parseInt(B,10)||void 0:Z=void 0;var ne=Z,re=function(){if(!d.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{d.addEventListener("test",f,t),d.removeEventListener("test",f,t)}catch(e){}return e}();function ie(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}function se(e,t){if(ie.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e){var n=this.type=e.type,r=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;if(this.target=e.target||e.srcElement,this.g=t,t=e.relatedTarget){if(H){e:{try{q(t.nodeName);var i=!0;break e}catch(e){}i=!1}i||(t=null)}}else"mouseover"==n?t=e.fromElement:"mouseout"==n&&(t=e.toElement);this.relatedTarget=t,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType="string"==typeof e.pointerType?e.pointerType:oe[e.pointerType]||"",this.state=e.state,this.i=e,e.defaultPrevented&&se.Z.h.call(this)}}ie.prototype.h=function(){this.defaultPrevented=!0},I(se,ie);var oe={2:"touch",3:"pen",4:"mouse"};se.prototype.h=function(){se.Z.h.call(this);var e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var ae="closure_listenable_"+(1e6*Math.random()|0),ce=0;function ue(e,t,n,r,i){this.listener=e,this.proxy=null,this.src=t,this.type=n,this.capture=!!r,this.ia=i,this.key=++ce,this.ca=this.fa=!1}function le(e){e.ca=!0,e.listener=null,e.proxy=null,e.src=null,e.ia=null}function he(e){this.src=e,this.g={},this.h=0}function de(e,t){var n=t.type;if(n in e.g){var r,i=e.g[n],s=S(i,t);(r=0<=s)&&Array.prototype.splice.call(i,s,1),r&&(le(t),0==e.g[n].length&&(delete e.g[n],e.h--))}}function fe(e,t,n,r){for(var i=0;i<e.length;++i){var s=e[i];if(!s.ca&&s.listener==t&&s.capture==!!n&&s.ia==r)return i}return-1}he.prototype.add=function(e,t,n,r,i){var s=e.toString();(e=this.g[s])||(e=this.g[s]=[],this.h++);var o=fe(e,t,r,i);return-1<o?(t=e[o],n||(t.fa=!1)):((t=new ue(t,this.src,s,!!r,i)).fa=n,e.push(t)),t};var pe="closure_lm_"+(1e6*Math.random()|0),me={};function ge(e,t,n,r,i){if(r&&r.once)return ve(e,t,n,r,i);if(Array.isArray(t)){for(var s=0;s<t.length;s++)ge(e,t[s],n,r,i);return null}return n=Se(n),e&&e[ae]?e.N(t,n,m(r)?!!r.capture:!!r,i):ye(e,t,n,!1,r,i)}function ye(e,t,n,r,i,s){if(!t)throw Error("Invalid event type");var o=m(i)?!!i.capture:!!i,a=Te(e);if(a||(e[pe]=a=new he(e)),(n=a.add(t,n,r,o,s)).proxy)return n;if(r=function(){var e=Ie;return function t(n){return e.call(t.src,t.listener,n)}}(),n.proxy=r,r.src=e,r.listener=n,e.addEventListener)re||(i=o),void 0===i&&(i=!1),e.addEventListener(t.toString(),r,i);else if(e.attachEvent)e.attachEvent(be(t.toString()),r);else{if(!e.addListener||!e.removeListener)throw Error("addEventListener and attachEvent are unavailable.");e.addListener(r)}return n}function ve(e,t,n,r,i){if(Array.isArray(t)){for(var s=0;s<t.length;s++)ve(e,t[s],n,r,i);return null}return n=Se(n),e&&e[ae]?e.O(t,n,m(r)?!!r.capture:!!r,i):ye(e,t,n,!0,r,i)}function we(e,t,n,r,i){if(Array.isArray(t))for(var s=0;s<t.length;s++)we(e,t[s],n,r,i);else r=m(r)?!!r.capture:!!r,n=Se(n),e&&e[ae]?(e=e.i,(t=String(t).toString())in e.g&&-1<(n=fe(s=e.g[t],n,r,i))&&(le(s[n]),Array.prototype.splice.call(s,n,1),0==s.length&&(delete e.g[t],e.h--))):e&&(e=Te(e))&&(t=e.g[t.toString()],e=-1,t&&(e=fe(t,n,r,i)),(n=-1<e?t[e]:null)&&_e(n))}function _e(e){if("number"!=typeof e&&e&&!e.ca){var t=e.src;if(t&&t[ae])de(t.i,e);else{var n=e.type,r=e.proxy;t.removeEventListener?t.removeEventListener(n,r,e.capture):t.detachEvent?t.detachEvent(be(n),r):t.addListener&&t.removeListener&&t.removeListener(r),(n=Te(t))?(de(n,e),0==n.h&&(n.src=null,t[pe]=null)):le(e)}}}function be(e){return e in me?me[e]:me[e]="on"+e}function Ie(e,t){if(e.ca)e=!0;else{t=new se(t,this);var n=e.listener,r=e.ia||e.src;e.fa&&_e(e),e=n.call(r,t)}return e}function Te(e){return(e=e[pe])instanceof he?e:null}var Ee="__closure_events_fn_"+(1e9*Math.random()>>>0);function Se(e){return"function"==typeof e?e:(e[Ee]||(e[Ee]=function(t){return e.handleEvent(t)}),e[Ee])}function ke(){T.call(this),this.i=new he(this),this.P=this,this.I=null}function Ae(e,t){var n,r=e.I;if(r)for(n=[];r;r=r.I)n.push(r);if(e=e.P,r=t.type||t,"string"==typeof t)t=new ie(t,e);else if(t instanceof ie)t.target=t.target||e;else{var i=t;V(t=new ie(r,e),i)}if(i=!0,n)for(var s=n.length-1;0<=s;s--){var o=t.g=n[s];i=Ce(o,r,!0,t)&&i}if(i=Ce(o=t.g=e,r,!0,t)&&i,i=Ce(o,r,!1,t)&&i,n)for(s=0;s<n.length;s++)i=Ce(o=t.g=n[s],r,!1,t)&&i}function Ce(e,t,n,r){if(!(t=e.i.g[String(t)]))return!0;t=t.concat();for(var i=!0,s=0;s<t.length;++s){var o=t[s];if(o&&!o.ca&&o.capture==n){var a=o.listener,c=o.ia||o.src;o.fa&&de(e.i,o),i=!1!==a.call(c,r)&&i}}return i&&!r.defaultPrevented}I(ke,T),ke.prototype[ae]=!0,ke.prototype.removeEventListener=function(e,t,n,r){we(this,e,t,n,r)},ke.prototype.M=function(){if(ke.Z.M.call(this),this.i){var e,t=this.i;for(e in t.g){for(var n=t.g[e],r=0;r<n.length;r++)le(n[r]);delete t.g[e],t.h--}}this.I=null},ke.prototype.N=function(e,t,n,r){return this.i.add(String(e),t,!1,n,r)},ke.prototype.O=function(e,t,n,r){return this.i.add(String(e),t,!0,n,r)};var Ne=d.JSON.stringify;function Re(){var e=Ue;let t=null;return e.g&&(t=e.g,e.g=e.g.next,e.g||(e.h=null),t.next=null),t}var De,xe=new class{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}((()=>new Oe),(e=>e.reset()));class Oe{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}function Pe(e){d.setTimeout((()=>{throw e}),0)}function Le(e,t){De||function(){var e=d.Promise.resolve(void 0);De=function(){e.then(Fe)}}(),Me||(De(),Me=!0),Ue.add(e,t)}var Me=!1,Ue=new class{constructor(){this.h=this.g=null}add(e,t){const n=xe.get();n.set(e,t),this.h?this.h.next=n:this.g=n,this.h=n}};function Fe(){for(var e;e=Re();){try{e.h.call(e.g)}catch(e){Pe(e)}var t=xe;t.j(e),100>t.h&&(t.h++,e.next=t.g,t.g=e)}Me=!1}function Ve(e,t){ke.call(this),this.h=e||1,this.g=t||d,this.j=_(this.kb,this),this.l=Date.now()}function qe(e){e.da=!1,e.S&&(e.g.clearTimeout(e.S),e.S=null)}function Be(e,t,n){if("function"==typeof e)n&&(e=_(e,n));else{if(!e||"function"!=typeof e.handleEvent)throw Error("Invalid listener argument");e=_(e.handleEvent,e)}return 2147483647<Number(t)?-1:d.setTimeout(e,t||0)}function je(e){e.g=Be((()=>{e.g=null,e.i&&(e.i=!1,je(e))}),e.j);const t=e.h;e.h=null,e.m.apply(null,t)}I(Ve,ke),(r=Ve.prototype).da=!1,r.S=null,r.kb=function(){if(this.da){var e=Date.now()-this.l;0<e&&e<.8*this.h?this.S=this.g.setTimeout(this.j,this.h-e):(this.S&&(this.g.clearTimeout(this.S),this.S=null),Ae(this,"tick"),this.da&&(qe(this),this.start()))}},r.start=function(){this.da=!0,this.S||(this.S=this.g.setTimeout(this.j,this.h),this.l=Date.now())},r.M=function(){Ve.Z.M.call(this),qe(this),delete this.g};class $e extends T{constructor(e,t){super(),this.m=e,this.j=t,this.h=null,this.i=!1,this.g=null}l(e){this.h=arguments,this.g?this.i=!0:je(this)}M(){super.M(),this.g&&(d.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function ze(e){T.call(this),this.h=e,this.g={}}I(ze,T);var Ge=[];function Ke(e,t,n,r){Array.isArray(n)||(n&&(Ge[0]=n.toString()),n=Ge);for(var i=0;i<n.length;i++){var s=ge(t,n[i],r||e.handleEvent,!1,e.h||e);if(!s)break;e.g[s.key]=s}}function He(e){M(e.g,(function(e,t){this.g.hasOwnProperty(t)&&_e(e)}),e),e.g={}}function We(){this.g=!0}function Ye(e,t,n,r){e.info((function(){return"XMLHTTP TEXT ("+t+"): "+function(e,t){if(!e.g)return t;if(!t)return null;try{var n=JSON.parse(t);if(n)for(e=0;e<n.length;e++)if(Array.isArray(n[e])){var r=n[e];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var s=i[0];if("noop"!=s&&"stop"!=s&&"close"!=s)for(var o=1;o<i.length;o++)i[o]=""}}}return Ne(n)}catch(e){return t}}(e,n)+(r?" "+r:"")}))}ze.prototype.M=function(){ze.Z.M.call(this),He(this)},ze.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},We.prototype.Aa=function(){this.g=!1},We.prototype.info=function(){};var Qe={},Xe=null;function Je(){return Xe=Xe||new ke}function Ze(e){ie.call(this,Qe.Ma,e)}function et(e){const t=Je();Ae(t,new Ze(t,e))}function tt(e,t){ie.call(this,Qe.STAT_EVENT,e),this.stat=t}function nt(e){const t=Je();Ae(t,new tt(t,e))}function rt(e,t){ie.call(this,Qe.Na,e),this.size=t}function it(e,t){if("function"!=typeof e)throw Error("Fn must not be null and must be a function");return d.setTimeout((function(){e()}),t)}Qe.Ma="serverreachability",I(Ze,ie),Qe.STAT_EVENT="statevent",I(tt,ie),Qe.Na="timingevent",I(rt,ie);var st={NO_ERROR:0,lb:1,yb:2,xb:3,sb:4,wb:5,zb:6,Ja:7,TIMEOUT:8,Cb:9},ot={qb:"complete",Mb:"success",Ka:"error",Ja:"abort",Eb:"ready",Fb:"readystatechange",TIMEOUT:"timeout",Ab:"incrementaldata",Db:"progress",tb:"downloadprogress",Ub:"uploadprogress"};function at(){}function ct(e){return e.h||(e.h=e.i())}function ut(){}at.prototype.h=null;var lt,ht={OPEN:"a",pb:"b",Ka:"c",Bb:"d"};function dt(){ie.call(this,"d")}function ft(){ie.call(this,"c")}function pt(){}function mt(e,t,n,r){this.l=e,this.j=t,this.m=n,this.X=r||1,this.V=new ze(this),this.P=yt,e=K?125:void 0,this.W=new Ve(e),this.H=null,this.i=!1,this.s=this.A=this.v=this.K=this.F=this.Y=this.B=null,this.D=[],this.g=null,this.C=0,this.o=this.u=null,this.N=-1,this.I=!1,this.O=0,this.L=null,this.aa=this.J=this.$=this.U=!1,this.h=new gt}function gt(){this.i=null,this.g="",this.h=!1}I(dt,ie),I(ft,ie),I(pt,at),pt.prototype.g=function(){return new XMLHttpRequest},pt.prototype.i=function(){return{}},lt=new pt;var yt=45e3,vt={},wt={};function _t(e,t,n){e.K=1,e.v=$t(Ut(t)),e.s=n,e.U=!0,bt(e,null)}function bt(e,t){e.F=Date.now(),St(e),e.A=Ut(e.v);var n=e.A,r=e.X;Array.isArray(r)||(r=[String(r)]),nn(n.h,"t",r),e.C=0,n=e.l.H,e.h=new gt,e.g=rr(e.l,n?t:null,!e.s),0<e.O&&(e.L=new $e(_(e.Ia,e,e.g),e.O)),Ke(e.V,e.g,"readystatechange",e.gb),t=e.H?U(e.H):{},e.s?(e.u||(e.u="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.ea(e.A,e.u,e.s,t)):(e.u="GET",e.g.ea(e.A,e.u,null,t)),et(1),function(e,t,n,r,i,s){e.info((function(){if(e.g)if(s)for(var o="",a=s.split("&"),c=0;c<a.length;c++){var u=a[c].split("=");if(1<u.length){var l=u[0];u=u[1];var h=l.split("_");o=2<=h.length&&"type"==h[1]?o+(l+"=")+u+"&":o+(l+"=redacted&")}}else o=null;else o=s;return"XMLHTTP REQ ("+r+") [attempt "+i+"]: "+t+"\n"+n+"\n"+o}))}(e.j,e.u,e.A,e.m,e.X,e.s)}function It(e){return!!e.g&&"GET"==e.u&&2!=e.K&&e.l.Ba}function Tt(e,t,n){let r,i=!0;for(;!e.I&&e.C<n.length;){if(r=Et(e,n),r==wt){4==t&&(e.o=4,nt(14),i=!1),Ye(e.j,e.m,null,"[Incomplete Response]");break}if(r==vt){e.o=4,nt(15),Ye(e.j,e.m,n,"[Invalid Chunk]"),i=!1;break}Ye(e.j,e.m,r,null),Rt(e,r)}It(e)&&r!=wt&&r!=vt&&(e.h.g="",e.C=0),4!=t||0!=n.length||e.h.h||(e.o=1,nt(16),i=!1),e.i=e.i&&i,i?0<n.length&&!e.aa&&(e.aa=!0,(t=e.l).g==e&&t.$&&!t.L&&(t.h.info("Great, no buffering proxy detected. Bytes received: "+n.length),Yn(t),t.L=!0,nt(11))):(Ye(e.j,e.m,n,"[Invalid Chunked Response]"),Nt(e),Ct(e))}function Et(e,t){var n=e.C,r=t.indexOf("\n",n);return-1==r?wt:(n=Number(t.substring(n,r)),isNaN(n)?vt:(r+=1)+n>t.length?wt:(t=t.substr(r,n),e.C=r+n,t))}function St(e){e.Y=Date.now()+e.P,kt(e,e.P)}function kt(e,t){if(null!=e.B)throw Error("WatchDog timer not null");e.B=it(_(e.eb,e),t)}function At(e){e.B&&(d.clearTimeout(e.B),e.B=null)}function Ct(e){0==e.l.G||e.I||Jn(e.l,e)}function Nt(e){At(e);var t=e.L;t&&"function"==typeof t.na&&t.na(),e.L=null,qe(e.W),He(e.V),e.g&&(t=e.g,e.g=null,t.abort(),t.na())}function Rt(e,t){try{var n=e.l;if(0!=n.G&&(n.g==e||un(n.i,e)))if(n.I=e.N,!e.J&&un(n.i,e)&&3==n.G){try{var r=n.Ca.g.parse(t)}catch(e){r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0]){e:if(!n.u){if(n.g){if(!(n.g.F+3e3<e.F))break e;Xn(n),qn(n)}Wn(n),nt(18)}}else n.ta=i[1],0<n.ta-n.U&&37500>i[2]&&n.N&&0==n.A&&!n.v&&(n.v=it(_(n.ab,n),6e3));if(1>=cn(n.i)&&n.ka){try{n.ka()}catch(e){}n.ka=void 0}}else er(n,11)}else if((e.J||n.g==e)&&Xn(n),!N(t))for(i=n.Ca.g.parse(t),t=0;t<i.length;t++){let u=i[t];if(n.U=u[0],u=u[1],2==n.G)if("c"==u[0]){n.J=u[1],n.la=u[2];const t=u[3];null!=t&&(n.ma=t,n.h.info("VER="+n.ma));const i=u[4];null!=i&&(n.za=i,n.h.info("SVER="+n.za));const l=u[5];null!=l&&"number"==typeof l&&0<l&&(r=1.5*l,n.K=r,n.h.info("backChannelRequestTimeoutMs_="+r)),r=n;const h=e.g;if(h){const e=h.g?h.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(e){var s=r.i;!s.g&&(x(e,"spdy")||x(e,"quic")||x(e,"h2"))&&(s.j=s.l,s.g=new Set,s.h&&(ln(s,s.h),s.h=null))}if(r.D){const e=h.g?h.g.getResponseHeader("X-HTTP-Session-Id"):null;e&&(r.sa=e,jt(r.F,r.D,e))}}n.G=3,n.j&&n.j.xa(),n.$&&(n.O=Date.now()-e.F,n.h.info("Handshake RTT: "+n.O+"ms"));var o=e;if((r=n).oa=nr(r,r.H?r.la:null,r.W),o.J){hn(r.i,o);var a=o,c=r.K;c&&a.setTimeout(c),a.B&&(At(a),St(a)),r.g=o}else Hn(r);0<n.l.length&&$n(n)}else"stop"!=u[0]&&"close"!=u[0]||er(n,7);else 3==n.G&&("stop"==u[0]||"close"==u[0]?"stop"==u[0]?er(n,7):Vn(n):"noop"!=u[0]&&n.j&&n.j.wa(u),n.A=0)}et(4)}catch(e){}}function Dt(e,t){if(e.forEach&&"function"==typeof e.forEach)e.forEach(t,void 0);else if(p(e)||"string"==typeof e)k(e,t,void 0);else{if(e.T&&"function"==typeof e.T)var n=e.T();else if(e.R&&"function"==typeof e.R)n=void 0;else if(p(e)||"string"==typeof e){n=[];for(var r=e.length,i=0;i<r;i++)n.push(i)}else for(i in n=[],r=0,e)n[r++]=i;r=function(e){if(e.R&&"function"==typeof e.R)return e.R();if("string"==typeof e)return e.split("");if(p(e)){for(var t=[],n=e.length,r=0;r<n;r++)t.push(e[r]);return t}for(r in t=[],n=0,e)t[n++]=e[r];return t}(e),i=r.length;for(var s=0;s<i;s++)t.call(void 0,r[s],n&&n[s],e)}}function xt(e,t){this.h={},this.g=[],this.i=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(e)if(e instanceof xt)for(n=e.T(),r=0;r<n.length;r++)this.set(n[r],e.get(n[r]));else for(r in e)this.set(r,e[r])}function Ot(e){if(e.i!=e.g.length){for(var t=0,n=0;t<e.g.length;){var r=e.g[t];Pt(e.h,r)&&(e.g[n++]=r),t++}e.g.length=n}if(e.i!=e.g.length){var i={};for(n=t=0;t<e.g.length;)Pt(i,r=e.g[t])||(e.g[n++]=r,i[r]=1),t++;e.g.length=n}}function Pt(e,t){return Object.prototype.hasOwnProperty.call(e,t)}(r=mt.prototype).setTimeout=function(e){this.P=e},r.gb=function(e){e=e.target;const t=this.L;t&&3==Pn(e)?t.l():this.Ia(e)},r.Ia=function(e){try{if(e==this.g)e:{const l=Pn(this.g);var t=this.g.Da();const h=this.g.ba();if(!(3>l)&&(3!=l||K||this.g&&(this.h.h||this.g.ga()||Ln(this.g)))){this.I||4!=l||7==t||et(8==t||0>=h?3:2),At(this);var n=this.g.ba();this.N=n;t:if(It(this)){var r=Ln(this.g);e="";var i=r.length,s=4==Pn(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){Nt(this),Ct(this);var o="";break t}this.h.i=new d.TextDecoder}for(t=0;t<i;t++)this.h.h=!0,e+=this.h.i.decode(r[t],{stream:s&&t==i-1});r.splice(0,i),this.h.g+=e,this.C=0,o=this.h.g}else o=this.g.ga();if(this.i=200==n,function(e,t,n,r,i,s,o){e.info((function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+t+"\n"+n+"\n"+s+" "+o}))}(this.j,this.u,this.A,this.m,this.X,l,n),this.i){if(this.$&&!this.J){t:{if(this.g){var a,c=this.g;if((a=c.g?c.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!N(a)){var u=a;break t}}u=null}if(!(n=u)){this.i=!1,this.o=3,nt(12),Nt(this),Ct(this);break e}Ye(this.j,this.m,n,"Initial handshake response via X-HTTP-Initial-Response"),this.J=!0,Rt(this,n)}this.U?(Tt(this,l,o),K&&this.i&&3==l&&(Ke(this.V,this.W,"tick",this.fb),this.W.start())):(Ye(this.j,this.m,o,null),Rt(this,o)),4==l&&Nt(this),this.i&&!this.I&&(4==l?Jn(this.l,this):(this.i=!1,St(this)))}else 400==n&&0<o.indexOf("Unknown SID")?(this.o=3,nt(12)):(this.o=0,nt(13)),Nt(this),Ct(this)}}}catch(e){}},r.fb=function(){if(this.g){var e=Pn(this.g),t=this.g.ga();this.C<t.length&&(At(this),Tt(this,e,t),this.i&&4!=e&&St(this))}},r.cancel=function(){this.I=!0,Nt(this)},r.eb=function(){this.B=null;const e=Date.now();0<=e-this.Y?(function(e,t){e.info((function(){return"TIMEOUT: "+t}))}(this.j,this.A),2!=this.K&&(et(3),nt(17)),Nt(this),this.o=2,Ct(this)):kt(this,this.Y-e)},(r=xt.prototype).R=function(){Ot(this);for(var e=[],t=0;t<this.g.length;t++)e.push(this.h[this.g[t]]);return e},r.T=function(){return Ot(this),this.g.concat()},r.get=function(e,t){return Pt(this.h,e)?this.h[e]:t},r.set=function(e,t){Pt(this.h,e)||(this.i++,this.g.push(e)),this.h[e]=t},r.forEach=function(e,t){for(var n=this.T(),r=0;r<n.length;r++){var i=n[r],s=this.get(i);e.call(t,s,i,this)}};var Lt=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function Mt(e,t){if(this.i=this.s=this.j="",this.m=null,this.o=this.l="",this.g=!1,e instanceof Mt){this.g=void 0!==t?t:e.g,Ft(this,e.j),this.s=e.s,Vt(this,e.i),qt(this,e.m),this.l=e.l,t=e.h;var n=new Jt;n.i=t.i,t.g&&(n.g=new xt(t.g),n.h=t.h),Bt(this,n),this.o=e.o}else e&&(n=String(e).match(Lt))?(this.g=!!t,Ft(this,n[1]||"",!0),this.s=zt(n[2]||""),Vt(this,n[3]||"",!0),qt(this,n[4]),this.l=zt(n[5]||"",!0),Bt(this,n[6]||"",!0),this.o=zt(n[7]||"")):(this.g=!!t,this.h=new Jt(null,this.g))}function Ut(e){return new Mt(e)}function Ft(e,t,n){e.j=n?zt(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function Vt(e,t,n){e.i=n?zt(t,!0):t}function qt(e,t){if(t){if(t=Number(t),isNaN(t)||0>t)throw Error("Bad port number "+t);e.m=t}else e.m=null}function Bt(e,t,n){t instanceof Jt?(e.h=t,function(e,t){t&&!e.j&&(Zt(e),e.i=null,e.g.forEach((function(e,t){var n=t.toLowerCase();t!=n&&(en(this,t),nn(this,n,e))}),e)),e.j=t}(e.h,e.g)):(n||(t=Gt(t,Qt)),e.h=new Jt(t,e.g))}function jt(e,t,n){e.h.set(t,n)}function $t(e){return jt(e,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),e}function zt(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function Gt(e,t,n){return"string"==typeof e?(e=encodeURI(e).replace(t,Kt),n&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function Kt(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}Mt.prototype.toString=function(){var e=[],t=this.j;t&&e.push(Gt(t,Ht,!0),":");var n=this.i;return(n||"file"==t)&&(e.push("//"),(t=this.s)&&e.push(Gt(t,Ht,!0),"@"),e.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.m)&&e.push(":",String(n))),(n=this.l)&&(this.i&&"/"!=n.charAt(0)&&e.push("/"),e.push(Gt(n,"/"==n.charAt(0)?Yt:Wt,!0))),(n=this.h.toString())&&e.push("?",n),(n=this.o)&&e.push("#",Gt(n,Xt)),e.join("")};var Ht=/[#\/\?@]/g,Wt=/[#\?:]/g,Yt=/[#\?]/g,Qt=/[#\?@]/g,Xt=/#/g;function Jt(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function Zt(e){e.g||(e.g=new xt,e.h=0,e.i&&function(e,t){if(e){e=e.split("&");for(var n=0;n<e.length;n++){var r=e[n].indexOf("="),i=null;if(0<=r){var s=e[n].substring(0,r);i=e[n].substring(r+1)}else s=e[n];t(s,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(e.i,(function(t,n){e.add(decodeURIComponent(t.replace(/\+/g," ")),n)})))}function en(e,t){Zt(e),t=rn(e,t),Pt(e.g.h,t)&&(e.i=null,e.h-=e.g.get(t).length,Pt((e=e.g).h,t)&&(delete e.h[t],e.i--,e.g.length>2*e.i&&Ot(e)))}function tn(e,t){return Zt(e),t=rn(e,t),Pt(e.g.h,t)}function nn(e,t,n){en(e,t),0<n.length&&(e.i=null,e.g.set(rn(e,t),C(n)),e.h+=n.length)}function rn(e,t){return t=String(t),e.j&&(t=t.toLowerCase()),t}function sn(e){this.l=e||on,e=d.PerformanceNavigationTiming?0<(e=d.performance.getEntriesByType("navigation")).length&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol):!!(d.g&&d.g.Ea&&d.g.Ea()&&d.g.Ea().Zb),this.j=e?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}(r=Jt.prototype).add=function(e,t){Zt(this),this.i=null,e=rn(this,e);var n=this.g.get(e);return n||this.g.set(e,n=[]),n.push(t),this.h+=1,this},r.forEach=function(e,t){Zt(this),this.g.forEach((function(n,r){k(n,(function(n){e.call(t,n,r,this)}),this)}),this)},r.T=function(){Zt(this);for(var e=this.g.R(),t=this.g.T(),n=[],r=0;r<t.length;r++)for(var i=e[r],s=0;s<i.length;s++)n.push(t[r]);return n},r.R=function(e){Zt(this);var t=[];if("string"==typeof e)tn(this,e)&&(t=A(t,this.g.get(rn(this,e))));else{e=this.g.R();for(var n=0;n<e.length;n++)t=A(t,e[n])}return t},r.set=function(e,t){return Zt(this),this.i=null,tn(this,e=rn(this,e))&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this},r.get=function(e,t){return e&&0<(e=this.R(e)).length?String(e[0]):t},r.toString=function(){if(this.i)return this.i;if(!this.g)return"";for(var e=[],t=this.g.T(),n=0;n<t.length;n++){var r=t[n],i=encodeURIComponent(String(r));r=this.R(r);for(var s=0;s<r.length;s++){var o=i;""!==r[s]&&(o+="="+encodeURIComponent(String(r[s]))),e.push(o)}}return this.i=e.join("&")};var on=10;function an(e){return!!e.h||!!e.g&&e.g.size>=e.j}function cn(e){return e.h?1:e.g?e.g.size:0}function un(e,t){return e.h?e.h==t:!!e.g&&e.g.has(t)}function ln(e,t){e.g?e.g.add(t):e.h=t}function hn(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}function dn(e){if(null!=e.h)return e.i.concat(e.h.D);if(null!=e.g&&0!==e.g.size){let t=e.i;for(const n of e.g.values())t=t.concat(n.D);return t}return C(e.i)}function fn(){}function pn(){this.g=new fn}function mn(e,t,n){const r=n||"";try{Dt(e,(function(e,n){let i=e;m(e)&&(i=Ne(e)),t.push(r+n+"="+encodeURIComponent(i))}))}catch(e){throw t.push(r+"type="+encodeURIComponent("_badmap")),e}}function gn(e,t,n,r,i){try{t.onload=null,t.onerror=null,t.onabort=null,t.ontimeout=null,i(r)}catch(e){}}function yn(e){this.l=e.$b||null,this.j=e.ib||!1}function vn(e,t){ke.call(this),this.D=e,this.u=t,this.m=void 0,this.readyState=wn,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}sn.prototype.cancel=function(){if(this.i=dn(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const e of this.g.values())e.cancel();this.g.clear()}},fn.prototype.stringify=function(e){return d.JSON.stringify(e,void 0)},fn.prototype.parse=function(e){return d.JSON.parse(e,void 0)},I(yn,at),yn.prototype.g=function(){return new vn(this.l,this.j)},yn.prototype.i=function(e){return function(){return e}}({}),I(vn,ke);var wn=0;function _n(e){e.j.read().then(e.Sa.bind(e)).catch(e.ha.bind(e))}function bn(e){e.readyState=4,e.l=null,e.j=null,e.A=null,In(e)}function In(e){e.onreadystatechange&&e.onreadystatechange.call(e)}(r=vn.prototype).open=function(e,t){if(this.readyState!=wn)throw this.abort(),Error("Error reopening a connection");this.C=e,this.B=t,this.readyState=1,In(this)},r.send=function(e){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const t={headers:this.v,method:this.C,credentials:this.m,cache:void 0};e&&(t.body=e),(this.D||d).fetch(new Request(this.B,t)).then(this.Va.bind(this),this.ha.bind(this))},r.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted."),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,bn(this)),this.readyState=wn},r.Va=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,In(this)),this.g&&(this.readyState=3,In(this),this.g)))if("arraybuffer"===this.responseType)e.arrayBuffer().then(this.Ta.bind(this),this.ha.bind(this));else if(void 0!==d.ReadableStream&&"body"in e){if(this.j=e.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;_n(this)}else e.text().then(this.Ua.bind(this),this.ha.bind(this))},r.Sa=function(e){if(this.g){if(this.u&&e.value)this.response.push(e.value);else if(!this.u){var t=e.value?e.value:new Uint8Array(0);(t=this.A.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)}e.done?bn(this):In(this),3==this.readyState&&_n(this)}},r.Ua=function(e){this.g&&(this.response=this.responseText=e,bn(this))},r.Ta=function(e){this.g&&(this.response=e,bn(this))},r.ha=function(){this.g&&bn(this)},r.setRequestHeader=function(e,t){this.v.append(e,t)},r.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""},r.getAllResponseHeaders=function(){if(!this.h)return"";const e=[],t=this.h.entries();for(var n=t.next();!n.done;)n=n.value,e.push(n[0]+": "+n[1]),n=t.next();return e.join("\r\n")},Object.defineProperty(vn.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(e){this.m=e?"include":"same-origin"}});var Tn=d.JSON.parse;function En(e){ke.call(this),this.headers=new xt,this.u=e||null,this.h=!1,this.C=this.g=null,this.H="",this.m=0,this.j="",this.l=this.F=this.v=this.D=!1,this.B=0,this.A=null,this.J=Sn,this.K=this.L=!1}I(En,ke);var Sn="",kn=/^https?$/i,An=["POST","PUT"];function Cn(e){return"content-type"==e.toLowerCase()}function Nn(e,t){e.h=!1,e.g&&(e.l=!0,e.g.abort(),e.l=!1),e.j=t,e.m=5,Rn(e),xn(e)}function Rn(e){e.D||(e.D=!0,Ae(e,"complete"),Ae(e,"error"))}function Dn(e){if(e.h&&void 0!==h&&(!e.C[1]||4!=Pn(e)||2!=e.ba()))if(e.v&&4==Pn(e))Be(e.Fa,0,e);else if(Ae(e,"readystatechange"),4==Pn(e)){e.h=!1;try{const a=e.ba();e:switch(a){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var t=!0;break e;default:t=!1}var n;if(!(n=t)){var r;if(r=0===a){var i=String(e.H).match(Lt)[1]||null;if(!i&&d.self&&d.self.location){var s=d.self.location.protocol;i=s.substr(0,s.length-1)}r=!kn.test(i?i.toLowerCase():"")}n=r}if(n)Ae(e,"complete"),Ae(e,"success");else{e.m=6;try{var o=2<Pn(e)?e.g.statusText:""}catch(e){o=""}e.j=o+" ["+e.ba()+"]",Rn(e)}}finally{xn(e)}}}function xn(e,t){if(e.g){On(e);const n=e.g,r=e.C[0]?f:null;e.g=null,e.C=null,t||Ae(e,"ready");try{n.onreadystatechange=r}catch(e){}}}function On(e){e.g&&e.K&&(e.g.ontimeout=null),e.A&&(d.clearTimeout(e.A),e.A=null)}function Pn(e){return e.g?e.g.readyState:0}function Ln(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.J){case Sn:case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch(e){return null}}function Mn(e,t,n){e:{for(r in n){var r=!1;break e}r=!0}r||(n=function(e){let t="";return M(e,(function(e,n){t+=n,t+=":",t+=e,t+="\r\n"})),t}(n),"string"==typeof e?null!=n&&encodeURIComponent(String(n)):jt(e,t,n))}function Un(e,t,n){return n&&n.internalChannelParams&&n.internalChannelParams[e]||t}function Fn(e){this.za=0,this.l=[],this.h=new We,this.la=this.oa=this.F=this.W=this.g=this.sa=this.D=this.aa=this.o=this.P=this.s=null,this.Za=this.V=0,this.Xa=Un("failFast",!1,e),this.N=this.v=this.u=this.m=this.j=null,this.X=!0,this.I=this.ta=this.U=-1,this.Y=this.A=this.C=0,this.Pa=Un("baseRetryDelayMs",5e3,e),this.$a=Un("retryDelaySeedMs",1e4,e),this.Ya=Un("forwardChannelMaxRetries",2,e),this.ra=Un("forwardChannelRequestTimeoutMs",2e4,e),this.qa=e&&e.xmlHttpFactory||void 0,this.Ba=e&&e.Yb||!1,this.K=void 0,this.H=e&&e.supportsCrossDomainXhr||!1,this.J="",this.i=new sn(e&&e.concurrentRequestLimit),this.Ca=new pn,this.ja=e&&e.fastHandshake||!1,this.Ra=e&&e.Wb||!1,e&&e.Aa&&this.h.Aa(),e&&e.forceLongPolling&&(this.X=!1),this.$=!this.ja&&this.X&&e&&e.detectBufferingProxy||!1,this.ka=void 0,this.O=0,this.L=!1,this.B=null,this.Wa=!e||!1!==e.Xb}function Vn(e){if(Bn(e),3==e.G){var t=e.V++,n=Ut(e.F);jt(n,"SID",e.J),jt(n,"RID",t),jt(n,"TYPE","terminate"),Gn(e,n),(t=new mt(e,e.h,t,void 0)).K=2,t.v=$t(Ut(n)),n=!1,d.navigator&&d.navigator.sendBeacon&&(n=d.navigator.sendBeacon(t.v.toString(),"")),!n&&d.Image&&((new Image).src=t.v,n=!0),n||(t.g=rr(t.l,null),t.g.ea(t.v)),t.F=Date.now(),St(t)}tr(e)}function qn(e){e.g&&(Yn(e),e.g.cancel(),e.g=null)}function Bn(e){qn(e),e.u&&(d.clearTimeout(e.u),e.u=null),Xn(e),e.i.cancel(),e.m&&("number"==typeof e.m&&d.clearTimeout(e.m),e.m=null)}function jn(e,t){e.l.push(new class{constructor(e,t){this.h=e,this.g=t}}(e.Za++,t)),3==e.G&&$n(e)}function $n(e){an(e.i)||e.m||(e.m=!0,Le(e.Ha,e),e.C=0)}function zn(e,t){var n;n=t?t.m:e.V++;const r=Ut(e.F);jt(r,"SID",e.J),jt(r,"RID",n),jt(r,"AID",e.U),Gn(e,r),e.o&&e.s&&Mn(r,e.o,e.s),n=new mt(e,e.h,n,e.C+1),null===e.o&&(n.H=e.s),t&&(e.l=t.D.concat(e.l)),t=Kn(e,n,1e3),n.setTimeout(Math.round(.5*e.ra)+Math.round(.5*e.ra*Math.random())),ln(e.i,n),_t(n,r,t)}function Gn(e,t){e.j&&Dt({},(function(e,n){jt(t,n,e)}))}function Kn(e,t,n){n=Math.min(e.l.length,n);var r=e.j?_(e.j.Oa,e.j,e):null;e:{var i=e.l;let t=-1;for(;;){const e=["count="+n];-1==t?0<n?(t=i[0].h,e.push("ofs="+t)):t=0:e.push("ofs="+t);let s=!0;for(let o=0;o<n;o++){let n=i[o].h;const a=i[o].g;if(n-=t,0>n)t=Math.max(0,i[o].h-100),s=!1;else try{mn(a,e,"req"+n+"_")}catch(e){r&&r(a)}}if(s){r=e.join("&");break e}}}return e=e.l.splice(0,n),t.D=e,r}function Hn(e){e.g||e.u||(e.Y=1,Le(e.Ga,e),e.A=0)}function Wn(e){return!(e.g||e.u||3<=e.A||(e.Y++,e.u=it(_(e.Ga,e),Zn(e,e.A)),e.A++,0))}function Yn(e){null!=e.B&&(d.clearTimeout(e.B),e.B=null)}function Qn(e){e.g=new mt(e,e.h,"rpc",e.Y),null===e.o&&(e.g.H=e.s),e.g.O=0;var t=Ut(e.oa);jt(t,"RID","rpc"),jt(t,"SID",e.J),jt(t,"CI",e.N?"0":"1"),jt(t,"AID",e.U),Gn(e,t),jt(t,"TYPE","xmlhttp"),e.o&&e.s&&Mn(t,e.o,e.s),e.K&&e.g.setTimeout(e.K);var n=e.g;e=e.la,n.K=1,n.v=$t(Ut(t)),n.s=null,n.U=!0,bt(n,e)}function Xn(e){null!=e.v&&(d.clearTimeout(e.v),e.v=null)}function Jn(e,t){var n=null;if(e.g==t){Xn(e),Yn(e),e.g=null;var r=2}else{if(!un(e.i,t))return;n=t.D,hn(e.i,t),r=1}if(e.I=t.N,0!=e.G)if(t.i)if(1==r){n=t.s?t.s.length:0,t=Date.now()-t.F;var i=e.C;Ae(r=Je(),new rt(r,n,t,i)),$n(e)}else Hn(e);else if(3==(i=t.o)||0==i&&0<e.I||!(1==r&&function(e,t){return!(cn(e.i)>=e.i.j-(e.m?1:0)||(e.m?(e.l=t.D.concat(e.l),0):1==e.G||2==e.G||e.C>=(e.Xa?0:e.Ya)||(e.m=it(_(e.Ha,e,t),Zn(e,e.C)),e.C++,0)))}(e,t)||2==r&&Wn(e)))switch(n&&0<n.length&&(t=e.i,t.i=t.i.concat(n)),i){case 1:er(e,5);break;case 4:er(e,10);break;case 3:er(e,6);break;default:er(e,2)}}function Zn(e,t){let n=e.Pa+Math.floor(Math.random()*e.$a);return e.j||(n*=2),n*t}function er(e,t){if(e.h.info("Error code "+t),2==t){var n=null;e.j&&(n=null);var r=_(e.jb,e);n||(n=new Mt("//www.google.com/images/cleardot.gif"),d.location&&"http"==d.location.protocol||Ft(n,"https"),$t(n)),function(e,t){const n=new We;if(d.Image){const r=new Image;r.onload=b(gn,n,r,"TestLoadImage: loaded",!0,t),r.onerror=b(gn,n,r,"TestLoadImage: error",!1,t),r.onabort=b(gn,n,r,"TestLoadImage: abort",!1,t),r.ontimeout=b(gn,n,r,"TestLoadImage: timeout",!1,t),d.setTimeout((function(){r.ontimeout&&r.ontimeout()}),1e4),r.src=e}else t(!1)}(n.toString(),r)}else nt(2);e.G=0,e.j&&e.j.va(t),tr(e),Bn(e)}function tr(e){e.G=0,e.I=-1,e.j&&(0==dn(e.i).length&&0==e.l.length||(e.i.i.length=0,C(e.l),e.l.length=0),e.j.ua())}function nr(e,t,n){let r=function(e){return e instanceof Mt?Ut(e):new Mt(e,void 0)}(n);if(""!=r.i)t&&Vt(r,t+"."+r.i),qt(r,r.m);else{const e=d.location;r=function(e,t,n,r){var i=new Mt(null,void 0);return e&&Ft(i,e),t&&Vt(i,t),n&&qt(i,n),r&&(i.l=r),i}(e.protocol,t?t+"."+e.hostname:e.hostname,+e.port,n)}return e.aa&&M(e.aa,(function(e,t){jt(r,t,e)})),t=e.D,n=e.sa,t&&n&&jt(r,t,n),jt(r,"VER",e.ma),Gn(e,r),r}function rr(e,t,n){if(t&&!e.H)throw Error("Can't create secondary domain capable XhrIo object.");return(t=n&&e.Ba&&!e.qa?new En(new yn({ib:!0})):new En(e.qa)).L=e.H,t}function ir(){}function sr(){if(z&&!(10<=Number(ne)))throw Error("Environmental error: no available transport.")}function or(e,t){ke.call(this),this.g=new Fn(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.s=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.ya&&(e?e["X-WebChannel-Client-Profile"]=t.ya:e={"X-WebChannel-Client-Profile":t.ya}),this.g.P=e,(e=t&&t.httpHeadersOverwriteParam)&&!N(e)&&(this.g.o=e),this.A=t&&t.supportsCrossDomainXhr||!1,this.v=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!N(t)&&(this.g.D=t,null!==(e=this.h)&&t in e&&t in(e=this.h)&&delete e[t]),this.j=new ur(this)}function ar(e){dt.call(this);var t=e.__sm__;if(t){e:{for(const n in t){e=n;break e}e=void 0}(this.i=e)&&(e=this.i,t=null!==t&&e in t?t[e]:void 0),this.data=t}else this.data=e}function cr(){ft.call(this),this.status=1}function ur(e){this.g=e}(r=En.prototype).ea=function(e,t,n,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.H+"; newUri="+e);t=t?t.toUpperCase():"GET",this.H=e,this.j="",this.m=0,this.D=!1,this.h=!0,this.g=this.u?this.u.g():lt.g(),this.C=this.u?ct(this.u):ct(lt),this.g.onreadystatechange=_(this.Fa,this);try{this.F=!0,this.g.open(t,String(e),!0),this.F=!1}catch(e){return void Nn(this,e)}e=n||"";const i=new xt(this.headers);r&&Dt(r,(function(e,t){i.set(t,e)})),r=function(e){e:{var t=Cn;const n=e.length,r="string"==typeof e?e.split(""):e;for(let i=0;i<n;i++)if(i in r&&t.call(void 0,r[i],i,e)){t=i;break e}t=-1}return 0>t?null:"string"==typeof e?e.charAt(t):e[t]}(i.T()),n=d.FormData&&e instanceof d.FormData,!(0<=S(An,t))||r||n||i.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),i.forEach((function(e,t){this.g.setRequestHeader(t,e)}),this),this.J&&(this.g.responseType=this.J),"withCredentials"in this.g&&this.g.withCredentials!==this.L&&(this.g.withCredentials=this.L);try{On(this),0<this.B&&((this.K=function(e){return z&&te()&&"number"==typeof e.timeout&&void 0!==e.ontimeout}(this.g))?(this.g.timeout=this.B,this.g.ontimeout=_(this.pa,this)):this.A=Be(this.pa,this.B,this)),this.v=!0,this.g.send(e),this.v=!1}catch(e){Nn(this,e)}},r.pa=function(){void 0!==h&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,Ae(this,"timeout"),this.abort(8))},r.abort=function(e){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=e||7,Ae(this,"complete"),Ae(this,"abort"),xn(this))},r.M=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),xn(this,!0)),En.Z.M.call(this)},r.Fa=function(){this.s||(this.F||this.v||this.l?Dn(this):this.cb())},r.cb=function(){Dn(this)},r.ba=function(){try{return 2<Pn(this)?this.g.status:-1}catch(e){return-1}},r.ga=function(){try{return this.g?this.g.responseText:""}catch(e){return""}},r.Qa=function(e){if(this.g){var t=this.g.responseText;return e&&0==t.indexOf(e)&&(t=t.substring(e.length)),Tn(t)}},r.Da=function(){return this.m},r.La=function(){return"string"==typeof this.j?this.j:String(this.j)},(r=Fn.prototype).ma=8,r.G=1,r.hb=function(e){try{this.h.info("Origin Trials invoked: "+e)}catch(e){}},r.Ha=function(e){if(this.m)if(this.m=null,1==this.G){if(!e){this.V=Math.floor(1e5*Math.random()),e=this.V++;const i=new mt(this,this.h,e,void 0);let s=this.s;if(this.P&&(s?(s=U(s),V(s,this.P)):s=this.P),null===this.o&&(i.H=s),this.ja)e:{for(var t=0,n=0;n<this.l.length;n++){var r=this.l[n];if(void 0===(r="__data__"in r.g&&"string"==typeof(r=r.g.__data__)?r.length:void 0))break;if(4096<(t+=r)){t=n;break e}if(4096===t||n===this.l.length-1){t=n+1;break e}}t=1e3}else t=1e3;t=Kn(this,i,t),jt(n=Ut(this.F),"RID",e),jt(n,"CVER",22),this.D&&jt(n,"X-HTTP-Session-Id",this.D),Gn(this,n),this.o&&s&&Mn(n,this.o,s),ln(this.i,i),this.Ra&&jt(n,"TYPE","init"),this.ja?(jt(n,"$req",t),jt(n,"SID","null"),i.$=!0,_t(i,n,null)):_t(i,n,t),this.G=2}}else 3==this.G&&(e?zn(this,e):0==this.l.length||an(this.i)||zn(this))},r.Ga=function(){if(this.u=null,Qn(this),this.$&&!(this.L||null==this.g||0>=this.O)){var e=2*this.O;this.h.info("BP detection timer enabled: "+e),this.B=it(_(this.bb,this),e)}},r.bb=function(){this.B&&(this.B=null,this.h.info("BP detection timeout reached."),this.h.info("Buffering proxy detected and switch to long-polling!"),this.N=!1,this.L=!0,nt(10),qn(this),Qn(this))},r.ab=function(){null!=this.v&&(this.v=null,qn(this),Wn(this),nt(19))},r.jb=function(e){e?(this.h.info("Successfully pinged google.com"),nt(2)):(this.h.info("Failed to ping google.com"),nt(1))},(r=ir.prototype).xa=function(){},r.wa=function(){},r.va=function(){},r.ua=function(){},r.Oa=function(){},sr.prototype.g=function(e,t){return new or(e,t)},I(or,ke),or.prototype.m=function(){this.g.j=this.j,this.A&&(this.g.H=!0);var e=this.g,t=this.l,n=this.h||void 0;e.Wa&&(e.h.info("Origin Trials enabled."),Le(_(e.hb,e,t))),nt(0),e.W=t,e.aa=n||{},e.N=e.X,e.F=nr(e,null,e.W),$n(e)},or.prototype.close=function(){Vn(this.g)},or.prototype.u=function(e){if("string"==typeof e){var t={};t.__data__=e,jn(this.g,t)}else this.v?((t={}).__data__=Ne(e),jn(this.g,t)):jn(this.g,e)},or.prototype.M=function(){this.g.j=null,delete this.j,Vn(this.g),delete this.g,or.Z.M.call(this)},I(ar,dt),I(cr,ft),I(ur,ir),ur.prototype.xa=function(){Ae(this.g,"a")},ur.prototype.wa=function(e){Ae(this.g,new ar(e))},ur.prototype.va=function(e){Ae(this.g,new cr(e))},ur.prototype.ua=function(){Ae(this.g,"b")},sr.prototype.createWebChannel=sr.prototype.g,or.prototype.send=or.prototype.u,or.prototype.open=or.prototype.m,or.prototype.close=or.prototype.close,st.NO_ERROR=0,st.TIMEOUT=8,st.HTTP_ERROR=6,ot.COMPLETE="complete",ut.EventType=ht,ht.OPEN="a",ht.CLOSE="b",ht.ERROR="c",ht.MESSAGE="d",ke.prototype.listen=ke.prototype.N,En.prototype.listenOnce=En.prototype.O,En.prototype.getLastError=En.prototype.La,En.prototype.getLastErrorCode=En.prototype.Da,En.prototype.getStatus=En.prototype.ba,En.prototype.getResponseJson=En.prototype.Qa,En.prototype.getResponseText=En.prototype.ga,En.prototype.send=En.prototype.ea;var lr=l.createWebChannelTransport=function(){return new sr},hr=l.getStatEventTarget=function(){return Je()},dr=l.ErrorCode=st,fr=l.EventType=ot,pr=l.Event=Qe,mr=l.Stat={rb:0,ub:1,vb:2,Ob:3,Tb:4,Qb:5,Rb:6,Pb:7,Nb:8,Sb:9,PROXY:10,NOPROXY:11,Lb:12,Hb:13,Ib:14,Gb:15,Jb:16,Kb:17,nb:18,mb:19,ob:20},gr=l.FetchXmlHttpFactory=yn,yr=l.WebChannel=ut,vr=l.XhrIo=En;const wr="@firebase/firestore";class _r{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}_r.UNAUTHENTICATED=new _r(null),_r.GOOGLE_CREDENTIALS=new _r("google-credentials-uid"),_r.FIRST_PARTY=new _r("first-party-uid"),_r.MOCK_USER=new _r("mock-user");let br="9.6.11";const Ir=new a.Yd("@firebase/firestore");function Tr(){return Ir.logLevel}function Er(e,...t){if(Ir.logLevel<=a.in.DEBUG){const n=t.map(Ar);Ir.debug(`Firestore (${br}): ${e}`,...n)}}function Sr(e,...t){if(Ir.logLevel<=a.in.ERROR){const n=t.map(Ar);Ir.error(`Firestore (${br}): ${e}`,...n)}}function kr(e,...t){if(Ir.logLevel<=a.in.WARN){const n=t.map(Ar);Ir.warn(`Firestore (${br}): ${e}`,...n)}}function Ar(e){if("string"==typeof e)return e;try{return t=e,JSON.stringify(t)}catch(t){return e}var t}function Cr(e="Unexpected state"){const t=`FIRESTORE (${br}) INTERNAL ASSERTION FAILED: `+e;throw Sr(t),new Error(t)}function Nr(e,t){e||Cr()}function Rr(e,t){return e}const Dr={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class xr extends c.ZR{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class Or{constructor(){this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}}class Pr{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class Lr{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable((()=>t(_r.UNAUTHENTICATED)))}shutdown(){}}class Mr{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable((()=>t(this.token.user)))}shutdown(){this.changeListener=null}}class Ur{constructor(e){this.t=e,this.currentUser=_r.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){let n=this.i;const r=e=>this.i!==n?(n=this.i,t(e)):Promise.resolve();let i=new Or;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new Or,e.enqueueRetryable((()=>r(this.currentUser)))};const s=()=>{const t=i;e.enqueueRetryable((async()=>{await t.promise,await r(this.currentUser)}))},o=e=>{Er("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=e,this.auth.addAuthTokenListener(this.o),s()};this.t.onInit((e=>o(e))),setTimeout((()=>{if(!this.auth){const e=this.t.getImmediate({optional:!0});e?o(e):(Er("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new Or)}}),0),s()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then((t=>this.i!==e?(Er("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):t?(Nr("string"==typeof t.accessToken),new Pr(t.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const e=this.auth&&this.auth.getUid();return Nr(null===e||"string"==typeof e),new _r(e)}}class Fr{constructor(e,t,n){this.type="FirstParty",this.user=_r.FIRST_PARTY,this.headers=new Map,this.headers.set("X-Goog-AuthUser",t);const r=e.auth.getAuthHeaderValueForFirstParty([]);r&&this.headers.set("Authorization",r),n&&this.headers.set("X-Goog-Iam-Authorization-Token",n)}}class Vr{constructor(e,t,n){this.h=e,this.l=t,this.m=n}getToken(){return Promise.resolve(new Fr(this.h,this.l,this.m))}start(e,t){e.enqueueRetryable((()=>t(_r.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class qr{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class Br{constructor(e){this.g=e,this.forceRefresh=!1,this.appCheck=null,this.p=null}start(e,t){const n=e=>{null!=e.error&&Er("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${e.error.message}`);const n=e.token!==this.p;return this.p=e.token,Er("FirebaseAppCheckTokenProvider",`Received ${n?"new":"existing"} token.`),n?t(e.token):Promise.resolve()};this.o=t=>{e.enqueueRetryable((()=>n(t)))};const r=e=>{Er("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=e,this.appCheck.addTokenListener(this.o)};this.g.onInit((e=>r(e))),setTimeout((()=>{if(!this.appCheck){const e=this.g.getImmediate({optional:!0});e?r(e):Er("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then((e=>e?(Nr("string"==typeof e.token),this.p=e.token,new qr(e.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}class jr{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=e=>this.I(e),this.T=e=>t.writeSequenceNumber(e))}I(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.T&&this.T(e),e}}function $r(e){const t="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(e);if(t&&"function"==typeof t.getRandomValues)t.getRandomValues(n);else for(let t=0;t<e;t++)n[t]=Math.floor(256*Math.random());return n}jr.A=-1;class zr{static R(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length;let n="";for(;n.length<20;){const r=$r(40);for(let i=0;i<r.length;++i)n.length<20&&r[i]<t&&(n+=e.charAt(r[i]%e.length))}return n}}function Gr(e,t){return e<t?-1:e>t?1:0}function Kr(e,t,n){return e.length===t.length&&e.every(((e,r)=>n(e,t[r])))}function Hr(e){return e+"\0"}class Wr{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new xr(Dr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new xr(Dr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new xr(Dr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new xr(Dr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return Wr.fromMillis(Date.now())}static fromDate(e){return Wr.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),n=Math.floor(1e6*(e-1e3*t));return new Wr(t,n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?Gr(this.nanoseconds,e.nanoseconds):Gr(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class Yr{constructor(e){this.timestamp=e}static fromTimestamp(e){return new Yr(e)}static min(){return new Yr(new Wr(0,0))}static max(){return new Yr(new Wr(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}function Qr(e){let t=0;for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t++;return t}function Xr(e,t){for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(n,e[n])}function Jr(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}class Zr{constructor(e,t,n){void 0===t?t=0:t>e.length&&Cr(),void 0===n?n=e.length-t:n>e.length-t&&Cr(),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return 0===Zr.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof Zr?e.forEach((e=>{t.push(e)})):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=void 0===e?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const n=Math.min(e.length,t.length);for(let r=0;r<n;r++){const n=e.get(r),i=t.get(r);if(n<i)return-1;if(n>i)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class ei extends Zr{construct(e,t,n){return new ei(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...e){const t=[];for(const n of e){if(n.indexOf("//")>=0)throw new xr(Dr.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter((e=>e.length>0)))}return new ei(t)}static emptyPath(){return new ei([])}}const ti=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class ni extends Zr{construct(e,t,n){return new ni(e,t,n)}static isValidIdentifier(e){return ti.test(e)}canonicalString(){return this.toArray().map((e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),ni.isValidIdentifier(e)||(e="`"+e+"`"),e))).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new ni(["__name__"])}static fromServerFormat(e){const t=[];let n="",r=0;const i=()=>{if(0===n.length)throw new xr(Dr.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""};let s=!1;for(;r<e.length;){const t=e[r];if("\\"===t){if(r+1===e.length)throw new xr(Dr.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const t=e[r+1];if("\\"!==t&&"."!==t&&"`"!==t)throw new xr(Dr.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=t,r+=2}else"`"===t?(s=!s,r++):"."!==t||s?(n+=t,r++):(i(),r++)}if(i(),s)throw new xr(Dr.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new ni(t)}static emptyPath(){return new ni([])}}class ri{constructor(e){this.fields=e,e.sort(ni.comparator)}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Kr(this.fields,e.fields,((e,t)=>e.isEqual(t)))}}class ii{constructor(e){this.binaryString=e}static fromBase64String(e){const t=atob(e);return new ii(t)}static fromUint8Array(e){const t=function(e){let t="";for(let n=0;n<e.length;++n)t+=String.fromCharCode(e[n]);return t}(e);return new ii(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return e=this.binaryString,btoa(e);var e}toUint8Array(){return function(e){const t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return Gr(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}ii.EMPTY_BYTE_STRING=new ii("");const si=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function oi(e){if(Nr(!!e),"string"==typeof e){let t=0;const n=si.exec(e);if(Nr(!!n),n[1]){let e=n[1];e=(e+"000000000").substr(0,9),t=Number(e)}const r=new Date(e);return{seconds:Math.floor(r.getTime()/1e3),nanos:t}}return{seconds:ai(e.seconds),nanos:ai(e.nanos)}}function ai(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function ci(e){return"string"==typeof e?ii.fromBase64String(e):ii.fromUint8Array(e)}function ui(e){var t,n;return"server_timestamp"===(null===(n=((null===(t=null==e?void 0:e.mapValue)||void 0===t?void 0:t.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function li(e){const t=e.mapValue.fields.__previous_value__;return ui(t)?li(t):t}function hi(e){const t=oi(e.mapValue.fields.__local_write_time__.timestampValue);return new Wr(t.seconds,t.nanos)}class di{constructor(e,t,n,r,i,s,o,a){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=r,this.ssl=i,this.forceLongPolling=s,this.autoDetectLongPolling=o,this.useFetchStreams=a}}class fi{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new fi("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(e){return e instanceof fi&&e.projectId===this.projectId&&e.database===this.database}}function pi(e){return null==e}function mi(e){return 0===e&&1/e==-1/0}function gi(e){return"number"==typeof e&&Number.isInteger(e)&&!mi(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}class yi{constructor(e){this.path=e}static fromPath(e){return new yi(ei.fromString(e))}static fromName(e){return new yi(ei.fromString(e).popFirst(5))}static empty(){return new yi(ei.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===ei.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return ei.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new yi(new ei(e.slice()))}}const vi={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},wi={nullValue:"NULL_VALUE"};function _i(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?ui(e)?4:Pi(e)?9:10:Cr()}function bi(e,t){if(e===t)return!0;const n=_i(e);if(n!==_i(t))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return hi(e).isEqual(hi(t));case 3:return function(e,t){if("string"==typeof e.timestampValue&&"string"==typeof t.timestampValue&&e.timestampValue.length===t.timestampValue.length)return e.timestampValue===t.timestampValue;const n=oi(e.timestampValue),r=oi(t.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(e,t);case 5:return e.stringValue===t.stringValue;case 6:return function(e,t){return ci(e.bytesValue).isEqual(ci(t.bytesValue))}(e,t);case 7:return e.referenceValue===t.referenceValue;case 8:return function(e,t){return ai(e.geoPointValue.latitude)===ai(t.geoPointValue.latitude)&&ai(e.geoPointValue.longitude)===ai(t.geoPointValue.longitude)}(e,t);case 2:return function(e,t){if("integerValue"in e&&"integerValue"in t)return ai(e.integerValue)===ai(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){const n=ai(e.doubleValue),r=ai(t.doubleValue);return n===r?mi(n)===mi(r):isNaN(n)&&isNaN(r)}return!1}(e,t);case 9:return Kr(e.arrayValue.values||[],t.arrayValue.values||[],bi);case 10:return function(e,t){const n=e.mapValue.fields||{},r=t.mapValue.fields||{};if(Qr(n)!==Qr(r))return!1;for(const e in n)if(n.hasOwnProperty(e)&&(void 0===r[e]||!bi(n[e],r[e])))return!1;return!0}(e,t);default:return Cr()}}function Ii(e,t){return void 0!==(e.values||[]).find((e=>bi(e,t)))}function Ti(e,t){if(e===t)return 0;const n=_i(e),r=_i(t);if(n!==r)return Gr(n,r);switch(n){case 0:case 9007199254740991:return 0;case 1:return Gr(e.booleanValue,t.booleanValue);case 2:return function(e,t){const n=ai(e.integerValue||e.doubleValue),r=ai(t.integerValue||t.doubleValue);return n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1}(e,t);case 3:return Ei(e.timestampValue,t.timestampValue);case 4:return Ei(hi(e),hi(t));case 5:return Gr(e.stringValue,t.stringValue);case 6:return function(e,t){const n=ci(e),r=ci(t);return n.compareTo(r)}(e.bytesValue,t.bytesValue);case 7:return function(e,t){const n=e.split("/"),r=t.split("/");for(let e=0;e<n.length&&e<r.length;e++){const t=Gr(n[e],r[e]);if(0!==t)return t}return Gr(n.length,r.length)}(e.referenceValue,t.referenceValue);case 8:return function(e,t){const n=Gr(ai(e.latitude),ai(t.latitude));return 0!==n?n:Gr(ai(e.longitude),ai(t.longitude))}(e.geoPointValue,t.geoPointValue);case 9:return function(e,t){const n=e.values||[],r=t.values||[];for(let e=0;e<n.length&&e<r.length;++e){const t=Ti(n[e],r[e]);if(t)return t}return Gr(n.length,r.length)}(e.arrayValue,t.arrayValue);case 10:return function(e,t){const n=e.fields||{},r=Object.keys(n),i=t.fields||{},s=Object.keys(i);r.sort(),s.sort();for(let e=0;e<r.length&&e<s.length;++e){const t=Gr(r[e],s[e]);if(0!==t)return t;const o=Ti(n[r[e]],i[s[e]]);if(0!==o)return o}return Gr(r.length,s.length)}(e.mapValue,t.mapValue);default:throw Cr()}}function Ei(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return Gr(e,t);const n=oi(e),r=oi(t),i=Gr(n.seconds,r.seconds);return 0!==i?i:Gr(n.nanos,r.nanos)}function Si(e){return ki(e)}function ki(e){return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function(e){const t=oi(e);return`time(${t.seconds},${t.nanos})`}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?ci(e.bytesValue).toBase64():"referenceValue"in e?(n=e.referenceValue,yi.fromName(n).toString()):"geoPointValue"in e?`geo(${(t=e.geoPointValue).latitude},${t.longitude})`:"arrayValue"in e?function(e){let t="[",n=!0;for(const r of e.values||[])n?n=!1:t+=",",t+=ki(r);return t+"]"}(e.arrayValue):"mapValue"in e?function(e){const t=Object.keys(e.fields||{}).sort();let n="{",r=!0;for(const i of t)r?r=!1:n+=",",n+=`${i}:${ki(e.fields[i])}`;return n+"}"}(e.mapValue):Cr();var t,n}function Ai(e,t){return{referenceValue:`projects/${e.projectId}/databases/${e.database}/documents/${t.path.canonicalString()}`}}function Ci(e){return!!e&&"integerValue"in e}function Ni(e){return!!e&&"arrayValue"in e}function Ri(e){return!!e&&"nullValue"in e}function Di(e){return!!e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function xi(e){return!!e&&"mapValue"in e}function Oi(e){if(e.geoPointValue)return{geoPointValue:Object.assign({},e.geoPointValue)};if(e.timestampValue&&"object"==typeof e.timestampValue)return{timestampValue:Object.assign({},e.timestampValue)};if(e.mapValue){const t={mapValue:{fields:{}}};return Xr(e.mapValue.fields,((e,n)=>t.mapValue.fields[e]=Oi(n))),t}if(e.arrayValue){const t={arrayValue:{values:[]}};for(let n=0;n<(e.arrayValue.values||[]).length;++n)t.arrayValue.values[n]=Oi(e.arrayValue.values[n]);return t}return Object.assign({},e)}function Pi(e){return"__max__"===(((e.mapValue||{}).fields||{}).__type__||{}).stringValue}function Li(e){return"nullValue"in e?wi:"booleanValue"in e?{booleanValue:!1}:"integerValue"in e||"doubleValue"in e?{doubleValue:NaN}:"timestampValue"in e?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in e?{stringValue:""}:"bytesValue"in e?{bytesValue:""}:"referenceValue"in e?Ai(fi.empty(),yi.empty()):"geoPointValue"in e?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in e?{arrayValue:{}}:"mapValue"in e?{mapValue:{}}:Cr()}function Mi(e){return"nullValue"in e?{booleanValue:!1}:"booleanValue"in e?{doubleValue:NaN}:"integerValue"in e||"doubleValue"in e?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in e?{stringValue:""}:"stringValue"in e?{bytesValue:""}:"bytesValue"in e?Ai(fi.empty(),yi.empty()):"referenceValue"in e?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in e?{arrayValue:{}}:"arrayValue"in e?{mapValue:{}}:"mapValue"in e?vi:Cr()}function Ui(e,t){return void 0===e?t:void 0===t||Ti(e,t)>0?e:t}function Fi(e,t){return void 0===e?t:void 0===t||Ti(e,t)<0?e:t}class Vi{constructor(e){this.value=e}static empty(){return new Vi({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(t=(t.mapValue.fields||{})[e.get(n)],!xi(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Oi(t)}setAll(e){let t=ni.emptyPath(),n={},r=[];e.forEach(((e,i)=>{if(!t.isImmediateParentOf(i)){const e=this.getFieldsMap(t);this.applyChanges(e,n,r),n={},r=[],t=i.popLast()}e?n[i.lastSegment()]=Oi(e):r.push(i.lastSegment())}));const i=this.getFieldsMap(t);this.applyChanges(i,n,r)}delete(e){const t=this.field(e.popLast());xi(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return bi(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let r=t.mapValue.fields[e.get(n)];xi(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=r),t=r}return t.mapValue.fields}applyChanges(e,t,n){Xr(t,((t,n)=>e[t]=n));for(const t of n)delete e[t]}clone(){return new Vi(Oi(this.value))}}function qi(e){const t=[];return Xr(e.fields,((e,n)=>{const r=new ni([e]);if(xi(n)){const e=qi(n.mapValue).fields;if(0===e.length)t.push(r);else for(const n of e)t.push(r.child(n))}else t.push(r)})),new ri(t)}class Bi{constructor(e,t,n,r,i,s){this.key=e,this.documentType=t,this.version=n,this.readTime=r,this.data=i,this.documentState=s}static newInvalidDocument(e){return new Bi(e,0,Yr.min(),Yr.min(),Vi.empty(),0)}static newFoundDocument(e,t,n){return new Bi(e,1,t,Yr.min(),n,0)}static newNoDocument(e,t){return new Bi(e,2,t,Yr.min(),Vi.empty(),0)}static newUnknownDocument(e,t){return new Bi(e,3,t,Yr.min(),Vi.empty(),2)}convertToFoundDocument(e,t){return this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Vi.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Vi.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof Bi&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new Bi(this.key,this.documentType,this.version,this.readTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class ji{constructor(e,t,n,r){this.indexId=e,this.collectionGroup=t,this.fields=n,this.indexState=r}}function $i(e){return e.fields.find((e=>2===e.kind))}function zi(e){return e.fields.filter((e=>2!==e.kind))}ji.UNKNOWN_ID=-1;class Gi{constructor(e,t){this.fieldPath=e,this.kind=t}}class Ki{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new Ki(0,Yi.min())}}function Hi(e,t){const n=e.toTimestamp().seconds,r=e.toTimestamp().nanoseconds+1,i=Yr.fromTimestamp(1e9===r?new Wr(n+1,0):new Wr(n,r));return new Yi(i,yi.empty(),t)}function Wi(e){return new Yi(e.readTime,e.key,-1)}class Yi{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new Yi(Yr.min(),yi.empty(),-1)}static max(){return new Yi(Yr.max(),yi.empty(),-1)}}function Qi(e,t){let n=e.readTime.compareTo(t.readTime);return 0!==n?n:(n=yi.comparator(e.documentKey,t.documentKey),0!==n?n:Gr(e.largestBatchId,t.largestBatchId))}class Xi{constructor(e,t=null,n=[],r=[],i=null,s=null,o=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=s,this.endAt=o,this.P=null}}function Ji(e,t=null,n=[],r=[],i=null,s=null,o=null){return new Xi(e,t,n,r,i,s,o)}function Zi(e){const t=Rr(e);if(null===t.P){let e=t.path.canonicalString();null!==t.collectionGroup&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map((e=>{return(t=e).field.canonicalString()+t.op.toString()+Si(t.value);var t})).join(","),e+="|ob:",e+=t.orderBy.map((e=>function(e){return e.field.canonicalString()+e.dir}(e))).join(","),pi(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map((e=>Si(e))).join(",")),t.endAt&&(e+="|ub:",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map((e=>Si(e))).join(",")),t.P=e}return t.P}function es(e,t){if(e.limit!==t.limit)return!1;if(e.orderBy.length!==t.orderBy.length)return!1;for(let n=0;n<e.orderBy.length;n++)if(!gs(e.orderBy[n],t.orderBy[n]))return!1;if(e.filters.length!==t.filters.length)return!1;for(let i=0;i<e.filters.length;i++)if(n=e.filters[i],r=t.filters[i],n.op!==r.op||!n.field.isEqual(r.field)||!bi(n.value,r.value))return!1;var n,r;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!vs(e.startAt,t.startAt)&&vs(e.endAt,t.endAt)}function ts(e){return yi.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}function ns(e,t){return e.filters.filter((e=>e instanceof ss&&e.field.isEqual(t)))}function rs(e,t,n){let r,i=!0;for(const n of ns(e,t)){let e,t=!0;switch(n.op){case"<":case"<=":e=Li(n.value);break;case"==":case"in":case">=":e=n.value;break;case">":e=n.value,t=!1;break;case"!=":case"not-in":e=wi}Ui(r,e)===e&&(r=e,i=t)}if(null!==n)for(let s=0;s<e.orderBy.length;++s)if(e.orderBy[s].field.isEqual(t)){const e=n.position[s];Ui(r,e)===e&&(r=e,i=n.inclusive);break}return{value:r,inclusive:i}}function is(e,t,n){let r,i=!0;for(const n of ns(e,t)){let e,t=!0;switch(n.op){case">=":case">":e=Mi(n.value),t=!1;break;case"==":case"in":case"<=":e=n.value;break;case"<":e=n.value,t=!1;break;case"!=":case"not-in":e=vi}Fi(r,e)===e&&(r=e,i=t)}if(null!==n)for(let s=0;s<e.orderBy.length;++s)if(e.orderBy[s].field.isEqual(t)){const e=n.position[s];Fi(r,e)===e&&(r=e,i=n.inclusive);break}return{value:r,inclusive:i}}class ss extends class{}{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?"in"===t||"not-in"===t?this.V(e,t,n):new os(e,t,n):"array-contains"===t?new ls(e,n):"in"===t?new hs(e,n):"not-in"===t?new ds(e,n):"array-contains-any"===t?new fs(e,n):new ss(e,t,n)}static V(e,t,n){return"in"===t?new as(e,n):new cs(e,n)}matches(e){const t=e.data.field(this.field);return"!="===this.op?null!==t&&this.v(Ti(t,this.value)):null!==t&&_i(this.value)===_i(t)&&this.v(Ti(t,this.value))}v(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return Cr()}}S(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}}class os extends ss{constructor(e,t,n){super(e,t,n),this.key=yi.fromName(n.referenceValue)}matches(e){const t=yi.comparator(e.key,this.key);return this.v(t)}}class as extends ss{constructor(e,t){super(e,"in",t),this.keys=us(0,t)}matches(e){return this.keys.some((t=>t.isEqual(e.key)))}}class cs extends ss{constructor(e,t){super(e,"not-in",t),this.keys=us(0,t)}matches(e){return!this.keys.some((t=>t.isEqual(e.key)))}}function us(e,t){var n;return((null===(n=t.arrayValue)||void 0===n?void 0:n.values)||[]).map((e=>yi.fromName(e.referenceValue)))}class ls extends ss{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return Ni(t)&&Ii(t.arrayValue,this.value)}}class hs extends ss{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return null!==t&&Ii(this.value.arrayValue,t)}}class ds extends ss{constructor(e,t){super(e,"not-in",t)}matches(e){if(Ii(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return null!==t&&!Ii(this.value.arrayValue,t)}}class fs extends ss{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!Ni(t)||!t.arrayValue.values)&&t.arrayValue.values.some((e=>Ii(this.value.arrayValue,e)))}}class ps{constructor(e,t){this.position=e,this.inclusive=t}}class ms{constructor(e,t="asc"){this.field=e,this.dir=t}}function gs(e,t){return e.dir===t.dir&&e.field.isEqual(t.field)}function ys(e,t,n){let r=0;for(let i=0;i<e.position.length;i++){const s=t[i],o=e.position[i];if(r=s.field.isKeyField()?yi.comparator(yi.fromName(o.referenceValue),n.key):Ti(o,n.data.field(s.field)),"desc"===s.dir&&(r*=-1),0!==r)break}return r}function vs(e,t){if(null===e)return null===t;if(null===t)return!1;if(e.inclusive!==t.inclusive||e.position.length!==t.position.length)return!1;for(let n=0;n<e.position.length;n++)if(!bi(e.position[n],t.position[n]))return!1;return!0}class ws{constructor(e,t=null,n=[],r=[],i=null,s="F",o=null,a=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=s,this.startAt=o,this.endAt=a,this.D=null,this.C=null,this.startAt,this.endAt}}function _s(e,t,n,r,i,s,o,a){return new ws(e,t,n,r,i,s,o,a)}function bs(e){return new ws(e)}function Is(e){return!pi(e.limit)&&"F"===e.limitType}function Ts(e){return!pi(e.limit)&&"L"===e.limitType}function Es(e){return e.explicitOrderBy.length>0?e.explicitOrderBy[0].field:null}function Ss(e){for(const t of e.filters)if(t.S())return t.field;return null}function ks(e){return null!==e.collectionGroup}function As(e){const t=Rr(e);if(null===t.D){t.D=[];const e=Ss(t),n=Es(t);if(null!==e&&null===n)e.isKeyField()||t.D.push(new ms(e)),t.D.push(new ms(ni.keyField(),"asc"));else{let e=!1;for(const n of t.explicitOrderBy)t.D.push(n),n.field.isKeyField()&&(e=!0);if(!e){const e=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc";t.D.push(new ms(ni.keyField(),e))}}}return t.D}function Cs(e){const t=Rr(e);if(!t.C)if("F"===t.limitType)t.C=Ji(t.path,t.collectionGroup,As(t),t.filters,t.limit,t.startAt,t.endAt);else{const e=[];for(const n of As(t)){const t="desc"===n.dir?"asc":"desc";e.push(new ms(n.field,t))}const n=t.endAt?new ps(t.endAt.position,!t.endAt.inclusive):null,r=t.startAt?new ps(t.startAt.position,!t.startAt.inclusive):null;t.C=Ji(t.path,t.collectionGroup,e,t.filters,t.limit,n,r)}return t.C}function Ns(e,t,n){return new ws(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,n,e.startAt,e.endAt)}function Rs(e,t){return es(Cs(e),Cs(t))&&e.limitType===t.limitType}function Ds(e){return`${Zi(Cs(e))}|lt:${e.limitType}`}function xs(e){return`Query(target=${function(e){let t=e.path.canonicalString();return null!==e.collectionGroup&&(t+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(t+=`, filters: [${e.filters.map((e=>{return`${(t=e).field.canonicalString()} ${t.op} ${Si(t.value)}`;var t})).join(", ")}]`),pi(e.limit)||(t+=", limit: "+e.limit),e.orderBy.length>0&&(t+=`, orderBy: [${e.orderBy.map((e=>function(e){return`${e.field.canonicalString()} (${e.dir})`}(e))).join(", ")}]`),e.startAt&&(t+=", startAt: ",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map((e=>Si(e))).join(",")),e.endAt&&(t+=", endAt: ",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map((e=>Si(e))).join(",")),`Target(${t})`}(Cs(e))}; limitType=${e.limitType})`}function Os(e,t){return t.isFoundDocument()&&function(e,t){const n=t.key.path;return null!==e.collectionGroup?t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(n):yi.isDocumentKey(e.path)?e.path.isEqual(n):e.path.isImmediateParentOf(n)}(e,t)&&function(e,t){for(const n of e.explicitOrderBy)if(!n.field.isKeyField()&&null===t.data.field(n.field))return!1;return!0}(e,t)&&function(e,t){for(const n of e.filters)if(!n.matches(t))return!1;return!0}(e,t)&&function(e,t){return!(e.startAt&&!function(e,t,n){const r=ys(e,t,n);return e.inclusive?r<=0:r<0}(e.startAt,As(e),t)||e.endAt&&!function(e,t,n){const r=ys(e,t,n);return e.inclusive?r>=0:r>0}(e.endAt,As(e),t))}(e,t)}function Ps(e){return e.collectionGroup||(e.path.length%2==1?e.path.lastSegment():e.path.get(e.path.length-2))}function Ls(e){return(t,n)=>{let r=!1;for(const i of As(e)){const e=Ms(i,t,n);if(0!==e)return e;r=r||i.field.isKeyField()}return 0}}function Ms(e,t,n){const r=e.field.isKeyField()?yi.comparator(t.key,n.key):function(e,t,n){const r=t.data.field(e),i=n.data.field(e);return null!==r&&null!==i?Ti(r,i):Cr()}(e.field,t,n);switch(e.dir){case"asc":return r;case"desc":return-1*r;default:return Cr()}}function Us(e,t){if(e.N){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:mi(t)?"-0":t}}function Fs(e){return{integerValue:""+e}}function Vs(e,t){return gi(t)?Fs(t):Us(e,t)}class qs{constructor(){this._=void 0}}function Bs(e,t,n){return e instanceof zs?function(e,t){const n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:e.seconds,nanos:e.nanoseconds}}}};return t&&(n.fields.__previous_value__=t),{mapValue:n}}(n,t):e instanceof Gs?Ks(e,t):e instanceof Hs?Ws(e,t):function(e,t){const n=$s(e,t),r=Qs(n)+Qs(e.k);return Ci(n)&&Ci(e.k)?Fs(r):Us(e.M,r)}(e,t)}function js(e,t,n){return e instanceof Gs?Ks(e,t):e instanceof Hs?Ws(e,t):n}function $s(e,t){return e instanceof Ys?Ci(n=t)||function(e){return!!e&&"doubleValue"in e}(n)?t:{integerValue:0}:null;var n}class zs extends qs{}class Gs extends qs{constructor(e){super(),this.elements=e}}function Ks(e,t){const n=Xs(t);for(const t of e.elements)n.some((e=>bi(e,t)))||n.push(t);return{arrayValue:{values:n}}}class Hs extends qs{constructor(e){super(),this.elements=e}}function Ws(e,t){let n=Xs(t);for(const t of e.elements)n=n.filter((e=>!bi(e,t)));return{arrayValue:{values:n}}}class Ys extends qs{constructor(e,t){super(),this.M=e,this.k=t}}function Qs(e){return ai(e.integerValue||e.doubleValue)}function Xs(e){return Ni(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}class Js{constructor(e,t){this.field=e,this.transform=t}}class Zs{constructor(e,t){this.version=e,this.transformResults=t}}class eo{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new eo}static exists(e){return new eo(void 0,e)}static updateTime(e){return new eo(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function to(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}class no{}function ro(e,t,n){e instanceof co?function(e,t,n){const r=e.value.clone(),i=ho(e.fieldTransforms,t,n.transformResults);r.setAll(i),t.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(e,t,n):e instanceof uo?function(e,t,n){if(!to(e.precondition,t))return void t.convertToUnknownDocument(n.version);const r=ho(e.fieldTransforms,t,n.transformResults),i=t.data;i.setAll(lo(e)),i.setAll(r),t.convertToFoundDocument(n.version,i).setHasCommittedMutations()}(e,t,n):function(e,t,n){t.convertToNoDocument(n.version).setHasCommittedMutations()}(0,t,n)}function io(e,t,n){e instanceof co?function(e,t,n){if(!to(e.precondition,t))return;const r=e.value.clone(),i=fo(e.fieldTransforms,n,t);r.setAll(i),t.convertToFoundDocument(ao(t),r).setHasLocalMutations()}(e,t,n):e instanceof uo?function(e,t,n){if(!to(e.precondition,t))return;const r=fo(e.fieldTransforms,n,t),i=t.data;i.setAll(lo(e)),i.setAll(r),t.convertToFoundDocument(ao(t),i).setHasLocalMutations()}(e,t,n):function(e,t){to(e.precondition,t)&&t.convertToNoDocument(Yr.min())}(e,t)}function so(e,t){let n=null;for(const r of e.fieldTransforms){const e=t.data.field(r.field),i=$s(r.transform,e||null);null!=i&&(null==n&&(n=Vi.empty()),n.set(r.field,i))}return n||null}function oo(e,t){return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&!!function(e,t){return void 0===e&&void 0===t||!(!e||!t)&&Kr(e,t,((e,t)=>function(e,t){return e.field.isEqual(t.field)&&function(e,t){return e instanceof Gs&&t instanceof Gs||e instanceof Hs&&t instanceof Hs?Kr(e.elements,t.elements,bi):e instanceof Ys&&t instanceof Ys?bi(e.k,t.k):e instanceof zs&&t instanceof zs}(e.transform,t.transform)}(e,t)))}(e.fieldTransforms,t.fieldTransforms)&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask))}function ao(e){return e.isFoundDocument()?e.version:Yr.min()}class co extends no{constructor(e,t,n,r=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=r,this.type=0}}class uo extends no{constructor(e,t,n,r,i=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=r,this.fieldTransforms=i,this.type=1}}function lo(e){const t=new Map;return e.fieldMask.fields.forEach((n=>{if(!n.isEmpty()){const r=e.data.field(n);t.set(n,r)}})),t}function ho(e,t,n){const r=new Map;Nr(e.length===n.length);for(let i=0;i<n.length;i++){const s=e[i],o=s.transform,a=t.data.field(s.field);r.set(s.field,js(o,a,n[i]))}return r}function fo(e,t,n){const r=new Map;for(const i of e){const e=i.transform,s=n.data.field(i.field);r.set(i.field,Bs(e,s,t))}return r}class po extends no{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}}class mo extends no{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}}class go{constructor(e){this.count=e}}var yo,vo;function wo(e){switch(e){default:return Cr();case Dr.CANCELLED:case Dr.UNKNOWN:case Dr.DEADLINE_EXCEEDED:case Dr.RESOURCE_EXHAUSTED:case Dr.INTERNAL:case Dr.UNAVAILABLE:case Dr.UNAUTHENTICATED:return!1;case Dr.INVALID_ARGUMENT:case Dr.NOT_FOUND:case Dr.ALREADY_EXISTS:case Dr.PERMISSION_DENIED:case Dr.FAILED_PRECONDITION:case Dr.ABORTED:case Dr.OUT_OF_RANGE:case Dr.UNIMPLEMENTED:case Dr.DATA_LOSS:return!0}}function _o(e){if(void 0===e)return Sr("GRPC error has no .code"),Dr.UNKNOWN;switch(e){case yo.OK:return Dr.OK;case yo.CANCELLED:return Dr.CANCELLED;case yo.UNKNOWN:return Dr.UNKNOWN;case yo.DEADLINE_EXCEEDED:return Dr.DEADLINE_EXCEEDED;case yo.RESOURCE_EXHAUSTED:return Dr.RESOURCE_EXHAUSTED;case yo.INTERNAL:return Dr.INTERNAL;case yo.UNAVAILABLE:return Dr.UNAVAILABLE;case yo.UNAUTHENTICATED:return Dr.UNAUTHENTICATED;case yo.INVALID_ARGUMENT:return Dr.INVALID_ARGUMENT;case yo.NOT_FOUND:return Dr.NOT_FOUND;case yo.ALREADY_EXISTS:return Dr.ALREADY_EXISTS;case yo.PERMISSION_DENIED:return Dr.PERMISSION_DENIED;case yo.FAILED_PRECONDITION:return Dr.FAILED_PRECONDITION;case yo.ABORTED:return Dr.ABORTED;case yo.OUT_OF_RANGE:return Dr.OUT_OF_RANGE;case yo.UNIMPLEMENTED:return Dr.UNIMPLEMENTED;case yo.DATA_LOSS:return Dr.DATA_LOSS;default:return Cr()}}(vo=yo||(yo={}))[vo.OK=0]="OK",vo[vo.CANCELLED=1]="CANCELLED",vo[vo.UNKNOWN=2]="UNKNOWN",vo[vo.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",vo[vo.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",vo[vo.NOT_FOUND=5]="NOT_FOUND",vo[vo.ALREADY_EXISTS=6]="ALREADY_EXISTS",vo[vo.PERMISSION_DENIED=7]="PERMISSION_DENIED",vo[vo.UNAUTHENTICATED=16]="UNAUTHENTICATED",vo[vo.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",vo[vo.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",vo[vo.ABORTED=10]="ABORTED",vo[vo.OUT_OF_RANGE=11]="OUT_OF_RANGE",vo[vo.UNIMPLEMENTED=12]="UNIMPLEMENTED",vo[vo.INTERNAL=13]="INTERNAL",vo[vo.UNAVAILABLE=14]="UNAVAILABLE",vo[vo.DATA_LOSS=15]="DATA_LOSS";class bo{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n)for(const[t,r]of n)if(this.equalsFn(t,e))return r}has(e){return void 0!==this.get(e)}set(e,t){const n=this.mapKeyFn(e),r=this.inner[n];if(void 0===r)return this.inner[n]=[[e,t]],void this.innerSize++;for(let n=0;n<r.length;n++)if(this.equalsFn(r[n][0],e))return void(r[n]=[e,t]);r.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0===n)return!1;for(let r=0;r<n.length;r++)if(this.equalsFn(n[r][0],e))return 1===n.length?delete this.inner[t]:n.splice(r,1),this.innerSize--,!0;return!1}forEach(e){Xr(this.inner,((t,n)=>{for(const[t,r]of n)e(t,r)}))}isEmpty(){return Jr(this.inner)}size(){return this.innerSize}}class Io{constructor(e,t){this.comparator=e,this.root=t||Eo.EMPTY}insert(e,t){return new Io(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Eo.BLACK,null,null))}remove(e){return new Io(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Eo.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){const r=this.comparator(e,n.key);if(0===r)return t+n.left.size;r<0?n=n.left:(t+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal(((t,n)=>(e(t,n),!1)))}toString(){const e=[];return this.inorderTraversal(((t,n)=>(e.push(`${t}:${n}`),!1))),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new To(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new To(this.root,e,this.comparator,!1)}getReverseIterator(){return new To(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new To(this.root,e,this.comparator,!0)}}class To{constructor(e,t,n,r){this.isReverse=r,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?n(e.key,t):1,t&&r&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(0===i){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Eo{constructor(e,t,n,r,i){this.key=e,this.value=t,this.color=null!=n?n:Eo.RED,this.left=null!=r?r:Eo.EMPTY,this.right=null!=i?i:Eo.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,r,i){return new Eo(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let r=this;const i=n(e,r.key);return r=i<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===i?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n)),r.fixUp()}removeMin(){if(this.left.isEmpty())return Eo.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let n,r=this;if(t(e,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(e,t),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),0===t(e,r.key)){if(r.right.isEmpty())return Eo.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Eo.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Eo.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw Cr();if(this.right.isRed())throw Cr();const e=this.left.check();if(e!==this.right.check())throw Cr();return e+(this.isRed()?0:1)}}Eo.EMPTY=null,Eo.RED=!0,Eo.BLACK=!1,Eo.EMPTY=new class{constructor(){this.size=0}get key(){throw Cr()}get value(){throw Cr()}get color(){throw Cr()}get left(){throw Cr()}get right(){throw Cr()}copy(e,t,n,r,i){return this}insert(e,t,n){return new Eo(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class So{constructor(e){this.comparator=e,this.data=new Io(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal(((t,n)=>(e(t),!1)))}forEachInRange(e,t){const n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){const r=n.getNext();if(this.comparator(r.key,e[1])>=0)return;t(r.key)}}forEachWhile(e,t){let n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new ko(this.data.getIterator())}getIteratorFrom(e){return new ko(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach((e=>{t=t.add(e)})),t}isEqual(e){if(!(e instanceof So))return!1;if(this.size!==e.size)return!1;const t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){const e=t.getNext().key,r=n.getNext().key;if(0!==this.comparator(e,r))return!1}return!0}toArray(){const e=[];return this.forEach((t=>{e.push(t)})),e}toString(){const e=[];return this.forEach((t=>e.push(t))),"SortedSet("+e.toString()+")"}copy(e){const t=new So(this.comparator);return t.data=e,t}}class ko{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function Ao(e){return e.hasNext()?e.getNext():void 0}const Co=new Io(yi.comparator);function No(){return Co}const Ro=new Io(yi.comparator);function Do(){return Ro}function xo(){return new bo((e=>e.toString()),((e,t)=>e.isEqual(t)))}const Oo=new Io(yi.comparator),Po=new So(yi.comparator);function Lo(...e){let t=Po;for(const n of e)t=t.add(n);return t}const Mo=new So(Gr);function Uo(){return Mo}class Fo{constructor(e,t,n,r,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t){const n=new Map;return n.set(e,Vo.createSynthesizedTargetChangeForCurrentChange(e,t)),new Fo(Yr.min(),n,Uo(),No(),Lo())}}class Vo{constructor(e,t,n,r,i){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t){return new Vo(ii.EMPTY_BYTE_STRING,t,Lo(),Lo(),Lo())}}class qo{constructor(e,t,n,r){this.O=e,this.removedTargetIds=t,this.key=n,this.F=r}}class Bo{constructor(e,t){this.targetId=e,this.$=t}}class jo{constructor(e,t,n=ii.EMPTY_BYTE_STRING,r=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=r}}class $o{constructor(){this.B=0,this.L=Ko(),this.U=ii.EMPTY_BYTE_STRING,this.q=!1,this.K=!0}get current(){return this.q}get resumeToken(){return this.U}get G(){return 0!==this.B}get j(){return this.K}W(e){e.approximateByteSize()>0&&(this.K=!0,this.U=e)}H(){let e=Lo(),t=Lo(),n=Lo();return this.L.forEach(((r,i)=>{switch(i){case 0:e=e.add(r);break;case 2:t=t.add(r);break;case 1:n=n.add(r);break;default:Cr()}})),new Vo(this.U,this.q,e,t,n)}J(){this.K=!1,this.L=Ko()}Y(e,t){this.K=!0,this.L=this.L.insert(e,t)}X(e){this.K=!0,this.L=this.L.remove(e)}Z(){this.B+=1}tt(){this.B-=1}et(){this.K=!0,this.q=!0}}class zo{constructor(e){this.nt=e,this.st=new Map,this.it=No(),this.rt=Go(),this.ot=new So(Gr)}ut(e){for(const t of e.O)e.F&&e.F.isFoundDocument()?this.at(t,e.F):this.ct(t,e.key,e.F);for(const t of e.removedTargetIds)this.ct(t,e.key,e.F)}ht(e){this.forEachTarget(e,(t=>{const n=this.lt(t);switch(e.state){case 0:this.ft(t)&&n.W(e.resumeToken);break;case 1:n.tt(),n.G||n.J(),n.W(e.resumeToken);break;case 2:n.tt(),n.G||this.removeTarget(t);break;case 3:this.ft(t)&&(n.et(),n.W(e.resumeToken));break;case 4:this.ft(t)&&(this.dt(t),n.W(e.resumeToken));break;default:Cr()}}))}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.st.forEach(((e,n)=>{this.ft(n)&&t(n)}))}_t(e){const t=e.targetId,n=e.$.count,r=this.wt(t);if(r){const e=r.target;if(ts(e))if(0===n){const n=new yi(e.path);this.ct(t,n,Bi.newNoDocument(n,Yr.min()))}else Nr(1===n);else this.gt(t)!==n&&(this.dt(t),this.ot=this.ot.add(t))}}yt(e){const t=new Map;this.st.forEach(((n,r)=>{const i=this.wt(r);if(i){if(n.current&&ts(i.target)){const t=new yi(i.target.path);null!==this.it.get(t)||this.It(r,t)||this.ct(r,t,Bi.newNoDocument(t,e))}n.j&&(t.set(r,n.H()),n.J())}}));let n=Lo();this.rt.forEach(((e,t)=>{let r=!0;t.forEachWhile((e=>{const t=this.wt(e);return!t||2===t.purpose||(r=!1,!1)})),r&&(n=n.add(e))})),this.it.forEach(((t,n)=>n.setReadTime(e)));const r=new Fo(e,t,this.ot,this.it,n);return this.it=No(),this.rt=Go(),this.ot=new So(Gr),r}at(e,t){if(!this.ft(e))return;const n=this.It(e,t.key)?2:0;this.lt(e).Y(t.key,n),this.it=this.it.insert(t.key,t),this.rt=this.rt.insert(t.key,this.Tt(t.key).add(e))}ct(e,t,n){if(!this.ft(e))return;const r=this.lt(e);this.It(e,t)?r.Y(t,1):r.X(t),this.rt=this.rt.insert(t,this.Tt(t).delete(e)),n&&(this.it=this.it.insert(t,n))}removeTarget(e){this.st.delete(e)}gt(e){const t=this.lt(e).H();return this.nt.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Z(e){this.lt(e).Z()}lt(e){let t=this.st.get(e);return t||(t=new $o,this.st.set(e,t)),t}Tt(e){let t=this.rt.get(e);return t||(t=new So(Gr),this.rt=this.rt.insert(e,t)),t}ft(e){const t=null!==this.wt(e);return t||Er("WatchChangeAggregator","Detected inactive target",e),t}wt(e){const t=this.st.get(e);return t&&t.G?null:this.nt.Et(e)}dt(e){this.st.set(e,new $o),this.nt.getRemoteKeysForTarget(e).forEach((t=>{this.ct(e,t,null)}))}It(e,t){return this.nt.getRemoteKeysForTarget(e).has(t)}}function Go(){return new Io(yi.comparator)}function Ko(){return new Io(yi.comparator)}const Ho={asc:"ASCENDING",desc:"DESCENDING"},Wo={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"};class Yo{constructor(e,t){this.databaseId=e,this.N=t}}function Qo(e,t){return e.N?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function Xo(e,t){return e.N?t.toBase64():t.toUint8Array()}function Jo(e,t){return Qo(e,t.toTimestamp())}function Zo(e){return Nr(!!e),Yr.fromTimestamp(function(e){const t=oi(e);return new Wr(t.seconds,t.nanos)}(e))}function ea(e,t){return function(e){return new ei(["projects",e.projectId,"databases",e.database])}(e).child("documents").child(t).canonicalString()}function ta(e){const t=ei.fromString(e);return Nr(Ta(t)),t}function na(e,t){return ea(e.databaseId,t.path)}function ra(e,t){const n=ta(t);if(n.get(1)!==e.databaseId.projectId)throw new xr(Dr.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+e.databaseId.projectId);if(n.get(3)!==e.databaseId.database)throw new xr(Dr.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+e.databaseId.database);return new yi(aa(n))}function ia(e,t){return ea(e.databaseId,t)}function sa(e){const t=ta(e);return 4===t.length?ei.emptyPath():aa(t)}function oa(e){return new ei(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function aa(e){return Nr(e.length>4&&"documents"===e.get(4)),e.popFirst(5)}function ca(e,t,n){return{name:na(e,t),fields:n.value.mapValue.fields}}function ua(e,t,n){const r=ra(e,t.name),i=Zo(t.updateTime),s=new Vi({mapValue:{fields:t.fields}}),o=Bi.newFoundDocument(r,i,s);return n&&o.setHasCommittedMutations(),n?o.setHasCommittedMutations():o}function la(e,t){let n;if(t instanceof co)n={update:ca(e,t.key,t.value)};else if(t instanceof po)n={delete:na(e,t.key)};else if(t instanceof uo)n={update:ca(e,t.key,t.data),updateMask:Ia(t.fieldMask)};else{if(!(t instanceof mo))return Cr();n={verify:na(e,t.key)}}return t.fieldTransforms.length>0&&(n.updateTransforms=t.fieldTransforms.map((e=>function(e,t){const n=t.transform;if(n instanceof zs)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof Gs)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof Hs)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof Ys)return{fieldPath:t.field.canonicalString(),increment:n.k};throw Cr()}(0,e)))),t.precondition.isNone||(n.currentDocument=function(e,t){return void 0!==t.updateTime?{updateTime:Jo(e,t.updateTime)}:void 0!==t.exists?{exists:t.exists}:Cr()}(e,t.precondition)),n}function ha(e,t){const n=t.currentDocument?function(e){return void 0!==e.updateTime?eo.updateTime(Zo(e.updateTime)):void 0!==e.exists?eo.exists(e.exists):eo.none()}(t.currentDocument):eo.none(),r=t.updateTransforms?t.updateTransforms.map((t=>function(e,t){let n=null;if("setToServerValue"in t)Nr("REQUEST_TIME"===t.setToServerValue),n=new zs;else if("appendMissingElements"in t){const e=t.appendMissingElements.values||[];n=new Gs(e)}else if("removeAllFromArray"in t){const e=t.removeAllFromArray.values||[];n=new Hs(e)}else"increment"in t?n=new Ys(e,t.increment):Cr();const r=ni.fromServerFormat(t.fieldPath);return new Js(r,n)}(e,t))):[];if(t.update){t.update.name;const i=ra(e,t.update.name),s=new Vi({mapValue:{fields:t.update.fields}});if(t.updateMask){const e=function(e){const t=e.fieldPaths||[];return new ri(t.map((e=>ni.fromServerFormat(e))))}(t.updateMask);return new uo(i,s,e,n,r)}return new co(i,s,n,r)}if(t.delete){const r=ra(e,t.delete);return new po(r,n)}if(t.verify){const r=ra(e,t.verify);return new mo(r,n)}return Cr()}function da(e,t){return{documents:[ia(e,t.path)]}}function fa(e,t){const n={structuredQuery:{}},r=t.path;null!==t.collectionGroup?(n.parent=ia(e,r),n.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(n.parent=ia(e,r.popLast()),n.structuredQuery.from=[{collectionId:r.lastSegment()}]);const i=function(e){if(0===e.length)return;const t=e.map((e=>function(e){if("=="===e.op){if(Di(e.value))return{unaryFilter:{field:va(e.field),op:"IS_NAN"}};if(Ri(e.value))return{unaryFilter:{field:va(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(Di(e.value))return{unaryFilter:{field:va(e.field),op:"IS_NOT_NAN"}};if(Ri(e.value))return{unaryFilter:{field:va(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:va(e.field),op:ya(e.op),value:e.value}}}(e)));return 1===t.length?t[0]:{compositeFilter:{op:"AND",filters:t}}}(t.filters);i&&(n.structuredQuery.where=i);const s=function(e){if(0!==e.length)return e.map((e=>function(e){return{field:va(e.field),direction:ga(e.dir)}}(e)))}(t.orderBy);s&&(n.structuredQuery.orderBy=s);const o=function(e,t){return e.N||pi(t)?t:{value:t}}(e,t.limit);var a;return null!==o&&(n.structuredQuery.limit=o),t.startAt&&(n.structuredQuery.startAt={before:(a=t.startAt).inclusive,values:a.position}),t.endAt&&(n.structuredQuery.endAt=function(e){return{before:!e.inclusive,values:e.position}}(t.endAt)),n}function pa(e){let t=sa(e.parent);const n=e.structuredQuery,r=n.from?n.from.length:0;let i=null;if(r>0){Nr(1===r);const e=n.from[0];e.allDescendants?i=e.collectionId:t=t.child(e.collectionId)}let s=[];n.where&&(s=ma(n.where));let o=[];n.orderBy&&(o=n.orderBy.map((e=>function(e){return new ms(wa(e.field),function(e){switch(e){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(e.direction))}(e))));let a=null;n.limit&&(a=function(e){let t;return t="object"==typeof e?e.value:e,pi(t)?null:t}(n.limit));let c=null;n.startAt&&(c=function(e){const t=!!e.before,n=e.values||[];return new ps(n,t)}(n.startAt));let u=null;return n.endAt&&(u=function(e){const t=!e.before,n=e.values||[];return new ps(n,t)}(n.endAt)),_s(t,i,o,s,a,"F",c,u)}function ma(e){return e?void 0!==e.unaryFilter?[ba(e)]:void 0!==e.fieldFilter?[_a(e)]:void 0!==e.compositeFilter?e.compositeFilter.filters.map((e=>ma(e))).reduce(((e,t)=>e.concat(t))):Cr():[]}function ga(e){return Ho[e]}function ya(e){return Wo[e]}function va(e){return{fieldPath:e.canonicalString()}}function wa(e){return ni.fromServerFormat(e.fieldPath)}function _a(e){return ss.create(wa(e.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return Cr()}}(e.fieldFilter.op),e.fieldFilter.value)}function ba(e){switch(e.unaryFilter.op){case"IS_NAN":const t=wa(e.unaryFilter.field);return ss.create(t,"==",{doubleValue:NaN});case"IS_NULL":const n=wa(e.unaryFilter.field);return ss.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const r=wa(e.unaryFilter.field);return ss.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const i=wa(e.unaryFilter.field);return ss.create(i,"!=",{nullValue:"NULL_VALUE"});default:return Cr()}}function Ia(e){const t=[];return e.fields.forEach((e=>t.push(e.canonicalString()))),{fieldPaths:t}}function Ta(e){return e.length>=4&&"projects"===e.get(0)&&"databases"===e.get(2)}function Ea(e){let t="";for(let n=0;n<e.length;n++)t.length>0&&(t=ka(t)),t=Sa(e.get(n),t);return ka(t)}function Sa(e,t){let n=t;const r=e.length;for(let t=0;t<r;t++){const r=e.charAt(t);switch(r){case"\0":n+="";break;case"":n+="";break;default:n+=r}}return n}function ka(e){return e+""}function Aa(e){const t=e.length;if(Nr(t>=2),2===t)return Nr(""===e.charAt(0)&&""===e.charAt(1)),ei.emptyPath();const n=t-2,r=[];let i="";for(let s=0;s<t;){const t=e.indexOf("",s);switch((t<0||t>n)&&Cr(),e.charAt(t+1)){case"":const n=e.substring(s,t);let o;0===i.length?o=n:(i+=n,o=i,i=""),r.push(o);break;case"":i+=e.substring(s,t),i+="\0";break;case"":i+=e.substring(s,t+1);break;default:Cr()}s=t+2}return new ei(r)}const Ca=["userId","batchId"];function Na(e,t){return[e,Ea(t)]}function Ra(e,t,n){return[e,Ea(t),n]}const Da={},xa=["prefixPath","collectionGroup","readTime","documentId"],Oa=["prefixPath","collectionGroup","documentId"],Pa=["collectionGroup","readTime","prefixPath","documentId"],La=["canonicalId","targetId"],Ma=["targetId","path"],Ua=["path","targetId"],Fa=["collectionId","parent"],Va=["indexId","uid"],qa=["uid","sequenceNumber"],Ba=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],ja=["indexId","uid","orderedDocumentKey"],$a=["userId","collectionPath","documentId"],za=["userId","collectionPath","largestBatchId"],Ga=["userId","collectionGroup","largestBatchId"],Ka=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],Ha=[...Ka,"documentOverlays"],Wa=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],Ya=[...Wa,"indexConfiguration","indexState","indexEntries"],Qa="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class Xa{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((e=>e()))}}class Ja{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e((e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)}),(e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)}))}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&Cr(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new Ja(((n,r)=>{this.nextCallback=t=>{this.wrapSuccess(e,t).next(n,r)},this.catchCallback=e=>{this.wrapFailure(t,e).next(n,r)}}))}toPromise(){return new Promise(((e,t)=>{this.next(e,t)}))}wrapUserFunction(e){try{const t=e();return t instanceof Ja?t:Ja.resolve(t)}catch(e){return Ja.reject(e)}}wrapSuccess(e,t){return e?this.wrapUserFunction((()=>e(t))):Ja.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction((()=>e(t))):Ja.reject(t)}static resolve(e){return new Ja(((t,n)=>{t(e)}))}static reject(e){return new Ja(((t,n)=>{n(e)}))}static waitFor(e){return new Ja(((t,n)=>{let r=0,i=0,s=!1;e.forEach((e=>{++r,e.next((()=>{++i,s&&i===r&&t()}),(e=>n(e)))})),s=!0,i===r&&t()}))}static or(e){let t=Ja.resolve(!1);for(const n of e)t=t.next((e=>e?Ja.resolve(e):n()));return t}static forEach(e,t){const n=[];return e.forEach(((e,r)=>{n.push(t.call(this,e,r))})),this.waitFor(n)}}class Za{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.At=new Or,this.transaction.oncomplete=()=>{this.At.resolve()},this.transaction.onabort=()=>{t.error?this.At.reject(new nc(e,t.error)):this.At.resolve()},this.transaction.onerror=t=>{const n=ac(t.target.error);this.At.reject(new nc(e,n))}}static open(e,t,n,r){try{return new Za(t,e.transaction(r,n))}catch(e){throw new nc(t,e)}}get Rt(){return this.At.promise}abort(e){e&&this.At.reject(e),this.aborted||(Er("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}Pt(){const e=this.transaction;this.aborted||"function"!=typeof e.commit||e.commit()}store(e){const t=this.transaction.objectStore(e);return new ic(t)}}class ec{constructor(e,t,n){this.name=e,this.version=t,this.bt=n,12.2===ec.Vt((0,c.z$)())&&Sr("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return Er("SimpleDb","Removing database:",e),sc(window.indexedDB.deleteDatabase(e)).toPromise()}static vt(){if(!(0,c.hl)())return!1;if(ec.St())return!0;const e=(0,c.z$)(),t=ec.Vt(e),n=0<t&&t<10,r=ec.Dt(e),i=0<r&&r<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||n||i)}static St(){var e;return"undefined"!=typeof process&&"YES"===(null===(e=process.env)||void 0===e?void 0:e.Ct)}static xt(e,t){return e.store(t)}static Vt(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(n)}static Dt(e){const t=e.match(/Android ([\d.]+)/i),n=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(n)}async Nt(e){return this.db||(Er("SimpleDb","Opening database:",this.name),this.db=await new Promise(((t,n)=>{const r=indexedDB.open(this.name,this.version);r.onsuccess=e=>{const n=e.target.result;t(n)},r.onblocked=()=>{n(new nc(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},r.onerror=t=>{const r=t.target.error;"VersionError"===r.name?n(new xr(Dr.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):"InvalidStateError"===r.name?n(new xr(Dr.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+r)):n(new nc(e,r))},r.onupgradeneeded=e=>{Er("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',e.oldVersion);const t=e.target.result;this.bt.kt(t,r.transaction,e.oldVersion,this.version).next((()=>{Er("SimpleDb","Database upgrade to version "+this.version+" complete")}))}}))),this.Mt&&(this.db.onversionchange=e=>this.Mt(e)),this.db}Ot(e){this.Mt=e,this.db&&(this.db.onversionchange=t=>e(t))}async runTransaction(e,t,n,r){const i="readonly"===t;let s=0;for(;;){++s;try{this.db=await this.Nt(e);const t=Za.open(this.db,e,i?"readonly":"readwrite",n),s=r(t).next((e=>(t.Pt(),e))).catch((e=>(t.abort(e),Ja.reject(e)))).toPromise();return s.catch((()=>{})),await t.Rt,s}catch(e){const t="FirebaseError"!==e.name&&s<3;if(Er("SimpleDb","Transaction failed with error:",e.message,"Retrying:",t),this.close(),!t)return Promise.reject(e)}}}close(){this.db&&this.db.close(),this.db=void 0}}class tc{constructor(e){this.Ft=e,this.$t=!1,this.Bt=null}get isDone(){return this.$t}get Lt(){return this.Bt}set cursor(e){this.Ft=e}done(){this.$t=!0}Ut(e){this.Bt=e}delete(){return sc(this.Ft.delete())}}class nc extends xr{constructor(e,t){super(Dr.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function rc(e){return"IndexedDbTransactionError"===e.name}class ic{constructor(e){this.store=e}put(e,t){let n;return void 0!==t?(Er("SimpleDb","PUT",this.store.name,e,t),n=this.store.put(t,e)):(Er("SimpleDb","PUT",this.store.name,"<auto-key>",e),n=this.store.put(e)),sc(n)}add(e){return Er("SimpleDb","ADD",this.store.name,e,e),sc(this.store.add(e))}get(e){return sc(this.store.get(e)).next((t=>(void 0===t&&(t=null),Er("SimpleDb","GET",this.store.name,e,t),t)))}delete(e){return Er("SimpleDb","DELETE",this.store.name,e),sc(this.store.delete(e))}count(){return Er("SimpleDb","COUNT",this.store.name),sc(this.store.count())}qt(e,t){const n=this.options(e,t);if(n.index||"function"!=typeof this.store.getAll){const e=this.cursor(n),t=[];return this.Kt(e,((e,n)=>{t.push(n)})).next((()=>t))}{const e=this.store.getAll(n.range);return new Ja(((t,n)=>{e.onerror=e=>{n(e.target.error)},e.onsuccess=e=>{t(e.target.result)}}))}}Gt(e,t){const n=this.store.getAll(e,null===t?void 0:t);return new Ja(((e,t)=>{n.onerror=e=>{t(e.target.error)},n.onsuccess=t=>{e(t.target.result)}}))}Qt(e,t){Er("SimpleDb","DELETE ALL",this.store.name);const n=this.options(e,t);n.jt=!1;const r=this.cursor(n);return this.Kt(r,((e,t,n)=>n.delete()))}Wt(e,t){let n;t?n=e:(n={},t=e);const r=this.cursor(n);return this.Kt(r,t)}zt(e){const t=this.cursor({});return new Ja(((n,r)=>{t.onerror=e=>{const t=ac(e.target.error);r(t)},t.onsuccess=t=>{const r=t.target.result;r?e(r.primaryKey,r.value).next((e=>{e?r.continue():n()})):n()}}))}Kt(e,t){const n=[];return new Ja(((r,i)=>{e.onerror=e=>{i(e.target.error)},e.onsuccess=e=>{const i=e.target.result;if(!i)return void r();const s=new tc(i),o=t(i.primaryKey,i.value,s);if(o instanceof Ja){const e=o.catch((e=>(s.done(),Ja.reject(e))));n.push(e)}s.isDone?r():null===s.Lt?i.continue():i.continue(s.Lt)}})).next((()=>Ja.waitFor(n)))}options(e,t){let n;return void 0!==e&&("string"==typeof e?n=e:t=e),{index:n,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const n=this.store.index(e.index);return e.jt?n.openKeyCursor(e.range,t):n.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function sc(e){return new Ja(((t,n)=>{e.onsuccess=e=>{const n=e.target.result;t(n)},e.onerror=e=>{const t=ac(e.target.error);n(t)}}))}let oc=!1;function ac(e){const t=ec.Vt((0,c.z$)());if(t>=12.2&&t<13){const t="An internal error was encountered in the Indexed Database server";if(e.message.indexOf(t)>=0){const e=new xr("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return oc||(oc=!0,setTimeout((()=>{throw e}),0)),e}}return e}class cc extends Xa{constructor(e,t){super(),this.Ht=e,this.currentSequenceNumber=t}}function uc(e,t){const n=Rr(e);return ec.xt(n.Ht,t)}class lc{constructor(e,t,n,r){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=r}applyToRemoteDocument(e,t){const n=t.mutationResults;for(let t=0;t<this.mutations.length;t++){const r=this.mutations[t];r.key.isEqual(e.key)&&ro(r,e,n[t])}}applyToLocalView(e){for(const t of this.baseMutations)t.key.isEqual(e.key)&&io(t,e,this.localWriteTime);for(const t of this.mutations)t.key.isEqual(e.key)&&io(t,e,this.localWriteTime)}applyToLocalDocumentSet(e){this.mutations.forEach((t=>{const n=e.get(t.key),r=n;this.applyToLocalView(r),n.isValidDocument()||r.convertToNoDocument(Yr.min())}))}keys(){return this.mutations.reduce(((e,t)=>e.add(t.key)),Lo())}isEqual(e){return this.batchId===e.batchId&&Kr(this.mutations,e.mutations,((e,t)=>oo(e,t)))&&Kr(this.baseMutations,e.baseMutations,((e,t)=>oo(e,t)))}}class hc{constructor(e,t,n,r){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=r}static from(e,t,n){Nr(e.mutations.length===n.length);let r=Oo;const i=e.mutations;for(let e=0;e<i.length;e++)r=r.insert(i[e].key,n[e].version);return new hc(e,t,n,r)}}class dc{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class fc{constructor(e,t,n,r,i=Yr.min(),s=Yr.min(),o=ii.EMPTY_BYTE_STRING){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=s,this.resumeToken=o}withSequenceNumber(e){return new fc(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)}withResumeToken(e,t){return new fc(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e)}withLastLimboFreeSnapshotVersion(e){return new fc(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken)}}class pc{constructor(e){this.Jt=e}}function mc(e,t){const n=t.key,r={prefixPath:n.getCollectionPath().popLast().toArray(),collectionGroup:n.collectionGroup,documentId:n.path.lastSegment(),readTime:gc(t.readTime),hasCommittedMutations:t.hasCommittedMutations};if(t.isFoundDocument())r.document=function(e,t){return{name:na(e,t.key),fields:t.data.value.mapValue.fields,updateTime:Qo(e,t.version.toTimestamp())}}(e.Jt,t);else if(t.isNoDocument())r.noDocument={path:n.path.toArray(),readTime:yc(t.version)};else{if(!t.isUnknownDocument())return Cr();r.unknownDocument={path:n.path.toArray(),version:yc(t.version)}}return r}function gc(e){const t=e.toTimestamp();return[t.seconds,t.nanoseconds]}function yc(e){const t=e.toTimestamp();return{seconds:t.seconds,nanoseconds:t.nanoseconds}}function vc(e){const t=new Wr(e.seconds,e.nanoseconds);return Yr.fromTimestamp(t)}function wc(e,t){const n=(t.baseMutations||[]).map((t=>ha(e.Jt,t)));for(let e=0;e<t.mutations.length-1;++e){const n=t.mutations[e];if(e+1<t.mutations.length&&void 0!==t.mutations[e+1].transform){const r=t.mutations[e+1];n.updateTransforms=r.transform.fieldTransforms,t.mutations.splice(e+1,1),++e}}const r=t.mutations.map((t=>ha(e.Jt,t))),i=Wr.fromMillis(t.localWriteTimeMs);return new lc(t.batchId,i,n,r)}function _c(e){const t=vc(e.readTime),n=void 0!==e.lastLimboFreeSnapshotVersion?vc(e.lastLimboFreeSnapshotVersion):Yr.min();let r;var i;return void 0!==e.query.documents?(Nr(1===(i=e.query).documents.length),r=Cs(bs(sa(i.documents[0])))):r=function(e){return Cs(pa(e))}(e.query),new fc(r,e.targetId,0,e.lastListenSequenceNumber,t,n,ii.fromBase64String(e.resumeToken))}function bc(e,t){const n=yc(t.snapshotVersion),r=yc(t.lastLimboFreeSnapshotVersion);let i;i=ts(t.target)?da(e.Jt,t.target):fa(e.Jt,t.target);const s=t.resumeToken.toBase64();return{targetId:t.targetId,canonicalId:Zi(t.target),readTime:n,resumeToken:s,lastListenSequenceNumber:t.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:i}}function Ic(e){const t=pa({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?Ns(t,t.limit,"L"):t}function Tc(e,t){return new dc(t.largestBatchId,ha(e.Jt,t.overlayMutation))}function Ec(e,t){const n=t.path.lastSegment();return[e,Ea(t.path.popLast()),n]}class Sc{getBundleMetadata(e,t){return kc(e).get(t).next((e=>{if(e)return{id:(t=e).bundleId,createTime:vc(t.createTime),version:t.version};var t}))}saveBundleMetadata(e,t){return kc(e).put({bundleId:(n=t).id,createTime:yc(Zo(n.createTime)),version:n.version});var n}getNamedQuery(e,t){return Ac(e).get(t).next((e=>{if(e)return{name:(t=e).name,query:Ic(t.bundledQuery),readTime:vc(t.readTime)};var t}))}saveNamedQuery(e,t){return Ac(e).put(function(e){return{name:e.name,readTime:yc(Zo(e.readTime)),bundledQuery:e.bundledQuery}}(t))}}function kc(e){return uc(e,"bundles")}function Ac(e){return uc(e,"namedQueries")}class Cc{constructor(e,t){this.M=e,this.userId=t}static Yt(e,t){const n=t.uid||"";return new Cc(e,n)}getOverlay(e,t){return Nc(e).get(Ec(this.userId,t)).next((e=>e?Tc(this.M,e):null))}saveOverlays(e,t,n){const r=[];return n.forEach(((n,i)=>{const s=new dc(t,i);r.push(this.Xt(e,s))})),Ja.waitFor(r)}removeOverlaysForBatchId(e,t,n){const r=new Set;t.forEach((e=>r.add(Ea(e.getCollectionPath()))));const i=[];return r.forEach((t=>{const r=IDBKeyRange.bound([this.userId,t,n],[this.userId,t,n+1],!1,!0);i.push(Nc(e).Qt("collectionPathOverlayIndex",r))})),Ja.waitFor(i)}getOverlaysForCollection(e,t,n){const r=xo(),i=Ea(t),s=IDBKeyRange.bound([this.userId,i,n],[this.userId,i,Number.POSITIVE_INFINITY],!0);return Nc(e).qt("collectionPathOverlayIndex",s).next((e=>{for(const t of e){const e=Tc(this.M,t);r.set(e.getKey(),e)}return r}))}getOverlaysForCollectionGroup(e,t,n,r){const i=xo();let s;const o=IDBKeyRange.bound([this.userId,t,n],[this.userId,t,Number.POSITIVE_INFINITY],!0);return Nc(e).Wt({index:"collectionGroupOverlayIndex",range:o},((e,t,n)=>{const o=Tc(this.M,t);i.size()<r||o.largestBatchId===s?(i.set(o.getKey(),o),s=o.largestBatchId):n.done()})).next((()=>i))}Xt(e,t){return Nc(e).put(function(e,t,n){const[r,i,s]=Ec(t,n.mutation.key);return{userId:t,collectionPath:i,documentId:s,collectionGroup:n.mutation.key.getCollectionGroup(),largestBatchId:n.largestBatchId,overlayMutation:la(e.Jt,n.mutation)}}(this.M,this.userId,t))}}function Nc(e){return uc(e,"documentOverlays")}class Rc{constructor(){}Zt(e,t){this.te(e,t),t.ee()}te(e,t){if("nullValue"in e)this.ne(t,5);else if("booleanValue"in e)this.ne(t,10),t.se(e.booleanValue?1:0);else if("integerValue"in e)this.ne(t,15),t.se(ai(e.integerValue));else if("doubleValue"in e){const n=ai(e.doubleValue);isNaN(n)?this.ne(t,13):(this.ne(t,15),mi(n)?t.se(0):t.se(n))}else if("timestampValue"in e){const n=e.timestampValue;this.ne(t,20),"string"==typeof n?t.ie(n):(t.ie(`${n.seconds||""}`),t.se(n.nanos||0))}else if("stringValue"in e)this.re(e.stringValue,t),this.oe(t);else if("bytesValue"in e)this.ne(t,30),t.ue(ci(e.bytesValue)),this.oe(t);else if("referenceValue"in e)this.ae(e.referenceValue,t);else if("geoPointValue"in e){const n=e.geoPointValue;this.ne(t,45),t.se(n.latitude||0),t.se(n.longitude||0)}else"mapValue"in e?Pi(e)?this.ne(t,Number.MAX_SAFE_INTEGER):(this.ce(e.mapValue,t),this.oe(t)):"arrayValue"in e?(this.he(e.arrayValue,t),this.oe(t)):Cr()}re(e,t){this.ne(t,25),this.le(e,t)}le(e,t){t.ie(e)}ce(e,t){const n=e.fields||{};this.ne(t,55);for(const e of Object.keys(n))this.re(e,t),this.te(n[e],t)}he(e,t){const n=e.values||[];this.ne(t,50);for(const e of n)this.te(e,t)}ae(e,t){this.ne(t,37),yi.fromName(e).path.forEach((e=>{this.ne(t,60),this.le(e,t)}))}ne(e,t){e.se(t)}oe(e){e.se(2)}}function Dc(e){if(0===e)return 8;let t=0;return e>>4==0&&(t+=4,e<<=4),e>>6==0&&(t+=2,e<<=2),e>>7==0&&(t+=1),t}function xc(e){const t=64-function(e){let t=0;for(let n=0;n<8;++n){const r=Dc(255&e[n]);if(t+=r,8!==r)break}return t}(e);return Math.ceil(t/8)}Rc.fe=new Rc;class Oc{constructor(){this.buffer=new Uint8Array(1024),this.position=0}de(e){const t=e[Symbol.iterator]();let n=t.next();for(;!n.done;)this._e(n.value),n=t.next();this.we()}me(e){const t=e[Symbol.iterator]();let n=t.next();for(;!n.done;)this.ge(n.value),n=t.next();this.ye()}pe(e){for(const t of e){const e=t.charCodeAt(0);if(e<128)this._e(e);else if(e<2048)this._e(960|e>>>6),this._e(128|63&e);else if(t<"\ud800"||"\udbff"<t)this._e(480|e>>>12),this._e(128|63&e>>>6),this._e(128|63&e);else{const e=t.codePointAt(0);this._e(240|e>>>18),this._e(128|63&e>>>12),this._e(128|63&e>>>6),this._e(128|63&e)}}this.we()}Ie(e){for(const t of e){const e=t.charCodeAt(0);if(e<128)this.ge(e);else if(e<2048)this.ge(960|e>>>6),this.ge(128|63&e);else if(t<"\ud800"||"\udbff"<t)this.ge(480|e>>>12),this.ge(128|63&e>>>6),this.ge(128|63&e);else{const e=t.codePointAt(0);this.ge(240|e>>>18),this.ge(128|63&e>>>12),this.ge(128|63&e>>>6),this.ge(128|63&e)}}this.ye()}Te(e){const t=this.Ee(e),n=xc(t);this.Ae(1+n),this.buffer[this.position++]=255&n;for(let e=t.length-n;e<t.length;++e)this.buffer[this.position++]=255&t[e]}Re(e){const t=this.Ee(e),n=xc(t);this.Ae(1+n),this.buffer[this.position++]=~(255&n);for(let e=t.length-n;e<t.length;++e)this.buffer[this.position++]=~(255&t[e])}Pe(){this.be(255),this.be(255)}Ve(){this.ve(255),this.ve(255)}reset(){this.position=0}seed(e){this.Ae(e.length),this.buffer.set(e,this.position),this.position+=e.length}Se(){return this.buffer.slice(0,this.position)}Ee(e){const t=function(e){const t=new DataView(new ArrayBuffer(8));return t.setFloat64(0,e,!1),new Uint8Array(t.buffer)}(e),n=0!=(128&t[0]);t[0]^=n?255:128;for(let e=1;e<t.length;++e)t[e]^=n?255:0;return t}_e(e){const t=255&e;0===t?(this.be(0),this.be(255)):255===t?(this.be(255),this.be(0)):this.be(t)}ge(e){const t=255&e;0===t?(this.ve(0),this.ve(255)):255===t?(this.ve(255),this.ve(0)):this.ve(e)}we(){this.be(0),this.be(1)}ye(){this.ve(0),this.ve(1)}be(e){this.Ae(1),this.buffer[this.position++]=e}ve(e){this.Ae(1),this.buffer[this.position++]=~e}Ae(e){const t=e+this.position;if(t<=this.buffer.length)return;let n=2*this.buffer.length;n<t&&(n=t);const r=new Uint8Array(n);r.set(this.buffer),this.buffer=r}}class Pc{constructor(e){this.De=e}ue(e){this.De.de(e)}ie(e){this.De.pe(e)}se(e){this.De.Te(e)}ee(){this.De.Pe()}}class Lc{constructor(e){this.De=e}ue(e){this.De.me(e)}ie(e){this.De.Ie(e)}se(e){this.De.Re(e)}ee(){this.De.Ve()}}class Mc{constructor(){this.De=new Oc,this.Ce=new Pc(this.De),this.xe=new Lc(this.De)}seed(e){this.De.seed(e)}Ne(e){return 0===e?this.Ce:this.xe}Se(){return this.De.Se()}reset(){this.De.reset()}}class Uc{constructor(e,t,n,r){this.indexId=e,this.documentKey=t,this.arrayValue=n,this.directionalValue=r}ke(){const e=this.directionalValue.length,t=0===e||255===this.directionalValue[e-1]?e+1:e,n=new Uint8Array(t);return n.set(this.directionalValue,0),t!==e?n.set([0],this.directionalValue.length):++n[n.length-1],new Uc(this.indexId,this.documentKey,this.arrayValue,n)}}function Fc(e,t){let n=e.indexId-t.indexId;return 0!==n?n:(n=Vc(e.arrayValue,t.arrayValue),0!==n?n:(n=Vc(e.directionalValue,t.directionalValue),0!==n?n:yi.comparator(e.documentKey,t.documentKey)))}function Vc(e,t){for(let n=0;n<e.length&&n<t.length;++n){const r=e[n]-t[n];if(0!==r)return r}return e.length-t.length}class qc{constructor(e){this.collectionId=null!=e.collectionGroup?e.collectionGroup:e.path.lastSegment(),this.Me=e.orderBy,this.Oe=[];for(const t of e.filters){const e=t;e.S()?this.Fe=e:this.Oe.push(e)}}$e(e){const t=$i(e);if(void 0!==t&&!this.Be(t))return!1;const n=zi(e);let r=0,i=0;for(;r<n.length&&this.Be(n[r]);++r);if(r===n.length)return!0;if(void 0!==this.Fe){const e=n[r];if(!this.Le(this.Fe,e)||!this.Ue(this.Me[i++],e))return!1;++r}for(;r<n.length;++r){const e=n[r];if(i>=this.Me.length||!this.Ue(this.Me[i++],e))return!1}return!0}Be(e){for(const t of this.Oe)if(this.Le(t,e))return!0;return!1}Le(e,t){if(void 0===e||!e.field.isEqual(t.fieldPath))return!1;const n="array-contains"===e.op||"array-contains-any"===e.op;return 2===t.kind===n}Ue(e,t){return!!e.field.isEqual(t.fieldPath)&&(0===t.kind&&"asc"===e.dir||1===t.kind&&"desc"===e.dir)}}class Bc{constructor(){this.qe=new jc}addToCollectionParentIndex(e,t){return this.qe.add(t),Ja.resolve()}getCollectionParents(e,t){return Ja.resolve(this.qe.getEntries(t))}addFieldIndex(e,t){return Ja.resolve()}deleteFieldIndex(e,t){return Ja.resolve()}getDocumentsMatchingTarget(e,t){return Ja.resolve(null)}getFieldIndex(e,t){return Ja.resolve(null)}getFieldIndexes(e,t){return Ja.resolve([])}getNextCollectionGroupToUpdate(e){return Ja.resolve(null)}updateCollectionGroup(e,t,n){return Ja.resolve()}updateIndexEntries(e,t){return Ja.resolve()}}class jc{constructor(){this.index={}}add(e){const t=e.lastSegment(),n=e.popLast(),r=this.index[t]||new So(ei.comparator),i=!r.has(n);return this.index[t]=r.add(n),i}has(e){const t=e.lastSegment(),n=e.popLast(),r=this.index[t];return r&&r.has(n)}getEntries(e){return(this.index[e]||new So(ei.comparator)).toArray()}}const $c=new Uint8Array(0);class zc{constructor(e,t){this.user=e,this.databaseId=t,this.Ke=new jc,this.Ge=new bo((e=>Zi(e)),((e,t)=>es(e,t))),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.Ke.has(t)){const n=t.lastSegment(),r=t.popLast();e.addOnCommittedListener((()=>{this.Ke.add(t)}));const i={collectionId:n,parent:Ea(r)};return Gc(e).put(i)}return Ja.resolve()}getCollectionParents(e,t){const n=[],r=IDBKeyRange.bound([t,""],[Hr(t),""],!1,!0);return Gc(e).qt(r).next((e=>{for(const r of e){if(r.collectionId!==t)break;n.push(Aa(r.parent))}return n}))}addFieldIndex(e,t){const n=Hc(e),r=function(e){return{indexId:e.indexId,collectionGroup:e.collectionGroup,fields:e.fields.map((e=>[e.fieldPath.canonicalString(),e.kind]))}}(t);return delete r.indexId,n.add(r).next()}deleteFieldIndex(e,t){const n=Hc(e),r=Wc(e),i=Kc(e);return n.delete(t.indexId).next((()=>r.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))).next((()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))))}getDocumentsMatchingTarget(e,t){const n=Kc(e);let r=!0;const i=new Map;return Ja.forEach(this.Qe(t),(t=>this.getFieldIndex(e,t).next((e=>{r&&(r=!!e),i.set(t,e)})))).next((()=>{if(r){let e=Lo();const r=[];return Ja.forEach(i,((i,s)=>{var o;Er("IndexedDbIndexManager",`Using index ${o=i,`id=${o.indexId}|cg=${o.collectionGroup}|f=${o.fields.map((e=>`${e.fieldPath}:${e.kind}`)).join(",")}`} to execute ${Zi(t)}`);const a=function(e,t){const n=$i(t);if(void 0===n)return null;for(const t of ns(e,n.fieldPath))switch(t.op){case"array-contains-any":return t.value.arrayValue.values||[];case"array-contains":return[t.value]}return null}(s,i),c=function(e,t){const n=new Map;for(const r of zi(t))for(const t of ns(e,r.fieldPath))switch(t.op){case"==":case"in":n.set(r.fieldPath.canonicalString(),t.value);break;case"not-in":case"!=":return n.set(r.fieldPath.canonicalString(),t.value),Array.from(n.values())}return null}(s,i),u=function(e,t){const n=[];let r=!0;for(const i of zi(t)){const t=0===i.kind?rs(e,i.fieldPath,e.startAt):is(e,i.fieldPath,e.startAt);if(!t.value)return null;n.push(t.value),r&&(r=t.inclusive)}return new ps(n,r)}(s,i),l=function(e,t){const n=[];let r=!0;for(const i of zi(t)){const t=0===i.kind?is(e,i.fieldPath,e.endAt):rs(e,i.fieldPath,e.endAt);if(!t.value)return null;n.push(t.value),r&&(r=t.inclusive)}return new ps(n,r)}(s,i),h=this.je(i,s,u),d=this.je(i,s,l),f=this.We(i,s,c),p=this.ze(i.indexId,a,h,!!u&&u.inclusive,d,!!l&&l.inclusive,f);return Ja.forEach(p,(i=>n.Gt(i,t.limit).next((t=>{t.forEach((t=>{const n=yi.fromSegments(t.documentKey);e.has(n)||(e=e.add(n),r.push(n))}))}))))})).next((()=>r))}return Ja.resolve(null)}))}Qe(e){let t=this.Ge.get(e);return t||(t=[e],this.Ge.set(e,t),t)}ze(e,t,n,r,i,s,o){const a=(null!=t?t.length:1)*Math.max(null!=n?n.length:1,null!=i?i.length:1),c=a/(null!=t?t.length:1),u=[];for(let l=0;l<a;++l){const a=t?this.He(t[l/c]):$c,h=n?this.Je(e,a,n[l%c],r):this.Ye(e),d=i?this.Xe(e,a,i[l%c],s):this.Ye(e+1);u.push(...this.createRange(h,d,o.map((t=>this.Je(e,a,t,!0)))))}return u}Je(e,t,n,r){const i=new Uc(e,yi.empty(),t,n);return r?i:i.ke()}Xe(e,t,n,r){const i=new Uc(e,yi.empty(),t,n);return r?i.ke():i}Ye(e){return new Uc(e,yi.empty(),$c,$c)}getFieldIndex(e,t){const n=new qc(t),r=null!=t.collectionGroup?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,r).next((e=>{const t=e.filter((e=>n.$e(e)));return t.sort(((e,t)=>t.fields.length-e.fields.length)),t.length>0?t[0]:null}))}Ze(e,t){const n=new Mc;for(const r of zi(e)){const e=t.data.field(r.fieldPath);if(null==e)return null;const i=n.Ne(r.kind);Rc.fe.Zt(e,i)}return n.Se()}He(e){const t=new Mc;return Rc.fe.Zt(e,t.Ne(0)),t.Se()}tn(e,t){const n=new Mc;return Rc.fe.Zt(Ai(this.databaseId,t),n.Ne(function(e){const t=zi(e);return 0===t.length?0:t[t.length-1].kind}(e))),n.Se()}We(e,t,n){if(null===n)return[];let r=[];r.push(new Mc);let i=0;for(const s of zi(e)){const e=n[i++];for(const n of r)if(this.en(t,s.fieldPath)&&Ni(e))r=this.nn(r,s,e);else{const t=n.Ne(s.kind);Rc.fe.Zt(e,t)}}return this.sn(r)}je(e,t,n){return null==n?null:this.We(e,t,n.position)}sn(e){const t=[];for(let n=0;n<e.length;++n)t[n]=e[n].Se();return t}nn(e,t,n){const r=[...e],i=[];for(const e of n.arrayValue.values||[])for(const n of r){const r=new Mc;r.seed(n.Se()),Rc.fe.Zt(e,r.Ne(t.kind)),i.push(r)}return i}en(e,t){return!!e.filters.find((e=>e instanceof ss&&e.field.isEqual(t)&&("in"===e.op||"not-in"===e.op)))}getFieldIndexes(e,t){const n=Hc(e),r=Wc(e);return(t?n.qt("collectionGroupIndex",IDBKeyRange.bound(t,t)):n.qt()).next((e=>{const t=[];return Ja.forEach(e,(e=>r.get([e.indexId,this.uid]).next((n=>{t.push(function(e,t){const n=t?new Ki(t.sequenceNumber,new Yi(vc(t.readTime),new yi(Aa(t.documentKey)),t.largestBatchId)):Ki.empty(),r=e.fields.map((([e,t])=>new Gi(ni.fromServerFormat(e),t)));return new ji(e.indexId,e.collectionGroup,r,n)}(e,n))})))).next((()=>t))}))}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next((e=>0===e.length?null:(e.sort(((e,t)=>{const n=e.indexState.sequenceNumber-t.indexState.sequenceNumber;return 0!==n?n:Gr(e.collectionGroup,t.collectionGroup)})),e[0].collectionGroup)))}updateCollectionGroup(e,t,n){const r=Hc(e),i=Wc(e);return this.rn(e).next((e=>r.qt("collectionGroupIndex",IDBKeyRange.bound(t,t)).next((t=>Ja.forEach(t,(t=>i.put(function(e,t,n,r){return{indexId:e,uid:t.uid||"",sequenceNumber:n,readTime:yc(r.readTime),documentKey:Ea(r.documentKey.path),largestBatchId:r.largestBatchId}}(t.indexId,this.user,e,n))))))))}updateIndexEntries(e,t){const n=new Map;return Ja.forEach(t,((t,r)=>{const i=n.get(t.collectionGroup);return(i?Ja.resolve(i):this.getFieldIndexes(e,t.collectionGroup)).next((i=>(n.set(t.collectionGroup,i),Ja.forEach(i,(n=>this.on(e,t,n).next((t=>{const i=this.un(r,n);return t.isEqual(i)?Ja.resolve():this.an(e,r,n,t,i)})))))))}))}cn(e,t,n,r){return Kc(e).put({indexId:r.indexId,uid:this.uid,arrayValue:r.arrayValue,directionalValue:r.directionalValue,orderedDocumentKey:this.tn(n,t.key),documentKey:t.key.path.toArray()})}hn(e,t,n,r){return Kc(e).delete([r.indexId,this.uid,r.arrayValue,r.directionalValue,this.tn(n,t.key),t.key.path.toArray()])}on(e,t,n){const r=Kc(e);let i=new So(Fc);return r.Wt({index:"documentKeyIndex",range:IDBKeyRange.only([n.indexId,this.uid,this.tn(n,t)])},((e,r)=>{i=i.add(new Uc(n.indexId,t,r.arrayValue,r.directionalValue))})).next((()=>i))}un(e,t){let n=new So(Fc);const r=this.Ze(t,e);if(null==r)return n;const i=$i(t);if(null!=i){const s=e.data.field(i.fieldPath);if(Ni(s))for(const i of s.arrayValue.values||[])n=n.add(new Uc(t.indexId,e.key,this.He(i),r))}else n=n.add(new Uc(t.indexId,e.key,$c,r));return n}an(e,t,n,r,i){Er("IndexedDbIndexManager","Updating index entries for document '%s'",t.key);const s=[];return function(e,t,n,r,i){const s=e.getIterator(),o=t.getIterator();let a=Ao(s),c=Ao(o);for(;a||c;){let e=!1,t=!1;if(a&&c){const r=n(a,c);r<0?t=!0:r>0&&(e=!0)}else null!=a?t=!0:e=!0;e?(r(c),c=Ao(o)):t?(i(a),a=Ao(s)):(a=Ao(s),c=Ao(o))}}(r,i,Fc,(r=>{s.push(this.cn(e,t,n,r))}),(r=>{s.push(this.hn(e,t,n,r))})),Ja.waitFor(s)}rn(e){let t=1;return Wc(e).Wt({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},((e,n,r)=>{r.done(),t=n.sequenceNumber+1})).next((()=>t))}createRange(e,t,n){n=n.sort(((e,t)=>Fc(e,t))).filter(((e,t,n)=>!t||0!==Fc(e,n[t-1])));const r=[];r.push(e);for(const i of n){const n=Fc(i,e),s=Fc(i,t);if(0===n)r[0]=e.ke();else if(n>0&&s<0)r.push(i),r.push(i.ke());else if(s>0)break}r.push(t);const i=[];for(let e=0;e<r.length;e+=2)i.push(IDBKeyRange.bound([r[e].indexId,this.uid,r[e].arrayValue,r[e].directionalValue,$c,[]],[r[e+1].indexId,this.uid,r[e+1].arrayValue,r[e+1].directionalValue,$c,[]]));return i}}function Gc(e){return uc(e,"collectionParents")}function Kc(e){return uc(e,"indexEntries")}function Hc(e){return uc(e,"indexConfiguration")}function Wc(e){return uc(e,"indexState")}const Yc={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class Qc{constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}static withCacheSize(e){return new Qc(e,Qc.DEFAULT_COLLECTION_PERCENTILE,Qc.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}function Xc(e,t,n){const r=e.store("mutations"),i=e.store("documentMutations"),s=[],o=IDBKeyRange.only(n.batchId);let a=0;const c=r.Wt({range:o},((e,t,n)=>(a++,n.delete())));s.push(c.next((()=>{Nr(1===a)})));const u=[];for(const e of n.mutations){const r=Ra(t,e.key.path,n.batchId);s.push(i.delete(r)),u.push(e.key)}return Ja.waitFor(s).next((()=>u))}function Jc(e){if(!e)return 0;let t;if(e.document)t=e.document;else if(e.unknownDocument)t=e.unknownDocument;else{if(!e.noDocument)throw Cr();t=e.noDocument}return JSON.stringify(t).length}Qc.DEFAULT_COLLECTION_PERCENTILE=10,Qc.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Qc.DEFAULT=new Qc(41943040,Qc.DEFAULT_COLLECTION_PERCENTILE,Qc.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Qc.DISABLED=new Qc(-1,0,0);class Zc{constructor(e,t,n,r){this.userId=e,this.M=t,this.indexManager=n,this.referenceDelegate=r,this.ln={}}static Yt(e,t,n,r){Nr(""!==e.uid);const i=e.isAuthenticated()?e.uid:"";return new Zc(i,t,n,r)}checkEmpty(e){let t=!0;const n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return tu(e).Wt({index:"userMutationsIndex",range:n},((e,n,r)=>{t=!1,r.done()})).next((()=>t))}addMutationBatch(e,t,n,r){const i=nu(e),s=tu(e);return s.add({}).next((o=>{Nr("number"==typeof o);const a=new lc(o,t,n,r),c=function(e,t,n){const r=n.baseMutations.map((t=>la(e.Jt,t))),i=n.mutations.map((t=>la(e.Jt,t)));return{userId:t,batchId:n.batchId,localWriteTimeMs:n.localWriteTime.toMillis(),baseMutations:r,mutations:i}}(this.M,this.userId,a),u=[];let l=new So(((e,t)=>Gr(e.canonicalString(),t.canonicalString())));for(const e of r){const t=Ra(this.userId,e.key.path,o);l=l.add(e.key.path.popLast()),u.push(s.put(c)),u.push(i.put(t,Da))}return l.forEach((t=>{u.push(this.indexManager.addToCollectionParentIndex(e,t))})),e.addOnCommittedListener((()=>{this.ln[o]=a.keys()})),Ja.waitFor(u).next((()=>a))}))}lookupMutationBatch(e,t){return tu(e).get(t).next((e=>e?(Nr(e.userId===this.userId),wc(this.M,e)):null))}fn(e,t){return this.ln[t]?Ja.resolve(this.ln[t]):this.lookupMutationBatch(e,t).next((e=>{if(e){const n=e.keys();return this.ln[t]=n,n}return null}))}getNextMutationBatchAfterBatchId(e,t){const n=t+1,r=IDBKeyRange.lowerBound([this.userId,n]);let i=null;return tu(e).Wt({index:"userMutationsIndex",range:r},((e,t,r)=>{t.userId===this.userId&&(Nr(t.batchId>=n),i=wc(this.M,t)),r.done()})).next((()=>i))}getHighestUnacknowledgedBatchId(e){const t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let n=-1;return tu(e).Wt({index:"userMutationsIndex",range:t,reverse:!0},((e,t,r)=>{n=t.batchId,r.done()})).next((()=>n))}getAllMutationBatches(e){const t=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return tu(e).qt("userMutationsIndex",t).next((e=>e.map((e=>wc(this.M,e)))))}getAllMutationBatchesAffectingDocumentKey(e,t){const n=Na(this.userId,t.path),r=IDBKeyRange.lowerBound(n),i=[];return nu(e).Wt({range:r},((n,r,s)=>{const[o,a,c]=n,u=Aa(a);if(o===this.userId&&t.path.isEqual(u))return tu(e).get(c).next((e=>{if(!e)throw Cr();Nr(e.userId===this.userId),i.push(wc(this.M,e))}));s.done()})).next((()=>i))}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new So(Gr);const r=[];return t.forEach((t=>{const i=Na(this.userId,t.path),s=IDBKeyRange.lowerBound(i),o=nu(e).Wt({range:s},((e,r,i)=>{const[s,o,a]=e,c=Aa(o);s===this.userId&&t.path.isEqual(c)?n=n.add(a):i.done()}));r.push(o)})),Ja.waitFor(r).next((()=>this.dn(e,n)))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,r=n.length+1,i=Na(this.userId,n),s=IDBKeyRange.lowerBound(i);let o=new So(Gr);return nu(e).Wt({range:s},((e,t,i)=>{const[s,a,c]=e,u=Aa(a);s===this.userId&&n.isPrefixOf(u)?u.length===r&&(o=o.add(c)):i.done()})).next((()=>this.dn(e,o)))}dn(e,t){const n=[],r=[];return t.forEach((t=>{r.push(tu(e).get(t).next((e=>{if(null===e)throw Cr();Nr(e.userId===this.userId),n.push(wc(this.M,e))})))})),Ja.waitFor(r).next((()=>n))}removeMutationBatch(e,t){return Xc(e.Ht,this.userId,t).next((n=>(e.addOnCommittedListener((()=>{this._n(t.batchId)})),Ja.forEach(n,(t=>this.referenceDelegate.markPotentiallyOrphaned(e,t))))))}_n(e){delete this.ln[e]}performConsistencyCheck(e){return this.checkEmpty(e).next((t=>{if(!t)return Ja.resolve();const n=IDBKeyRange.lowerBound([this.userId]),r=[];return nu(e).Wt({range:n},((e,t,n)=>{if(e[0]===this.userId){const t=Aa(e[1]);r.push(t)}else n.done()})).next((()=>{Nr(0===r.length)}))}))}containsKey(e,t){return eu(e,this.userId,t)}wn(e){return ru(e).get(this.userId).next((e=>e||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""}))}}function eu(e,t,n){const r=Na(t,n.path),i=r[1],s=IDBKeyRange.lowerBound(r);let o=!1;return nu(e).Wt({range:s,jt:!0},((e,n,r)=>{const[s,a,c]=e;s===t&&a===i&&(o=!0),r.done()})).next((()=>o))}function tu(e){return uc(e,"mutations")}function nu(e){return uc(e,"documentMutations")}function ru(e){return uc(e,"mutationQueues")}class iu{constructor(e){this.mn=e}next(){return this.mn+=2,this.mn}static gn(){return new iu(0)}static yn(){return new iu(-1)}}class su{constructor(e,t){this.referenceDelegate=e,this.M=t}allocateTargetId(e){return this.pn(e).next((t=>{const n=new iu(t.highestTargetId);return t.highestTargetId=n.next(),this.In(e,t).next((()=>t.highestTargetId))}))}getLastRemoteSnapshotVersion(e){return this.pn(e).next((e=>Yr.fromTimestamp(new Wr(e.lastRemoteSnapshotVersion.seconds,e.lastRemoteSnapshotVersion.nanoseconds))))}getHighestSequenceNumber(e){return this.pn(e).next((e=>e.highestListenSequenceNumber))}setTargetsMetadata(e,t,n){return this.pn(e).next((r=>(r.highestListenSequenceNumber=t,n&&(r.lastRemoteSnapshotVersion=n.toTimestamp()),t>r.highestListenSequenceNumber&&(r.highestListenSequenceNumber=t),this.In(e,r))))}addTargetData(e,t){return this.Tn(e,t).next((()=>this.pn(e).next((n=>(n.targetCount+=1,this.En(t,n),this.In(e,n))))))}updateTargetData(e,t){return this.Tn(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next((()=>ou(e).delete(t.targetId))).next((()=>this.pn(e))).next((t=>(Nr(t.targetCount>0),t.targetCount-=1,this.In(e,t))))}removeTargets(e,t,n){let r=0;const i=[];return ou(e).Wt(((s,o)=>{const a=_c(o);a.sequenceNumber<=t&&null===n.get(a.targetId)&&(r++,i.push(this.removeTargetData(e,a)))})).next((()=>Ja.waitFor(i))).next((()=>r))}forEachTarget(e,t){return ou(e).Wt(((e,n)=>{const r=_c(n);t(r)}))}pn(e){return au(e).get("targetGlobalKey").next((e=>(Nr(null!==e),e)))}In(e,t){return au(e).put("targetGlobalKey",t)}Tn(e,t){return ou(e).put(bc(this.M,t))}En(e,t){let n=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,n=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,n=!0),n}getTargetCount(e){return this.pn(e).next((e=>e.targetCount))}getTargetData(e,t){const n=Zi(t),r=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]);let i=null;return ou(e).Wt({range:r,index:"queryTargetsIndex"},((e,n,r)=>{const s=_c(n);es(t,s.target)&&(i=s,r.done())})).next((()=>i))}addMatchingKeys(e,t,n){const r=[],i=cu(e);return t.forEach((t=>{const s=Ea(t.path);r.push(i.put({targetId:n,path:s})),r.push(this.referenceDelegate.addReference(e,n,t))})),Ja.waitFor(r)}removeMatchingKeys(e,t,n){const r=cu(e);return Ja.forEach(t,(t=>{const i=Ea(t.path);return Ja.waitFor([r.delete([n,i]),this.referenceDelegate.removeReference(e,n,t)])}))}removeMatchingKeysForTargetId(e,t){const n=cu(e),r=IDBKeyRange.bound([t],[t+1],!1,!0);return n.delete(r)}getMatchingKeysForTargetId(e,t){const n=IDBKeyRange.bound([t],[t+1],!1,!0),r=cu(e);let i=Lo();return r.Wt({range:n,jt:!0},((e,t,n)=>{const r=Aa(e[1]),s=new yi(r);i=i.add(s)})).next((()=>i))}containsKey(e,t){const n=Ea(t.path),r=IDBKeyRange.bound([n],[Hr(n)],!1,!0);let i=0;return cu(e).Wt({index:"documentTargetsIndex",jt:!0,range:r},(([e,t],n,r)=>{0!==e&&(i++,r.done())})).next((()=>i>0))}Et(e,t){return ou(e).get(t).next((e=>e?_c(e):null))}}function ou(e){return uc(e,"targets")}function au(e){return uc(e,"targetGlobal")}function cu(e){return uc(e,"targetDocuments")}async function uu(e){if(e.code!==Dr.FAILED_PRECONDITION||e.message!==Qa)throw e;Er("LocalStore","Unexpectedly lost primary lease")}function lu([e,t],[n,r]){const i=Gr(e,n);return 0===i?Gr(t,r):i}class hu{constructor(e){this.An=e,this.buffer=new So(lu),this.Rn=0}Pn(){return++this.Rn}bn(e){const t=[e,this.Pn()];if(this.buffer.size<this.An)this.buffer=this.buffer.add(t);else{const e=this.buffer.last();lu(t,e)<0&&(this.buffer=this.buffer.delete(e).add(t))}}get maxValue(){return this.buffer.last()[0]}}class du{constructor(e,t){this.garbageCollector=e,this.asyncQueue=t,this.Vn=!1,this.vn=null}start(e){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.Sn(e)}stop(){this.vn&&(this.vn.cancel(),this.vn=null)}get started(){return null!==this.vn}Sn(e){const t=this.Vn?3e5:6e4;Er("LruGarbageCollector",`Garbage collection scheduled in ${t}ms`),this.vn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",t,(async()=>{this.vn=null,this.Vn=!0;try{await e.collectGarbage(this.garbageCollector)}catch(e){rc(e)?Er("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",e):await uu(e)}await this.Sn(e)}))}}class fu{constructor(e,t){this.Dn=e,this.params=t}calculateTargetCount(e,t){return this.Dn.Cn(e).next((e=>Math.floor(t/100*e)))}nthSequenceNumber(e,t){if(0===t)return Ja.resolve(jr.A);const n=new hu(t);return this.Dn.forEachTarget(e,(e=>n.bn(e.sequenceNumber))).next((()=>this.Dn.xn(e,(e=>n.bn(e))))).next((()=>n.maxValue))}removeTargets(e,t,n){return this.Dn.removeTargets(e,t,n)}removeOrphanedDocuments(e,t){return this.Dn.removeOrphanedDocuments(e,t)}collect(e,t){return-1===this.params.cacheSizeCollectionThreshold?(Er("LruGarbageCollector","Garbage collection skipped; disabled"),Ja.resolve(Yc)):this.getCacheSize(e).next((n=>n<this.params.cacheSizeCollectionThreshold?(Er("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),Yc):this.Nn(e,t)))}getCacheSize(e){return this.Dn.getCacheSize(e)}Nn(e,t){let n,r,i,s,o,c,u;const l=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next((t=>(t>this.params.maximumSequenceNumbersToCollect?(Er("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${t}`),r=this.params.maximumSequenceNumbersToCollect):r=t,s=Date.now(),this.nthSequenceNumber(e,r)))).next((r=>(n=r,o=Date.now(),this.removeTargets(e,n,t)))).next((t=>(i=t,c=Date.now(),this.removeOrphanedDocuments(e,n)))).next((e=>(u=Date.now(),Tr()<=a.in.DEBUG&&Er("LruGarbageCollector",`LRU Garbage Collection\n\tCounted targets in ${s-l}ms\n\tDetermined least recently used ${r} in `+(o-s)+"ms\n"+`\tRemoved ${i} targets in `+(c-o)+"ms\n"+`\tRemoved ${e} documents in `+(u-c)+"ms\n"+`Total Duration: ${u-l}ms`),Ja.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:i,documentsRemoved:e}))))}}class pu{constructor(e,t){this.db=e,this.garbageCollector=function(e,t){return new fu(e,t)}(this,t)}Cn(e){const t=this.kn(e);return this.db.getTargetCache().getTargetCount(e).next((e=>t.next((t=>e+t))))}kn(e){let t=0;return this.xn(e,(e=>{t++})).next((()=>t))}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}xn(e,t){return this.Mn(e,((e,n)=>t(n)))}addReference(e,t,n){return mu(e,n)}removeReference(e,t,n){return mu(e,n)}removeTargets(e,t,n){return this.db.getTargetCache().removeTargets(e,t,n)}markPotentiallyOrphaned(e,t){return mu(e,t)}On(e,t){return function(e,t){let n=!1;return ru(e).zt((r=>eu(e,r,t).next((e=>(e&&(n=!0),Ja.resolve(!e)))))).next((()=>n))}(e,t)}removeOrphanedDocuments(e,t){const n=this.db.getRemoteDocumentCache().newChangeBuffer(),r=[];let i=0;return this.Mn(e,((s,o)=>{if(o<=t){const t=this.On(e,s).next((t=>{if(!t)return i++,n.getEntry(e,s).next((()=>(n.removeEntry(s,Yr.min()),cu(e).delete([0,Ea(s.path)]))))}));r.push(t)}})).next((()=>Ja.waitFor(r))).next((()=>n.apply(e))).next((()=>i))}removeTarget(e,t){const n=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,n)}updateLimboDocument(e,t){return mu(e,t)}Mn(e,t){const n=cu(e);let r,i=jr.A;return n.Wt({index:"documentTargetsIndex"},(([e,n],{path:s,sequenceNumber:o})=>{0===e?(i!==jr.A&&t(new yi(Aa(r)),i),i=o,r=s):i=jr.A})).next((()=>{i!==jr.A&&t(new yi(Aa(r)),i)}))}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function mu(e,t){return cu(e).put(function(e,t){return{targetId:0,path:Ea(e.path),sequenceNumber:t}}(t,e.currentSequenceNumber))}class gu{constructor(){this.changes=new bo((e=>e.toString()),((e,t)=>e.isEqual(t))),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,Bi.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const n=this.changes.get(t);return void 0!==n?Ja.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class yu{constructor(e){this.M=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,n){return _u(e).put(n)}removeEntry(e,t,n){return _u(e).delete(function(e,t){const n=e.path.toArray();return[n.slice(0,n.length-2),n[n.length-2],gc(t),n[n.length-1]]}(t,n))}updateMetadata(e,t){return this.getMetadata(e).next((n=>(n.byteSize+=t,this.Fn(e,n))))}getEntry(e,t){let n=Bi.newInvalidDocument(t);return _u(e).Wt({index:"documentKeyIndex",range:IDBKeyRange.only(bu(t))},((e,r)=>{n=this.$n(t,r)})).next((()=>n))}Bn(e,t){let n={size:0,document:Bi.newInvalidDocument(t)};return _u(e).Wt({index:"documentKeyIndex",range:IDBKeyRange.only(bu(t))},((e,r)=>{n={document:this.$n(t,r),size:Jc(r)}})).next((()=>n))}getEntries(e,t){let n=No();return this.Ln(e,t,((e,t)=>{const r=this.$n(e,t);n=n.insert(e,r)})).next((()=>n))}Un(e,t){let n=No(),r=new Io(yi.comparator);return this.Ln(e,t,((e,t)=>{const i=this.$n(e,t);n=n.insert(e,i),r=r.insert(e,Jc(t))})).next((()=>({documents:n,qn:r})))}Ln(e,t,n){if(t.isEmpty())return Ja.resolve();let r=new So(Tu);t.forEach((e=>r=r.add(e)));const i=IDBKeyRange.bound(bu(r.first()),bu(r.last())),s=r.getIterator();let o=s.getNext();return _u(e).Wt({index:"documentKeyIndex",range:i},((e,t,r)=>{const i=yi.fromSegments([...t.prefixPath,t.collectionGroup,t.documentId]);for(;o&&Tu(o,i)<0;)n(o,null),o=s.getNext();o&&o.isEqual(i)&&(n(o,t),o=s.hasNext()?s.getNext():null),o?r.Ut(bu(o)):r.done()})).next((()=>{for(;o;)n(o,null),o=s.hasNext()?s.getNext():null}))}getAllFromCollection(e,t,n){const r=[t.popLast().toArray(),t.lastSegment(),gc(n.readTime),n.documentKey.path.isEmpty()?"":n.documentKey.path.lastSegment()],i=[t.popLast().toArray(),t.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return _u(e).qt(IDBKeyRange.bound(r,i,!0)).next((e=>{let t=No();for(const n of e){const e=this.$n(yi.fromSegments(n.prefixPath.concat(n.collectionGroup,n.documentId)),n);t=t.insert(e.key,e)}return t}))}getAllFromCollectionGroup(e,t,n,r){let i=No();const s=Iu(t,n),o=Iu(t,Yi.max());return _u(e).Wt({index:"collectionGroupIndex",range:IDBKeyRange.bound(s,o,!0)},((e,t,n)=>{const s=this.$n(yi.fromSegments(t.prefixPath.concat(t.collectionGroup,t.documentId)),t);i=i.insert(s.key,s),i.size===r&&n.done()})).next((()=>i))}newChangeBuffer(e){return new vu(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next((e=>e.byteSize))}getMetadata(e){return wu(e).get("remoteDocumentGlobalKey").next((e=>(Nr(!!e),e)))}Fn(e,t){return wu(e).put("remoteDocumentGlobalKey",t)}$n(e,t){if(t){const e=function(e,t){let n;if(t.document)n=ua(e.Jt,t.document,!!t.hasCommittedMutations);else if(t.noDocument){const e=yi.fromSegments(t.noDocument.path),r=vc(t.noDocument.readTime);n=Bi.newNoDocument(e,r),t.hasCommittedMutations&&n.setHasCommittedMutations()}else{if(!t.unknownDocument)return Cr();{const e=yi.fromSegments(t.unknownDocument.path),r=vc(t.unknownDocument.version);n=Bi.newUnknownDocument(e,r)}}return t.readTime&&n.setReadTime(function(e){const t=new Wr(e[0],e[1]);return Yr.fromTimestamp(t)}(t.readTime)),n}(this.M,t);if(!e.isNoDocument()||!e.version.isEqual(Yr.min()))return e}return Bi.newInvalidDocument(e)}}class vu extends gu{constructor(e,t){super(),this.Kn=e,this.trackRemovals=t,this.Gn=new bo((e=>e.toString()),((e,t)=>e.isEqual(t)))}applyChanges(e){const t=[];let n=0,r=new So(((e,t)=>Gr(e.canonicalString(),t.canonicalString())));return this.changes.forEach(((i,s)=>{const o=this.Gn.get(i);if(t.push(this.Kn.removeEntry(e,i,o.readTime)),s.isValidDocument()){const a=mc(this.Kn.M,s);r=r.add(i.path.popLast());const c=Jc(a);n+=c-o.size,t.push(this.Kn.addEntry(e,i,a))}else if(n-=o.size,this.trackRemovals){const n=mc(this.Kn.M,s.convertToNoDocument(Yr.min()));t.push(this.Kn.addEntry(e,i,n))}})),r.forEach((n=>{t.push(this.Kn.indexManager.addToCollectionParentIndex(e,n))})),t.push(this.Kn.updateMetadata(e,n)),Ja.waitFor(t)}getFromCache(e,t){return this.Kn.Bn(e,t).next((e=>(this.Gn.set(t,{size:e.size,readTime:e.document.readTime}),e.document)))}getAllFromCache(e,t){return this.Kn.Un(e,t).next((({documents:e,qn:t})=>(t.forEach(((t,n)=>{this.Gn.set(t,{size:n,readTime:e.get(t).readTime})})),e)))}}function wu(e){return uc(e,"remoteDocumentGlobal")}function _u(e){return uc(e,"remoteDocumentsV14")}function bu(e){const t=e.path.toArray();return[t.slice(0,t.length-2),t[t.length-2],t[t.length-1]]}function Iu(e,t){const n=t.documentKey.path.toArray();return[e,gc(t.readTime),n.slice(0,n.length-2),n.length>0?n[n.length-1]:""]}function Tu(e,t){const n=e.path.toArray(),r=t.path.toArray();let i=0;for(let e=0;e<n.length-2&&e<r.length-2;++e)if(i=Gr(n[e],r[e]),i)return i;return i=Gr(n.length,r.length),i||(i=Gr(n[n.length-2],r[r.length-2]),i||Gr(n[n.length-1],r[r.length-1]))}class Eu{constructor(e){this.M=e}kt(e,t,n,r){const i=new Za("createOrUpgrade",t);n<1&&r>=1&&(function(e){e.createObjectStore("owner")}(e),function(e){e.createObjectStore("mutationQueues",{keyPath:"userId"}),e.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",Ca,{unique:!0}),e.createObjectStore("documentMutations")}(e),Su(e),function(e){e.createObjectStore("remoteDocuments")}(e));let s=Ja.resolve();return n<3&&r>=3&&(0!==n&&(function(e){e.deleteObjectStore("targetDocuments"),e.deleteObjectStore("targets"),e.deleteObjectStore("targetGlobal")}(e),Su(e)),s=s.next((()=>function(e){const t=e.store("targetGlobal"),n={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:Yr.min().toTimestamp(),targetCount:0};return t.put("targetGlobalKey",n)}(i)))),n<4&&r>=4&&(0!==n&&(s=s.next((()=>function(e,t){return t.store("mutations").qt().next((n=>{e.deleteObjectStore("mutations"),e.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",Ca,{unique:!0});const r=t.store("mutations"),i=n.map((e=>r.put(e)));return Ja.waitFor(i)}))}(e,i)))),s=s.next((()=>{!function(e){e.createObjectStore("clientMetadata",{keyPath:"clientId"})}(e)}))),n<5&&r>=5&&(s=s.next((()=>this.Qn(i)))),n<6&&r>=6&&(s=s.next((()=>(function(e){e.createObjectStore("remoteDocumentGlobal")}(e),this.jn(i))))),n<7&&r>=7&&(s=s.next((()=>this.Wn(i)))),n<8&&r>=8&&(s=s.next((()=>this.zn(e,i)))),n<9&&r>=9&&(s=s.next((()=>{!function(e){e.objectStoreNames.contains("remoteDocumentChanges")&&e.deleteObjectStore("remoteDocumentChanges")}(e)}))),n<10&&r>=10&&(s=s.next((()=>this.Hn(i)))),n<11&&r>=11&&(s=s.next((()=>{!function(e){e.createObjectStore("bundles",{keyPath:"bundleId"})}(e),function(e){e.createObjectStore("namedQueries",{keyPath:"name"})}(e)}))),n<12&&r>=12&&(s=s.next((()=>{!function(e){const t=e.createObjectStore("documentOverlays",{keyPath:$a});t.createIndex("collectionPathOverlayIndex",za,{unique:!1}),t.createIndex("collectionGroupOverlayIndex",Ga,{unique:!1})}(e)}))),n<13&&r>=13&&(s=s.next((()=>function(e){const t=e.createObjectStore("remoteDocumentsV14",{keyPath:xa});t.createIndex("documentKeyIndex",Oa),t.createIndex("collectionGroupIndex",Pa)}(e))).next((()=>this.Jn(e,i))).next((()=>e.deleteObjectStore("remoteDocuments")))),n<14&&r>=14&&(s=s.next((()=>{!function(e){e.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),e.createObjectStore("indexState",{keyPath:Va}).createIndex("sequenceNumberIndex",qa,{unique:!1}),e.createObjectStore("indexEntries",{keyPath:Ba}).createIndex("documentKeyIndex",ja,{unique:!1})}(e)}))),s}jn(e){let t=0;return e.store("remoteDocuments").Wt(((e,n)=>{t+=Jc(n)})).next((()=>{const n={byteSize:t};return e.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",n)}))}Qn(e){const t=e.store("mutationQueues"),n=e.store("mutations");return t.qt().next((t=>Ja.forEach(t,(t=>{const r=IDBKeyRange.bound([t.userId,-1],[t.userId,t.lastAcknowledgedBatchId]);return n.qt("userMutationsIndex",r).next((n=>Ja.forEach(n,(n=>{Nr(n.userId===t.userId);const r=wc(this.M,n);return Xc(e,t.userId,r).next((()=>{}))}))))}))))}Wn(e){const t=e.store("targetDocuments"),n=e.store("remoteDocuments");return e.store("targetGlobal").get("targetGlobalKey").next((e=>{const r=[];return n.Wt(((n,i)=>{const s=new ei(n),o=function(e){return[0,Ea(e)]}(s);r.push(t.get(o).next((n=>n?Ja.resolve():(n=>t.put({targetId:0,path:Ea(n),sequenceNumber:e.highestListenSequenceNumber}))(s))))})).next((()=>Ja.waitFor(r)))}))}zn(e,t){e.createObjectStore("collectionParents",{keyPath:Fa});const n=t.store("collectionParents"),r=new jc,i=e=>{if(r.add(e)){const t=e.lastSegment(),r=e.popLast();return n.put({collectionId:t,parent:Ea(r)})}};return t.store("remoteDocuments").Wt({jt:!0},((e,t)=>{const n=new ei(e);return i(n.popLast())})).next((()=>t.store("documentMutations").Wt({jt:!0},(([e,t,n],r)=>{const s=Aa(t);return i(s.popLast())}))))}Hn(e){const t=e.store("targets");return t.Wt(((e,n)=>{const r=_c(n),i=bc(this.M,r);return t.put(i)}))}Jn(e,t){const n=t.store("remoteDocuments"),r=[];return n.Wt(((e,n)=>{const i=t.store("remoteDocumentsV14"),s=(o=n,o.document?new yi(ei.fromString(o.document.name).popFirst(5)):o.noDocument?yi.fromSegments(o.noDocument.path):o.unknownDocument?yi.fromSegments(o.unknownDocument.path):Cr()).path.toArray();var o;const a={prefixPath:s.slice(0,s.length-2),collectionGroup:s[s.length-2],documentId:s[s.length-1],readTime:n.readTime||[0,0],unknownDocument:n.unknownDocument,noDocument:n.noDocument,document:n.document,hasCommittedMutations:!!n.hasCommittedMutations};r.push(i.put(a))})).next((()=>Ja.waitFor(r)))}}function Su(e){e.createObjectStore("targetDocuments",{keyPath:Ma}).createIndex("documentTargetsIndex",Ua,{unique:!0}),e.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",La,{unique:!0}),e.createObjectStore("targetGlobal")}const ku="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class Au{constructor(e,t,n,r,i,s,o,a,c,u,l=13){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=n,this.Yn=i,this.window=s,this.document=o,this.Xn=c,this.Zn=u,this.ts=l,this.es=null,this.ns=!1,this.isPrimary=!1,this.networkEnabled=!0,this.ss=null,this.inForeground=!1,this.rs=null,this.os=null,this.us=Number.NEGATIVE_INFINITY,this.cs=e=>Promise.resolve(),!Au.vt())throw new xr(Dr.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new pu(this,r),this.hs=t+"main",this.M=new pc(a),this.ls=new ec(this.hs,this.ts,new Eu(this.M)),this.fs=new su(this.referenceDelegate,this.M),this.ds=function(e){return new yu(e)}(this.M),this._s=new Sc,this.window&&this.window.localStorage?this.ws=this.window.localStorage:(this.ws=null,!1===u&&Sr("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.gs().then((()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new xr(Dr.FAILED_PRECONDITION,ku);return this.ys(),this.ps(),this.Is(),this.runTransaction("getHighestListenSequenceNumber","readonly",(e=>this.fs.getHighestSequenceNumber(e)))})).then((e=>{this.es=new jr(e,this.Xn)})).then((()=>{this.ns=!0})).catch((e=>(this.ls&&this.ls.close(),Promise.reject(e))))}Ts(e){return this.cs=async t=>{if(this.started)return e(t)},e(this.isPrimary)}setDatabaseDeletedListener(e){this.ls.Ot((async t=>{null===t.newVersion&&await e()}))}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.Yn.enqueueAndForget((async()=>{this.started&&await this.gs()})))}gs(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",(e=>Nu(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next((()=>{if(this.isPrimary)return this.Es(e).next((e=>{e||(this.isPrimary=!1,this.Yn.enqueueRetryable((()=>this.cs(!1))))}))})).next((()=>this.As(e))).next((t=>this.isPrimary&&!t?this.Rs(e).next((()=>!1)):!!t&&this.Ps(e).next((()=>!0)))))).catch((e=>{if(rc(e))return Er("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return Er("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1})).then((e=>{this.isPrimary!==e&&this.Yn.enqueueRetryable((()=>this.cs(e))),this.isPrimary=e}))}Es(e){return Cu(e).get("owner").next((e=>Ja.resolve(this.bs(e))))}Vs(e){return Nu(e).delete(this.clientId)}async vs(){if(this.isPrimary&&!this.Ss(this.us,18e5)){this.us=Date.now();const e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",(e=>{const t=uc(e,"clientMetadata");return t.qt().next((e=>{const n=this.Ds(e,18e5),r=e.filter((e=>-1===n.indexOf(e)));return Ja.forEach(r,(e=>t.delete(e.clientId))).next((()=>r))}))})).catch((()=>[]));if(this.ws)for(const t of e)this.ws.removeItem(this.Cs(t.clientId))}}Is(){this.os=this.Yn.enqueueAfterDelay("client_metadata_refresh",4e3,(()=>this.gs().then((()=>this.vs())).then((()=>this.Is()))))}bs(e){return!!e&&e.ownerId===this.clientId}As(e){return this.Zn?Ja.resolve(!0):Cu(e).get("owner").next((t=>{if(null!==t&&this.Ss(t.leaseTimestampMs,5e3)&&!this.xs(t.ownerId)){if(this.bs(t)&&this.networkEnabled)return!0;if(!this.bs(t)){if(!t.allowTabSynchronization)throw new xr(Dr.FAILED_PRECONDITION,ku);return!1}}return!(!this.networkEnabled||!this.inForeground)||Nu(e).qt().next((e=>void 0===this.Ds(e,5e3).find((e=>{if(this.clientId!==e.clientId){const t=!this.networkEnabled&&e.networkEnabled,n=!this.inForeground&&e.inForeground,r=this.networkEnabled===e.networkEnabled;if(t||n&&r)return!0}return!1}))))})).next((e=>(this.isPrimary!==e&&Er("IndexedDbPersistence",`Client ${e?"is":"is not"} eligible for a primary lease.`),e)))}async shutdown(){this.ns=!1,this.Ns(),this.os&&(this.os.cancel(),this.os=null),this.ks(),this.Ms(),await this.ls.runTransaction("shutdown","readwrite",["owner","clientMetadata"],(e=>{const t=new cc(e,jr.A);return this.Rs(t).next((()=>this.Vs(t)))})),this.ls.close(),this.Os()}Ds(e,t){return e.filter((e=>this.Ss(e.updateTimeMs,t)&&!this.xs(e.clientId)))}Fs(){return this.runTransaction("getActiveClients","readonly",(e=>Nu(e).qt().next((e=>this.Ds(e,18e5).map((e=>e.clientId))))))}get started(){return this.ns}getMutationQueue(e,t){return Zc.Yt(e,this.M,t,this.referenceDelegate)}getTargetCache(){return this.fs}getRemoteDocumentCache(){return this.ds}getIndexManager(e){return new zc(e,this.M.Jt.databaseId)}getDocumentOverlayCache(e){return Cc.Yt(this.M,e)}getBundleCache(){return this._s}runTransaction(e,t,n){Er("IndexedDbPersistence","Starting transaction:",e);const r="readonly"===t?"readonly":"readwrite",i=14===(s=this.ts)?Ya:13===s?Wa:12===s?Ha:11===s?Ka:void Cr();var s;let o;return this.ls.runTransaction(e,r,i,(r=>(o=new cc(r,this.es?this.es.next():jr.A),"readwrite-primary"===t?this.Es(o).next((e=>!!e||this.As(o))).next((t=>{if(!t)throw Sr(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.Yn.enqueueRetryable((()=>this.cs(!1))),new xr(Dr.FAILED_PRECONDITION,Qa);return n(o)})).next((e=>this.Ps(o).next((()=>e)))):this.$s(o).next((()=>n(o)))))).then((e=>(o.raiseOnCommittedEvent(),e)))}$s(e){return Cu(e).get("owner").next((e=>{if(null!==e&&this.Ss(e.leaseTimestampMs,5e3)&&!this.xs(e.ownerId)&&!this.bs(e)&&!(this.Zn||this.allowTabSynchronization&&e.allowTabSynchronization))throw new xr(Dr.FAILED_PRECONDITION,ku)}))}Ps(e){const t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return Cu(e).put("owner",t)}static vt(){return ec.vt()}Rs(e){const t=Cu(e);return t.get("owner").next((e=>this.bs(e)?(Er("IndexedDbPersistence","Releasing primary lease."),t.delete("owner")):Ja.resolve()))}Ss(e,t){const n=Date.now();return!(e<n-t||e>n&&(Sr(`Detected an update time that is in the future: ${e} > ${n}`),1))}ys(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.rs=()=>{this.Yn.enqueueAndForget((()=>(this.inForeground="visible"===this.document.visibilityState,this.gs())))},this.document.addEventListener("visibilitychange",this.rs),this.inForeground="visible"===this.document.visibilityState)}ks(){this.rs&&(this.document.removeEventListener("visibilitychange",this.rs),this.rs=null)}ps(){var e;"function"==typeof(null===(e=this.window)||void 0===e?void 0:e.addEventListener)&&(this.ss=()=>{this.Ns(),(0,c.G6)()&&navigator.appVersion.match(/Version\/1[45]/)&&this.Yn.enterRestrictedMode(!0),this.Yn.enqueueAndForget((()=>this.shutdown()))},this.window.addEventListener("pagehide",this.ss))}Ms(){this.ss&&(this.window.removeEventListener("pagehide",this.ss),this.ss=null)}xs(e){var t;try{const n=null!==(null===(t=this.ws)||void 0===t?void 0:t.getItem(this.Cs(e)));return Er("IndexedDbPersistence",`Client '${e}' ${n?"is":"is not"} zombied in LocalStorage`),n}catch(e){return Sr("IndexedDbPersistence","Failed to get zombied client id.",e),!1}}Ns(){if(this.ws)try{this.ws.setItem(this.Cs(this.clientId),String(Date.now()))}catch(e){Sr("Failed to set zombie client id.",e)}}Os(){if(this.ws)try{this.ws.removeItem(this.Cs(this.clientId))}catch(e){}}Cs(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function Cu(e){return uc(e,"owner")}function Nu(e){return uc(e,"clientMetadata")}function Ru(e,t){let n=e.projectId;return e.isDefaultDatabase||(n+="."+e.database),"firestore/"+t+"/"+n+"/"}class Du{constructor(e,t,n){this.ds=e,this.Bs=t,this.indexManager=n}Ls(e,t){return this.Bs.getAllMutationBatchesAffectingDocumentKey(e,t).next((n=>this.Us(e,t,n)))}Us(e,t,n){return this.ds.getEntry(e,t).next((e=>{for(const t of n)t.applyToLocalView(e);return e}))}qs(e,t){e.forEach(((e,n)=>{for(const e of t)e.applyToLocalView(n)}))}Ks(e,t){return this.ds.getEntries(e,t).next((t=>this.Gs(e,t).next((()=>t))))}Gs(e,t){return this.Bs.getAllMutationBatchesAffectingDocumentKeys(e,t).next((e=>this.qs(t,e)))}Qs(e,t,n){return function(e){return yi.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}(t)?this.js(e,t.path):ks(t)?this.Ws(e,t,n):this.zs(e,t,n)}js(e,t){return this.Ls(e,new yi(t)).next((e=>{let t=Do();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t}))}Ws(e,t,n){const r=t.collectionGroup;let i=Do();return this.indexManager.getCollectionParents(e,r).next((s=>Ja.forEach(s,(s=>{const o=function(e,t){return new ws(t,null,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(t,s.child(r));return this.zs(e,o,n).next((e=>{e.forEach(((e,t)=>{i=i.insert(e,t)}))}))})).next((()=>i))))}zs(e,t,n){let r;return this.ds.getAllFromCollection(e,t.path,n).next((n=>(r=n,this.Bs.getAllMutationBatchesAffectingQuery(e,t)))).next((e=>{for(const t of e)for(const e of t.mutations){const n=e.key;let i=r.get(n);null==i&&(i=Bi.newInvalidDocument(n),r=r.insert(n,i)),io(e,i,t.localWriteTime),i.isFoundDocument()||(r=r.remove(n))}})).next((()=>(r.forEach(((e,n)=>{Os(t,n)||(r=r.remove(e))})),r)))}}class xu{constructor(e,t,n,r){this.targetId=e,this.fromCache=t,this.Hs=n,this.Js=r}static Ys(e,t){let n=Lo(),r=Lo();for(const e of t.docChanges)switch(e.type){case 0:n=n.add(e.doc.key);break;case 1:r=r.add(e.doc.key)}return new xu(e,t.fromCache,n,r)}}class Ou{Xs(e){this.Zs=e}Qs(e,t,n,r){return function(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}(t)||n.isEqual(Yr.min())?this.ti(e,t):this.Zs.Ks(e,r).next((i=>{const s=this.ei(t,i);return(Is(t)||Ts(t))&&this.ni(t.limitType,s,r,n)?this.ti(e,t):(Tr()<=a.in.DEBUG&&Er("QueryEngine","Re-using previous result from %s to execute query: %s",n.toString(),xs(t)),this.Zs.Qs(e,t,Hi(n,-1)).next((e=>(s.forEach((t=>{e=e.insert(t.key,t)})),e))))}))}ei(e,t){let n=new So(Ls(e));return t.forEach(((t,r)=>{Os(e,r)&&(n=n.add(r))})),n}ni(e,t,n,r){if(n.size!==t.size)return!0;const i="F"===e?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(r)>0)}ti(e,t){return Tr()<=a.in.DEBUG&&Er("QueryEngine","Using full collection scan to execute query:",xs(t)),this.Zs.Qs(e,t,Yi.min())}}class Pu{constructor(e,t,n,r){this.persistence=e,this.si=t,this.M=r,this.ii=new Io(Gr),this.ri=new bo((e=>Zi(e)),es),this.oi=new Map,this.ui=e.getRemoteDocumentCache(),this.fs=e.getTargetCache(),this._s=e.getBundleCache(),this.ai(n)}ai(e){this.indexManager=this.persistence.getIndexManager(e),this.Bs=this.persistence.getMutationQueue(e,this.indexManager),this.ci=new Du(this.ui,this.Bs,this.indexManager),this.ui.setIndexManager(this.indexManager),this.si.Xs(this.ci)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(t=>e.collect(t,this.ii)))}}function Lu(e,t,n,r){return new Pu(e,t,n,r)}async function Mu(e,t){const n=Rr(e);return await n.persistence.runTransaction("Handle user change","readonly",(e=>{let r;return n.Bs.getAllMutationBatches(e).next((i=>(r=i,n.ai(t),n.Bs.getAllMutationBatches(e)))).next((t=>{const i=[],s=[];let o=Lo();for(const e of r){i.push(e.batchId);for(const t of e.mutations)o=o.add(t.key)}for(const e of t){s.push(e.batchId);for(const t of e.mutations)o=o.add(t.key)}return n.ci.Ks(e,o).next((e=>({hi:e,removedBatchIds:i,addedBatchIds:s})))}))}))}function Uu(e){const t=Rr(e);return t.persistence.runTransaction("Get last remote snapshot version","readonly",(e=>t.fs.getLastRemoteSnapshotVersion(e)))}function Fu(e,t,n){let r=Lo();return n.forEach((e=>r=r.add(e))),t.getEntries(e,r).next((e=>{let r=No();return n.forEach(((n,i)=>{const s=e.get(n);i.isNoDocument()&&i.version.isEqual(Yr.min())?(t.removeEntry(n,i.readTime),r=r.insert(n,i)):!s.isValidDocument()||i.version.compareTo(s.version)>0||0===i.version.compareTo(s.version)&&s.hasPendingWrites?(t.addEntry(i),r=r.insert(n,i)):Er("LocalStore","Ignoring outdated watch update for ",n,". Current version:",s.version," Watch version:",i.version)})),r}))}function Vu(e,t){const n=Rr(e);return n.persistence.runTransaction("Get next mutation batch","readonly",(e=>(void 0===t&&(t=-1),n.Bs.getNextMutationBatchAfterBatchId(e,t))))}function qu(e,t){const n=Rr(e);return n.persistence.runTransaction("Allocate target","readwrite",(e=>{let r;return n.fs.getTargetData(e,t).next((i=>i?(r=i,Ja.resolve(r)):n.fs.allocateTargetId(e).next((i=>(r=new fc(t,i,0,e.currentSequenceNumber),n.fs.addTargetData(e,r).next((()=>r)))))))})).then((e=>{const r=n.ii.get(e.targetId);return(null===r||e.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(n.ii=n.ii.insert(e.targetId,e),n.ri.set(t,e.targetId)),e}))}async function Bu(e,t,n){const r=Rr(e),i=r.ii.get(t),s=n?"readwrite":"readwrite-primary";try{n||await r.persistence.runTransaction("Release target",s,(e=>r.persistence.referenceDelegate.removeTarget(e,i)))}catch(e){if(!rc(e))throw e;Er("LocalStore",`Failed to update sequence numbers for target ${t}: ${e}`)}r.ii=r.ii.remove(t),r.ri.delete(i.target)}function ju(e,t,n){const r=Rr(e);let i=Yr.min(),s=Lo();return r.persistence.runTransaction("Execute query","readonly",(e=>function(e,t,n){const r=Rr(e),i=r.ri.get(n);return void 0!==i?Ja.resolve(r.ii.get(i)):r.fs.getTargetData(t,n)}(r,e,Cs(t)).next((t=>{if(t)return i=t.lastLimboFreeSnapshotVersion,r.fs.getMatchingKeysForTargetId(e,t.targetId).next((e=>{s=e}))})).next((()=>r.si.Qs(e,t,n?i:Yr.min(),n?s:Lo()))).next((e=>(Gu(r,Ps(t),e),{documents:e,li:s})))))}function $u(e,t){const n=Rr(e),r=Rr(n.fs),i=n.ii.get(t);return i?Promise.resolve(i.target):n.persistence.runTransaction("Get target data","readonly",(e=>r.Et(e,t).next((e=>e?e.target:null))))}function zu(e,t){const n=Rr(e),r=n.oi.get(t)||Yr.min();return n.persistence.runTransaction("Get new document changes","readonly",(e=>n.ui.getAllFromCollectionGroup(e,t,Hi(r,-1),Number.MAX_SAFE_INTEGER))).then((e=>(Gu(n,t,e),e)))}function Gu(e,t,n){let r=Yr.min();n.forEach(((e,t)=>{t.readTime.compareTo(r)>0&&(r=t.readTime)})),e.oi.set(t,r)}async function Ku(e,t,n=Lo()){const r=await qu(e,Cs(Ic(t.bundledQuery))),i=Rr(e);return i.persistence.runTransaction("Save named query","readwrite",(e=>{const s=Zo(t.readTime);if(r.snapshotVersion.compareTo(s)>=0)return i._s.saveNamedQuery(e,t);const o=r.withResumeToken(ii.EMPTY_BYTE_STRING,s);return i.ii=i.ii.insert(o.targetId,o),i.fs.updateTargetData(e,o).next((()=>i.fs.removeMatchingKeysForTargetId(e,r.targetId))).next((()=>i.fs.addMatchingKeys(e,n,r.targetId))).next((()=>i._s.saveNamedQuery(e,t)))}))}class Hu{constructor(e){this.M=e,this.wi=new Map,this.mi=new Map}getBundleMetadata(e,t){return Ja.resolve(this.wi.get(t))}saveBundleMetadata(e,t){var n;return this.wi.set(t.id,{id:(n=t).id,version:n.version,createTime:Zo(n.createTime)}),Ja.resolve()}getNamedQuery(e,t){return Ja.resolve(this.mi.get(t))}saveNamedQuery(e,t){return this.mi.set(t.name,function(e){return{name:e.name,query:Ic(e.bundledQuery),readTime:Zo(e.readTime)}}(t)),Ja.resolve()}}class Wu{constructor(){this.overlays=new Io(yi.comparator),this.gi=new Map}getOverlay(e,t){return Ja.resolve(this.overlays.get(t))}saveOverlays(e,t,n){return n.forEach(((n,r)=>{this.Xt(e,t,r)})),Ja.resolve()}removeOverlaysForBatchId(e,t,n){const r=this.gi.get(n);return void 0!==r&&(r.forEach((e=>this.overlays=this.overlays.remove(e))),this.gi.delete(n)),Ja.resolve()}getOverlaysForCollection(e,t,n){const r=xo(),i=t.length+1,s=new yi(t.child("")),o=this.overlays.getIteratorFrom(s);for(;o.hasNext();){const e=o.getNext().value,s=e.getKey();if(!t.isPrefixOf(s.path))break;s.path.length===i&&e.largestBatchId>n&&r.set(e.getKey(),e)}return Ja.resolve(r)}getOverlaysForCollectionGroup(e,t,n,r){let i=new Io(((e,t)=>e-t));const s=this.overlays.getIterator();for(;s.hasNext();){const e=s.getNext().value;if(e.getKey().getCollectionGroup()===t&&e.largestBatchId>n){let t=i.get(e.largestBatchId);null===t&&(t=xo(),i=i.insert(e.largestBatchId,t)),t.set(e.getKey(),e)}}const o=xo(),a=i.getIterator();for(;a.hasNext()&&(a.getNext().value.forEach(((e,t)=>o.set(e,t))),!(o.size()>=r)););return Ja.resolve(o)}Xt(e,t,n){if(null===n)return;const r=this.overlays.get(n.key);if(null!==r){const e=this.gi.get(r.largestBatchId).delete(n.key);this.gi.set(r.largestBatchId,e)}this.overlays=this.overlays.insert(n.key,new dc(t,n));let i=this.gi.get(t);void 0===i&&(i=Lo(),this.gi.set(t,i)),this.gi.set(t,i.add(n.key))}}class Yu{constructor(){this.yi=new So(Qu.pi),this.Ii=new So(Qu.Ti)}isEmpty(){return this.yi.isEmpty()}addReference(e,t){const n=new Qu(e,t);this.yi=this.yi.add(n),this.Ii=this.Ii.add(n)}Ei(e,t){e.forEach((e=>this.addReference(e,t)))}removeReference(e,t){this.Ai(new Qu(e,t))}Ri(e,t){e.forEach((e=>this.removeReference(e,t)))}Pi(e){const t=new yi(new ei([])),n=new Qu(t,e),r=new Qu(t,e+1),i=[];return this.Ii.forEachInRange([n,r],(e=>{this.Ai(e),i.push(e.key)})),i}bi(){this.yi.forEach((e=>this.Ai(e)))}Ai(e){this.yi=this.yi.delete(e),this.Ii=this.Ii.delete(e)}Vi(e){const t=new yi(new ei([])),n=new Qu(t,e),r=new Qu(t,e+1);let i=Lo();return this.Ii.forEachInRange([n,r],(e=>{i=i.add(e.key)})),i}containsKey(e){const t=new Qu(e,0),n=this.yi.firstAfterOrEqual(t);return null!==n&&e.isEqual(n.key)}}class Qu{constructor(e,t){this.key=e,this.vi=t}static pi(e,t){return yi.comparator(e.key,t.key)||Gr(e.vi,t.vi)}static Ti(e,t){return Gr(e.vi,t.vi)||yi.comparator(e.key,t.key)}}class Xu{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.Bs=[],this.Si=1,this.Di=new So(Qu.pi)}checkEmpty(e){return Ja.resolve(0===this.Bs.length)}addMutationBatch(e,t,n,r){const i=this.Si;this.Si++,this.Bs.length>0&&this.Bs[this.Bs.length-1];const s=new lc(i,t,n,r);this.Bs.push(s);for(const t of r)this.Di=this.Di.add(new Qu(t.key,i)),this.indexManager.addToCollectionParentIndex(e,t.key.path.popLast());return Ja.resolve(s)}lookupMutationBatch(e,t){return Ja.resolve(this.Ci(t))}getNextMutationBatchAfterBatchId(e,t){const n=t+1,r=this.xi(n),i=r<0?0:r;return Ja.resolve(this.Bs.length>i?this.Bs[i]:null)}getHighestUnacknowledgedBatchId(){return Ja.resolve(0===this.Bs.length?-1:this.Si-1)}getAllMutationBatches(e){return Ja.resolve(this.Bs.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const n=new Qu(t,0),r=new Qu(t,Number.POSITIVE_INFINITY),i=[];return this.Di.forEachInRange([n,r],(e=>{const t=this.Ci(e.vi);i.push(t)})),Ja.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new So(Gr);return t.forEach((e=>{const t=new Qu(e,0),r=new Qu(e,Number.POSITIVE_INFINITY);this.Di.forEachInRange([t,r],(e=>{n=n.add(e.vi)}))})),Ja.resolve(this.Ni(n))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,r=n.length+1;let i=n;yi.isDocumentKey(i)||(i=i.child(""));const s=new Qu(new yi(i),0);let o=new So(Gr);return this.Di.forEachWhile((e=>{const t=e.key.path;return!!n.isPrefixOf(t)&&(t.length===r&&(o=o.add(e.vi)),!0)}),s),Ja.resolve(this.Ni(o))}Ni(e){const t=[];return e.forEach((e=>{const n=this.Ci(e);null!==n&&t.push(n)})),t}removeMutationBatch(e,t){Nr(0===this.ki(t.batchId,"removed")),this.Bs.shift();let n=this.Di;return Ja.forEach(t.mutations,(r=>{const i=new Qu(r.key,t.batchId);return n=n.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,r.key)})).next((()=>{this.Di=n}))}_n(e){}containsKey(e,t){const n=new Qu(t,0),r=this.Di.firstAfterOrEqual(n);return Ja.resolve(t.isEqual(r&&r.key))}performConsistencyCheck(e){return this.Bs.length,Ja.resolve()}ki(e,t){return this.xi(e)}xi(e){return 0===this.Bs.length?0:e-this.Bs[0].batchId}Ci(e){const t=this.xi(e);return t<0||t>=this.Bs.length?null:this.Bs[t]}}class Ju{constructor(e){this.Mi=e,this.docs=new Io(yi.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const n=t.key,r=this.docs.get(n),i=r?r.size:0,s=this.Mi(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:s}),this.size+=s-i,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const n=this.docs.get(t);return Ja.resolve(n?n.document.mutableCopy():Bi.newInvalidDocument(t))}getEntries(e,t){let n=No();return t.forEach((e=>{const t=this.docs.get(e);n=n.insert(e,t?t.document.mutableCopy():Bi.newInvalidDocument(e))})),Ja.resolve(n)}getAllFromCollection(e,t,n){let r=No();const i=new yi(t.child("")),s=this.docs.getIteratorFrom(i);for(;s.hasNext();){const{key:e,value:{document:i}}=s.getNext();if(!t.isPrefixOf(e.path))break;e.path.length>t.length+1||Qi(Wi(i),n)<=0||(r=r.insert(i.key,i.mutableCopy()))}return Ja.resolve(r)}getAllFromCollectionGroup(e,t,n,r){Cr()}Oi(e,t){return Ja.forEach(this.docs,(e=>t(e)))}newChangeBuffer(e){return new Zu(this)}getSize(e){return Ja.resolve(this.size)}}class Zu extends gu{constructor(e){super(),this.Kn=e}applyChanges(e){const t=[];return this.changes.forEach(((n,r)=>{r.isValidDocument()?t.push(this.Kn.addEntry(e,r)):this.Kn.removeEntry(n)})),Ja.waitFor(t)}getFromCache(e,t){return this.Kn.getEntry(e,t)}getAllFromCache(e,t){return this.Kn.getEntries(e,t)}}class el{constructor(e){this.persistence=e,this.Fi=new bo((e=>Zi(e)),es),this.lastRemoteSnapshotVersion=Yr.min(),this.highestTargetId=0,this.$i=0,this.Bi=new Yu,this.targetCount=0,this.Li=iu.gn()}forEachTarget(e,t){return this.Fi.forEach(((e,n)=>t(n))),Ja.resolve()}getLastRemoteSnapshotVersion(e){return Ja.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return Ja.resolve(this.$i)}allocateTargetId(e){return this.highestTargetId=this.Li.next(),Ja.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.$i&&(this.$i=t),Ja.resolve()}Tn(e){this.Fi.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.Li=new iu(t),this.highestTargetId=t),e.sequenceNumber>this.$i&&(this.$i=e.sequenceNumber)}addTargetData(e,t){return this.Tn(t),this.targetCount+=1,Ja.resolve()}updateTargetData(e,t){return this.Tn(t),Ja.resolve()}removeTargetData(e,t){return this.Fi.delete(t.target),this.Bi.Pi(t.targetId),this.targetCount-=1,Ja.resolve()}removeTargets(e,t,n){let r=0;const i=[];return this.Fi.forEach(((s,o)=>{o.sequenceNumber<=t&&null===n.get(o.targetId)&&(this.Fi.delete(s),i.push(this.removeMatchingKeysForTargetId(e,o.targetId)),r++)})),Ja.waitFor(i).next((()=>r))}getTargetCount(e){return Ja.resolve(this.targetCount)}getTargetData(e,t){const n=this.Fi.get(t)||null;return Ja.resolve(n)}addMatchingKeys(e,t,n){return this.Bi.Ei(t,n),Ja.resolve()}removeMatchingKeys(e,t,n){this.Bi.Ri(t,n);const r=this.persistence.referenceDelegate,i=[];return r&&t.forEach((t=>{i.push(r.markPotentiallyOrphaned(e,t))})),Ja.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this.Bi.Pi(t),Ja.resolve()}getMatchingKeysForTargetId(e,t){const n=this.Bi.Vi(t);return Ja.resolve(n)}containsKey(e,t){return Ja.resolve(this.Bi.containsKey(t))}}class tl{constructor(e,t){this.Ui={},this.overlays={},this.es=new jr(0),this.ns=!1,this.ns=!0,this.referenceDelegate=e(this),this.fs=new el(this),this.indexManager=new Bc,this.ds=function(e){return new Ju(e)}((e=>this.referenceDelegate.qi(e))),this.M=new pc(t),this._s=new Hu(this.M)}start(){return Promise.resolve()}shutdown(){return this.ns=!1,Promise.resolve()}get started(){return this.ns}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new Wu,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.Ui[e.toKey()];return n||(n=new Xu(t,this.referenceDelegate),this.Ui[e.toKey()]=n),n}getTargetCache(){return this.fs}getRemoteDocumentCache(){return this.ds}getBundleCache(){return this._s}runTransaction(e,t,n){Er("MemoryPersistence","Starting transaction:",e);const r=new nl(this.es.next());return this.referenceDelegate.Ki(),n(r).next((e=>this.referenceDelegate.Gi(r).next((()=>e)))).toPromise().then((e=>(r.raiseOnCommittedEvent(),e)))}Qi(e,t){return Ja.or(Object.values(this.Ui).map((n=>()=>n.containsKey(e,t))))}}class nl extends Xa{constructor(e){super(),this.currentSequenceNumber=e}}class rl{constructor(e){this.persistence=e,this.ji=new Yu,this.Wi=null}static zi(e){return new rl(e)}get Hi(){if(this.Wi)return this.Wi;throw Cr()}addReference(e,t,n){return this.ji.addReference(n,t),this.Hi.delete(n.toString()),Ja.resolve()}removeReference(e,t,n){return this.ji.removeReference(n,t),this.Hi.add(n.toString()),Ja.resolve()}markPotentiallyOrphaned(e,t){return this.Hi.add(t.toString()),Ja.resolve()}removeTarget(e,t){this.ji.Pi(t.targetId).forEach((e=>this.Hi.add(e.toString())));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next((e=>{e.forEach((e=>this.Hi.add(e.toString())))})).next((()=>n.removeTargetData(e,t)))}Ki(){this.Wi=new Set}Gi(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return Ja.forEach(this.Hi,(n=>{const r=yi.fromPath(n);return this.Ji(e,r).next((e=>{e||t.removeEntry(r,Yr.min())}))})).next((()=>(this.Wi=null,t.apply(e))))}updateLimboDocument(e,t){return this.Ji(e,t).next((e=>{e?this.Hi.delete(t.toString()):this.Hi.add(t.toString())}))}qi(e){return 0}Ji(e,t){return Ja.or([()=>Ja.resolve(this.ji.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Qi(e,t)])}}function il(e,t){return`firestore_clients_${e}_${t}`}function sl(e,t,n){let r=`firestore_mutations_${e}_${n}`;return t.isAuthenticated()&&(r+=`_${t.uid}`),r}function ol(e,t){return`firestore_targets_${e}_${t}`}class al{constructor(e,t,n,r){this.user=e,this.batchId=t,this.state=n,this.error=r}static Yi(e,t,n){const r=JSON.parse(n);let i,s="object"==typeof r&&-1!==["pending","acknowledged","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error);return s&&r.error&&(s="string"==typeof r.error.message&&"string"==typeof r.error.code,s&&(i=new xr(r.error.code,r.error.message))),s?new al(e,t,r.state,i):(Sr("SharedClientState",`Failed to parse mutation state for ID '${t}': ${n}`),null)}Xi(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class cl{constructor(e,t,n){this.targetId=e,this.state=t,this.error=n}static Yi(e,t){const n=JSON.parse(t);let r,i="object"==typeof n&&-1!==["not-current","current","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error);return i&&n.error&&(i="string"==typeof n.error.message&&"string"==typeof n.error.code,i&&(r=new xr(n.error.code,n.error.message))),i?new cl(e,n.state,r):(Sr("SharedClientState",`Failed to parse target state for ID '${e}': ${t}`),null)}Xi(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class ul{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static Yi(e,t){const n=JSON.parse(t);let r="object"==typeof n&&n.activeTargetIds instanceof Array,i=Uo();for(let e=0;r&&e<n.activeTargetIds.length;++e)r=gi(n.activeTargetIds[e]),i=i.add(n.activeTargetIds[e]);return r?new ul(e,i):(Sr("SharedClientState",`Failed to parse client data for instance '${e}': ${t}`),null)}}class ll{constructor(e,t){this.clientId=e,this.onlineState=t}static Yi(e){const t=JSON.parse(e);return"object"==typeof t&&-1!==["Unknown","Online","Offline"].indexOf(t.onlineState)&&"string"==typeof t.clientId?new ll(t.clientId,t.onlineState):(Sr("SharedClientState",`Failed to parse online state: ${e}`),null)}}class hl{constructor(){this.activeTargetIds=Uo()}Zi(e){this.activeTargetIds=this.activeTargetIds.add(e)}tr(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Xi(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class dl{constructor(e,t,n,r,i){this.window=e,this.Yn=t,this.persistenceKey=n,this.er=r,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.nr=this.sr.bind(this),this.ir=new Io(Gr),this.started=!1,this.rr=[];const s=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.ur=il(this.persistenceKey,this.er),this.ar=function(e){return`firestore_sequence_number_${e}`}(this.persistenceKey),this.ir=this.ir.insert(this.er,new hl),this.cr=new RegExp(`^firestore_clients_${s}_([^_]*)$`),this.hr=new RegExp(`^firestore_mutations_${s}_(\\d+)(?:_(.*))?$`),this.lr=new RegExp(`^firestore_targets_${s}_(\\d+)$`),this.dr=function(e){return`firestore_online_state_${e}`}(this.persistenceKey),this._r=function(e){return`firestore_bundle_loaded_v2_${e}`}(this.persistenceKey),this.window.addEventListener("storage",this.nr)}static vt(e){return!(!e||!e.localStorage)}async start(){const e=await this.syncEngine.Fs();for(const t of e){if(t===this.er)continue;const e=this.getItem(il(this.persistenceKey,t));if(e){const n=ul.Yi(t,e);n&&(this.ir=this.ir.insert(n.clientId,n))}}this.wr();const t=this.storage.getItem(this.dr);if(t){const e=this.mr(t);e&&this.gr(e)}for(const e of this.rr)this.sr(e);this.rr=[],this.window.addEventListener("pagehide",(()=>this.shutdown())),this.started=!0}writeSequenceNumber(e){this.setItem(this.ar,JSON.stringify(e))}getAllActiveQueryTargets(){return this.yr(this.ir)}isActiveQueryTarget(e){let t=!1;return this.ir.forEach(((n,r)=>{r.activeTargetIds.has(e)&&(t=!0)})),t}addPendingMutation(e){this.pr(e,"pending")}updateMutationState(e,t,n){this.pr(e,t,n),this.Ir(e)}addLocalQueryTarget(e){let t="not-current";if(this.isActiveQueryTarget(e)){const n=this.storage.getItem(ol(this.persistenceKey,e));if(n){const r=cl.Yi(e,n);r&&(t=r.state)}}return this.Tr.Zi(e),this.wr(),t}removeLocalQueryTarget(e){this.Tr.tr(e),this.wr()}isLocalQueryTarget(e){return this.Tr.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(ol(this.persistenceKey,e))}updateQueryState(e,t,n){this.Er(e,t,n)}handleUserChange(e,t,n){t.forEach((e=>{this.Ir(e)})),this.currentUser=e,n.forEach((e=>{this.addPendingMutation(e)}))}setOnlineState(e){this.Ar(e)}notifyBundleLoaded(e){this.Rr(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.nr),this.removeItem(this.ur),this.started=!1)}getItem(e){const t=this.storage.getItem(e);return Er("SharedClientState","READ",e,t),t}setItem(e,t){Er("SharedClientState","SET",e,t),this.storage.setItem(e,t)}removeItem(e){Er("SharedClientState","REMOVE",e),this.storage.removeItem(e)}sr(e){const t=e;if(t.storageArea===this.storage){if(Er("SharedClientState","EVENT",t.key,t.newValue),t.key===this.ur)return void Sr("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Yn.enqueueRetryable((async()=>{if(this.started){if(null!==t.key)if(this.cr.test(t.key)){if(null==t.newValue){const e=this.Pr(t.key);return this.br(e,null)}{const e=this.Vr(t.key,t.newValue);if(e)return this.br(e.clientId,e)}}else if(this.hr.test(t.key)){if(null!==t.newValue){const e=this.vr(t.key,t.newValue);if(e)return this.Sr(e)}}else if(this.lr.test(t.key)){if(null!==t.newValue){const e=this.Dr(t.key,t.newValue);if(e)return this.Cr(e)}}else if(t.key===this.dr){if(null!==t.newValue){const e=this.mr(t.newValue);if(e)return this.gr(e)}}else if(t.key===this.ar){const e=function(e){let t=jr.A;if(null!=e)try{const n=JSON.parse(e);Nr("number"==typeof n),t=n}catch(e){Sr("SharedClientState","Failed to read sequence number from WebStorage",e)}return t}(t.newValue);e!==jr.A&&this.sequenceNumberHandler(e)}else if(t.key===this._r){const e=this.Nr(t.newValue);await Promise.all(e.map((e=>this.syncEngine.kr(e))))}}else this.rr.push(t)}))}}get Tr(){return this.ir.get(this.er)}wr(){this.setItem(this.ur,this.Tr.Xi())}pr(e,t,n){const r=new al(this.currentUser,e,t,n),i=sl(this.persistenceKey,this.currentUser,e);this.setItem(i,r.Xi())}Ir(e){const t=sl(this.persistenceKey,this.currentUser,e);this.removeItem(t)}Ar(e){const t={clientId:this.er,onlineState:e};this.storage.setItem(this.dr,JSON.stringify(t))}Er(e,t,n){const r=ol(this.persistenceKey,e),i=new cl(e,t,n);this.setItem(r,i.Xi())}Rr(e){const t=JSON.stringify(Array.from(e));this.setItem(this._r,t)}Pr(e){const t=this.cr.exec(e);return t?t[1]:null}Vr(e,t){const n=this.Pr(e);return ul.Yi(n,t)}vr(e,t){const n=this.hr.exec(e),r=Number(n[1]),i=void 0!==n[2]?n[2]:null;return al.Yi(new _r(i),r,t)}Dr(e,t){const n=this.lr.exec(e),r=Number(n[1]);return cl.Yi(r,t)}mr(e){return ll.Yi(e)}Nr(e){return JSON.parse(e)}async Sr(e){if(e.user.uid===this.currentUser.uid)return this.syncEngine.Mr(e.batchId,e.state,e.error);Er("SharedClientState",`Ignoring mutation for non-active user ${e.user.uid}`)}Cr(e){return this.syncEngine.Or(e.targetId,e.state,e.error)}br(e,t){const n=t?this.ir.insert(e,t):this.ir.remove(e),r=this.yr(this.ir),i=this.yr(n),s=[],o=[];return i.forEach((e=>{r.has(e)||s.push(e)})),r.forEach((e=>{i.has(e)||o.push(e)})),this.syncEngine.Fr(s,o).then((()=>{this.ir=n}))}gr(e){this.ir.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}yr(e){let t=Uo();return e.forEach(((e,n)=>{t=t.unionWith(n.activeTargetIds)})),t}}class fl{constructor(){this.$r=new hl,this.Br={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e){return this.$r.Zi(e),this.Br[e]||"not-current"}updateQueryState(e,t,n){this.Br[e]=t}removeLocalQueryTarget(e){this.$r.tr(e)}isLocalQueryTarget(e){return this.$r.activeTargetIds.has(e)}clearQueryState(e){delete this.Br[e]}getAllActiveQueryTargets(){return this.$r.activeTargetIds}isActiveQueryTarget(e){return this.$r.activeTargetIds.has(e)}start(){return this.$r=new hl,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class pl{Lr(e){}shutdown(){}}class ml{constructor(){this.Ur=()=>this.qr(),this.Kr=()=>this.Gr(),this.Qr=[],this.jr()}Lr(e){this.Qr.push(e)}shutdown(){window.removeEventListener("online",this.Ur),window.removeEventListener("offline",this.Kr)}jr(){window.addEventListener("online",this.Ur),window.addEventListener("offline",this.Kr)}qr(){Er("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.Qr)e(0)}Gr(){Er("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.Qr)e(1)}static vt(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}const gl={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"};class yl{constructor(e){this.Wr=e.Wr,this.zr=e.zr}Hr(e){this.Jr=e}Yr(e){this.Xr=e}onMessage(e){this.Zr=e}close(){this.zr()}send(e){this.Wr(e)}eo(){this.Jr()}no(e){this.Xr(e)}so(e){this.Zr(e)}}class vl extends class{constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http";this.io=t+"://"+e.host,this.ro="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}oo(e,t,n,r,i){const s=this.uo(e,t);Er("RestConnection","Sending: ",s,n);const o={};return this.ao(o,r,i),this.co(e,s,o,n).then((e=>(Er("RestConnection","Received: ",e),e)),(t=>{throw kr("RestConnection",`${e} failed with error: `,t,"url: ",s,"request:",n),t}))}ho(e,t,n,r,i){return this.oo(e,t,n,r,i)}ao(e,t,n){e["X-Goog-Api-Client"]="gl-js/ fire/"+br,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach(((t,n)=>e[n]=t)),n&&n.headers.forEach(((t,n)=>e[n]=t))}uo(e,t){const n=gl[e];return`${this.io}/v1/${t}:${n}`}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams}co(e,t,n,r){return new Promise(((i,s)=>{const o=new vr;o.listenOnce(fr.COMPLETE,(()=>{try{switch(o.getLastErrorCode()){case dr.NO_ERROR:const t=o.getResponseJson();Er("Connection","XHR received:",JSON.stringify(t)),i(t);break;case dr.TIMEOUT:Er("Connection",'RPC "'+e+'" timed out'),s(new xr(Dr.DEADLINE_EXCEEDED,"Request time out"));break;case dr.HTTP_ERROR:const n=o.getStatus();if(Er("Connection",'RPC "'+e+'" failed with status:',n,"response text:",o.getResponseText()),n>0){const e=o.getResponseJson().error;if(e&&e.status&&e.message){const t=function(e){const t=e.toLowerCase().replace(/_/g,"-");return Object.values(Dr).indexOf(t)>=0?t:Dr.UNKNOWN}(e.status);s(new xr(t,e.message))}else s(new xr(Dr.UNKNOWN,"Server responded with status "+o.getStatus()))}else s(new xr(Dr.UNAVAILABLE,"Connection failed."));break;default:Cr()}}finally{Er("Connection",'RPC "'+e+'" completed.')}}));const a=JSON.stringify(r);o.send(t,"POST",a,n,15)}))}lo(e,t,n){const r=[this.io,"/","google.firestore.v1.Firestore","/",e,"/channel"],i=lr(),s=hr(),o={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.useFetchStreams&&(o.xmlHttpFactory=new gr({})),this.ao(o.initMessageHeaders,t,n),(0,c.uI)()||(0,c.b$)()||(0,c.d)()||(0,c.w1)()||(0,c.Mn)()||(0,c.ru)()||(o.httpHeadersOverwriteParam="$httpHeaders");const a=r.join("");Er("Connection","Creating WebChannel: "+a,o);const u=i.createWebChannel(a,o);let l=!1,h=!1;const d=new yl({Wr:e=>{h?Er("Connection","Not sending because WebChannel is closed:",e):(l||(Er("Connection","Opening WebChannel transport."),u.open(),l=!0),Er("Connection","WebChannel sending:",e),u.send(e))},zr:()=>u.close()}),f=(e,t,n)=>{e.listen(t,(e=>{try{n(e)}catch(e){setTimeout((()=>{throw e}),0)}}))};return f(u,yr.EventType.OPEN,(()=>{h||Er("Connection","WebChannel transport opened.")})),f(u,yr.EventType.CLOSE,(()=>{h||(h=!0,Er("Connection","WebChannel transport closed"),d.no())})),f(u,yr.EventType.ERROR,(e=>{h||(h=!0,kr("Connection","WebChannel transport errored:",e),d.no(new xr(Dr.UNAVAILABLE,"The operation could not be completed")))})),f(u,yr.EventType.MESSAGE,(e=>{var t;if(!h){const n=e.data[0];Nr(!!n);const r=n,i=r.error||(null===(t=r[0])||void 0===t?void 0:t.error);if(i){Er("Connection","WebChannel received error:",i);const e=i.status;let t=function(e){const t=yo[e];if(void 0!==t)return _o(t)}(e),n=i.message;void 0===t&&(t=Dr.INTERNAL,n="Unknown error status: "+e+" with message "+i.message),h=!0,d.no(new xr(t,n)),u.close()}else Er("Connection","WebChannel received:",n),d.so(n)}})),f(s,pr.STAT_EVENT,(e=>{e.stat===mr.PROXY?Er("Connection","Detected buffering proxy"):e.stat===mr.NOPROXY&&Er("Connection","Detected no buffering proxy")})),setTimeout((()=>{d.eo()}),0),d}}function wl(){return"undefined"!=typeof window?window:null}function _l(){return"undefined"!=typeof document?document:null}function bl(e){return new Yo(e,!0)}class Il{constructor(e,t,n=1e3,r=1.5,i=6e4){this.Yn=e,this.timerId=t,this.fo=n,this._o=r,this.wo=i,this.mo=0,this.yo=null,this.po=Date.now(),this.reset()}reset(){this.mo=0}Io(){this.mo=this.wo}To(e){this.cancel();const t=Math.floor(this.mo+this.Eo()),n=Math.max(0,Date.now()-this.po),r=Math.max(0,t-n);r>0&&Er("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.mo} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.yo=this.Yn.enqueueAfterDelay(this.timerId,r,(()=>(this.po=Date.now(),e()))),this.mo*=this._o,this.mo<this.fo&&(this.mo=this.fo),this.mo>this.wo&&(this.mo=this.wo)}Ao(){null!==this.yo&&(this.yo.skipDelay(),this.yo=null)}cancel(){null!==this.yo&&(this.yo.cancel(),this.yo=null)}Eo(){return(Math.random()-.5)*this.mo}}class Tl{constructor(e,t,n,r,i,s,o,a){this.Yn=e,this.Ro=n,this.Po=r,this.bo=i,this.authCredentialsProvider=s,this.appCheckCredentialsProvider=o,this.listener=a,this.state=0,this.Vo=0,this.vo=null,this.So=null,this.stream=null,this.Do=new Il(e,t)}Co(){return 1===this.state||5===this.state||this.xo()}xo(){return 2===this.state||3===this.state}start(){4!==this.state?this.auth():this.No()}async stop(){this.Co()&&await this.close(0)}ko(){this.state=0,this.Do.reset()}Mo(){this.xo()&&null===this.vo&&(this.vo=this.Yn.enqueueAfterDelay(this.Ro,6e4,(()=>this.Oo())))}Fo(e){this.$o(),this.stream.send(e)}async Oo(){if(this.xo())return this.close(0)}$o(){this.vo&&(this.vo.cancel(),this.vo=null)}Bo(){this.So&&(this.So.cancel(),this.So=null)}async close(e,t){this.$o(),this.Bo(),this.Do.cancel(),this.Vo++,4!==e?this.Do.reset():t&&t.code===Dr.RESOURCE_EXHAUSTED?(Sr(t.toString()),Sr("Using maximum backoff delay to prevent overloading the backend."),this.Do.Io()):t&&t.code===Dr.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.Lo(),this.stream.close(),this.stream=null),this.state=e,await this.listener.Yr(t)}Lo(){}auth(){this.state=1;const e=this.Uo(this.Vo),t=this.Vo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([e,n])=>{this.Vo===t&&this.qo(e,n)}),(t=>{e((()=>{const e=new xr(Dr.UNKNOWN,"Fetching auth token failed: "+t.message);return this.Ko(e)}))}))}qo(e,t){const n=this.Uo(this.Vo);this.stream=this.Go(e,t),this.stream.Hr((()=>{n((()=>(this.state=2,this.So=this.Yn.enqueueAfterDelay(this.Po,1e4,(()=>(this.xo()&&(this.state=3),Promise.resolve()))),this.listener.Hr())))})),this.stream.Yr((e=>{n((()=>this.Ko(e)))})),this.stream.onMessage((e=>{n((()=>this.onMessage(e)))}))}No(){this.state=5,this.Do.To((async()=>{this.state=0,this.start()}))}Ko(e){return Er("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}Uo(e){return t=>{this.Yn.enqueueAndForget((()=>this.Vo===e?t():(Er("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class El extends Tl{constructor(e,t,n,r,i,s){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,r,s),this.M=i}Go(e,t){return this.bo.lo("Listen",e,t)}onMessage(e){this.Do.reset();const t=function(e,t){let n;if("targetChange"in t){t.targetChange;const r=function(e){return"NO_CHANGE"===e?0:"ADD"===e?1:"REMOVE"===e?2:"CURRENT"===e?3:"RESET"===e?4:Cr()}(t.targetChange.targetChangeType||"NO_CHANGE"),i=t.targetChange.targetIds||[],s=function(e,t){return e.N?(Nr(void 0===t||"string"==typeof t),ii.fromBase64String(t||"")):(Nr(void 0===t||t instanceof Uint8Array),ii.fromUint8Array(t||new Uint8Array))}(e,t.targetChange.resumeToken),o=t.targetChange.cause,a=o&&function(e){const t=void 0===e.code?Dr.UNKNOWN:_o(e.code);return new xr(t,e.message||"")}(o);n=new jo(r,i,s,a||null)}else if("documentChange"in t){t.documentChange;const r=t.documentChange;r.document,r.document.name,r.document.updateTime;const i=ra(e,r.document.name),s=Zo(r.document.updateTime),o=new Vi({mapValue:{fields:r.document.fields}}),a=Bi.newFoundDocument(i,s,o),c=r.targetIds||[],u=r.removedTargetIds||[];n=new qo(c,u,a.key,a)}else if("documentDelete"in t){t.documentDelete;const r=t.documentDelete;r.document;const i=ra(e,r.document),s=r.readTime?Zo(r.readTime):Yr.min(),o=Bi.newNoDocument(i,s),a=r.removedTargetIds||[];n=new qo([],a,o.key,o)}else if("documentRemove"in t){t.documentRemove;const r=t.documentRemove;r.document;const i=ra(e,r.document),s=r.removedTargetIds||[];n=new qo([],s,i,null)}else{if(!("filter"in t))return Cr();{t.filter;const e=t.filter;e.targetId;const r=e.count||0,i=new go(r),s=e.targetId;n=new Bo(s,i)}}return n}(this.M,e),n=function(e){if(!("targetChange"in e))return Yr.min();const t=e.targetChange;return t.targetIds&&t.targetIds.length?Yr.min():t.readTime?Zo(t.readTime):Yr.min()}(e);return this.listener.Qo(t,n)}jo(e){const t={};t.database=oa(this.M),t.addTarget=function(e,t){let n;const r=t.target;return n=ts(r)?{documents:da(e,r)}:{query:fa(e,r)},n.targetId=t.targetId,t.resumeToken.approximateByteSize()>0?n.resumeToken=Xo(e,t.resumeToken):t.snapshotVersion.compareTo(Yr.min())>0&&(n.readTime=Qo(e,t.snapshotVersion.toTimestamp())),n}(this.M,e);const n=function(e,t){const n=function(e,t){switch(t){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return Cr()}}(0,t.purpose);return null==n?null:{"goog-listen-tags":n}}(this.M,e);n&&(t.labels=n),this.Fo(t)}Wo(e){const t={};t.database=oa(this.M),t.removeTarget=e,this.Fo(t)}}class Sl extends Tl{constructor(e,t,n,r,i,s){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,r,s),this.M=i,this.zo=!1}get Ho(){return this.zo}start(){this.zo=!1,this.lastStreamToken=void 0,super.start()}Lo(){this.zo&&this.Jo([])}Go(e,t){return this.bo.lo("Write",e,t)}onMessage(e){if(Nr(!!e.streamToken),this.lastStreamToken=e.streamToken,this.zo){this.Do.reset();const t=function(e,t){return e&&e.length>0?(Nr(void 0!==t),e.map((e=>function(e,t){let n=e.updateTime?Zo(e.updateTime):Zo(t);return n.isEqual(Yr.min())&&(n=Zo(t)),new Zs(n,e.transformResults||[])}(e,t)))):[]}(e.writeResults,e.commitTime),n=Zo(e.commitTime);return this.listener.Yo(n,t)}return Nr(!e.writeResults||0===e.writeResults.length),this.zo=!0,this.listener.Xo()}Zo(){const e={};e.database=oa(this.M),this.Fo(e)}Jo(e){const t={streamToken:this.lastStreamToken,writes:e.map((e=>la(this.M,e)))};this.Fo(t)}}class kl extends class{}{constructor(e,t,n,r){super(),this.authCredentials=e,this.appCheckCredentials=t,this.bo=n,this.M=r,this.tu=!1}eu(){if(this.tu)throw new xr(Dr.FAILED_PRECONDITION,"The client has already been terminated.")}oo(e,t,n){return this.eu(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([r,i])=>this.bo.oo(e,t,n,r,i))).catch((e=>{throw"FirebaseError"===e.name?(e.code===Dr.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new xr(Dr.UNKNOWN,e.toString())}))}ho(e,t,n){return this.eu(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([r,i])=>this.bo.ho(e,t,n,r,i))).catch((e=>{throw"FirebaseError"===e.name?(e.code===Dr.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new xr(Dr.UNKNOWN,e.toString())}))}terminate(){this.tu=!0}}class Al{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.nu=0,this.su=null,this.iu=!0}ru(){0===this.nu&&(this.ou("Unknown"),this.su=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this.su=null,this.uu("Backend didn't respond within 10 seconds."),this.ou("Offline"),Promise.resolve()))))}au(e){"Online"===this.state?this.ou("Unknown"):(this.nu++,this.nu>=1&&(this.cu(),this.uu(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ou("Offline")))}set(e){this.cu(),this.nu=0,"Online"===e&&(this.iu=!1),this.ou(e)}ou(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}uu(e){const t=`Could not reach Cloud Firestore backend. ${e}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.iu?(Sr(t),this.iu=!1):Er("OnlineStateTracker",t)}cu(){null!==this.su&&(this.su.cancel(),this.su=null)}}class Cl{constructor(e,t,n,r,i){this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.hu=[],this.lu=new Map,this.fu=new Set,this.du=[],this._u=i,this._u.Lr((e=>{n.enqueueAndForget((async()=>{Ul(this)&&(Er("RemoteStore","Restarting streams for network reachability change."),await async function(e){const t=Rr(e);t.fu.add(4),await Rl(t),t.wu.set("Unknown"),t.fu.delete(4),await Nl(t)}(this))}))})),this.wu=new Al(n,r)}}async function Nl(e){if(Ul(e))for(const t of e.du)await t(!0)}async function Rl(e){for(const t of e.du)await t(!1)}function Dl(e,t){const n=Rr(e);n.lu.has(t.targetId)||(n.lu.set(t.targetId,t),Ml(n)?Ll(n):th(n).xo()&&Ol(n,t))}function xl(e,t){const n=Rr(e),r=th(n);n.lu.delete(t),r.xo()&&Pl(n,t),0===n.lu.size&&(r.xo()?r.Mo():Ul(n)&&n.wu.set("Unknown"))}function Ol(e,t){e.mu.Z(t.targetId),th(e).jo(t)}function Pl(e,t){e.mu.Z(t),th(e).Wo(t)}function Ll(e){e.mu=new zo({getRemoteKeysForTarget:t=>e.remoteSyncer.getRemoteKeysForTarget(t),Et:t=>e.lu.get(t)||null}),th(e).start(),e.wu.ru()}function Ml(e){return Ul(e)&&!th(e).Co()&&e.lu.size>0}function Ul(e){return 0===Rr(e).fu.size}function Fl(e){e.mu=void 0}async function Vl(e){e.lu.forEach(((t,n)=>{Ol(e,t)}))}async function ql(e,t){Fl(e),Ml(e)?(e.wu.au(t),Ll(e)):e.wu.set("Unknown")}async function Bl(e,t,n){if(e.wu.set("Online"),t instanceof jo&&2===t.state&&t.cause)try{await async function(e,t){const n=t.cause;for(const r of t.targetIds)e.lu.has(r)&&(await e.remoteSyncer.rejectListen(r,n),e.lu.delete(r),e.mu.removeTarget(r))}(e,t)}catch(n){Er("RemoteStore","Failed to remove targets %s: %s ",t.targetIds.join(","),n),await jl(e,n)}else if(t instanceof qo?e.mu.ut(t):t instanceof Bo?e.mu._t(t):e.mu.ht(t),!n.isEqual(Yr.min()))try{const t=await Uu(e.localStore);n.compareTo(t)>=0&&await function(e,t){const n=e.mu.yt(t);return n.targetChanges.forEach(((n,r)=>{if(n.resumeToken.approximateByteSize()>0){const i=e.lu.get(r);i&&e.lu.set(r,i.withResumeToken(n.resumeToken,t))}})),n.targetMismatches.forEach((t=>{const n=e.lu.get(t);if(!n)return;e.lu.set(t,n.withResumeToken(ii.EMPTY_BYTE_STRING,n.snapshotVersion)),Pl(e,t);const r=new fc(n.target,t,1,n.sequenceNumber);Ol(e,r)})),e.remoteSyncer.applyRemoteEvent(n)}(e,n)}catch(t){Er("RemoteStore","Failed to raise snapshot:",t),await jl(e,t)}}async function jl(e,t,n){if(!rc(t))throw t;e.fu.add(1),await Rl(e),e.wu.set("Offline"),n||(n=()=>Uu(e.localStore)),e.asyncQueue.enqueueRetryable((async()=>{Er("RemoteStore","Retrying IndexedDB access"),await n(),e.fu.delete(1),await Nl(e)}))}function $l(e,t){return t().catch((n=>jl(e,n,t)))}async function zl(e){const t=Rr(e),n=nh(t);let r=t.hu.length>0?t.hu[t.hu.length-1].batchId:-1;for(;Gl(t);)try{const e=await Vu(t.localStore,r);if(null===e){0===t.hu.length&&n.Mo();break}r=e.batchId,Kl(t,e)}catch(e){await jl(t,e)}Hl(t)&&Wl(t)}function Gl(e){return Ul(e)&&e.hu.length<10}function Kl(e,t){e.hu.push(t);const n=nh(e);n.xo()&&n.Ho&&n.Jo(t.mutations)}function Hl(e){return Ul(e)&&!nh(e).Co()&&e.hu.length>0}function Wl(e){nh(e).start()}async function Yl(e){nh(e).Zo()}async function Ql(e){const t=nh(e);for(const n of e.hu)t.Jo(n.mutations)}async function Xl(e,t,n){const r=e.hu.shift(),i=hc.from(r,t,n);await $l(e,(()=>e.remoteSyncer.applySuccessfulWrite(i))),await zl(e)}async function Jl(e,t){t&&nh(e).Ho&&await async function(e,t){if(wo(n=t.code)&&n!==Dr.ABORTED){const n=e.hu.shift();nh(e).ko(),await $l(e,(()=>e.remoteSyncer.rejectFailedWrite(n.batchId,t))),await zl(e)}var n}(e,t),Hl(e)&&Wl(e)}async function Zl(e,t){const n=Rr(e);n.asyncQueue.verifyOperationInProgress(),Er("RemoteStore","RemoteStore received new credentials");const r=Ul(n);n.fu.add(3),await Rl(n),r&&n.wu.set("Unknown"),await n.remoteSyncer.handleCredentialChange(t),n.fu.delete(3),await Nl(n)}async function eh(e,t){const n=Rr(e);t?(n.fu.delete(2),await Nl(n)):t||(n.fu.add(2),await Rl(n),n.wu.set("Unknown"))}function th(e){return e.gu||(e.gu=function(e,t,n){const r=Rr(e);return r.eu(),new El(t,r.bo,r.authCredentials,r.appCheckCredentials,r.M,n)}(e.datastore,e.asyncQueue,{Hr:Vl.bind(null,e),Yr:ql.bind(null,e),Qo:Bl.bind(null,e)}),e.du.push((async t=>{t?(e.gu.ko(),Ml(e)?Ll(e):e.wu.set("Unknown")):(await e.gu.stop(),Fl(e))}))),e.gu}function nh(e){return e.yu||(e.yu=function(e,t,n){const r=Rr(e);return r.eu(),new Sl(t,r.bo,r.authCredentials,r.appCheckCredentials,r.M,n)}(e.datastore,e.asyncQueue,{Hr:Yl.bind(null,e),Yr:Jl.bind(null,e),Xo:Ql.bind(null,e),Yo:Xl.bind(null,e)}),e.du.push((async t=>{t?(e.yu.ko(),await zl(e)):(await e.yu.stop(),e.hu.length>0&&(Er("RemoteStore",`Stopping write stream with ${e.hu.length} pending writes`),e.hu=[]))}))),e.yu}class rh{constructor(e,t,n,r,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new Or,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((e=>{}))}static createAndSchedule(e,t,n,r,i){const s=Date.now()+n,o=new rh(e,t,s,r,i);return o.start(n),o}start(e){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new xr(Dr.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then((e=>this.deferred.resolve(e)))):Promise.resolve()))}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function ih(e,t){if(Sr("AsyncQueue",`${t}: ${e}`),rc(e))return new xr(Dr.UNAVAILABLE,`${t}: ${e}`);throw e}class sh{constructor(e){this.comparator=e?(t,n)=>e(t,n)||yi.comparator(t.key,n.key):(e,t)=>yi.comparator(e.key,t.key),this.keyedMap=Do(),this.sortedSet=new Io(this.comparator)}static emptySet(e){return new sh(e.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal(((t,n)=>(e(t),!1)))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof sh))return!1;if(this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){const e=t.getNext().key,r=n.getNext().key;if(!e.isEqual(r))return!1}return!0}toString(){const e=[];return this.forEach((t=>{e.push(t.toString())})),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){const n=new sh;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}class oh{constructor(){this.pu=new Io(yi.comparator)}track(e){const t=e.doc.key,n=this.pu.get(t);n?0!==e.type&&3===n.type?this.pu=this.pu.insert(t,e):3===e.type&&1!==n.type?this.pu=this.pu.insert(t,{type:n.type,doc:e.doc}):2===e.type&&2===n.type?this.pu=this.pu.insert(t,{type:2,doc:e.doc}):2===e.type&&0===n.type?this.pu=this.pu.insert(t,{type:0,doc:e.doc}):1===e.type&&0===n.type?this.pu=this.pu.remove(t):1===e.type&&2===n.type?this.pu=this.pu.insert(t,{type:1,doc:n.doc}):0===e.type&&1===n.type?this.pu=this.pu.insert(t,{type:2,doc:e.doc}):Cr():this.pu=this.pu.insert(t,e)}Iu(){const e=[];return this.pu.inorderTraversal(((t,n)=>{e.push(n)})),e}}class ah{constructor(e,t,n,r,i,s,o,a){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=s,this.syncStateChanged=o,this.excludesMetadataChanges=a}static fromInitialDocuments(e,t,n,r){const i=[];return t.forEach((e=>{i.push({type:0,doc:e})})),new ah(e,t,sh.emptySet(t),i,n,r,!0,!1)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Rs(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let e=0;e<t.length;e++)if(t[e].type!==n[e].type||!t[e].doc.isEqual(n[e].doc))return!1;return!0}}class ch{constructor(){this.Tu=void 0,this.listeners=[]}}class uh{constructor(){this.queries=new bo((e=>Ds(e)),Rs),this.onlineState="Unknown",this.Eu=new Set}}async function lh(e,t){const n=Rr(e),r=t.query;let i=!1,s=n.queries.get(r);if(s||(i=!0,s=new ch),i)try{s.Tu=await n.onListen(r)}catch(e){const n=ih(e,`Initialization of query '${xs(t.query)}' failed`);return void t.onError(n)}n.queries.set(r,s),s.listeners.push(t),t.Au(n.onlineState),s.Tu&&t.Ru(s.Tu)&&ph(n)}async function hh(e,t){const n=Rr(e),r=t.query;let i=!1;const s=n.queries.get(r);if(s){const e=s.listeners.indexOf(t);e>=0&&(s.listeners.splice(e,1),i=0===s.listeners.length)}if(i)return n.queries.delete(r),n.onUnlisten(r)}function dh(e,t){const n=Rr(e);let r=!1;for(const e of t){const t=e.query,i=n.queries.get(t);if(i){for(const t of i.listeners)t.Ru(e)&&(r=!0);i.Tu=e}}r&&ph(n)}function fh(e,t,n){const r=Rr(e),i=r.queries.get(t);if(i)for(const e of i.listeners)e.onError(n);r.queries.delete(t)}function ph(e){e.Eu.forEach((e=>{e.next()}))}class mh{constructor(e,t,n){this.query=e,this.Pu=t,this.bu=!1,this.Vu=null,this.onlineState="Unknown",this.options=n||{}}Ru(e){if(!this.options.includeMetadataChanges){const t=[];for(const n of e.docChanges)3!==n.type&&t.push(n);e=new ah(e.query,e.docs,e.oldDocs,t,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0)}let t=!1;return this.bu?this.vu(e)&&(this.Pu.next(e),t=!0):this.Su(e,this.onlineState)&&(this.Du(e),t=!0),this.Vu=e,t}onError(e){this.Pu.error(e)}Au(e){this.onlineState=e;let t=!1;return this.Vu&&!this.bu&&this.Su(this.Vu,e)&&(this.Du(this.Vu),t=!0),t}Su(e,t){if(!e.fromCache)return!0;const n="Offline"!==t;return!(this.options.Cu&&n||e.docs.isEmpty()&&"Offline"!==t)}vu(e){if(e.docChanges.length>0)return!0;const t=this.Vu&&this.Vu.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&!0===this.options.includeMetadataChanges}Du(e){e=ah.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache),this.bu=!0,this.Pu.next(e)}}class gh{constructor(e,t){this.payload=e,this.byteLength=t}xu(){return"metadata"in this.payload}}class yh{constructor(e){this.M=e}fi(e){return ra(this.M,e)}di(e){return e.metadata.exists?ua(this.M,e.document,!1):Bi.newNoDocument(this.fi(e.metadata.name),this._i(e.metadata.readTime))}_i(e){return Zo(e)}}class vh{constructor(e,t,n){this.Nu=e,this.localStore=t,this.M=n,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=wh(e)}ku(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.payload.namedQuery)this.queries.push(e.payload.namedQuery);else if(e.payload.documentMetadata){this.documents.push({metadata:e.payload.documentMetadata}),e.payload.documentMetadata.exists||++t;const n=ei.fromString(e.payload.documentMetadata.name);this.collectionGroups.add(n.get(n.length-2))}else e.payload.document&&(this.documents[this.documents.length-1].document=e.payload.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}Mu(e){const t=new Map,n=new yh(this.M);for(const r of e)if(r.metadata.queries){const e=n.fi(r.metadata.name);for(const n of r.metadata.queries){const r=(t.get(n)||Lo()).add(e);t.set(n,r)}}return t}async complete(){const e=await async function(e,t,n,r){const i=Rr(e);let s=Lo(),o=No();for(const e of n){const n=t.fi(e.metadata.name);e.document&&(s=s.add(n));const r=t.di(e);r.setReadTime(t._i(e.metadata.readTime)),o=o.insert(n,r)}const a=i.ui.newChangeBuffer({trackRemovals:!0}),c=await qu(i,function(e){return Cs(bs(ei.fromString(`__bundle__/docs/${e}`)))}(r));return i.persistence.runTransaction("Apply bundle documents","readwrite",(e=>Fu(e,a,o).next((t=>(a.apply(e),t))).next((t=>i.fs.removeMatchingKeysForTargetId(e,c.targetId).next((()=>i.fs.addMatchingKeys(e,s,c.targetId))).next((()=>i.ci.Gs(e,t))).next((()=>t))))))}(this.localStore,new yh(this.M),this.documents,this.Nu.id),t=this.Mu(this.documents);for(const e of this.queries)await Ku(this.localStore,e,t.get(e.name));return this.progress.taskState="Success",{progress:this.progress,Ou:this.collectionGroups,Fu:e}}}function wh(e){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:e.totalDocuments,totalBytes:e.totalBytes}}class _h{constructor(e){this.key=e}}class bh{constructor(e){this.key=e}}class Ih{constructor(e,t){this.query=e,this.$u=t,this.Bu=null,this.current=!1,this.Lu=Lo(),this.mutatedKeys=Lo(),this.Uu=Ls(e),this.qu=new sh(this.Uu)}get Ku(){return this.$u}Gu(e,t){const n=t?t.Qu:new oh,r=t?t.qu:this.qu;let i=t?t.mutatedKeys:this.mutatedKeys,s=r,o=!1;const a=Is(this.query)&&r.size===this.query.limit?r.last():null,c=Ts(this.query)&&r.size===this.query.limit?r.first():null;if(e.inorderTraversal(((e,t)=>{const u=r.get(e),l=Os(this.query,t)?t:null,h=!!u&&this.mutatedKeys.has(u.key),d=!!l&&(l.hasLocalMutations||this.mutatedKeys.has(l.key)&&l.hasCommittedMutations);let f=!1;u&&l?u.data.isEqual(l.data)?h!==d&&(n.track({type:3,doc:l}),f=!0):this.ju(u,l)||(n.track({type:2,doc:l}),f=!0,(a&&this.Uu(l,a)>0||c&&this.Uu(l,c)<0)&&(o=!0)):!u&&l?(n.track({type:0,doc:l}),f=!0):u&&!l&&(n.track({type:1,doc:u}),f=!0,(a||c)&&(o=!0)),f&&(l?(s=s.add(l),i=d?i.add(e):i.delete(e)):(s=s.delete(e),i=i.delete(e)))})),Is(this.query)||Ts(this.query))for(;s.size>this.query.limit;){const e=Is(this.query)?s.last():s.first();s=s.delete(e.key),i=i.delete(e.key),n.track({type:1,doc:e})}return{qu:s,Qu:n,ni:o,mutatedKeys:i}}ju(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n){const r=this.qu;this.qu=e.qu,this.mutatedKeys=e.mutatedKeys;const i=e.Qu.Iu();i.sort(((e,t)=>function(e,t){const n=e=>{switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Cr()}};return n(e)-n(t)}(e.type,t.type)||this.Uu(e.doc,t.doc))),this.Wu(n);const s=t?this.zu():[],o=0===this.Lu.size&&this.current?1:0,a=o!==this.Bu;return this.Bu=o,0!==i.length||a?{snapshot:new ah(this.query,e.qu,r,i,e.mutatedKeys,0===o,a,!1),Hu:s}:{Hu:s}}Au(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({qu:this.qu,Qu:new oh,mutatedKeys:this.mutatedKeys,ni:!1},!1)):{Hu:[]}}Ju(e){return!this.$u.has(e)&&!!this.qu.has(e)&&!this.qu.get(e).hasLocalMutations}Wu(e){e&&(e.addedDocuments.forEach((e=>this.$u=this.$u.add(e))),e.modifiedDocuments.forEach((e=>{})),e.removedDocuments.forEach((e=>this.$u=this.$u.delete(e))),this.current=e.current)}zu(){if(!this.current)return[];const e=this.Lu;this.Lu=Lo(),this.qu.forEach((e=>{this.Ju(e.key)&&(this.Lu=this.Lu.add(e.key))}));const t=[];return e.forEach((e=>{this.Lu.has(e)||t.push(new bh(e))})),this.Lu.forEach((n=>{e.has(n)||t.push(new _h(n))})),t}Yu(e){this.$u=e.li,this.Lu=Lo();const t=this.Gu(e.documents);return this.applyChanges(t,!0)}Xu(){return ah.fromInitialDocuments(this.query,this.qu,this.mutatedKeys,0===this.Bu)}}class Th{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class Eh{constructor(e){this.key=e,this.Zu=!1}}class Sh{constructor(e,t,n,r,i,s){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=s,this.ta={},this.ea=new bo((e=>Ds(e)),Rs),this.na=new Map,this.sa=new Set,this.ia=new Io(yi.comparator),this.ra=new Map,this.oa=new Yu,this.ua={},this.aa=new Map,this.ca=iu.yn(),this.onlineState="Unknown",this.ha=void 0}get isPrimaryClient(){return!0===this.ha}}async function kh(e,t){const n=Jh(e);let r,i;const s=n.ea.get(t);if(s)r=s.targetId,n.sharedClientState.addLocalQueryTarget(r),i=s.view.Xu();else{const e=await qu(n.localStore,Cs(t));n.isPrimaryClient&&Dl(n.remoteStore,e);const s=n.sharedClientState.addLocalQueryTarget(e.targetId);r=e.targetId,i=await Ah(n,t,r,"current"===s)}return i}async function Ah(e,t,n,r){e.la=(t,n,r)=>async function(e,t,n,r){let i=t.view.Gu(n);i.ni&&(i=await ju(e.localStore,t.query,!1).then((({documents:e})=>t.view.Gu(e,i))));const s=r&&r.targetChanges.get(t.targetId),o=t.view.applyChanges(i,e.isPrimaryClient,s);return Fh(e,t.targetId,o.Hu),o.snapshot}(e,t,n,r);const i=await ju(e.localStore,t,!0),s=new Ih(t,i.li),o=s.Gu(i.documents),a=Vo.createSynthesizedTargetChangeForCurrentChange(n,r&&"Offline"!==e.onlineState),c=s.applyChanges(o,e.isPrimaryClient,a);Fh(e,n,c.Hu);const u=new Th(t,n,s);return e.ea.set(t,u),e.na.has(n)?e.na.get(n).push(t):e.na.set(n,[t]),c.snapshot}async function Ch(e,t){const n=Rr(e),r=n.ea.get(t),i=n.na.get(r.targetId);if(i.length>1)return n.na.set(r.targetId,i.filter((e=>!Rs(e,t)))),void n.ea.delete(t);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(r.targetId),n.sharedClientState.isActiveQueryTarget(r.targetId)||await Bu(n.localStore,r.targetId,!1).then((()=>{n.sharedClientState.clearQueryState(r.targetId),xl(n.remoteStore,r.targetId),Mh(n,r.targetId)})).catch(uu)):(Mh(n,r.targetId),await Bu(n.localStore,r.targetId,!0))}async function Nh(e,t){const n=Rr(e);try{const e=await function(e,t){const n=Rr(e),r=t.snapshotVersion;let i=n.ii;return n.persistence.runTransaction("Apply remote event","readwrite-primary",(e=>{const s=n.ui.newChangeBuffer({trackRemovals:!0});i=n.ii;const o=[];t.targetChanges.forEach(((s,a)=>{const c=i.get(a);if(!c)return;o.push(n.fs.removeMatchingKeys(e,s.removedDocuments,a).next((()=>n.fs.addMatchingKeys(e,s.addedDocuments,a))));let u=c.withSequenceNumber(e.currentSequenceNumber);t.targetMismatches.has(a)?u=u.withResumeToken(ii.EMPTY_BYTE_STRING,Yr.min()).withLastLimboFreeSnapshotVersion(Yr.min()):s.resumeToken.approximateByteSize()>0&&(u=u.withResumeToken(s.resumeToken,r)),i=i.insert(a,u),function(e,t,n){return 0===e.resumeToken.approximateByteSize()||t.snapshotVersion.toMicroseconds()-e.snapshotVersion.toMicroseconds()>=3e8||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0}(c,u,s)&&o.push(n.fs.updateTargetData(e,u))}));let a=No();if(t.documentUpdates.forEach((r=>{t.resolvedLimboDocuments.has(r)&&o.push(n.persistence.referenceDelegate.updateLimboDocument(e,r))})),o.push(Fu(e,s,t.documentUpdates).next((e=>{a=e}))),!r.isEqual(Yr.min())){const t=n.fs.getLastRemoteSnapshotVersion(e).next((t=>n.fs.setTargetsMetadata(e,e.currentSequenceNumber,r)));o.push(t)}return Ja.waitFor(o).next((()=>s.apply(e))).next((()=>n.ci.Gs(e,a))).next((()=>a))})).then((e=>(n.ii=i,e)))}(n.localStore,t);t.targetChanges.forEach(((e,t)=>{const r=n.ra.get(t);r&&(Nr(e.addedDocuments.size+e.modifiedDocuments.size+e.removedDocuments.size<=1),e.addedDocuments.size>0?r.Zu=!0:e.modifiedDocuments.size>0?Nr(r.Zu):e.removedDocuments.size>0&&(Nr(r.Zu),r.Zu=!1))})),await Bh(n,e,t)}catch(e){await uu(e)}}function Rh(e,t,n){const r=Rr(e);if(r.isPrimaryClient&&0===n||!r.isPrimaryClient&&1===n){const e=[];r.ea.forEach(((n,r)=>{const i=r.view.Au(t);i.snapshot&&e.push(i.snapshot)})),function(e,t){const n=Rr(e);n.onlineState=t;let r=!1;n.queries.forEach(((e,n)=>{for(const e of n.listeners)e.Au(t)&&(r=!0)})),r&&ph(n)}(r.eventManager,t),e.length&&r.ta.Qo(e),r.onlineState=t,r.isPrimaryClient&&r.sharedClientState.setOnlineState(t)}}async function Dh(e,t,n){const r=Rr(e);r.sharedClientState.updateQueryState(t,"rejected",n);const i=r.ra.get(t),s=i&&i.key;if(s){let e=new Io(yi.comparator);e=e.insert(s,Bi.newNoDocument(s,Yr.min()));const n=Lo().add(s),i=new Fo(Yr.min(),new Map,new So(Gr),e,n);await Nh(r,i),r.ia=r.ia.remove(s),r.ra.delete(t),qh(r)}else await Bu(r.localStore,t,!1).then((()=>Mh(r,t,n))).catch(uu)}async function xh(e,t){const n=Rr(e),r=t.batch.batchId;try{const e=await function(e,t){const n=Rr(e);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",(e=>{const r=t.batch.keys(),i=n.ui.newChangeBuffer({trackRemovals:!0});return function(e,t,n,r){const i=n.batch,s=i.keys();let o=Ja.resolve();return s.forEach((e=>{o=o.next((()=>r.getEntry(t,e))).next((t=>{const s=n.docVersions.get(e);Nr(null!==s),t.version.compareTo(s)<0&&(i.applyToRemoteDocument(t,n),t.isValidDocument()&&(t.setReadTime(n.commitVersion),r.addEntry(t)))}))})),o.next((()=>e.Bs.removeMutationBatch(t,i)))}(n,e,t,i).next((()=>i.apply(e))).next((()=>n.Bs.performConsistencyCheck(e))).next((()=>n.ci.Ks(e,r)))}))}(n.localStore,t);Lh(n,r,null),Ph(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),await Bh(n,e)}catch(e){await uu(e)}}async function Oh(e,t,n){const r=Rr(e);try{const e=await function(e,t){const n=Rr(e);return n.persistence.runTransaction("Reject batch","readwrite-primary",(e=>{let r;return n.Bs.lookupMutationBatch(e,t).next((t=>(Nr(null!==t),r=t.keys(),n.Bs.removeMutationBatch(e,t)))).next((()=>n.Bs.performConsistencyCheck(e))).next((()=>n.ci.Ks(e,r)))}))}(r.localStore,t);Lh(r,t,n),Ph(r,t),r.sharedClientState.updateMutationState(t,"rejected",n),await Bh(r,e)}catch(n){await uu(n)}}function Ph(e,t){(e.aa.get(t)||[]).forEach((e=>{e.resolve()})),e.aa.delete(t)}function Lh(e,t,n){const r=Rr(e);let i=r.ua[r.currentUser.toKey()];if(i){const e=i.get(t);e&&(n?e.reject(n):e.resolve(),i=i.remove(t)),r.ua[r.currentUser.toKey()]=i}}function Mh(e,t,n=null){e.sharedClientState.removeLocalQueryTarget(t);for(const r of e.na.get(t))e.ea.delete(r),n&&e.ta.fa(r,n);e.na.delete(t),e.isPrimaryClient&&e.oa.Pi(t).forEach((t=>{e.oa.containsKey(t)||Uh(e,t)}))}function Uh(e,t){e.sa.delete(t.path.canonicalString());const n=e.ia.get(t);null!==n&&(xl(e.remoteStore,n),e.ia=e.ia.remove(t),e.ra.delete(n),qh(e))}function Fh(e,t,n){for(const r of n)r instanceof _h?(e.oa.addReference(r.key,t),Vh(e,r)):r instanceof bh?(Er("SyncEngine","Document no longer in limbo: "+r.key),e.oa.removeReference(r.key,t),e.oa.containsKey(r.key)||Uh(e,r.key)):Cr()}function Vh(e,t){const n=t.key,r=n.path.canonicalString();e.ia.get(n)||e.sa.has(r)||(Er("SyncEngine","New document in limbo: "+n),e.sa.add(r),qh(e))}function qh(e){for(;e.sa.size>0&&e.ia.size<e.maxConcurrentLimboResolutions;){const t=e.sa.values().next().value;e.sa.delete(t);const n=new yi(ei.fromString(t)),r=e.ca.next();e.ra.set(r,new Eh(n)),e.ia=e.ia.insert(n,r),Dl(e.remoteStore,new fc(Cs(bs(n.path)),r,2,jr.A))}}async function Bh(e,t,n){const r=Rr(e),i=[],s=[],o=[];r.ea.isEmpty()||(r.ea.forEach(((e,a)=>{o.push(r.la(a,t,n).then((e=>{if(e){r.isPrimaryClient&&r.sharedClientState.updateQueryState(a.targetId,e.fromCache?"not-current":"current"),i.push(e);const t=xu.Ys(a.targetId,e);s.push(t)}})))})),await Promise.all(o),r.ta.Qo(i),await async function(e,t){const n=Rr(e);try{await n.persistence.runTransaction("notifyLocalViewChanges","readwrite",(e=>Ja.forEach(t,(t=>Ja.forEach(t.Hs,(r=>n.persistence.referenceDelegate.addReference(e,t.targetId,r))).next((()=>Ja.forEach(t.Js,(r=>n.persistence.referenceDelegate.removeReference(e,t.targetId,r)))))))))}catch(e){if(!rc(e))throw e;Er("LocalStore","Failed to update sequence numbers: "+e)}for(const e of t){const t=e.targetId;if(!e.fromCache){const e=n.ii.get(t),r=e.snapshotVersion,i=e.withLastLimboFreeSnapshotVersion(r);n.ii=n.ii.insert(t,i)}}}(r.localStore,s))}async function jh(e,t){const n=Rr(e);if(!n.currentUser.isEqual(t)){Er("SyncEngine","User change. New user:",t.toKey());const e=await Mu(n.localStore,t);n.currentUser=t,function(e,t){e.aa.forEach((e=>{e.forEach((e=>{e.reject(new xr(Dr.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))}))})),e.aa.clear()}(n),n.sharedClientState.handleUserChange(t,e.removedBatchIds,e.addedBatchIds),await Bh(n,e.hi)}}function $h(e,t){const n=Rr(e),r=n.ra.get(t);if(r&&r.Zu)return Lo().add(r.key);{let e=Lo();const r=n.na.get(t);if(!r)return e;for(const t of r){const r=n.ea.get(t);e=e.unionWith(r.view.Ku)}return e}}async function zh(e,t){const n=Rr(e),r=await ju(n.localStore,t.query,!0),i=t.view.Yu(r);return n.isPrimaryClient&&Fh(n,t.targetId,i.Hu),i}async function Gh(e,t){const n=Rr(e);return zu(n.localStore,t).then((e=>Bh(n,e)))}async function Kh(e,t,n,r){const i=Rr(e),s=await function(e,t){const n=Rr(e),r=Rr(n.Bs);return n.persistence.runTransaction("Lookup mutation documents","readonly",(e=>r.fn(e,t).next((t=>t?n.ci.Ks(e,t):Ja.resolve(null)))))}(i.localStore,t);null!==s?("pending"===n?await zl(i.remoteStore):"acknowledged"===n||"rejected"===n?(Lh(i,t,r||null),Ph(i,t),function(e,t){Rr(Rr(e).Bs)._n(t)}(i.localStore,t)):Cr(),await Bh(i,s)):Er("SyncEngine","Cannot apply mutation batch with id: "+t)}async function Hh(e,t,n){const r=Rr(e),i=[],s=[];for(const e of t){let t;const n=r.na.get(e);if(n&&0!==n.length){t=await qu(r.localStore,Cs(n[0]));for(const e of n){const t=r.ea.get(e),n=await zh(r,t);n.snapshot&&s.push(n.snapshot)}}else{const n=await $u(r.localStore,e);t=await qu(r.localStore,n),await Ah(r,Wh(n),e,!1)}i.push(t)}return r.ta.Qo(s),i}function Wh(e){return _s(e.path,e.collectionGroup,e.orderBy,e.filters,e.limit,"F",e.startAt,e.endAt)}function Yh(e){const t=Rr(e);return Rr(Rr(t.localStore).persistence).Fs()}async function Qh(e,t,n,r){const i=Rr(e);if(i.ha)return void Er("SyncEngine","Ignoring unexpected query state notification.");const s=i.na.get(t);if(s&&s.length>0)switch(n){case"current":case"not-current":{const e=await zu(i.localStore,Ps(s[0])),r=Fo.createSynthesizedRemoteEventForCurrentChange(t,"current"===n);await Bh(i,e,r);break}case"rejected":await Bu(i.localStore,t,!0),Mh(i,t,r);break;default:Cr()}}async function Xh(e,t,n){const r=Jh(e);if(r.ha){for(const e of t){if(r.na.has(e)){Er("SyncEngine","Adding an already active target "+e);continue}const t=await $u(r.localStore,e),n=await qu(r.localStore,t);await Ah(r,Wh(t),n.targetId,!1),Dl(r.remoteStore,n)}for(const e of n)r.na.has(e)&&await Bu(r.localStore,e,!1).then((()=>{xl(r.remoteStore,e),Mh(r,e)})).catch(uu)}}function Jh(e){const t=Rr(e);return t.remoteStore.remoteSyncer.applyRemoteEvent=Nh.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=$h.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=Dh.bind(null,t),t.ta.Qo=dh.bind(null,t.eventManager),t.ta.fa=fh.bind(null,t.eventManager),t}function Zh(e){const t=Rr(e);return t.remoteStore.remoteSyncer.applySuccessfulWrite=xh.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=Oh.bind(null,t),t}class ed{constructor(){this.synchronizeTabs=!1}async initialize(e){this.M=bl(e.databaseInfo.databaseId),this.sharedClientState=this._a(e),this.persistence=this.wa(e),await this.persistence.start(),this.gcScheduler=this.ma(e),this.localStore=this.ga(e)}ma(e){return null}ga(e){return Lu(this.persistence,new Ou,e.initialUser,this.M)}wa(e){return new tl(rl.zi,this.M)}_a(e){return new fl}async terminate(){this.gcScheduler&&this.gcScheduler.stop(),await this.sharedClientState.shutdown(),await this.persistence.shutdown()}}class td extends ed{constructor(e,t,n){super(),this.ya=e,this.cacheSizeBytes=t,this.forceOwnership=n,this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await this.ya.initialize(this,e),await Zh(this.ya.syncEngine),await zl(this.ya.remoteStore),await this.persistence.Ts((()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(this.localStore),Promise.resolve())))}ga(e){return Lu(this.persistence,new Ou,e.initialUser,this.M)}ma(e){const t=this.persistence.referenceDelegate.garbageCollector;return new du(t,e.asyncQueue)}wa(e){const t=Ru(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),n=void 0!==this.cacheSizeBytes?Qc.withCacheSize(this.cacheSizeBytes):Qc.DEFAULT;return new Au(this.synchronizeTabs,t,e.clientId,n,e.asyncQueue,wl(),_l(),this.M,this.sharedClientState,!!this.forceOwnership)}_a(e){return new fl}}class nd extends td{constructor(e,t){super(e,t,!1),this.ya=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}async initialize(e){await super.initialize(e);const t=this.ya.syncEngine;this.sharedClientState instanceof dl&&(this.sharedClientState.syncEngine={Mr:Kh.bind(null,t),Or:Qh.bind(null,t),Fr:Xh.bind(null,t),Fs:Yh.bind(null,t),kr:Gh.bind(null,t)},await this.sharedClientState.start()),await this.persistence.Ts((async e=>{await async function(e,t){const n=Rr(e);if(Jh(n),Zh(n),!0===t&&!0!==n.ha){const e=n.sharedClientState.getAllActiveQueryTargets(),t=await Hh(n,e.toArray());n.ha=!0,await eh(n.remoteStore,!0);for(const e of t)Dl(n.remoteStore,e)}else if(!1===t&&!1!==n.ha){const e=[];let t=Promise.resolve();n.na.forEach(((r,i)=>{n.sharedClientState.isLocalQueryTarget(i)?e.push(i):t=t.then((()=>(Mh(n,i),Bu(n.localStore,i,!0)))),xl(n.remoteStore,i)})),await t,await Hh(n,e),function(e){const t=Rr(e);t.ra.forEach(((e,n)=>{xl(t.remoteStore,n)})),t.oa.bi(),t.ra=new Map,t.ia=new Io(yi.comparator)}(n),n.ha=!1,await eh(n.remoteStore,!1)}}(this.ya.syncEngine,e),this.gcScheduler&&(e&&!this.gcScheduler.started?this.gcScheduler.start(this.localStore):e||this.gcScheduler.stop())}))}_a(e){const t=wl();if(!dl.vt(t))throw new xr(Dr.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");const n=Ru(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new dl(t,e.asyncQueue,n,e.clientId,e.initialUser)}}class rd{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=e=>Rh(this.syncEngine,e,1),this.remoteStore.remoteSyncer.handleCredentialChange=jh.bind(null,this.syncEngine),await eh(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return new uh}createDatastore(e){const t=bl(e.databaseInfo.databaseId),n=(r=e.databaseInfo,new vl(r));var r;return function(e,t,n,r){return new kl(e,t,n,r)}(e.authCredentials,e.appCheckCredentials,n,t)}createRemoteStore(e){return t=this.localStore,n=this.datastore,r=e.asyncQueue,i=e=>Rh(this.syncEngine,e,0),s=ml.vt()?new ml:new pl,new Cl(t,n,r,i,s);var t,n,r,i,s}createSyncEngine(e,t){return function(e,t,n,r,i,s,o){const a=new Sh(e,t,n,r,i,s);return o&&(a.ha=!0),a}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}terminate(){return async function(e){const t=Rr(e);Er("RemoteStore","RemoteStore shutting down."),t.fu.add(5),await Rl(t),t._u.shutdown(),t.wu.set("Unknown")}(this.remoteStore)}}function id(e,t=10240){let n=0;return{async read(){if(n<e.byteLength){const r={value:e.slice(n,n+t),done:!1};return n+=t,r}return{done:!0}},async cancel(){},releaseLock(){},closed:Promise.reject("unimplemented")}}class sd{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.pa(this.observer.next,e)}error(e){this.observer.error?this.pa(this.observer.error,e):console.error("Uncaught Error in snapshot listener:",e)}Ia(){this.muted=!0}pa(e,t){this.muted||setTimeout((()=>{this.muted||e(t)}),0)}}class od{constructor(e,t){this.Ta=e,this.M=t,this.metadata=new Or,this.buffer=new Uint8Array,this.Ea=new TextDecoder("utf-8"),this.Aa().then((e=>{e&&e.xu()?this.metadata.resolve(e.payload.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is\n             ${JSON.stringify(null==e?void 0:e.payload)}`))}),(e=>this.metadata.reject(e)))}close(){return this.Ta.cancel()}async getMetadata(){return this.metadata.promise}async da(){return await this.getMetadata(),this.Aa()}async Aa(){const e=await this.Ra();if(null===e)return null;const t=this.Ea.decode(e),n=Number(t);isNaN(n)&&this.Pa(`length string (${t}) is not valid number`);const r=await this.ba(n);return new gh(JSON.parse(r),e.length+n)}Va(){return this.buffer.findIndex((e=>e==="{".charCodeAt(0)))}async Ra(){for(;this.Va()<0&&!await this.va(););if(0===this.buffer.length)return null;const e=this.Va();e<0&&this.Pa("Reached the end of bundle when a length string is expected.");const t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t}async ba(e){for(;this.buffer.length<e;)await this.va()&&this.Pa("Reached the end of bundle when more is expected.");const t=this.Ea.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t}Pa(e){throw this.Ta.cancel(),new Error(`Invalid bundle format: ${e}`)}async va(){const e=await this.Ta.read();if(!e.done){const t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done}}class ad{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}async lookup(e){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw new xr(Dr.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");const t=await async function(e,t){const n=Rr(e),r=oa(n.M)+"/documents",i={documents:t.map((e=>na(n.M,e)))},s=await n.ho("BatchGetDocuments",r,i),o=new Map;s.forEach((e=>{const t=function(e,t){return"found"in t?function(e,t){Nr(!!t.found),t.found.name,t.found.updateTime;const n=ra(e,t.found.name),r=Zo(t.found.updateTime),i=new Vi({mapValue:{fields:t.found.fields}});return Bi.newFoundDocument(n,r,i)}(e,t):"missing"in t?function(e,t){Nr(!!t.missing),Nr(!!t.readTime);const n=ra(e,t.missing),r=Zo(t.readTime);return Bi.newNoDocument(n,r)}(e,t):Cr()}(n.M,e);o.set(t.key.toString(),t)}));const a=[];return t.forEach((e=>{const t=o.get(e.toString());Nr(!!t),a.push(t)})),a}(this.datastore,e);return t.forEach((e=>this.recordVersion(e))),t}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(e){this.lastWriteError=e}this.writtenDocs.add(e.toString())}delete(e){this.write(new po(e,this.precondition(e))),this.writtenDocs.add(e.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastWriteError)throw this.lastWriteError;const e=this.readVersions;this.mutations.forEach((t=>{e.delete(t.key.toString())})),e.forEach(((e,t)=>{const n=yi.fromPath(t);this.mutations.push(new mo(n,this.precondition(n)))})),await async function(e,t){const n=Rr(e),r=oa(n.M)+"/documents",i={writes:t.map((e=>la(n.M,e)))};await n.oo("Commit",r,i)}(this.datastore,this.mutations),this.committed=!0}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw Cr();t=Yr.min()}const n=this.readVersions.get(e.key.toString());if(n){if(!t.isEqual(n))throw new xr(Dr.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){const t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?eo.updateTime(t):eo.none()}preconditionForUpdate(e){const t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(Yr.min()))throw new xr(Dr.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return eo.updateTime(t)}return eo.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}class cd{constructor(e,t,n,r){this.asyncQueue=e,this.datastore=t,this.updateFunction=n,this.deferred=r,this.Sa=5,this.Do=new Il(this.asyncQueue,"transaction_retry")}run(){this.Sa-=1,this.Da()}Da(){this.Do.To((async()=>{const e=new ad(this.datastore),t=this.Ca(e);t&&t.then((t=>{this.asyncQueue.enqueueAndForget((()=>e.commit().then((()=>{this.deferred.resolve(t)})).catch((e=>{this.xa(e)}))))})).catch((e=>{this.xa(e)}))}))}Ca(e){try{const t=this.updateFunction(e);return!pi(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(e){return this.deferred.reject(e),null}}xa(e){this.Sa>0&&this.Na(e)?(this.Sa-=1,this.asyncQueue.enqueueAndForget((()=>(this.Da(),Promise.resolve())))):this.deferred.reject(e)}Na(e){if("FirebaseError"===e.name){const t=e.code;return"aborted"===t||"failed-precondition"===t||!wo(t)}return!1}}class ud{constructor(e,t,n,r){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=r,this.user=_r.UNAUTHENTICATED,this.clientId=zr.R(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(n,(async e=>{Er("FirestoreClient","Received user=",e.uid),await this.authCredentialListener(e),this.user=e})),this.appCheckCredentials.start(n,(e=>(Er("FirestoreClient","Received new app check token=",e),this.appCheckCredentialListener(e,this.user))))}async getConfiguration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new xr(Dr.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();const e=new Or;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this.onlineComponents&&await this.onlineComponents.terminate(),this.offlineComponents&&await this.offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const n=ih(t,"Failed to shutdown persistence");e.reject(n)}})),e.promise}}async function ld(e,t){e.asyncQueue.verifyOperationInProgress(),Er("FirestoreClient","Initializing OfflineComponentProvider");const n=await e.getConfiguration();await t.initialize(n);let r=n.initialUser;e.setCredentialChangeListener((async e=>{r.isEqual(e)||(await Mu(t.localStore,e),r=e)})),t.persistence.setDatabaseDeletedListener((()=>e.terminate())),e.offlineComponents=t}async function hd(e,t){e.asyncQueue.verifyOperationInProgress();const n=await dd(e);Er("FirestoreClient","Initializing OnlineComponentProvider");const r=await e.getConfiguration();await t.initialize(n,r),e.setCredentialChangeListener((e=>Zl(t.remoteStore,e))),e.setAppCheckTokenChangeListener(((e,n)=>Zl(t.remoteStore,n))),e.onlineComponents=t}async function dd(e){return e.offlineComponents||(Er("FirestoreClient","Using default OfflineComponentProvider"),await ld(e,new ed)),e.offlineComponents}async function fd(e){return e.onlineComponents||(Er("FirestoreClient","Using default OnlineComponentProvider"),await hd(e,new rd)),e.onlineComponents}function pd(e){return dd(e).then((e=>e.persistence))}function md(e){return dd(e).then((e=>e.localStore))}function gd(e){return fd(e).then((e=>e.remoteStore))}function yd(e){return fd(e).then((e=>e.syncEngine))}async function vd(e){const t=await fd(e),n=t.eventManager;return n.onListen=kh.bind(null,t.syncEngine),n.onUnlisten=Ch.bind(null,t.syncEngine),n}function wd(e,t,n={}){const r=new Or;return e.asyncQueue.enqueueAndForget((async()=>function(e,t,n,r,i){const s=new sd({next:s=>{t.enqueueAndForget((()=>hh(e,o)));const a=s.docs.has(n);!a&&s.fromCache?i.reject(new xr(Dr.UNAVAILABLE,"Failed to get document because the client is offline.")):a&&s.fromCache&&r&&"server"===r.source?i.reject(new xr(Dr.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(s)},error:e=>i.reject(e)}),o=new mh(bs(n.path),s,{includeMetadataChanges:!0,Cu:!0});return lh(e,o)}(await vd(e),e.asyncQueue,t,n,r))),r.promise}function _d(e,t,n={}){const r=new Or;return e.asyncQueue.enqueueAndForget((async()=>function(e,t,n,r,i){const s=new sd({next:n=>{t.enqueueAndForget((()=>hh(e,o))),n.fromCache&&"server"===r.source?i.reject(new xr(Dr.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(n)},error:e=>i.reject(e)}),o=new mh(n,s,{includeMetadataChanges:!0,Cu:!0});return lh(e,o)}(await vd(e),e.asyncQueue,t,n,r))),r.promise}const bd=new Map;function Id(e,t,n){if(!n)throw new xr(Dr.INVALID_ARGUMENT,`Function ${e}() cannot be called with an empty ${t}.`)}function Td(e,t,n,r){if(!0===t&&!0===r)throw new xr(Dr.INVALID_ARGUMENT,`${e} and ${n} cannot be used together.`)}function Ed(e){if(!yi.isDocumentKey(e))throw new xr(Dr.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${e} has ${e.length}.`)}function Sd(e){if(yi.isDocumentKey(e))throw new xr(Dr.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${e} has ${e.length}.`)}function kd(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return e.length>20&&(e=`${e.substring(0,20)}...`),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"==typeof e){if(e instanceof Array)return"an array";{const t=function(e){return e.constructor?e.constructor.name:null}(e);return t?`a custom ${t} object`:"an object"}}return"function"==typeof e?"a function":Cr()}function Ad(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new xr(Dr.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=kd(e);throw new xr(Dr.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${n}`)}}return e}function Cd(e,t){if(t<=0)throw new xr(Dr.INVALID_ARGUMENT,`Function ${e}() requires a positive number, but it was: ${t}.`)}class Nd{constructor(e){var t;if(void 0===e.host){if(void 0!==e.ssl)throw new xr(Dr.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=null===(t=e.ssl)||void 0===t||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,void 0===e.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new xr(Dr.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.useFetchStreams=!!e.useFetchStreams,Td("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling)}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class Rd{constructor(e,t,n){this._authCredentials=t,this._appCheckCredentials=n,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Nd({}),this._settingsFrozen=!1,e instanceof fi?this._databaseId=e:(this._app=e,this._databaseId=function(e){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new xr(Dr.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new fi(e.options.projectId)}(e))}get app(){if(!this._app)throw new xr(Dr.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new xr(Dr.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Nd(e),void 0!==e.credentials&&(this._authCredentials=function(e){if(!e)return new Lr;switch(e.type){case"gapi":const t=e.client;return Nr(!("object"!=typeof t||null===t||!t.auth||!t.auth.getAuthHeaderValueForFirstParty)),new Vr(t,e.sessionIndex||"0",e.iamToken||null);case"provider":return e.client;default:throw new xr(Dr.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){const t=bd.get(e);t&&(Er("ComponentProvider","Removing Datastore"),bd.delete(e),t.terminate())}(this),Promise.resolve()}}class Dd{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Od(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Dd(this.firestore,e,this._key)}}class xd{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new xd(this.firestore,e,this._query)}}class Od extends xd{constructor(e,t,n){super(e,t,bs(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Dd(this.firestore,null,new yi(e))}withConverter(e){return new Od(this.firestore,e,this._path)}}function Pd(e,t,...n){if(e=(0,c.m9)(e),Id("collection","path",t),e instanceof Rd){const r=ei.fromString(t,...n);return Sd(r),new Od(e,null,r)}{if(!(e instanceof Dd||e instanceof Od))throw new xr(Dr.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=e._path.child(ei.fromString(t,...n));return Sd(r),new Od(e.firestore,null,r)}}function Ld(e,t,...n){if(e=(0,c.m9)(e),1===arguments.length&&(t=zr.R()),Id("doc","path",t),e instanceof Rd){const r=ei.fromString(t,...n);return Ed(r),new Dd(e,null,new yi(r))}{if(!(e instanceof Dd||e instanceof Od))throw new xr(Dr.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=e._path.child(ei.fromString(t,...n));return Ed(r),new Dd(e.firestore,e instanceof Od?e.converter:null,new yi(r))}}function Md(e,t){return e=(0,c.m9)(e),t=(0,c.m9)(t),(e instanceof Dd||e instanceof Od)&&(t instanceof Dd||t instanceof Od)&&e.firestore===t.firestore&&e.path===t.path&&e.converter===t.converter}function Ud(e,t){return e=(0,c.m9)(e),t=(0,c.m9)(t),e instanceof xd&&t instanceof xd&&e.firestore===t.firestore&&Rs(e._query,t._query)&&e.converter===t.converter}class Fd{constructor(){this.ka=Promise.resolve(),this.Ma=[],this.Oa=!1,this.Fa=[],this.$a=null,this.Ba=!1,this.La=!1,this.Ua=[],this.Do=new Il(this,"async_queue_retry"),this.qa=()=>{const e=_l();e&&Er("AsyncQueue","Visibility state changed to "+e.visibilityState),this.Do.Ao()};const e=_l();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.qa)}get isShuttingDown(){return this.Oa}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.Ka(),this.Ga(e)}enterRestrictedMode(e){if(!this.Oa){this.Oa=!0,this.La=e||!1;const t=_l();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.qa)}}enqueue(e){if(this.Ka(),this.Oa)return new Promise((()=>{}));const t=new Or;return this.Ga((()=>this.Oa&&this.La?Promise.resolve():(e().then(t.resolve,t.reject),t.promise))).then((()=>t.promise))}enqueueRetryable(e){this.enqueueAndForget((()=>(this.Ma.push(e),this.Qa())))}async Qa(){if(0!==this.Ma.length){try{await this.Ma[0](),this.Ma.shift(),this.Do.reset()}catch(e){if(!rc(e))throw e;Er("AsyncQueue","Operation failed with retryable error: "+e)}this.Ma.length>0&&this.Do.To((()=>this.Qa()))}}Ga(e){const t=this.ka.then((()=>(this.Ba=!0,e().catch((e=>{this.$a=e,this.Ba=!1;const t=function(e){let t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t}(e);throw Sr("INTERNAL UNHANDLED ERROR: ",t),e})).then((e=>(this.Ba=!1,e))))));return this.ka=t,t}enqueueAfterDelay(e,t,n){this.Ka(),this.Ua.indexOf(e)>-1&&(t=0);const r=rh.createAndSchedule(this,e,t,n,(e=>this.ja(e)));return this.Fa.push(r),r}Ka(){this.$a&&Cr()}verifyOperationInProgress(){}async Wa(){let e;do{e=this.ka,await e}while(e!==this.ka)}za(e){for(const t of this.Fa)if(t.timerId===e)return!0;return!1}Ha(e){return this.Wa().then((()=>{this.Fa.sort(((e,t)=>e.targetTimeMs-t.targetTimeMs));for(const t of this.Fa)if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.Wa()}))}Ja(e){this.Ua.push(e)}ja(e){const t=this.Fa.indexOf(e);this.Fa.splice(t,1)}}function Vd(e){return function(e,t){if("object"!=typeof e||null===e)return!1;const n=e;for(const e of["next","error","complete"])if(e in n&&"function"==typeof n[e])return!0;return!1}(e)}class qd{constructor(){this._progressObserver={},this._taskCompletionResolver=new Or,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,n){this._progressObserver={next:e,error:t,complete:n}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}class Bd extends Rd{constructor(e,t,n){super(e,t,n),this.type="firestore",this._queue=new Fd,this._persistenceKey="name"in e?e.name:"[DEFAULT]"}_terminate(){return this._firestoreClient||$d(this),this._firestoreClient.terminate()}}function jd(e){return e._firestoreClient||$d(e),e._firestoreClient.verifyNotTerminated(),e._firestoreClient}function $d(e){var t;const n=e._freezeSettings(),r=function(e,t,n,r){return new di(e,t,n,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling,r.useFetchStreams)}(e._databaseId,(null===(t=e._app)||void 0===t?void 0:t.options.appId)||"",e._persistenceKey,n);e._firestoreClient=new ud(e._authCredentials,e._appCheckCredentials,e._queue,r)}function zd(e,t,n){const r=new Or;return e.asyncQueue.enqueue((async()=>{try{await ld(e,n),await hd(e,t),r.resolve()}catch(e){if(!function(e){return"FirebaseError"===e.name?e.code===Dr.FAILED_PRECONDITION||e.code===Dr.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&e instanceof DOMException)||22===e.code||20===e.code||11===e.code}(e))throw e;console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+e),r.reject(e)}})).then((()=>r.promise))}function Gd(e){if(e._initialized||e._terminated)throw new xr(Dr.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}class Kd{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new xr(Dr.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new ni(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class Hd{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Hd(ii.fromBase64String(e))}catch(e){throw new xr(Dr.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(e){return new Hd(ii.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}class Wd{constructor(e){this._methodName=e}}class Yd{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new xr(Dr.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new xr(Dr.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return Gr(this._lat,e._lat)||Gr(this._long,e._long)}}const Qd=/^__.*__$/;class Xd{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return null!==this.fieldMask?new uo(e,this.data,this.fieldMask,t,this.fieldTransforms):new co(e,this.data,t,this.fieldTransforms)}}class Jd{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return new uo(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function Zd(e){switch(e){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Cr()}}class ef{constructor(e,t,n,r,i,s){this.settings=e,this.databaseId=t,this.M=n,this.ignoreUndefinedProperties=r,void 0===i&&this.Ya(),this.fieldTransforms=i||[],this.fieldMask=s||[]}get path(){return this.settings.path}get Xa(){return this.settings.Xa}Za(e){return new ef(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.M,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}tc(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.Za({path:n,ec:!1});return r.nc(e),r}sc(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.Za({path:n,ec:!1});return r.Ya(),r}ic(e){return this.Za({path:void 0,ec:!0})}rc(e){return bf(e,this.settings.methodName,this.settings.oc||!1,this.path,this.settings.uc)}contains(e){return void 0!==this.fieldMask.find((t=>e.isPrefixOf(t)))||void 0!==this.fieldTransforms.find((t=>e.isPrefixOf(t.field)))}Ya(){if(this.path)for(let e=0;e<this.path.length;e++)this.nc(this.path.get(e))}nc(e){if(0===e.length)throw this.rc("Document fields must not be empty");if(Zd(this.Xa)&&Qd.test(e))throw this.rc('Document fields cannot begin and end with "__"')}}class tf{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.M=n||bl(e)}ac(e,t,n,r=!1){return new ef({Xa:e,methodName:t,uc:n,path:ni.emptyPath(),ec:!1,oc:r},this.databaseId,this.M,this.ignoreUndefinedProperties)}}function nf(e){const t=e._freezeSettings(),n=bl(e._databaseId);return new tf(e._databaseId,!!t.ignoreUndefinedProperties,n)}function rf(e,t,n,r,i,s={}){const o=e.ac(s.merge||s.mergeFields?2:0,t,n,i);yf("Data must be an object, but it was:",o,r);const a=mf(r,o);let c,u;if(s.merge)c=new ri(o.fieldMask),u=o.fieldTransforms;else if(s.mergeFields){const e=[];for(const r of s.mergeFields){const i=vf(t,r,n);if(!o.contains(i))throw new xr(Dr.INVALID_ARGUMENT,`Field '${i}' is specified in your field mask but missing from your input data.`);If(e,i)||e.push(i)}c=new ri(e),u=o.fieldTransforms.filter((e=>c.covers(e.field)))}else c=null,u=o.fieldTransforms;return new Xd(new Vi(a),c,u)}class sf extends Wd{_toFieldTransform(e){if(2!==e.Xa)throw 1===e.Xa?e.rc(`${this._methodName}() can only appear at the top level of your update data`):e.rc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof sf}}function of(e,t,n){return new ef({Xa:3,uc:t.settings.uc,methodName:e._methodName,ec:n},t.databaseId,t.M,t.ignoreUndefinedProperties)}class af extends Wd{_toFieldTransform(e){return new Js(e.path,new zs)}isEqual(e){return e instanceof af}}class cf extends Wd{constructor(e,t){super(e),this.cc=t}_toFieldTransform(e){const t=of(this,e,!0),n=this.cc.map((e=>pf(e,t))),r=new Gs(n);return new Js(e.path,r)}isEqual(e){return this===e}}class uf extends Wd{constructor(e,t){super(e),this.cc=t}_toFieldTransform(e){const t=of(this,e,!0),n=this.cc.map((e=>pf(e,t))),r=new Hs(n);return new Js(e.path,r)}isEqual(e){return this===e}}class lf extends Wd{constructor(e,t){super(e),this.hc=t}_toFieldTransform(e){const t=new Ys(e.M,Vs(e.M,this.hc));return new Js(e.path,t)}isEqual(e){return this===e}}function hf(e,t,n,r){const i=e.ac(1,t,n);yf("Data must be an object, but it was:",i,r);const s=[],o=Vi.empty();Xr(r,((e,r)=>{const a=_f(t,e,n);r=(0,c.m9)(r);const u=i.sc(a);if(r instanceof sf)s.push(a);else{const e=pf(r,u);null!=e&&(s.push(a),o.set(a,e))}}));const a=new ri(s);return new Jd(o,a,i.fieldTransforms)}function df(e,t,n,r,i,s){const o=e.ac(1,t,n),a=[vf(t,r,n)],u=[i];if(s.length%2!=0)throw new xr(Dr.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let e=0;e<s.length;e+=2)a.push(vf(t,s[e])),u.push(s[e+1]);const l=[],h=Vi.empty();for(let e=a.length-1;e>=0;--e)if(!If(l,a[e])){const t=a[e];let n=u[e];n=(0,c.m9)(n);const r=o.sc(t);if(n instanceof sf)l.push(t);else{const e=pf(n,r);null!=e&&(l.push(t),h.set(t,e))}}const d=new ri(l);return new Jd(h,d,o.fieldTransforms)}function ff(e,t,n,r=!1){return pf(n,e.ac(r?4:3,t))}function pf(e,t){if(gf(e=(0,c.m9)(e)))return yf("Unsupported field value:",t,e),mf(e,t);if(e instanceof Wd)return function(e,t){if(!Zd(t.Xa))throw t.rc(`${e._methodName}() can only be used with update() and set()`);if(!t.path)throw t.rc(`${e._methodName}() is not currently supported inside arrays`);const n=e._toFieldTransform(t);n&&t.fieldTransforms.push(n)}(e,t),null;if(void 0===e&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),e instanceof Array){if(t.settings.ec&&4!==t.Xa)throw t.rc("Nested arrays are not supported");return function(e,t){const n=[];let r=0;for(const i of e){let e=pf(i,t.ic(r));null==e&&(e={nullValue:"NULL_VALUE"}),n.push(e),r++}return{arrayValue:{values:n}}}(e,t)}return function(e,t){if(null===(e=(0,c.m9)(e)))return{nullValue:"NULL_VALUE"};if("number"==typeof e)return Vs(t.M,e);if("boolean"==typeof e)return{booleanValue:e};if("string"==typeof e)return{stringValue:e};if(e instanceof Date){const n=Wr.fromDate(e);return{timestampValue:Qo(t.M,n)}}if(e instanceof Wr){const n=new Wr(e.seconds,1e3*Math.floor(e.nanoseconds/1e3));return{timestampValue:Qo(t.M,n)}}if(e instanceof Yd)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};if(e instanceof Hd)return{bytesValue:Xo(t.M,e._byteString)};if(e instanceof Dd){const n=t.databaseId,r=e.firestore._databaseId;if(!r.isEqual(n))throw t.rc(`Document reference is for database ${r.projectId}/${r.database} but should be for database ${n.projectId}/${n.database}`);return{referenceValue:ea(e.firestore._databaseId||t.databaseId,e._key.path)}}throw t.rc(`Unsupported field value: ${kd(e)}`)}(e,t)}function mf(e,t){const n={};return Jr(e)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):Xr(e,((e,r)=>{const i=pf(r,t.tc(e));null!=i&&(n[e]=i)})),{mapValue:{fields:n}}}function gf(e){return!("object"!=typeof e||null===e||e instanceof Array||e instanceof Date||e instanceof Wr||e instanceof Yd||e instanceof Hd||e instanceof Dd||e instanceof Wd)}function yf(e,t,n){if(!gf(n)||!function(e){return"object"==typeof e&&null!==e&&(Object.getPrototypeOf(e)===Object.prototype||null===Object.getPrototypeOf(e))}(n)){const r=kd(n);throw"an object"===r?t.rc(e+" a custom object"):t.rc(e+" "+r)}}function vf(e,t,n){if((t=(0,c.m9)(t))instanceof Kd)return t._internalPath;if("string"==typeof t)return _f(e,t);throw bf("Field path arguments must be of type string or ",e,!1,void 0,n)}const wf=new RegExp("[~\\*/\\[\\]]");function _f(e,t,n){if(t.search(wf)>=0)throw bf(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,e,!1,void 0,n);try{return new Kd(...t.split("."))._internalPath}catch(r){throw bf(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,e,!1,void 0,n)}}function bf(e,t,n,r,i){const s=r&&!r.isEmpty(),o=void 0!==i;let a=`Function ${t}() called with invalid data`;n&&(a+=" (via `toFirestore()`)"),a+=". ";let c="";return(s||o)&&(c+=" (found",s&&(c+=` in field ${r}`),o&&(c+=` in document ${i}`),c+=")"),new xr(Dr.INVALID_ARGUMENT,a+e+c)}function If(e,t){return e.some((e=>e.isEqual(t)))}class Tf{constructor(e,t,n,r,i){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=r,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new Dd(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const e=new Ef(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(Sf("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class Ef extends Tf{data(){return super.data()}}function Sf(e,t){return"string"==typeof t?_f(e,t):t instanceof Kd?t._internalPath:t._delegate._internalPath}class kf{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class Af extends Tf{constructor(e,t,n,r,i,s){super(e,t,n,r,s),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new Cf(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const n=this._document.data.field(Sf("DocumentSnapshot.get",e));if(null!==n)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}}class Cf extends Af{data(e={}){return super.data(e)}}class Nf{constructor(e,t,n,r){this._firestore=e,this._userDataWriter=t,this._snapshot=r,this.metadata=new kf(r.hasPendingWrites,r.fromCache),this.query=n}get docs(){const e=[];return this.forEach((t=>e.push(t))),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach((n=>{e.call(t,new Cf(this._firestore,this._userDataWriter,n.key,n,new kf(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new xr(Dr.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(e,t){if(e._snapshot.oldDocs.isEmpty()){let t=0;return e._snapshot.docChanges.map((n=>({type:"added",doc:new Cf(e._firestore,e._userDataWriter,n.doc.key,n.doc,new kf(e._snapshot.mutatedKeys.has(n.doc.key),e._snapshot.fromCache),e.query.converter),oldIndex:-1,newIndex:t++})))}{let n=e._snapshot.oldDocs;return e._snapshot.docChanges.filter((e=>t||3!==e.type)).map((t=>{const r=new Cf(e._firestore,e._userDataWriter,t.doc.key,t.doc,new kf(e._snapshot.mutatedKeys.has(t.doc.key),e._snapshot.fromCache),e.query.converter);let i=-1,s=-1;return 0!==t.type&&(i=n.indexOf(t.doc.key),n=n.delete(t.doc.key)),1!==t.type&&(n=n.add(t.doc),s=n.indexOf(t.doc.key)),{type:Rf(t.type),doc:r,oldIndex:i,newIndex:s}}))}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function Rf(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Cr()}}function Df(e,t){return e instanceof Af&&t instanceof Af?e._firestore===t._firestore&&e._key.isEqual(t._key)&&(null===e._document?null===t._document:e._document.isEqual(t._document))&&e._converter===t._converter:e instanceof Nf&&t instanceof Nf&&e._firestore===t._firestore&&Ud(e.query,t.query)&&e.metadata.isEqual(t.metadata)&&e._snapshot.isEqual(t._snapshot)}function xf(e){if(Ts(e)&&0===e.explicitOrderBy.length)throw new xr(Dr.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class Of{}function Pf(e,...t){for(const n of t)e=n._apply(e);return e}class Lf extends Of{constructor(e,t,n){super(),this.lc=e,this.fc=t,this.dc=n,this.type="where"}_apply(e){const t=nf(e.firestore),n=function(e,t,n,r,i,s,o){let a;if(i.isKeyField()){if("array-contains"===s||"array-contains-any"===s)throw new xr(Dr.INVALID_ARGUMENT,`Invalid Query. You can't perform '${s}' queries on documentId().`);if("in"===s||"not-in"===s){jf(o,s);const t=[];for(const n of o)t.push(Bf(r,e,n));a={arrayValue:{values:t}}}else a=Bf(r,e,o)}else"in"!==s&&"not-in"!==s&&"array-contains-any"!==s||jf(o,s),a=ff(n,"where",o,"in"===s||"not-in"===s);const c=ss.create(i,s,a);return function(e,t){if(t.S()){const n=Ss(e);if(null!==n&&!n.isEqual(t.field))throw new xr(Dr.INVALID_ARGUMENT,`Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '${n.toString()}' and '${t.field.toString()}'`);const r=Es(e);null!==r&&$f(0,t.field,r)}const n=function(e,t){for(const n of e.filters)if(t.indexOf(n.op)>=0)return n.op;return null}(e,function(e){switch(e){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}(t.op));if(null!==n)throw n===t.op?new xr(Dr.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`):new xr(Dr.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${n.toString()}' filters.`)}(e,c),c}(e._query,0,t,e.firestore._databaseId,this.lc,this.fc,this.dc);return new xd(e.firestore,e.converter,function(e,t){const n=e.filters.concat([t]);return new ws(e.path,e.collectionGroup,e.explicitOrderBy.slice(),n,e.limit,e.limitType,e.startAt,e.endAt)}(e._query,n))}}class Mf extends Of{constructor(e,t){super(),this.lc=e,this._c=t,this.type="orderBy"}_apply(e){const t=function(e,t,n){if(null!==e.startAt)throw new xr(Dr.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==e.endAt)throw new xr(Dr.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");const r=new ms(t,n);return function(e,t){if(null===Es(e)){const n=Ss(e);null!==n&&$f(0,n,t.field)}}(e,r),r}(e._query,this.lc,this._c);return new xd(e.firestore,e.converter,function(e,t){const n=e.explicitOrderBy.concat([t]);return new ws(e.path,e.collectionGroup,n,e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(e._query,t))}}class Uf extends Of{constructor(e,t,n){super(),this.type=e,this.wc=t,this.mc=n}_apply(e){return new xd(e.firestore,e.converter,Ns(e._query,this.wc,this.mc))}}class Ff extends Of{constructor(e,t,n){super(),this.type=e,this.gc=t,this.yc=n}_apply(e){const t=qf(e,this.type,this.gc,this.yc);return new xd(e.firestore,e.converter,function(e,t){return new ws(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,t,e.endAt)}(e._query,t))}}class Vf extends Of{constructor(e,t,n){super(),this.type=e,this.gc=t,this.yc=n}_apply(e){const t=qf(e,this.type,this.gc,this.yc);return new xd(e.firestore,e.converter,function(e,t){return new ws(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,t)}(e._query,t))}}function qf(e,t,n,r){if(n[0]=(0,c.m9)(n[0]),n[0]instanceof Tf)return function(e,t,n,r,i){if(!r)throw new xr(Dr.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${n}().`);const s=[];for(const n of As(e))if(n.field.isKeyField())s.push(Ai(t,r.key));else{const e=r.data.field(n.field);if(ui(e))throw new xr(Dr.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+n.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===e){const e=n.field.canonicalString();throw new xr(Dr.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${e}' (used as the orderBy) does not exist.`)}s.push(e)}return new ps(s,i)}(e._query,e.firestore._databaseId,t,n[0]._document,r);{const i=nf(e.firestore);return function(e,t,n,r,i,s){const o=e.explicitOrderBy;if(i.length>o.length)throw new xr(Dr.INVALID_ARGUMENT,`Too many arguments provided to ${r}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const a=[];for(let s=0;s<i.length;s++){const c=i[s];if(o[s].field.isKeyField()){if("string"!=typeof c)throw new xr(Dr.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${r}(), but got a ${typeof c}`);if(!ks(e)&&-1!==c.indexOf("/"))throw new xr(Dr.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${r}() must be a plain document ID, but '${c}' contains a slash.`);const n=e.path.child(ei.fromString(c));if(!yi.isDocumentKey(n))throw new xr(Dr.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${r}() must result in a valid document path, but '${n}' is not because it contains an odd number of segments.`);const i=new yi(n);a.push(Ai(t,i))}else{const e=ff(n,r,c);a.push(e)}}return new ps(a,s)}(e._query,e.firestore._databaseId,i,t,n,r)}}function Bf(e,t,n){if("string"==typeof(n=(0,c.m9)(n))){if(""===n)throw new xr(Dr.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!ks(t)&&-1!==n.indexOf("/"))throw new xr(Dr.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);const r=t.path.child(ei.fromString(n));if(!yi.isDocumentKey(r))throw new xr(Dr.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return Ai(e,new yi(r))}if(n instanceof Dd)return Ai(e,n._key);throw new xr(Dr.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${kd(n)}.`)}function jf(e,t){if(!Array.isArray(e)||0===e.length)throw new xr(Dr.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`);if(e.length>10)throw new xr(Dr.INVALID_ARGUMENT,`Invalid Query. '${t.toString()}' filters support a maximum of 10 elements in the value array.`)}function $f(e,t,n){if(!n.isEqual(t))throw new xr(Dr.INVALID_ARGUMENT,`Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '${t.toString()}' and so you must also use '${t.toString()}' as your first argument to orderBy(), but your first orderBy() is on field '${n.toString()}' instead.`)}class zf{convertValue(e,t="none"){switch(_i(e)){case 0:return null;case 1:return e.booleanValue;case 2:return ai(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(ci(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw Cr()}}convertObject(e,t){const n={};return Xr(e.fields,((e,r)=>{n[e]=this.convertValue(r,t)})),n}convertGeoPoint(e){return new Yd(ai(e.latitude),ai(e.longitude))}convertArray(e,t){return(e.values||[]).map((e=>this.convertValue(e,t)))}convertServerTimestamp(e,t){switch(t){case"previous":const n=li(e);return null==n?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(hi(e));default:return null}}convertTimestamp(e){const t=oi(e);return new Wr(t.seconds,t.nanos)}convertDocumentKey(e,t){const n=ei.fromString(e);Nr(Ta(n));const r=new fi(n.get(1),n.get(3)),i=new yi(n.popFirst(5));return r.isEqual(t)||Sr(`Document ${i} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}function Gf(e,t,n){let r;return r=e?n&&(n.merge||n.mergeFields)?e.toFirestore(t,n):e.toFirestore(t):t,r}class Kf extends zf{constructor(e){super(),this.firestore=e}convertBytes(e){return new Hd(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Dd(this.firestore,null,t)}}class Hf{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=nf(e)}set(e,t,n){this._verifyNotCommitted();const r=Wf(e,this._firestore),i=Gf(r.converter,t,n),s=rf(this._dataReader,"WriteBatch.set",r._key,i,null!==r.converter,n);return this._mutations.push(s.toMutation(r._key,eo.none())),this}update(e,t,n,...r){this._verifyNotCommitted();const i=Wf(e,this._firestore);let s;return s="string"==typeof(t=(0,c.m9)(t))||t instanceof Kd?df(this._dataReader,"WriteBatch.update",i._key,t,n,r):hf(this._dataReader,"WriteBatch.update",i._key,t),this._mutations.push(s.toMutation(i._key,eo.exists(!0))),this}delete(e){this._verifyNotCommitted();const t=Wf(e,this._firestore);return this._mutations=this._mutations.concat(new po(t._key,eo.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new xr(Dr.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function Wf(e,t){if((e=(0,c.m9)(e)).firestore!==t)throw new xr(Dr.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return e}class Yf extends zf{constructor(e){super(),this.firestore=e}convertBytes(e){return new Hd(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Dd(this.firestore,null,t)}}function Qf(e,t,n){e=Ad(e,Dd);const r=Ad(e.firestore,Bd),i=Gf(e.converter,t,n);return Zf(r,[rf(nf(r),"setDoc",e._key,i,null!==e.converter,n).toMutation(e._key,eo.none())])}function Xf(e,t,n,...r){e=Ad(e,Dd);const i=Ad(e.firestore,Bd),s=nf(i);let o;return o="string"==typeof(t=(0,c.m9)(t))||t instanceof Kd?df(s,"updateDoc",e._key,t,n,r):hf(s,"updateDoc",e._key,t),Zf(i,[o.toMutation(e._key,eo.exists(!0))])}function Jf(e,...t){var n,r,i;e=(0,c.m9)(e);let s={includeMetadataChanges:!1},o=0;"object"!=typeof t[o]||Vd(t[o])||(s=t[o],o++);const a={includeMetadataChanges:s.includeMetadataChanges};if(Vd(t[o])){const e=t[o];t[o]=null===(n=e.next)||void 0===n?void 0:n.bind(e),t[o+1]=null===(r=e.error)||void 0===r?void 0:r.bind(e),t[o+2]=null===(i=e.complete)||void 0===i?void 0:i.bind(e)}let u,l,h;if(e instanceof Dd)l=Ad(e.firestore,Bd),h=bs(e._key.path),u={next:n=>{t[o]&&t[o](ep(l,e,n))},error:t[o+1],complete:t[o+2]};else{const n=Ad(e,xd);l=Ad(n.firestore,Bd),h=n._query;const r=new Yf(l);u={next:e=>{t[o]&&t[o](new Nf(l,r,n,e))},error:t[o+1],complete:t[o+2]},xf(e._query)}return function(e,t,n,r){const i=new sd(r),s=new mh(t,i,n);return e.asyncQueue.enqueueAndForget((async()=>lh(await vd(e),s))),()=>{i.Ia(),e.asyncQueue.enqueueAndForget((async()=>hh(await vd(e),s)))}}(jd(l),h,a,u)}function Zf(e,t){return function(e,t){const n=new Or;return e.asyncQueue.enqueueAndForget((async()=>async function(e,t,n){const r=Zh(e);try{const e=await function(e,t){const n=Rr(e),r=Wr.now(),i=t.reduce(((e,t)=>e.add(t.key)),Lo());let s;return n.persistence.runTransaction("Locally write mutations","readwrite",(e=>n.ci.Ks(e,i).next((i=>{s=i;const o=[];for(const e of t){const t=so(e,s.get(e.key));null!=t&&o.push(new uo(e.key,t,qi(t.value.mapValue),eo.exists(!0)))}return n.Bs.addMutationBatch(e,r,o,t)})))).then((e=>(e.applyToLocalDocumentSet(s),{batchId:e.batchId,changes:s})))}(r.localStore,t);r.sharedClientState.addPendingMutation(e.batchId),function(e,t,n){let r=e.ua[e.currentUser.toKey()];r||(r=new Io(Gr)),r=r.insert(t,n),e.ua[e.currentUser.toKey()]=r}(r,e.batchId,n),await Bh(r,e.changes),await zl(r.remoteStore)}catch(e){const t=ih(e,"Failed to persist write");n.reject(t)}}(await yd(e),t,n))),n.promise}(jd(e),t)}function ep(e,t,n){const r=n.docs.get(t._key),i=new Yf(e);return new Af(e,i,t._key,r,new kf(n.hasPendingWrites,n.fromCache),t.converter)}class tp extends class{constructor(e,t){this._firestore=e,this._transaction=t,this._dataReader=nf(e)}get(e){const t=Wf(e,this._firestore),n=new Kf(this._firestore);return this._transaction.lookup([t._key]).then((e=>{if(!e||1!==e.length)return Cr();const r=e[0];if(r.isFoundDocument())return new Tf(this._firestore,n,r.key,r,t.converter);if(r.isNoDocument())return new Tf(this._firestore,n,t._key,null,t.converter);throw Cr()}))}set(e,t,n){const r=Wf(e,this._firestore),i=Gf(r.converter,t,n),s=rf(this._dataReader,"Transaction.set",r._key,i,null!==r.converter,n);return this._transaction.set(r._key,s),this}update(e,t,n,...r){const i=Wf(e,this._firestore);let s;return s="string"==typeof(t=(0,c.m9)(t))||t instanceof Kd?df(this._dataReader,"Transaction.update",i._key,t,n,r):hf(this._dataReader,"Transaction.update",i._key,t),this._transaction.update(i._key,s),this}delete(e){const t=Wf(e,this._firestore);return this._transaction.delete(t._key),this}}{constructor(e,t){super(e,t),this._firestore=e}get(e){const t=Wf(e,this._firestore),n=new Yf(this._firestore);return super.get(e).then((e=>new Af(this._firestore,n,t._key,e._document,new kf(!1,!1),t.converter)))}}function np(e,t){if(void 0===t)return{merge:!1};if(void 0!==t.mergeFields&&void 0!==t.merge)throw new xr("invalid-argument",`Invalid options passed to function ${e}(): You cannot specify both "merge" and "mergeFields".`);return t}function rp(){if("undefined"==typeof Uint8Array)throw new xr("unimplemented","Uint8Arrays are not available in this environment.")}function ip(){if("undefined"==typeof atob)throw new xr("unimplemented","Blobs are unavailable in Firestore in this environment.")}!function(e,t=!0){!function(e){br=e}(s.SDK_VERSION),(0,s._registerComponent)(new o.wA("firestore",((e,{options:n})=>{const r=e.getProvider("app").getImmediate(),i=new Bd(r,new Ur(e.getProvider("auth-internal")),new Br(e.getProvider("app-check-internal")));return n=Object.assign({useFetchStreams:t},n),i._setSettings(n),i}),"PUBLIC")),(0,s.registerVersion)(wr,"3.4.8",e),(0,s.registerVersion)(wr,"3.4.8","esm2017")}();class sp{constructor(e){this._delegate=e}static fromBase64String(e){return ip(),new sp(Hd.fromBase64String(e))}static fromUint8Array(e){return rp(),new sp(Hd.fromUint8Array(e))}toBase64(){return ip(),this._delegate.toBase64()}toUint8Array(){return rp(),this._delegate.toUint8Array()}isEqual(e){return this._delegate.isEqual(e._delegate)}toString(){return"Blob(base64: "+this.toBase64()+")"}}function op(e){return function(e,t){if("object"!=typeof e||null===e)return!1;const n=e;for(const e of["next","error","complete"])if(e in n&&"function"==typeof n[e])return!0;return!1}(e)}class ap{enableIndexedDbPersistence(e,t){return function(e,t){Gd(e=Ad(e,Bd));const n=jd(e),r=e._freezeSettings(),i=new rd;return zd(n,i,new td(i,r.cacheSizeBytes,null==t?void 0:t.forceOwnership))}(e._delegate,{forceOwnership:t})}enableMultiTabIndexedDbPersistence(e){return function(e){Gd(e=Ad(e,Bd));const t=jd(e),n=e._freezeSettings(),r=new rd;return zd(t,r,new nd(r,n.cacheSizeBytes))}(e._delegate)}clearIndexedDbPersistence(e){return function(e){if(e._initialized&&!e._terminated)throw new xr(Dr.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const t=new Or;return e._queue.enqueueAndForgetEvenWhileRestricted((async()=>{try{await async function(e){if(!ec.vt())return Promise.resolve();const t=e+"main";await ec.delete(t)}(Ru(e._databaseId,e._persistenceKey)),t.resolve()}catch(e){t.reject(e)}})),t.promise}(e._delegate)}}class cp{constructor(e,t,n){this._delegate=t,this._persistenceProvider=n,this.INTERNAL={delete:()=>this.terminate()},e instanceof fi||(this._appCompat=e)}get _databaseId(){return this._delegate._databaseId}settings(e){const t=this._delegate._getSettings();e.merge||t.host===e.host||kr("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),e.merge&&delete(e=Object.assign(Object.assign({},t),e)).merge,this._delegate._setSettings(e)}useEmulator(e,t,n={}){!function(e,t,n,r={}){var i;const s=(e=Ad(e,Rd))._getSettings();if("firestore.googleapis.com"!==s.host&&s.host!==t&&kr("Host has been set in both settings() and useEmulator(), emulator host will be used"),e._setSettings(Object.assign(Object.assign({},s),{host:`${t}:${n}`,ssl:!1})),r.mockUserToken){let t,n;if("string"==typeof r.mockUserToken)t=r.mockUserToken,n=_r.MOCK_USER;else{t=(0,c.Sg)(r.mockUserToken,null===(i=e._app)||void 0===i?void 0:i.options.projectId);const s=r.mockUserToken.sub||r.mockUserToken.user_id;if(!s)throw new xr(Dr.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");n=new _r(s)}e._authCredentials=new Mr(new Pr(t,n))}}(this._delegate,e,t,n)}enableNetwork(){return function(e){return function(e){return e.asyncQueue.enqueue((async()=>{const t=await pd(e),n=await gd(e);return t.setNetworkEnabled(!0),function(e){const t=Rr(e);return t.fu.delete(0),Nl(t)}(n)}))}(jd(e=Ad(e,Bd)))}(this._delegate)}disableNetwork(){return function(e){return function(e){return e.asyncQueue.enqueue((async()=>{const t=await pd(e),n=await gd(e);return t.setNetworkEnabled(!1),async function(e){const t=Rr(e);t.fu.add(0),await Rl(t),t.wu.set("Offline")}(n)}))}(jd(e=Ad(e,Bd)))}(this._delegate)}enablePersistence(e){let t=!1,n=!1;return e&&(t=!!e.synchronizeTabs,n=!!e.experimentalForceOwningTab,Td("synchronizeTabs",t,"experimentalForceOwningTab",n)),t?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,n)}clearPersistence(){return this._persistenceProvider.clearIndexedDbPersistence(this)}terminate(){return this._appCompat&&(this._appCompat._removeServiceInstance("firestore-compat"),this._appCompat._removeServiceInstance("firestore")),this._delegate._delete()}waitForPendingWrites(){return function(e){return function(e){const t=new Or;return e.asyncQueue.enqueueAndForget((async()=>async function(e,t){const n=Rr(e);Ul(n.remoteStore)||Er("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{const e=await function(e){const t=Rr(e);return t.persistence.runTransaction("Get highest unacknowledged batch id","readonly",(e=>t.Bs.getHighestUnacknowledgedBatchId(e)))}(n.localStore);if(-1===e)return void t.resolve();const r=n.aa.get(e)||[];r.push(t),n.aa.set(e,r)}catch(e){const n=ih(e,"Initialization of waitForPendingWrites() operation failed");t.reject(n)}}(await yd(e),t))),t.promise}(jd(e=Ad(e,Bd)))}(this._delegate)}onSnapshotsInSync(e){return function(e,t){return function(e,t){const n=new sd(t);return e.asyncQueue.enqueueAndForget((async()=>function(e,t){Rr(e).Eu.add(t),t.next()}(await vd(e),n))),()=>{n.Ia(),e.asyncQueue.enqueueAndForget((async()=>function(e,t){Rr(e).Eu.delete(t)}(await vd(e),n)))}}(jd(e=Ad(e,Bd)),Vd(t)?t:{next:t})}(this._delegate,e)}get app(){if(!this._appCompat)throw new xr("failed-precondition","Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._appCompat}collection(e){try{return new Ip(this,Pd(this._delegate,e))}catch(e){throw pp(e,"collection()","Firestore.collection()")}}doc(e){try{return new fp(this,Ld(this._delegate,e))}catch(e){throw pp(e,"doc()","Firestore.doc()")}}collectionGroup(e){try{return new wp(this,function(e,t){if(e=Ad(e,Rd),Id("collectionGroup","collection id",t),t.indexOf("/")>=0)throw new xr(Dr.INVALID_ARGUMENT,`Invalid collection ID '${t}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new xd(e,null,function(e){return new ws(ei.emptyPath(),e)}(t))}(this._delegate,e))}catch(e){throw pp(e,"collectionGroup()","Firestore.collectionGroup()")}}runTransaction(e){return function(e,t){return function(e,t){const n=new Or;return e.asyncQueue.enqueueAndForget((async()=>{const r=await function(e){return fd(e).then((e=>e.datastore))}(e);new cd(e.asyncQueue,r,t,n).run()})),n.promise}(jd(e=Ad(e,Bd)),(n=>t(new tp(e,n))))}(this._delegate,(t=>e(new lp(this,t))))}batch(){return jd(this._delegate),new hp(new Hf(this._delegate,(e=>Zf(this._delegate,e))))}loadBundle(e){return function(e,t){const n=jd(e=Ad(e,Bd)),r=new qd;return function(e,t,n,r){const i=function(e,t){let n;return n="string"==typeof e?(new TextEncoder).encode(e):e,function(e,t){return new od(e,t)}(function(e,t){if(e instanceof Uint8Array)return id(e,t);if(e instanceof ArrayBuffer)return id(new Uint8Array(e),t);if(e instanceof ReadableStream)return e.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(n),t)}(n,bl(t));e.asyncQueue.enqueueAndForget((async()=>{!function(e,t,n){const r=Rr(e);(async function(e,t,n){try{const r=await t.getMetadata();if(await function(e,t){const n=Rr(e),r=Zo(t.createTime);return n.persistence.runTransaction("hasNewerBundle","readonly",(e=>n._s.getBundleMetadata(e,t.id))).then((e=>!!e&&e.createTime.compareTo(r)>=0))}(e.localStore,r))return await t.close(),n._completeWith(function(e){return{taskState:"Success",documentsLoaded:e.totalDocuments,bytesLoaded:e.totalBytes,totalDocuments:e.totalDocuments,totalBytes:e.totalBytes}}(r)),Promise.resolve(new Set);n._updateProgress(wh(r));const i=new vh(r,e.localStore,t.M);let s=await t.da();for(;s;){const e=await i.ku(s);e&&n._updateProgress(e),s=await t.da()}const o=await i.complete();return await Bh(e,o.Fu,void 0),await function(e,t){const n=Rr(e);return n.persistence.runTransaction("Save bundle","readwrite",(e=>n._s.saveBundleMetadata(e,t)))}(e.localStore,r),n._completeWith(o.progress),Promise.resolve(o.Ou)}catch(e){return kr("SyncEngine",`Loading bundle failed with ${e}`),n._failWith(e),Promise.resolve(new Set)}})(r,t,n).then((e=>{r.sharedClientState.notifyBundleLoaded(e)}))}(await yd(e),i,r)}))}(n,e._databaseId,t,r),r}(this._delegate,e)}namedQuery(e){return function(e,t){return function(e,t){return e.asyncQueue.enqueue((async()=>function(e,t){const n=Rr(e);return n.persistence.runTransaction("Get named query","readonly",(e=>n._s.getNamedQuery(e,t)))}(await md(e),t)))}(jd(e=Ad(e,Bd)),t).then((t=>t?new xd(e,null,t.query):null))}(this._delegate,e).then((e=>e?new wp(this,e):null))}}class up extends zf{constructor(e){super(),this.firestore=e}convertBytes(e){return new sp(new Hd(e))}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return fp.forKey(t,this.firestore,null)}}class lp{constructor(e,t){this._firestore=e,this._delegate=t,this._userDataWriter=new up(e)}get(e){const t=Tp(e);return this._delegate.get(t).then((e=>new yp(this._firestore,new Af(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,t.converter))))}set(e,t,n){const r=Tp(e);return n?(np("Transaction.set",n),this._delegate.set(r,t,n)):this._delegate.set(r,t),this}update(e,t,n,...r){const i=Tp(e);return 2===arguments.length?this._delegate.update(i,t):this._delegate.update(i,t,n,...r),this}delete(e){const t=Tp(e);return this._delegate.delete(t),this}}class hp{constructor(e){this._delegate=e}set(e,t,n){const r=Tp(e);return n?(np("WriteBatch.set",n),this._delegate.set(r,t,n)):this._delegate.set(r,t),this}update(e,t,n,...r){const i=Tp(e);return 2===arguments.length?this._delegate.update(i,t):this._delegate.update(i,t,n,...r),this}delete(e){const t=Tp(e);return this._delegate.delete(t),this}commit(){return this._delegate.commit()}}class dp{constructor(e,t,n){this._firestore=e,this._userDataWriter=t,this._delegate=n}fromFirestore(e,t){const n=new Cf(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,null);return this._delegate.fromFirestore(new vp(this._firestore,n),null!=t?t:{})}toFirestore(e,t){return t?this._delegate.toFirestore(e,t):this._delegate.toFirestore(e)}static getInstance(e,t){const n=dp.INSTANCES;let r=n.get(e);r||(r=new WeakMap,n.set(e,r));let i=r.get(t);return i||(i=new dp(e,new up(e),t),r.set(t,i)),i}}dp.INSTANCES=new WeakMap;class fp{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new up(e)}static forPath(e,t,n){if(e.length%2!=0)throw new xr("invalid-argument",`Invalid document reference. Document references must have an even number of segments, but ${e.canonicalString()} has ${e.length}`);return new fp(t,new Dd(t._delegate,n,new yi(e)))}static forKey(e,t,n){return new fp(t,new Dd(t._delegate,n,e))}get id(){return this._delegate.id}get parent(){return new Ip(this.firestore,this._delegate.parent)}get path(){return this._delegate.path}collection(e){try{return new Ip(this.firestore,Pd(this._delegate,e))}catch(e){throw pp(e,"collection()","DocumentReference.collection()")}}isEqual(e){return(e=(0,c.m9)(e))instanceof Dd&&Md(this._delegate,e)}set(e,t){t=np("DocumentReference.set",t);try{return t?Qf(this._delegate,e,t):Qf(this._delegate,e)}catch(e){throw pp(e,"setDoc()","DocumentReference.set()")}}update(e,t,...n){try{return 1===arguments.length?Xf(this._delegate,e):Xf(this._delegate,e,t,...n)}catch(e){throw pp(e,"updateDoc()","DocumentReference.update()")}}delete(){return function(e){return Zf(Ad(e.firestore,Bd),[new po(e._key,eo.none())])}(this._delegate)}onSnapshot(...e){const t=mp(e),n=gp(e,(e=>new yp(this.firestore,new Af(this.firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,this._delegate.converter))));return Jf(this._delegate,t,n)}get(e){let t;return t="cache"===(null==e?void 0:e.source)?function(e){e=Ad(e,Dd);const t=Ad(e.firestore,Bd),n=jd(t),r=new Yf(t);return function(e,t){const n=new Or;return e.asyncQueue.enqueueAndForget((async()=>async function(e,t,n){try{const r=await function(e,t){const n=Rr(e);return n.persistence.runTransaction("read document","readonly",(e=>n.ci.Ls(e,t)))}(e,t);r.isFoundDocument()?n.resolve(r):r.isNoDocument()?n.resolve(null):n.reject(new xr(Dr.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(e){const r=ih(e,`Failed to get document '${t} from cache`);n.reject(r)}}(await md(e),t,n))),n.promise}(n,e._key).then((n=>new Af(t,r,e._key,n,new kf(null!==n&&n.hasLocalMutations,!0),e.converter)))}(this._delegate):"server"===(null==e?void 0:e.source)?function(e){e=Ad(e,Dd);const t=Ad(e.firestore,Bd);return wd(jd(t),e._key,{source:"server"}).then((n=>ep(t,e,n)))}(this._delegate):function(e){e=Ad(e,Dd);const t=Ad(e.firestore,Bd);return wd(jd(t),e._key).then((n=>ep(t,e,n)))}(this._delegate),t.then((e=>new yp(this.firestore,new Af(this.firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,this._delegate.converter))))}withConverter(e){return new fp(this.firestore,e?this._delegate.withConverter(dp.getInstance(this.firestore,e)):this._delegate.withConverter(null))}}function pp(e,t,n){return e.message=e.message.replace(t,n),e}function mp(e){for(const t of e)if("object"==typeof t&&!op(t))return t;return{}}function gp(e,t){var n,r;let i;return i=op(e[0])?e[0]:op(e[1])?e[1]:"function"==typeof e[0]?{next:e[0],error:e[1],complete:e[2]}:{next:e[1],error:e[2],complete:e[3]},{next:e=>{i.next&&i.next(t(e))},error:null===(n=i.error)||void 0===n?void 0:n.bind(i),complete:null===(r=i.complete)||void 0===r?void 0:r.bind(i)}}class yp{constructor(e,t){this._firestore=e,this._delegate=t}get ref(){return new fp(this._firestore,this._delegate.ref)}get id(){return this._delegate.id}get metadata(){return this._delegate.metadata}get exists(){return this._delegate.exists()}data(e){return this._delegate.data(e)}get(e,t){return this._delegate.get(e,t)}isEqual(e){return Df(this._delegate,e._delegate)}}class vp extends yp{data(e){const t=this._delegate.data(e);return function(e,t){e||Cr()}(void 0!==t),t}}class wp{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new up(e)}where(e,t,n){try{return new wp(this.firestore,Pf(this._delegate,function(e,t,n){const r=t,i=Sf("where",e);return new Lf(i,r,n)}(e,t,n)))}catch(e){throw pp(e,/(orderBy|where)\(\)/,"Query.$1()")}}orderBy(e,t){try{return new wp(this.firestore,Pf(this._delegate,function(e,t="asc"){const n=t,r=Sf("orderBy",e);return new Mf(r,n)}(e,t)))}catch(e){throw pp(e,/(orderBy|where)\(\)/,"Query.$1()")}}limit(e){try{return new wp(this.firestore,Pf(this._delegate,function(e){return Cd("limit",e),new Uf("limit",e,"F")}(e)))}catch(e){throw pp(e,"limit()","Query.limit()")}}limitToLast(e){try{return new wp(this.firestore,Pf(this._delegate,function(e){return Cd("limitToLast",e),new Uf("limitToLast",e,"L")}(e)))}catch(e){throw pp(e,"limitToLast()","Query.limitToLast()")}}startAt(...e){try{return new wp(this.firestore,Pf(this._delegate,function(...e){return new Ff("startAt",e,!0)}(...e)))}catch(e){throw pp(e,"startAt()","Query.startAt()")}}startAfter(...e){try{return new wp(this.firestore,Pf(this._delegate,function(...e){return new Ff("startAfter",e,!1)}(...e)))}catch(e){throw pp(e,"startAfter()","Query.startAfter()")}}endBefore(...e){try{return new wp(this.firestore,Pf(this._delegate,function(...e){return new Vf("endBefore",e,!1)}(...e)))}catch(e){throw pp(e,"endBefore()","Query.endBefore()")}}endAt(...e){try{return new wp(this.firestore,Pf(this._delegate,function(...e){return new Vf("endAt",e,!0)}(...e)))}catch(e){throw pp(e,"endAt()","Query.endAt()")}}isEqual(e){return Ud(this._delegate,e._delegate)}get(e){let t;return t="cache"===(null==e?void 0:e.source)?function(e){e=Ad(e,xd);const t=Ad(e.firestore,Bd),n=jd(t),r=new Yf(t);return function(e,t){const n=new Or;return e.asyncQueue.enqueueAndForget((async()=>async function(e,t,n){try{const r=await ju(e,t,!0),i=new Ih(t,r.li),s=i.Gu(r.documents),o=i.applyChanges(s,!1);n.resolve(o.snapshot)}catch(e){const r=ih(e,`Failed to execute query '${t} against cache`);n.reject(r)}}(await md(e),t,n))),n.promise}(n,e._query).then((n=>new Nf(t,r,e,n)))}(this._delegate):"server"===(null==e?void 0:e.source)?function(e){e=Ad(e,xd);const t=Ad(e.firestore,Bd),n=jd(t),r=new Yf(t);return _d(n,e._query,{source:"server"}).then((n=>new Nf(t,r,e,n)))}(this._delegate):function(e){e=Ad(e,xd);const t=Ad(e.firestore,Bd),n=jd(t),r=new Yf(t);return xf(e._query),_d(n,e._query).then((n=>new Nf(t,r,e,n)))}(this._delegate),t.then((e=>new bp(this.firestore,new Nf(this.firestore._delegate,this._userDataWriter,this._delegate,e._snapshot))))}onSnapshot(...e){const t=mp(e),n=gp(e,(e=>new bp(this.firestore,new Nf(this.firestore._delegate,this._userDataWriter,this._delegate,e._snapshot))));return Jf(this._delegate,t,n)}withConverter(e){return new wp(this.firestore,e?this._delegate.withConverter(dp.getInstance(this.firestore,e)):this._delegate.withConverter(null))}}class _p{constructor(e,t){this._firestore=e,this._delegate=t}get type(){return this._delegate.type}get doc(){return new vp(this._firestore,this._delegate.doc)}get oldIndex(){return this._delegate.oldIndex}get newIndex(){return this._delegate.newIndex}}class bp{constructor(e,t){this._firestore=e,this._delegate=t}get query(){return new wp(this._firestore,this._delegate.query)}get metadata(){return this._delegate.metadata}get size(){return this._delegate.size}get empty(){return this._delegate.empty}get docs(){return this._delegate.docs.map((e=>new vp(this._firestore,e)))}docChanges(e){return this._delegate.docChanges(e).map((e=>new _p(this._firestore,e)))}forEach(e,t){this._delegate.forEach((n=>{e.call(t,new vp(this._firestore,n))}))}isEqual(e){return Df(this._delegate,e._delegate)}}class Ip extends wp{constructor(e,t){super(e,t),this.firestore=e,this._delegate=t}get id(){return this._delegate.id}get path(){return this._delegate.path}get parent(){const e=this._delegate.parent;return e?new fp(this.firestore,e):null}doc(e){try{return new fp(this.firestore,void 0===e?Ld(this._delegate):Ld(this._delegate,e))}catch(e){throw pp(e,"doc()","CollectionReference.doc()")}}add(e){return function(e,t){const n=Ad(e.firestore,Bd),r=Ld(e),i=Gf(e.converter,t);return Zf(n,[rf(nf(e.firestore),"addDoc",r._key,i,null!==e.converter,{}).toMutation(r._key,eo.exists(!1))]).then((()=>r))}(this._delegate,e).then((e=>new fp(this.firestore,e)))}isEqual(e){return Md(this._delegate,e._delegate)}withConverter(e){return new Ip(this.firestore,e?this._delegate.withConverter(dp.getInstance(this.firestore,e)):this._delegate.withConverter(null))}}function Tp(e){return Ad(e,Dd)}class Ep{constructor(...e){this._delegate=new Kd(...e)}static documentId(){return new Ep(ni.keyField().canonicalString())}isEqual(e){return(e=(0,c.m9)(e))instanceof Kd&&this._delegate._internalPath.isEqual(e._internalPath)}}class Sp{constructor(e){this._delegate=e}static serverTimestamp(){const e=new af("serverTimestamp");return e._methodName="FieldValue.serverTimestamp",new Sp(e)}static delete(){const e=new sf("deleteField");return e._methodName="FieldValue.delete",new Sp(e)}static arrayUnion(...e){const t=function(...e){return new cf("arrayUnion",e)}(...e);return t._methodName="FieldValue.arrayUnion",new Sp(t)}static arrayRemove(...e){const t=function(...e){return new uf("arrayRemove",e)}(...e);return t._methodName="FieldValue.arrayRemove",new Sp(t)}static increment(e){const t=function(e){return new lf("increment",e)}(e);return t._methodName="FieldValue.increment",new Sp(t)}isEqual(e){return this._delegate.isEqual(e._delegate)}}const kp={Firestore:cp,GeoPoint:Yd,Timestamp:Wr,Blob:sp,Transaction:lp,WriteBatch:hp,DocumentReference:fp,DocumentSnapshot:yp,Query:wp,QueryDocumentSnapshot:vp,QuerySnapshot:bp,CollectionReference:Ip,FieldPath:Ep,FieldValue:Sp,setLogLevel:function(e){!function(e){Ir.setLogLevel(e)}(e)},CACHE_SIZE_UNLIMITED:-1};var Ap,Cp;Ap=i.Z,Cp=(e,t)=>new cp(e,t,new ap),Ap.INTERNAL.registerComponent(new o.wA("firestore-compat",(e=>{const t=e.getProvider("app-compat").getImmediate(),n=e.getProvider("firestore").getImmediate();return Cp(t,n)}),"PUBLIC").setServiceProps(Object.assign({},kp))),Ap.registerVersion("@firebase/firestore-compat","0.1.17")},93516:(e,t,n)=>{var r=n(98180),i=n(90774),s=n(8463);class o{constructor(e,t,n){this._delegate=e,this.task=t,this.ref=n}get bytesTransferred(){return this._delegate.bytesTransferred}get metadata(){return this._delegate.metadata}get state(){return this._delegate.state}get totalBytes(){return this._delegate.totalBytes}}class a{constructor(e,t){this._delegate=e,this._ref=t,this.cancel=this._delegate.cancel.bind(this._delegate),this.catch=this._delegate.catch.bind(this._delegate),this.pause=this._delegate.pause.bind(this._delegate),this.resume=this._delegate.resume.bind(this._delegate)}get snapshot(){return new o(this._delegate.snapshot,this,this._ref)}then(e,t){return this._delegate.then((t=>{if(e)return e(new o(t,this,this._ref))}),t)}on(e,t,n,r){let i;return t&&(i="function"==typeof t?e=>t(new o(e,this,this._ref)):{next:t.next?e=>t.next(new o(e,this,this._ref)):void 0,complete:t.complete||void 0,error:t.error||void 0}),this._delegate.on(e,i,n||void 0,r||void 0)}}class c{constructor(e,t){this._delegate=e,this._service=t}get prefixes(){return this._delegate.prefixes.map((e=>new u(e,this._service)))}get items(){return this._delegate.items.map((e=>new u(e,this._service)))}get nextPageToken(){return this._delegate.nextPageToken||null}}class u{constructor(e,t){this._delegate=e,this.storage=t}get name(){return this._delegate.name}get bucket(){return this._delegate.bucket}get fullPath(){return this._delegate.fullPath}toString(){return this._delegate.toString()}child(e){const t=(0,i.g6)(this._delegate,e);return new u(t,this.storage)}get root(){return new u(this._delegate.root,this.storage)}get parent(){const e=this._delegate.parent;return null==e?null:new u(e,this.storage)}put(e,t){return this._throwIfRoot("put"),new a((0,i.B0)(this._delegate,e,t),this)}putString(e,t=i.bm.RAW,n){this._throwIfRoot("putString");const r=(0,i.qm)(t,e),s=Object.assign({},n);return null==s.contentType&&null!=r.contentType&&(s.contentType=r.contentType),new a(new i.IX(this._delegate,new i.UJ(r.data,!0),s),this)}listAll(){return(0,i.aF)(this._delegate).then((e=>new c(e,this.storage)))}list(e){return(0,i.pb)(this._delegate,e||void 0).then((e=>new c(e,this.storage)))}getMetadata(){return(0,i.sd)(this._delegate)}updateMetadata(e){return(0,i.Ym)(this._delegate,e)}getDownloadURL(){return(0,i.Jt)(this._delegate)}delete(){return this._throwIfRoot("delete"),(0,i.oq)(this._delegate)}_throwIfRoot(e){if(""===this._delegate._location.path)throw(0,i.y4)(e)}}class l{constructor(e,t){this.app=e,this._delegate=t}get maxOperationRetryTime(){return this._delegate.maxOperationRetryTime}get maxUploadRetryTime(){return this._delegate.maxUploadRetryTime}ref(e){if(h(e))throw(0,i.gH)("ref() expected a child path but got a URL, use refFromURL instead.");return new u((0,i.iH)(this._delegate,e),this)}refFromURL(e){if(!h(e))throw(0,i.gH)("refFromURL() expected a full URL but got a child path, use ref() instead.");try{i.gE.makeFromUrl(e,this._delegate.host)}catch(e){throw(0,i.gH)("refFromUrl() expected a valid full URL but got an invalid one.")}return new u((0,i.iH)(this._delegate,e),this)}setMaxUploadRetryTime(e){this._delegate.maxUploadRetryTime=e}setMaxOperationRetryTime(e){this._delegate.maxOperationRetryTime=e}useEmulator(e,t,n={}){(0,i.a1)(this._delegate,e,t,n)}}function h(e){return/^[A-Za-z]+:\/\//.test(e)}function d(e,{instanceIdentifier:t}){const n=e.getProvider("app-compat").getImmediate(),r=e.getProvider("storage").getImmediate({identifier:t});return new l(n,r)}!function(e){const t={TaskState:i.$Y,TaskEvent:i.FN,StringFormat:i.bm,Storage:l,Reference:u};e.INTERNAL.registerComponent(new s.wA("storage-compat",d,"PUBLIC").setServiceProps(t).setMultipleInstances(!0)),e.registerVersion("@firebase/storage-compat","0.1.13")}(r.Z)},33404:(e,t,n)=>{n.d(t,{B0:()=>r.B0,Jt:()=>r.Jt,cF:()=>r.cF,iH:()=>r.iH});var r=n(90774)},98180:(e,t,n)=>{n.d(t,{Z:()=>h});var r=n(74444),i=n(8463),s=n(32238),o=n(53333);class a{constructor(e,t){this._delegate=e,this.firebase=t,(0,s._addComponent)(e,new i.wA("app-compat",(()=>this),"PUBLIC")),this.container=e.container}get automaticDataCollectionEnabled(){return this._delegate.automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this._delegate.automaticDataCollectionEnabled=e}get name(){return this._delegate.name}get options(){return this._delegate.options}delete(){return new Promise((e=>{this._delegate.checkDestroyed(),e()})).then((()=>(this.firebase.INTERNAL.removeApp(this.name),(0,s.deleteApp)(this._delegate))))}_getService(e,t=s._DEFAULT_ENTRY_NAME){var n;this._delegate.checkDestroyed();const r=this._delegate.container.getProvider(e);return r.isInitialized()||"EXPLICIT"!==(null===(n=r.getComponent())||void 0===n?void 0:n.instantiationMode)||r.initialize(),r.getImmediate({identifier:t})}_removeServiceInstance(e,t=s._DEFAULT_ENTRY_NAME){this._delegate.container.getProvider(e).clearInstance(t)}_addComponent(e){(0,s._addComponent)(this._delegate,e)}_addOrOverwriteComponent(e){(0,s._addOrOverwriteComponent)(this._delegate,e)}toJSON(){return{name:this.name,automaticDataCollectionEnabled:this.automaticDataCollectionEnabled,options:this.options}}}const c=new r.LL("app-compat","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance."}),u=function e(){const t=function(e){const t={},n={__esModule:!0,initializeApp:function(i,o={}){const a=s.initializeApp(i,o);if((0,r.r3)(t,a.name))return t[a.name];const c=new e(a,n);return t[a.name]=c,c},app:i,registerVersion:s.registerVersion,setLogLevel:s.setLogLevel,onLog:s.onLog,apps:null,SDK_VERSION:s.SDK_VERSION,INTERNAL:{registerComponent:function(t){const o=t.name,a=o.replace("-compat","");if(s._registerComponent(t)&&"PUBLIC"===t.type){const s=(e=i())=>{if("function"!=typeof e[a])throw c.create("invalid-app-argument",{appName:o});return e[a]()};void 0!==t.serviceProps&&(0,r.ZB)(s,t.serviceProps),n[a]=s,e.prototype[a]=function(...e){return this._getService.bind(this,o).apply(this,t.multipleInstances?e:[])}}return"PUBLIC"===t.type?n[a]:null},removeApp:function(e){delete t[e]},useAsService:function(e,t){return"serverAuth"===t?null:t},modularAPIs:s}};function i(e){if(e=e||s._DEFAULT_ENTRY_NAME,!(0,r.r3)(t,e))throw c.create("no-app",{appName:e});return t[e]}return n.default=n,Object.defineProperty(n,"apps",{get:function(){return Object.keys(t).map((e=>t[e]))}}),i.App=e,n}(a);return t.INTERNAL=Object.assign(Object.assign({},t.INTERNAL),{createFirebaseNamespace:e,extendNamespace:function(e){(0,r.ZB)(t,e)},createSubscribe:r.ne,ErrorFactory:r.LL,deepExtend:r.ZB}),t}(),l=new o.Yd("@firebase/app-compat");if((0,r.jU)()&&void 0!==self.firebase){l.warn("\n    Warning: Firebase is already defined in the global scope. Please make sure\n    Firebase library is only loaded once.\n  ");const e=self.firebase.SDK_VERSION;e&&e.indexOf("LITE")>=0&&l.warn("\n    Warning: You are trying to load Firebase while using Firebase Performance standalone script.\n    You should load Firebase Performance with this instance of Firebase to avoid loading duplicate code.\n    ")}const h=u;(0,s.registerVersion)("@firebase/app-compat","0.1.22",undefined)},32238:(e,t,n)=>{n.r(t),n.d(t,{FirebaseError:()=>s.ZR,SDK_VERSION:()=>I,_DEFAULT_ENTRY_NAME:()=>l,_addComponent:()=>p,_addOrOverwriteComponent:()=>m,_apps:()=>d,_clearComponents:()=>w,_components:()=>f,_getProvider:()=>y,_registerComponent:()=>g,_removeServiceInstance:()=>v,deleteApp:()=>k,getApp:()=>E,getApps:()=>S,initializeApp:()=>T,onLog:()=>C,registerVersion:()=>A,setLogLevel:()=>N});var r=n(8463),i=n(53333),s=n(74444);class o{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map((e=>{if(function(e){const t=e.getComponent();return"VERSION"===(null==t?void 0:t.type)}(e)){const t=e.getImmediate();return`${t.library}/${t.version}`}return null})).filter((e=>e)).join(" ")}}const a="@firebase/app",c="0.7.21",u=new i.Yd("@firebase/app"),l="[DEFAULT]",h={[a]:"fire-core","@firebase/app-compat":"fire-core-compat","@firebase/analytics":"fire-analytics","@firebase/analytics-compat":"fire-analytics-compat","@firebase/app-check":"fire-app-check","@firebase/app-check-compat":"fire-app-check-compat","@firebase/auth":"fire-auth","@firebase/auth-compat":"fire-auth-compat","@firebase/database":"fire-rtdb","@firebase/database-compat":"fire-rtdb-compat","@firebase/functions":"fire-fn","@firebase/functions-compat":"fire-fn-compat","@firebase/installations":"fire-iid","@firebase/installations-compat":"fire-iid-compat","@firebase/messaging":"fire-fcm","@firebase/messaging-compat":"fire-fcm-compat","@firebase/performance":"fire-perf","@firebase/performance-compat":"fire-perf-compat","@firebase/remote-config":"fire-rc","@firebase/remote-config-compat":"fire-rc-compat","@firebase/storage":"fire-gcs","@firebase/storage-compat":"fire-gcs-compat","@firebase/firestore":"fire-fst","@firebase/firestore-compat":"fire-fst-compat","fire-js":"fire-js",firebase:"fire-js-all"},d=new Map,f=new Map;function p(e,t){try{e.container.addComponent(t)}catch(n){u.debug(`Component ${t.name} failed to register with FirebaseApp ${e.name}`,n)}}function m(e,t){e.container.addOrOverwriteComponent(t)}function g(e){const t=e.name;if(f.has(t))return u.debug(`There were multiple attempts to register component ${t}.`),!1;f.set(t,e);for(const t of d.values())p(t,e);return!0}function y(e,t){const n=e.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),e.container.getProvider(t)}function v(e,t,n=l){y(e,t).clearInstance(n)}function w(){f.clear()}const _=new s.LL("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()","bad-app-name":"Illegal App name: '{$appName}","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","storage-open":"Error thrown when opening storage. Original error: {$originalErrorMessage}.","storage-get":"Error thrown when reading from storage. Original error: {$originalErrorMessage}.","storage-set":"Error thrown when writing to storage. Original error: {$originalErrorMessage}.","storage-delete":"Error thrown when deleting from storage. Original error: {$originalErrorMessage}."});class b{constructor(e,t,n){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new r.wA("app",(()=>this),"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw _.create("app-deleted",{appName:this._name})}}const I="9.6.11";function T(e,t={}){"object"!=typeof t&&(t={name:t});const n=Object.assign({name:l,automaticDataCollectionEnabled:!1},t),i=n.name;if("string"!=typeof i||!i)throw _.create("bad-app-name",{appName:String(i)});const o=d.get(i);if(o){if((0,s.vZ)(e,o.options)&&(0,s.vZ)(n,o.config))return o;throw _.create("duplicate-app",{appName:i})}const a=new r.H0(i);for(const e of f.values())a.addComponent(e);const c=new b(e,n,a);return d.set(i,c),c}function E(e=l){const t=d.get(e);if(!t)throw _.create("no-app",{appName:e});return t}function S(){return Array.from(d.values())}async function k(e){const t=e.name;d.has(t)&&(d.delete(t),await Promise.all(e.container.getProviders().map((e=>e.delete()))),e.isDeleted=!0)}function A(e,t,n){var i;let s=null!==(i=h[e])&&void 0!==i?i:e;n&&(s+=`-${n}`);const o=s.match(/\s|\//),a=t.match(/\s|\//);if(o||a){const e=[`Unable to register library "${s}" with version "${t}":`];return o&&e.push(`library name "${s}" contains illegal characters (whitespace or "/")`),o&&a&&e.push("and"),a&&e.push(`version name "${t}" contains illegal characters (whitespace or "/")`),void u.warn(e.join(" "))}g(new r.wA(`${s}-version`,(()=>({library:s,version:t})),"VERSION"))}function C(e,t){if(null!==e&&"function"!=typeof e)throw _.create("invalid-log-argument");(0,i.Am)(e,t)}function N(e){(0,i.Ub)(e)}const R="firebase-heartbeat-store";let D=null;function x(){return D||(D=(0,s.X3)("firebase-heartbeat-database",1,((e,t)=>{0===t&&e.createObjectStore(R)})).catch((e=>{throw _.create("storage-open",{originalErrorMessage:e.message})}))),D}async function O(e,t){try{const n=(await x()).transaction(R,"readwrite"),r=n.objectStore(R);return await r.put(t,P(e)),n.complete}catch(e){throw _.create("storage-set",{originalErrorMessage:e.message})}}function P(e){return`${e.name}!${e.options.appId}`}class L{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new U(t),this._heartbeatsCachePromise=this._storage.read().then((e=>(this._heartbeatsCache=e,e)))}async triggerHeartbeat(){const e=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),t=M();if(null===this._heartbeatsCache&&(this._heartbeatsCache=await this._heartbeatsCachePromise),this._heartbeatsCache.lastSentHeartbeatDate!==t&&!this._heartbeatsCache.heartbeats.some((e=>e.date===t)))return this._heartbeatsCache.heartbeats.push({date:t,agent:e}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter((e=>{const t=new Date(e.date).valueOf();return Date.now()-t<=2592e6})),this._storage.overwrite(this._heartbeatsCache)}async getHeartbeatsHeader(){if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,null===this._heartbeatsCache||0===this._heartbeatsCache.heartbeats.length)return"";const e=M(),{heartbeatsToSend:t,unsentEntries:n}=function(e,t=1024){const n=[];let r=e.slice();for(const i of e){const e=n.find((e=>e.agent===i.agent));if(e){if(e.dates.push(i.date),F(n)>t){e.dates.pop();break}}else if(n.push({agent:i.agent,dates:[i.date]}),F(n)>t){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}(this._heartbeatsCache.heartbeats),r=(0,s.L)(JSON.stringify({version:2,heartbeats:t}));return this._heartbeatsCache.lastSentHeartbeatDate=e,n.length>0?(this._heartbeatsCache.heartbeats=n,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),r}}function M(){return(new Date).toISOString().substring(0,10)}class U{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!(0,s.hl)()&&(0,s.eu)().then((()=>!0)).catch((()=>!1))}async read(){return await this._canUseIndexedDBPromise&&await async function(e){try{return(await x()).transaction(R).objectStore(R).get(P(e))}catch(e){throw _.create("storage-get",{originalErrorMessage:e.message})}}(this.app)||{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){const n=await this.read();return O(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:e.heartbeats})}}async add(e){var t;if(await this._canUseIndexedDBPromise){const n=await this.read();return O(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...e.heartbeats]})}}}function F(e){return(0,s.L)(JSON.stringify({version:2,heartbeats:e})).length}g(new r.wA("platform-logger",(e=>new o(e)),"PRIVATE")),g(new r.wA("heartbeat",(e=>new L(e)),"PRIVATE")),A(a,c,""),A(a,c,"esm2017"),A("fire-js","")},8463:(e,t,n)=>{n.d(t,{H0:()=>a,wA:()=>i});var r=n(74444);class i{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const s="[DEFAULT]";class o{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const e=new r.BH;if(this.instancesDeferred.set(t,e),this.isInitialized(t)||this.shouldAutoInitialize())try{const n=this.getOrInitializeService({instanceIdentifier:t});n&&e.resolve(n)}catch(e){}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const n=this.normalizeInstanceIdentifier(null==e?void 0:e.identifier),r=null!==(t=null==e?void 0:e.optional)&&void 0!==t&&t;if(!this.isInitialized(n)&&!this.shouldAutoInitialize()){if(r)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:n})}catch(e){if(r)return null;throw e}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,this.shouldAutoInitialize()){if(function(e){return"EAGER"===e.instantiationMode}(e))try{this.getOrInitializeService({instanceIdentifier:s})}catch(e){}for(const[e,t]of this.instancesDeferred.entries()){const n=this.normalizeInstanceIdentifier(e);try{const e=this.getOrInitializeService({instanceIdentifier:n});t.resolve(e)}catch(e){}}}}clearInstance(e="[DEFAULT]"){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter((e=>"INTERNAL"in e)).map((e=>e.INTERNAL.delete())),...e.filter((e=>"_delete"in e)).map((e=>e._delete()))])}isComponentSet(){return null!=this.component}isInitialized(e="[DEFAULT]"){return this.instances.has(e)}getOptions(e="[DEFAULT]"){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,n=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const r=this.getOrInitializeService({instanceIdentifier:n,options:t});for(const[e,t]of this.instancesDeferred.entries())n===this.normalizeInstanceIdentifier(e)&&t.resolve(r);return r}onInit(e,t){var n;const r=this.normalizeInstanceIdentifier(t),i=null!==(n=this.onInitCallbacks.get(r))&&void 0!==n?n:new Set;i.add(e),this.onInitCallbacks.set(r,i);const s=this.instances.get(r);return s&&e(s,r),()=>{i.delete(e)}}invokeOnInitCallbacks(e,t){const n=this.onInitCallbacks.get(t);if(n)for(const r of n)try{r(e,t)}catch(e){}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let n=this.instances.get(e);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:(r=e,r===s?void 0:r),options:t}),this.instances.set(e,n),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(n,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,n)}catch(e){}var r;return n||null}normalizeInstanceIdentifier(e="[DEFAULT]"){return this.component?this.component.multipleInstances?e:s:e}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class a{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new o(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}},53333:(e,t,n)=>{n.d(t,{Am:()=>h,Ub:()=>l,Yd:()=>u,in:()=>i});const r=[];var i;!function(e){e[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT"}(i||(i={}));const s={debug:i.DEBUG,verbose:i.VERBOSE,info:i.INFO,warn:i.WARN,error:i.ERROR,silent:i.SILENT},o=i.INFO,a={[i.DEBUG]:"log",[i.VERBOSE]:"log",[i.INFO]:"info",[i.WARN]:"warn",[i.ERROR]:"error"},c=(e,t,...n)=>{if(t<e.logLevel)return;const r=(new Date).toISOString(),i=a[t];if(!i)throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`);console[i](`[${r}]  ${e.name}:`,...n)};class u{constructor(e){this.name=e,this._logLevel=o,this._logHandler=c,this._userLogHandler=null,r.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in i))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"==typeof e?s[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!=typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,i.DEBUG,...e),this._logHandler(this,i.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,i.VERBOSE,...e),this._logHandler(this,i.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,i.INFO,...e),this._logHandler(this,i.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,i.WARN,...e),this._logHandler(this,i.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,i.ERROR,...e),this._logHandler(this,i.ERROR,...e)}}function l(e){r.forEach((t=>{t.setLogLevel(e)}))}function h(e,t){for(const n of r){let r=null;t&&t.level&&(r=s[t.level]),n.userLogHandler=null===e?null:(t,n,...s)=>{const o=s.map((e=>{if(null==e)return null;if("string"==typeof e)return e;if("number"==typeof e||"boolean"==typeof e)return e.toString();if(e instanceof Error)return e.message;try{return JSON.stringify(e)}catch(e){return null}})).filter((e=>e)).join(" ");n>=(null!=r?r:t.logLevel)&&e({level:i[n].toLowerCase(),message:o,args:s,type:t.name})}}}}}]);